# SQL:1999åˆ°SQL:2011æ ‡å‡†

> **åˆ›å»ºæ—¥æœŸ**ï¼š2025-01-15
> **æœ€åŽæ›´æ–°**ï¼š2025-01-15
> **ç‰ˆæœ¬**ï¼šv1.0.0
> **éš¾åº¦**ï¼šâ­â­â­
> **åº”ç”¨åœºæ™¯**ï¼šSQLæ ‡å‡†å­¦ä¹ ã€ç‰¹æ€§æ¼”è¿›ç†è§£

---

## ðŸ“‹ ç›®å½•

- [SQL:1999åˆ°SQL:2011æ ‡å‡†](#sql1999åˆ°sql2011æ ‡å‡†)
  - [ðŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ä¸€ã€æ¦‚è¿°](#ä¸€æ¦‚è¿°)
    - [1.1 SQLæ ‡å‡†æ¼”è¿›çŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾](#11-sqlæ ‡å‡†æ¼”è¿›çŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾)
    - [1.2 SQLæ ‡å‡†ç‰ˆæœ¬æ¼”è¿›å¯¹æ¯”çŸ©é˜µ](#12-sqlæ ‡å‡†ç‰ˆæœ¬æ¼”è¿›å¯¹æ¯”çŸ©é˜µ)
  - [äºŒã€SQL:1999æ ‡å‡†](#äºŒsql1999æ ‡å‡†)
    - [2.1 ä¸»è¦ç‰¹æ€§](#21-ä¸»è¦ç‰¹æ€§)
    - [2.2 é€’å½’æŸ¥è¯¢](#22-é€’å½’æŸ¥è¯¢)
    - [2.2.1 åœºæ™¯ç¤ºä¾‹ï¼šç»„ç»‡æž¶æž„å±‚æ¬¡æŸ¥è¯¢](#221-åœºæ™¯ç¤ºä¾‹ç»„ç»‡æž¶æž„å±‚æ¬¡æŸ¥è¯¢)
    - [2.3 å­˜å‚¨è¿‡ç¨‹](#23-å­˜å‚¨è¿‡ç¨‹)
    - [2.3.1 åœºæ™¯ç¤ºä¾‹ï¼šå­¦ç”Ÿä¿¡æ¯æŸ¥è¯¢å­˜å‚¨è¿‡ç¨‹](#231-åœºæ™¯ç¤ºä¾‹å­¦ç”Ÿä¿¡æ¯æŸ¥è¯¢å­˜å‚¨è¿‡ç¨‹)
  - [ä¸‰ã€SQL:2003æ ‡å‡†](#ä¸‰sql2003æ ‡å‡†)
    - [3.1 ä¸»è¦ç‰¹æ€§](#31-ä¸»è¦ç‰¹æ€§)
    - [3.2 çª—å£å‡½æ•°](#32-çª—å£å‡½æ•°)
    - [3.2.1 åœºæ™¯ç¤ºä¾‹ï¼šå­¦ç”Ÿæˆç»©æŽ’ååˆ†æž](#321-åœºæ™¯ç¤ºä¾‹å­¦ç”Ÿæˆç»©æŽ’ååˆ†æž)
    - [3.3 MERGEè¯­å¥](#33-mergeè¯­å¥)
    - [3.3.1 åœºæ™¯ç¤ºä¾‹ï¼šå­¦ç”Ÿæ•°æ®åŒæ­¥](#331-åœºæ™¯ç¤ºä¾‹å­¦ç”Ÿæ•°æ®åŒæ­¥)
  - [å››ã€SQL:2008æ ‡å‡†](#å››sql2008æ ‡å‡†)
    - [4.1 ä¸»è¦ç‰¹æ€§](#41-ä¸»è¦ç‰¹æ€§)
    - [4.2 TRUNCATE TABLE](#42-truncate-table)
    - [4.3 FETCH FIRST](#43-fetch-first)
  - [äº”ã€SQL:2011æ ‡å‡†](#äº”sql2011æ ‡å‡†)
    - [5.1 ä¸»è¦ç‰¹æ€§](#51-ä¸»è¦ç‰¹æ€§)
    - [5.2 æ—¶æ€è¡¨](#52-æ—¶æ€è¡¨)
    - [5.2.1 åœºæ™¯ç¤ºä¾‹ï¼šå‘˜å·¥è–ªèµ„åŽ†å²ç®¡ç†](#521-åœºæ™¯ç¤ºä¾‹å‘˜å·¥è–ªèµ„åŽ†å²ç®¡ç†)
    - [5.3 æ—¶æ€æŸ¥è¯¢](#53-æ—¶æ€æŸ¥è¯¢)
    - [5.3.1 åœºæ™¯ç¤ºä¾‹ï¼šåŽ†å²æ•°æ®æŸ¥è¯¢](#531-åœºæ™¯ç¤ºä¾‹åŽ†å²æ•°æ®æŸ¥è¯¢)
  - [å…­ã€ç‰ˆæœ¬æ¼”è¿›å¯¹æ¯”](#å…­ç‰ˆæœ¬æ¼”è¿›å¯¹æ¯”)
  - [ä¸ƒã€ç›¸å…³èµ„æº](#ä¸ƒç›¸å…³èµ„æº)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)

---

## ä¸€ã€æ¦‚è¿°

æœ¬æ–‡æ¡£ä»‹ç»SQL:1999åˆ°SQL:2011æ ‡å‡†çš„ä¸»è¦ç‰¹æ€§å’Œæ¼”è¿›ï¼Œè¿™äº›ç‰ˆæœ¬åœ¨SQL-92åŸºç¡€ä¸Šå¼•å…¥äº†è®¸å¤šé‡è¦ç‰¹æ€§ã€‚

**ç‰ˆæœ¬æ—¶é—´çº¿**ï¼š

- SQL:1999 - 1999å¹´
- SQL:2003 - 2003å¹´
- SQL:2008 - 2008å¹´
- SQL:2011 - 2011å¹´

### 1.1 SQLæ ‡å‡†æ¼”è¿›çŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((SQLæ ‡å‡†æ¼”è¿›))
    SQL:1999
      é€’å½’æŸ¥è¯¢
        WITH RECURSIVE
        å±‚æ¬¡ç»“æž„
      å…¬å…±è¡¨è¡¨è¾¾å¼
        WITH CTE
        æŸ¥è¯¢ç®€åŒ–
      å­˜å‚¨è¿‡ç¨‹
        CREATE PROCEDURE
        ä¸šåŠ¡é€»è¾‘å°è£…
      è§¦å‘å™¨
        CREATE TRIGGER
        è‡ªåŠ¨æ‰§è¡Œ
    SQL:2003
      çª—å£å‡½æ•°
        OVERå­å¥
        æŽ’åç»Ÿè®¡
      MERGEè¯­å¥
        UPSERTæ“ä½œ
        æ•°æ®åŒæ­¥
      åºåˆ—
        CREATE SEQUENCE
        è‡ªå¢žåºåˆ—
    SQL:2008
      TRUNCATE TABLE
        å¿«é€Ÿæ¸…ç©º
        æ€§èƒ½ä¼˜åŒ–
      FETCH FIRST
        åˆ†é¡µæŸ¥è¯¢
        TOP NæŸ¥è¯¢
    SQL:2011
      æ—¶æ€è¡¨
        SYSTEM VERSIONING
        åŽ†å²æ•°æ®ç®¡ç†
      æ—¶æ€æŸ¥è¯¢
        AS OF
        BETWEEN
```

### 1.2 SQLæ ‡å‡†ç‰ˆæœ¬æ¼”è¿›å¯¹æ¯”çŸ©é˜µ

| ç‰¹æ€§ | SQL:1999 | SQL:2003 | SQL:2008 | SQL:2011 | æ¼”è¿›è¶‹åŠ¿ |
|------|----------|----------|----------|----------|---------|
| **é€’å½’æŸ¥è¯¢** | âœ… æ–°å¢ž | âœ… | âœ… | âœ… | ç¨³å®š |
| **CTE** | âœ… æ–°å¢ž | âœ… | âœ… | âœ… | ç¨³å®š |
| **çª—å£å‡½æ•°** | âŒ | âœ… æ–°å¢ž | âœ… | âœ… | å¢žå¼º |
| **MERGE** | âŒ | âœ… æ–°å¢ž | âœ… | âœ… | ç¨³å®š |
| **æ—¶æ€æ•°æ®** | âŒ | âŒ | âŒ | âœ… æ–°å¢ž | æ–°å¢ž |
| **TRUNCATE** | âŒ | âŒ | âœ… æ–°å¢ž | âœ… | ç¨³å®š |
| **FETCH FIRST** | âŒ | âŒ | âœ… æ–°å¢ž | âœ… | ç¨³å®š |

---

## äºŒã€SQL:1999æ ‡å‡†

### 2.1 ä¸»è¦ç‰¹æ€§

**SQL:1999æ ¸å¿ƒç‰¹æ€§**ï¼š

1. âœ… **é€’å½’æŸ¥è¯¢ï¼ˆWITH RECURSIVEï¼‰**
2. âœ… **å…¬å…±è¡¨è¡¨è¾¾å¼ï¼ˆCTEï¼‰**
3. âœ… **è§¦å‘å™¨ï¼ˆTriggersï¼‰**
4. âœ… **å­˜å‚¨è¿‡ç¨‹ï¼ˆStored Proceduresï¼‰**
5. âœ… **ç”¨æˆ·å®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰**
6. âœ… **å¯¹è±¡å…³ç³»æ”¯æŒ**
7. âœ… **æ•°ç»„å’Œé›†åˆç±»åž‹**

### 2.2 é€’å½’æŸ¥è¯¢

**WITH RECURSIVEè¯­æ³•**ï¼š

```sql
WITH RECURSIVE cte_name AS (
    -- åŸºç¡€æŸ¥è¯¢
    SELECT ...
    UNION ALL
    -- é€’å½’æŸ¥è¯¢
    SELECT ... FROM cte_name WHERE ...
)
SELECT * FROM cte_name;
```

### 2.2.1 åœºæ™¯ç¤ºä¾‹ï¼šç»„ç»‡æž¶æž„å±‚æ¬¡æŸ¥è¯¢

**ä¸šåŠ¡éœ€æ±‚**ï¼šæŸ¥è¯¢å®Œæ•´çš„ç»„ç»‡æž¶æž„æ ‘ï¼ŒåŒ…æ‹¬æ‰€æœ‰å±‚çº§å…³ç³»ã€‚

**æ•°æ®æ¨¡åž‹**ï¼š

```mermaid
erDiagram
    Organization ||--o{ Organization : "parent"
    Organization {
        int org_id PK
        string org_name
        int parent_id FK
        string org_type
    }
```

**é€’å½’æŸ¥è¯¢å®žçŽ°**ï¼š

```sql
WITH RECURSIVE org_tree AS (
    -- åŸºç¡€æŸ¥è¯¢ï¼šæ ¹èŠ‚ç‚¹
    SELECT
        org_id,
        org_name,
        parent_id,
        0 as level,
        CAST(org_name AS VARCHAR(1000)) as path
    FROM Organization
    WHERE parent_id IS NULL

    UNION ALL

    -- é€’å½’æŸ¥è¯¢ï¼šå­èŠ‚ç‚¹
    SELECT
        o.org_id,
        o.org_name,
        o.parent_id,
        ot.level + 1,
        ot.path || ' > ' || o.org_name
    FROM Organization o
    JOIN org_tree ot ON o.parent_id = ot.org_id
    WHERE ot.level < 10
)
SELECT * FROM org_tree ORDER BY path;
```

### 2.3 å­˜å‚¨è¿‡ç¨‹

**å­˜å‚¨è¿‡ç¨‹ç¤ºä¾‹**ï¼š

```sql
CREATE PROCEDURE get_student(IN student_id INTEGER)
BEGIN
    SELECT * FROM Student WHERE id = student_id;
END;
```

### 2.3.1 åœºæ™¯ç¤ºä¾‹ï¼šå­¦ç”Ÿä¿¡æ¯æŸ¥è¯¢å­˜å‚¨è¿‡ç¨‹

**ä¸šåŠ¡éœ€æ±‚**ï¼šåˆ›å»ºå­˜å‚¨è¿‡ç¨‹æŸ¥è¯¢å­¦ç”ŸåŠå…¶é€‰è¯¾ä¿¡æ¯ã€‚

**å­˜å‚¨è¿‡ç¨‹å®žçŽ°**ï¼š

```sql
CREATE PROCEDURE get_student_with_courses(
    IN p_student_id INTEGER
)
BEGIN
    SELECT
        s.student_id,
        s.name,
        s.major,
        c.course_name,
        e.score,
        e.enroll_date
    FROM Student s
    LEFT JOIN Enrollment e ON s.student_id = e.student_id
    LEFT JOIN Course c ON e.course_id = c.course_id
    WHERE s.student_id = p_student_id;
END;

-- è°ƒç”¨å­˜å‚¨è¿‡ç¨‹
CALL get_student_with_courses(1);
```

---

## ä¸‰ã€SQL:2003æ ‡å‡†

### 3.1 ä¸»è¦ç‰¹æ€§

**SQL:2003æ ¸å¿ƒç‰¹æ€§**ï¼š

1. âœ… **çª—å£å‡½æ•°ï¼ˆWindow Functionsï¼‰**
2. âœ… **MERGEè¯­å¥**
3. âœ… **åºåˆ—ï¼ˆSEQUENCESï¼‰**
4. âœ… **XMLæ”¯æŒ**
5. âœ… **å¤šæ€å‡½æ•°**

### 3.2 çª—å£å‡½æ•°

**çª—å£å‡½æ•°ç¤ºä¾‹**ï¼š

```sql
SELECT
    student_id,
    score,
    ROW_NUMBER() OVER (PARTITION BY class ORDER BY score DESC) as rank
FROM Scores;
```

### 3.2.1 åœºæ™¯ç¤ºä¾‹ï¼šå­¦ç”Ÿæˆç»©æŽ’ååˆ†æž

**ä¸šåŠ¡éœ€æ±‚**ï¼šè®¡ç®—æ¯é—¨è¯¾ç¨‹çš„å­¦ç”ŸæŽ’åï¼Œå¹¶åˆ†æžæˆç»©åˆ†å¸ƒã€‚

**çª—å£å‡½æ•°å®žçŽ°**ï¼š

```sql
SELECT
    course_id,
    student_id,
    score,
    ROW_NUMBER() OVER (PARTITION BY course_id ORDER BY score DESC) as rank,
    RANK() OVER (PARTITION BY course_id ORDER BY score DESC) as rank_with_ties,
    DENSE_RANK() OVER (PARTITION BY course_id ORDER BY score DESC) as dense_rank,
    AVG(score) OVER (PARTITION BY course_id) as avg_score,
    MAX(score) OVER (PARTITION BY course_id) as max_score,
    MIN(score) OVER (PARTITION BY course_id) as min_score
FROM Enrollment
ORDER BY course_id, rank;
```

### 3.3 MERGEè¯­å¥

**MERGEè¯­å¥ç¤ºä¾‹**ï¼š

```sql
MERGE INTO Student AS target
USING NewStudent AS source
ON target.id = source.id
WHEN MATCHED THEN
    UPDATE SET name = source.name
WHEN NOT MATCHED THEN
    INSERT (id, name) VALUES (source.id, source.name);
```

### 3.3.1 åœºæ™¯ç¤ºä¾‹ï¼šå­¦ç”Ÿæ•°æ®åŒæ­¥

**ä¸šåŠ¡éœ€æ±‚**ï¼šä»Žå¤–éƒ¨ç³»ç»ŸåŒæ­¥å­¦ç”Ÿæ•°æ®ï¼Œå­˜åœ¨åˆ™æ›´æ–°ï¼Œä¸å­˜åœ¨åˆ™æ’å…¥ã€‚

**MERGEå®žçŽ°**ï¼š

```sql
MERGE INTO Student AS target
USING ExternalStudent AS source
ON target.student_id = source.student_id
WHEN MATCHED THEN
    UPDATE SET
        name = source.name,
        age = source.age,
        major = source.major,
        email = source.email,
        update_time = CURRENT_TIMESTAMP
WHEN NOT MATCHED THEN
    INSERT (student_id, name, age, major, email, create_time)
    VALUES (source.student_id, source.name, source.age,
            source.major, source.email, CURRENT_TIMESTAMP);
```

---

## å››ã€SQL:2008æ ‡å‡†

### 4.1 ä¸»è¦ç‰¹æ€§

**SQL:2008æ ¸å¿ƒç‰¹æ€§**ï¼š

1. âœ… **INSTEAD OFè§¦å‘å™¨**
2. âœ… **TRUNCATE TABLE**
3. âœ… **FETCH FIRSTå­å¥**
4. âœ… **æ—¶æ€æ•°æ®æ”¯æŒå¢žå¼º**

### 4.2 TRUNCATE TABLE

**TRUNCATE TABLEè¯­æ³•**ï¼š

```sql
TRUNCATE TABLE table_name;
```

### 4.3 FETCH FIRST

**FETCH FIRSTè¯­æ³•**ï¼š

```sql
SELECT * FROM Student
ORDER BY score DESC
FETCH FIRST 10 ROWS ONLY;
```

---

## äº”ã€SQL:2011æ ‡å‡†

### 5.1 ä¸»è¦ç‰¹æ€§

**SQL:2011æ ¸å¿ƒç‰¹æ€§**ï¼š

1. âœ… **æ—¶æ€æ•°æ®ï¼ˆTemporal Dataï¼‰**
2. âœ… **æ—¶æ€è¡¨ï¼ˆTemporal Tablesï¼‰**
3. âœ… **æ—¶æ€æŸ¥è¯¢ï¼ˆTemporal Queriesï¼‰**
4. âœ… **æ•°æ®å˜æ›´è·Ÿè¸ª**

### 5.2 æ—¶æ€è¡¨

**æ—¶æ€è¡¨ç¤ºä¾‹**ï¼š

```sql
CREATE TABLE Employee (
    id INTEGER,
    name VARCHAR(50),
    salary DECIMAL(10,2),
    PERIOD FOR SYSTEM_TIME (start_time, end_time)
) WITH SYSTEM VERSIONING;
```

### 5.2.1 åœºæ™¯ç¤ºä¾‹ï¼šå‘˜å·¥è–ªèµ„åŽ†å²ç®¡ç†

**ä¸šåŠ¡éœ€æ±‚**ï¼šè·Ÿè¸ªå‘˜å·¥è–ªèµ„å˜æ›´åŽ†å²ï¼Œæ”¯æŒæŸ¥è¯¢ä»»æ„æ—¶é—´ç‚¹çš„è–ªèµ„ä¿¡æ¯ã€‚

**æ—¶æ€è¡¨å®žçŽ°**ï¼š

```sql
-- åˆ›å»ºæ—¶æ€è¡¨
CREATE TABLE Employee (
    employee_id INTEGER PRIMARY KEY,
    name VARCHAR(50),
    department VARCHAR(50),
    salary DECIMAL(10,2),
    PERIOD FOR SYSTEM_TIME (start_time, end_time)
) WITH SYSTEM VERSIONING;

-- æ’å…¥æ•°æ®
INSERT INTO Employee (employee_id, name, department, salary)
VALUES (1, 'Alice', 'Engineering', 50000);

-- æ›´æ–°è–ªèµ„ï¼ˆç³»ç»Ÿè‡ªåŠ¨åˆ›å»ºåŽ†å²è®°å½•ï¼‰
UPDATE Employee
SET salary = 55000
WHERE employee_id = 1;
```

### 5.3 æ—¶æ€æŸ¥è¯¢

**æ—¶æ€æŸ¥è¯¢ç¤ºä¾‹**ï¼š

```sql
SELECT * FROM Employee
FOR SYSTEM_TIME AS OF '2023-01-01';
```

### 5.3.1 åœºæ™¯ç¤ºä¾‹ï¼šåŽ†å²æ•°æ®æŸ¥è¯¢

**ä¸šåŠ¡éœ€æ±‚**ï¼šæŸ¥è¯¢å‘˜å·¥åœ¨ç‰¹å®šæ—¶é—´ç‚¹çš„è–ªèµ„ä¿¡æ¯ï¼Œä»¥åŠè–ªèµ„å˜æ›´åŽ†å²ã€‚

**æ—¶æ€æŸ¥è¯¢å®žçŽ°**ï¼š

```sql
-- æŸ¥è¯¢2023-01-01çš„è–ªèµ„
SELECT
    employee_id,
    name,
    salary
FROM Employee
FOR SYSTEM_TIME AS OF '2023-01-01'
WHERE employee_id = 1;

-- æŸ¥è¯¢2023å¹´å…¨å¹´çš„è–ªèµ„å˜æ›´
SELECT
    employee_id,
    name,
    salary,
    start_time,
    end_time
FROM Employee
FOR SYSTEM_TIME BETWEEN '2023-01-01' AND '2023-12-31'
WHERE employee_id = 1
ORDER BY start_time;
```

---

## å…­ã€ç‰ˆæœ¬æ¼”è¿›å¯¹æ¯”

| ç‰¹æ€§ | SQL:1999 | SQL:2003 | SQL:2008 | SQL:2011 |
|------|----------|----------|----------|----------|
| **é€’å½’æŸ¥è¯¢** | âœ… | âœ… | âœ… | âœ… |
| **CTE** | âœ… | âœ… | âœ… | âœ… |
| **çª—å£å‡½æ•°** | âŒ | âœ… | âœ… | âœ… |
| **MERGEè¯­å¥** | âŒ | âœ… | âœ… | âœ… |
| **æ—¶æ€æ•°æ®** | âŒ | âŒ | âš ï¸ | âœ… |
| **XMLæ”¯æŒ** | âŒ | âœ… | âœ… | âœ… |

---

## ä¸ƒã€ç›¸å…³èµ„æº

### ç›¸å…³æ–‡æ¡£

- [SQLæ ‡å‡†æ¼”è¿›åŽ†å²](./02.01-SQLæ ‡å‡†æ¼”è¿›åŽ†å².md) - SQLæ ‡å‡†å‘å±•åŽ†ç¨‹
- [SQL-92æ ‡å‡†è¯¦è§£](./02.02-SQL-92æ ‡å‡†è¯¦è§£.md) - SQL-92æ ‡å‡†
- [SQL:2016æ ‡å‡†è¯¦è§£](./02.04-SQL-2016æ ‡å‡†è¯¦è§£.md) - SQL:2016æ ‡å‡†
- [SQLæ ‡å‡†ç‰ˆæœ¬å¯¹æ¯”çŸ©é˜µ](./02.06-SQLæ ‡å‡†ç‰ˆæœ¬å¯¹æ¯”çŸ©é˜µ.md) - ç‰ˆæœ¬å¯¹æ¯”

---

**ç»´æŠ¤è€…**: SQL Standards Team
**æœ€åŽæ›´æ–°**: 2025-01-15
