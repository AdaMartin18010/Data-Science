# JSONæ”¯æŒè¯¦è§£

> **åˆ›å»ºæ—¥æœŸ**ï¼š2025-01-15
> **æœ€åæ›´æ–°**ï¼š2025-12-01
> **ç‰ˆæœ¬**ï¼šv2.0.0
> **æ ‡å‡†ç‰ˆæœ¬**ï¼šSQL:2016, SQL:2023
> **éš¾åº¦**ï¼šâ­â­â­â­
> **åº”ç”¨åœºæ™¯**ï¼šJSONæ•°æ®å¤„ç†ã€åŠç»“æ„åŒ–æ•°æ®å­˜å‚¨ã€ç°ä»£åº”ç”¨é›†æˆã€RAGç³»ç»Ÿ

---

## ğŸ“‹ ç›®å½•

- [JSONæ”¯æŒè¯¦è§£](#jsonæ”¯æŒè¯¦è§£)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ä¸€ã€æ¦‚è¿°](#ä¸€æ¦‚è¿°)
    - [1.0 JSONæ”¯æŒå†å²èƒŒæ™¯](#10-jsonæ”¯æŒå†å²èƒŒæ™¯)
    - [1.1 JSONæ”¯æŒçŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾](#11-jsonæ”¯æŒçŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾)
    - [1.2 JSONæ“ä½œé€‰æ‹©å†³ç­–æ ‘](#12-jsonæ“ä½œé€‰æ‹©å†³ç­–æ ‘)
    - [1.3 JSONå‡½æ•°å¯¹æ¯”çŸ©é˜µ](#13-jsonå‡½æ•°å¯¹æ¯”çŸ©é˜µ)
  - [äºŒã€JSONæ•°æ®ç±»å‹](#äºŒjsonæ•°æ®ç±»å‹)
    - [2.1 JSONç±»å‹](#21-jsonç±»å‹)
  - [ä¸‰ã€JSONå‡½æ•°](#ä¸‰jsonå‡½æ•°)
    - [3.1 JSONå‡½æ•°åˆ—è¡¨](#31-jsonå‡½æ•°åˆ—è¡¨)
  - [å››ã€JSONæŸ¥è¯¢](#å››jsonæŸ¥è¯¢)
    - [4.1 JSONæŸ¥è¯¢ç¤ºä¾‹](#41-jsonæŸ¥è¯¢ç¤ºä¾‹)
    - [4.3 åœºæ™¯ç¤ºä¾‹2ï¼šç”¨æˆ·é…ç½®ç³»ç»Ÿ - ç”¨æˆ·åå¥½æŸ¥è¯¢](#43-åœºæ™¯ç¤ºä¾‹2ç”¨æˆ·é…ç½®ç³»ç»Ÿ---ç”¨æˆ·åå¥½æŸ¥è¯¢)
  - [äº”ã€JSONç´¢å¼•](#äº”jsonç´¢å¼•)
    - [5.1 JSONç´¢å¼•](#51-jsonç´¢å¼•)
  - [å…­ã€2025 JSONæ–°ç‰¹æ€§ä¸AIé›†æˆ](#å…­2025-jsonæ–°ç‰¹æ€§ä¸aié›†æˆ)
    - [6.1 JSONB + å‘é‡èåˆæŸ¥è¯¢](#61-jsonb--å‘é‡èåˆæŸ¥è¯¢)
    - [6.2 JSON SchemaéªŒè¯](#62-json-schemaéªŒè¯)
    - [6.3 JSONèšåˆä¸RAGä¸Šä¸‹æ–‡æ„å»º](#63-jsonèšåˆä¸ragä¸Šä¸‹æ–‡æ„å»º)
    - [6.4 2025 JSONç‰¹æ€§å¯¹æ¯”çŸ©é˜µ](#64-2025-jsonç‰¹æ€§å¯¹æ¯”çŸ©é˜µ)
    - [6.5 JSON + å‘é‡æ£€ç´¢æ¶æ„](#65-json--å‘é‡æ£€ç´¢æ¶æ„)
  - [ä¸ƒã€PostgreSQL 18 JSONæ–°ç‰¹æ€§ ğŸ†•](#ä¸ƒpostgresql-18-jsonæ–°ç‰¹æ€§-)
    - [7.1 JSONè·¯å¾„æŸ¥è¯¢å¢å¼º](#71-jsonè·¯å¾„æŸ¥è¯¢å¢å¼º)
    - [7.2 JSONBèšåˆä¼˜åŒ–](#72-jsonbèšåˆä¼˜åŒ–)
  - [å…«ã€SQLite 3.45+ JSONç‰¹æ€§ ğŸ†•](#å…«sqlite-345-jsonç‰¹æ€§-)
    - [8.1 JSONæ“ä½œç¬¦å¢å¼º](#81-jsonæ“ä½œç¬¦å¢å¼º)
    - [8.2 JSONä¸å…¨æ–‡æœç´¢ç»“åˆ](#82-jsonä¸å…¨æ–‡æœç´¢ç»“åˆ)
  - [ä¹ã€ç›¸å…³èµ„æº](#ä¹ç›¸å…³èµ„æº)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)
    - [å¤–éƒ¨èµ„æº](#å¤–éƒ¨èµ„æº)

---

## ä¸€ã€æ¦‚è¿°

**JSONæ”¯æŒ**æ˜¯SQL:2016å¼•å…¥çš„é‡è¦ç‰¹æ€§ï¼Œå…è®¸åœ¨SQLä¸­å­˜å‚¨å’ŒæŸ¥è¯¢JSONæ•°æ®ã€‚

**JSONæ”¯æŒç‰ˆæœ¬**ï¼š

- SQL:2016ï¼šåŸºç¡€JSONæ”¯æŒ
- SQL:2023ï¼šå¢å¼ºJSONæ”¯æŒï¼ˆJSON_TABLEç­‰ï¼‰

### 1.0 JSONæ”¯æŒå†å²èƒŒæ™¯

**JSONæ”¯æŒçš„å‘å±•å†ç¨‹**ï¼š

- **SQL:2016**ï¼šæ­£å¼å¼•å…¥JSONæ”¯æŒï¼ŒåŒ…æ‹¬JSONæ•°æ®ç±»å‹ã€JSONå‡½æ•°ï¼ˆJSON_VALUEã€JSON_QUERYã€JSON_EXISTSç­‰ï¼‰
- **SQL:2023**ï¼šå¢å¼ºäº†JSONæ”¯æŒï¼Œæ·»åŠ äº†JSON_TABLEå‡½æ•°ã€æ”¹è¿›äº†JSON_OBJECTå’ŒJSON_ARRAYå‡½æ•°

**JSONæ”¯æŒçš„è®¾è®¡åŠ¨æœº**ï¼š

JSONæ”¯æŒçš„è®¾è®¡æ˜¯ä¸ºäº†è§£å†³ä¼ ç»ŸSQLåœ¨å¤„ç†åŠç»“æ„åŒ–æ•°æ®æ—¶çš„å±€é™æ€§ï¼š

1. **åŠç»“æ„åŒ–æ•°æ®éœ€æ±‚**ï¼šç°ä»£åº”ç”¨éœ€è¦å¤„ç†JSONã€XMLç­‰åŠç»“æ„åŒ–æ•°æ®
2. **NoSQLé›†æˆéœ€æ±‚**ï¼šéœ€è¦ä¸NoSQLæ•°æ®åº“é›†æˆï¼Œå¤„ç†JSONæ–‡æ¡£
3. **APIé›†æˆéœ€æ±‚**ï¼šREST APIé€šå¸¸ä½¿ç”¨JSONæ ¼å¼ï¼Œéœ€è¦åœ¨æ•°æ®åº“ä¸­å­˜å‚¨å’ŒæŸ¥è¯¢JSONæ•°æ®
4. **çµæ´»æ•°æ®æ¨¡å‹éœ€æ±‚**ï¼šæŸäº›åœºæ™¯éœ€è¦çµæ´»çš„æ•°æ®æ¨¡å‹ï¼ŒJSONæä¾›äº†è¿™ç§çµæ´»æ€§

**JSONæ”¯æŒä¸å…³ç³»æ¨¡å‹çš„å…³ç³»**ï¼š

JSONæ”¯æŒæ‰©å±•äº†å…³ç³»æ¨¡å‹ï¼Œå…è®¸åœ¨å…³ç³»è¡¨ä¸­å­˜å‚¨å’ŒæŸ¥è¯¢JSONæ•°æ®ã€‚JSONå¯ä»¥çœ‹ä½œæ˜¯å…³ç³»æ¨¡å‹çš„ä¸€ç§æ‰©å±•ï¼Œæä¾›äº†å¤„ç†åŠç»“æ„åŒ–æ•°æ®çš„èƒ½åŠ›ã€‚

### 1.1 JSONæ”¯æŒçŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((JSONæ”¯æŒ))
    æ•°æ®ç±»å‹
      JSON
        æ–‡æœ¬å­˜å‚¨
        éªŒè¯æ”¯æŒ
      JSONB
        äºŒè¿›åˆ¶å­˜å‚¨
        ç´¢å¼•æ”¯æŒ
        æŸ¥è¯¢ä¼˜åŒ–
    å‡½æ•°æ“ä½œ
      JSON_VALUE
        æå–æ ‡é‡å€¼
        ç±»å‹è½¬æ¢
      JSON_QUERY
        æå–å¯¹è±¡/æ•°ç»„
        ä¿æŒJSONæ ¼å¼
      JSON_EXISTS
        è·¯å¾„å­˜åœ¨æ£€æŸ¥
        æ¡ä»¶è¿‡æ»¤
      JSON_TABLE
        è½¬æ¢ä¸ºå…³ç³»è¡¨
        åˆ—å®šä¹‰
    æ„é€ å‡½æ•°
      JSON_OBJECT
        å¯¹è±¡æ„é€ 
        é”®å€¼å¯¹
      JSON_ARRAY
        æ•°ç»„æ„é€ 
        å…ƒç´ åˆ—è¡¨
    è·¯å¾„è¡¨è¾¾å¼
      JSONPath
        è·¯å¾„è¯­æ³•
        é€šé…ç¬¦
        è¿‡æ»¤å™¨
    åº”ç”¨åœºæ™¯
      åŠç»“æ„åŒ–æ•°æ®
        é…ç½®å­˜å‚¨
        å…ƒæ•°æ®å­˜å‚¨
      æ–‡æ¡£å­˜å‚¨
        NoSQLé›†æˆ
        æ–‡æ¡£æ•°æ®åº“
      APIé›†æˆ
        REST API
        å¾®æœåŠ¡
```

### 1.2 JSONæ“ä½œé€‰æ‹©å†³ç­–æ ‘

```mermaid
flowchart TD
    A[éœ€è¦JSONæ“ä½œ?] --> B{æ“ä½œç±»å‹}
    B -->|æå–å€¼| C{å€¼ç±»å‹}
    B -->|æ£€æŸ¥å­˜åœ¨| D[JSON_EXISTS]
    B -->|è½¬æ¢ä¸ºè¡¨| E[JSON_TABLE]
    B -->|æ„é€ JSON| F{æ„é€ ç±»å‹}

    C -->|æ ‡é‡å€¼| G[JSON_VALUE]
    C -->|å¯¹è±¡/æ•°ç»„| H[JSON_QUERY]

    F -->|å¯¹è±¡| I[JSON_OBJECT]
    F -->|æ•°ç»„| J[JSON_ARRAY]

    G --> K[æ‰§è¡Œæ“ä½œ]
    H --> K
    D --> K
    E --> K
    I --> K
    J --> K
```

### 1.3 JSONå‡½æ•°å¯¹æ¯”çŸ©é˜µ

| å‡½æ•° | è¾“å…¥ | è¾“å‡º | ç”¨é€” | SQLæ ‡å‡†ç‰ˆæœ¬ |
|------|------|------|------|------------|
| **JSON_VALUE** | JSON, Path | æ ‡é‡å€¼ | æå–å•ä¸ªå€¼ | SQL:2016 |
| **JSON_QUERY** | JSON, Path | JSON | æå–JSONç‰‡æ®µ | SQL:2016 |
| **JSON_EXISTS** | JSON, Path | Boolean | æ£€æŸ¥è·¯å¾„å­˜åœ¨ | SQL:2016 |
| **JSON_TABLE** | JSON, Path | å…³ç³»è¡¨ | è½¬æ¢ä¸ºè¡¨ | SQL:2023 |
| **JSON_OBJECT** | é”®å€¼å¯¹ | JSONå¯¹è±¡ | æ„é€ å¯¹è±¡ | SQL:2016 |
| **JSON_ARRAY** | å€¼åˆ—è¡¨ | JSONæ•°ç»„ | æ„é€ æ•°ç»„ | SQL:2016 |

---

## äºŒã€JSONæ•°æ®ç±»å‹

### 2.1 JSONç±»å‹

**JSONç±»å‹å®šä¹‰**ï¼š

```sql
CREATE TABLE products (
    id INTEGER,
    name VARCHAR(100),
    attributes JSON
);
```

---

## ä¸‰ã€JSONå‡½æ•°

### 3.1 JSONå‡½æ•°åˆ—è¡¨

**JSONå‡½æ•°**ï¼š

- JSON_VALUE()ï¼šæå–JSONå€¼
- JSON_QUERY()ï¼šæå–JSONå¯¹è±¡
- JSON_EXISTS()ï¼šæ£€æŸ¥JSONè·¯å¾„
- JSON_OBJECT()ï¼šåˆ›å»ºJSONå¯¹è±¡
- JSON_ARRAY()ï¼šåˆ›å»ºJSONæ•°ç»„
- JSON_TABLE()ï¼šå°†JSONè½¬æ¢ä¸ºè¡¨ï¼ˆSQL:2023ï¼‰

---

## å››ã€JSONæŸ¥è¯¢

### 4.1 JSONæŸ¥è¯¢ç¤ºä¾‹

**åœºæ™¯ç¤ºä¾‹1ï¼šç”µå•†ç³»ç»Ÿ - å•†å“å±æ€§æŸ¥è¯¢**:

**ä¸šåŠ¡éœ€æ±‚**ï¼šåœ¨ç”µå•†ç³»ç»Ÿä¸­ï¼Œå•†å“å±æ€§ä»¥JSONæ ¼å¼å­˜å‚¨ï¼Œéœ€è¦æŸ¥è¯¢ç‰¹å®šå±æ€§çš„å•†å“ã€‚

**æ•°æ®æ¨¡å‹**ï¼š

```mermaid
erDiagram
    Product ||--o{ OrderItem : "åŒ…å«"
    Product {
        int product_id PK
        string product_name
        decimal price
        json attributes
    }
    OrderItem {
        int order_id FK
        int product_id FK
        int quantity
    }
```

**ERå›¾è¯´æ˜**ï¼š

- Productè¡¨å­˜å‚¨å•†å“ä¿¡æ¯ï¼Œattributeså­—æ®µä¸ºJSONç±»å‹
- attributesåŒ…å«colorã€sizeã€brandç­‰åŠ¨æ€å±æ€§

**æŸ¥è¯¢ç¤ºä¾‹**ï¼š

```sql
-- æŸ¥è¯¢çº¢è‰²å•†å“
SELECT
    product_id,
    product_name,
    price,
    JSON_VALUE(attributes, '$.color') AS color,
    JSON_VALUE(attributes, '$.size') AS size,
    JSON_QUERY(attributes, '$.specs') AS specs
FROM Product
WHERE JSON_VALUE(attributes, '$.color') = 'red';

-- æŸ¥è¯¢æœ‰æŠ˜æ‰£çš„å•†å“
SELECT
    product_id,
    product_name,
    price,
    JSON_VALUE(attributes, '$.discount') AS discount
FROM Product
WHERE JSON_EXISTS(attributes, '$.discount')
  AND CAST(JSON_VALUE(attributes, '$.discount') AS DECIMAL) > 0.1;
```

### 4.3 åœºæ™¯ç¤ºä¾‹2ï¼šç”¨æˆ·é…ç½®ç³»ç»Ÿ - ç”¨æˆ·åå¥½æŸ¥è¯¢

**ä¸šåŠ¡éœ€æ±‚**ï¼šç”¨æˆ·åå¥½è®¾ç½®ä»¥JSONæ ¼å¼å­˜å‚¨ï¼Œéœ€è¦æŸ¥è¯¢å’Œæ›´æ–°ç”¨æˆ·é…ç½®ã€‚

**æ•°æ®æ¨¡å‹**ï¼š

```mermaid
erDiagram
    User ||--o{ UserPreference : "æ‹¥æœ‰"
    User {
        int user_id PK
        string username
        string email
    }
    UserPreference {
        int user_id FK
        json preferences
    }
```

**æŸ¥è¯¢ç¤ºä¾‹**ï¼š

```sql
-- æŸ¥è¯¢ç”¨æˆ·åå¥½
SELECT
    u.user_id,
    u.username,
    JSON_VALUE(up.preferences, '$.theme') AS theme,
    JSON_VALUE(up.preferences, '$.language') AS language,
    JSON_VALUE(up.preferences, '$.notifications.email') AS email_notification
FROM User u
JOIN UserPreference up ON u.user_id = up.user_id
WHERE JSON_VALUE(up.preferences, '$.theme') = 'dark';

-- æ›´æ–°ç”¨æˆ·åå¥½
UPDATE UserPreference
SET preferences = JSON_MODIFY(
    preferences,
    '$.theme',
    'light'
)
WHERE user_id = 1;
```

**æŸ¥è¯¢æ‰§è¡Œæµç¨‹æ—¶åºå›¾**ï¼š

```mermaid
sequenceDiagram
    participant Client
    participant QueryEngine
    participant JSONParser
    participant Storage

    Client->>QueryEngine: SELECT with JSON_VALUE
    QueryEngine->>Storage: è¯»å–Productè¡¨
    Storage-->>QueryEngine: è¿”å›JSONæ•°æ®
    QueryEngine->>JSONParser: è§£æJSONè·¯å¾„
    JSONParser->>JSONParser: æå–$.colorå€¼
    JSONParser-->>QueryEngine: è¿”å›colorå€¼
    QueryEngine->>QueryEngine: åº”ç”¨WHEREæ¡ä»¶
    QueryEngine-->>Client: è¿”å›ç»“æœé›†
```

---

## äº”ã€JSONç´¢å¼•

### 5.1 JSONç´¢å¼•

**JSONç´¢å¼•**ï¼š

æŸäº›æ•°æ®åº“æ”¯æŒJSONè·¯å¾„ç´¢å¼•ï¼Œæé«˜JSONæŸ¥è¯¢æ€§èƒ½ã€‚

---

## å…­ã€2025 JSONæ–°ç‰¹æ€§ä¸AIé›†æˆ

### 6.1 JSONB + å‘é‡èåˆæŸ¥è¯¢

**PostgreSQL JSONB + pgvector**ï¼š

```sql
-- åˆ›å»ºèåˆè¡¨ï¼šç»“æ„åŒ–å…ƒæ•°æ® + å‘é‡åµŒå…¥
CREATE TABLE rag_documents (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    metadata JSONB NOT NULL DEFAULT '{}',
    content TEXT,
    embedding vector(1536)
);

-- JSONBå…ƒæ•°æ®ç¤ºä¾‹
INSERT INTO rag_documents (metadata, content, embedding) VALUES
('{
    "title": "PostgreSQLå‘é‡æ£€ç´¢",
    "category": "database",
    "tags": ["pgvector", "AI", "RAG"],
    "author": {"name": "å¼ ä¸‰", "email": "zhang@example.com"},
    "created_at": "2025-01-01"
}', 'PostgreSQLæ”¯æŒå‘é‡æ£€ç´¢...', '[0.1, 0.2, ...]'::vector);

-- æ··åˆæŸ¥è¯¢ï¼šJSONè¿‡æ»¤ + å‘é‡æ£€ç´¢
SELECT
    id,
    metadata->>'title' AS title,
    1 - (embedding <=> $1) AS similarity
FROM rag_documents
WHERE metadata->>'category' = 'database'
  AND metadata->'tags' ? 'pgvector'
ORDER BY embedding <=> $1
LIMIT 10;
```

### 6.2 JSON SchemaéªŒè¯

**PostgreSQL CHECKçº¦æŸ**ï¼š

```sql
-- JSON SchemaéªŒè¯å‡½æ•°
CREATE OR REPLACE FUNCTION validate_doc_metadata(doc JSONB)
RETURNS BOOLEAN AS $$
BEGIN
    RETURN (
        doc ? 'title'
        AND doc ? 'category'
        AND jsonb_typeof(doc->'title') = 'string'
        AND jsonb_typeof(doc->'tags') = 'array'
    );
END;
$$ LANGUAGE plpgsql IMMUTABLE;

-- å¸¦éªŒè¯çš„è¡¨
CREATE TABLE validated_documents (
    id UUID PRIMARY KEY,
    metadata JSONB NOT NULL,
    CONSTRAINT valid_metadata CHECK (validate_doc_metadata(metadata))
);
```

### 6.3 JSONèšåˆä¸RAGä¸Šä¸‹æ–‡æ„å»º

**èšåˆJSONæ„å»ºRAGä¸Šä¸‹æ–‡**ï¼š

```sql
-- èšåˆæ£€ç´¢ç»“æœä¸ºRAGä¸Šä¸‹æ–‡
CREATE OR REPLACE FUNCTION build_rag_context(
    query_embedding vector(1536),
    max_chunks INTEGER DEFAULT 5,
    max_tokens INTEGER DEFAULT 4000
) RETURNS JSONB AS $$
DECLARE
    context JSONB;
    total_tokens INTEGER := 0;
BEGIN
    SELECT jsonb_agg(
        jsonb_build_object(
            'chunk_id', id,
            'title', metadata->>'title',
            'content', content,
            'similarity', 1 - (embedding <=> query_embedding)
        )
    )
    INTO context
    FROM (
        SELECT id, metadata, content, embedding
        FROM rag_documents
        ORDER BY embedding <=> query_embedding
        LIMIT max_chunks
    ) sub;

    RETURN jsonb_build_object(
        'chunks', context,
        'total_chunks', jsonb_array_length(context),
        'query_time', NOW()
    );
END;
$$ LANGUAGE plpgsql;

-- ä½¿ç”¨ç¤ºä¾‹
SELECT build_rag_context('[0.1, 0.2, ...]'::vector, 5);
```

### 6.4 2025 JSONç‰¹æ€§å¯¹æ¯”çŸ©é˜µ

| ç‰¹æ€§ | SQL:2016 | SQL:2023 | PostgreSQL 17 | åº”ç”¨åœºæ™¯ |
|------|----------|----------|---------------|---------|
| **JSON_VALUE** | âœ… | âœ… | âœ… | æå–æ ‡é‡å€¼ |
| **JSON_TABLE** | âŒ | âœ… | âœ… | JSONè½¬å…³ç³»è¡¨ |
| **JSONBç´¢å¼•** | - | - | âœ… GIN | é«˜æ•ˆæŸ¥è¯¢ |
| **JSONB + Vector** | - | - | âœ… | RAGç³»ç»Ÿ |
| **JSON Schema** | âŒ | éƒ¨åˆ† | è‡ªå®šä¹‰å‡½æ•° | æ•°æ®éªŒè¯ |
| **JSONèšåˆ** | éƒ¨åˆ† | âœ… | âœ… | æ„å»ºä¸Šä¸‹æ–‡ |

### 6.5 JSON + å‘é‡æ£€ç´¢æ¶æ„

```mermaid
flowchart TB
    subgraph Input["è¾“å…¥å±‚"]
        Q[ç”¨æˆ·æŸ¥è¯¢]
    end

    subgraph Processing["å¤„ç†å±‚"]
        E[Embeddingç”Ÿæˆ]
        F[JSONè¿‡æ»¤æ¡ä»¶]
    end

    subgraph Storage["å­˜å‚¨å±‚"]
        J[(JSONBå…ƒæ•°æ®)]
        V[(VectoråµŒå…¥)]
    end

    subgraph Output["è¾“å‡ºå±‚"]
        R[æ£€ç´¢ç»“æœ]
        C[RAGä¸Šä¸‹æ–‡]
    end

    Q --> E
    Q --> F

    E --> V
    F --> J

    J --> R
    V --> R

    R --> C
```

---

## ä¸ƒã€PostgreSQL 18 JSONæ–°ç‰¹æ€§ ğŸ†•

### 7.1 JSONè·¯å¾„æŸ¥è¯¢å¢å¼º

```sql
-- PostgreSQL 18: jsonb_path_queryå¢å¼º
SELECT
    product_id,
    -- æå–åµŒå¥—æ•°ç»„å…ƒç´ 
    jsonb_path_query(attributes, '$.tags[*] ? (@ like_regex "^sale")') AS sale_tags,
    -- æ•°å€¼è¿‡æ»¤
    jsonb_path_query(attributes, '$.prices[*] ? (@ < 100)') AS low_prices,
    -- å­˜åœ¨æ€§æ£€æŸ¥
    jsonb_path_exists(attributes, '$.discount') AS has_discount
FROM products;

-- JSON_TABLE (SQL:2023æ ‡å‡†)
SELECT p.*, jt.*
FROM products p,
JSON_TABLE(
    p.attributes,
    '$.variants[*]' COLUMNS (
        variant_id INTEGER PATH '$.id',
        variant_name TEXT PATH '$.name',
        variant_price NUMERIC PATH '$.price'
    )
) AS jt;
```

### 7.2 JSONBèšåˆä¼˜åŒ–

```sql
-- PostgreSQL 18: é«˜æ•ˆJSONèšåˆ
SELECT
    category_id,
    jsonb_agg(
        jsonb_build_object(
            'id', product_id,
            'name', name,
            'price', price
        ) ORDER BY price DESC
    ) AS products_json
FROM products
GROUP BY category_id;

-- æ¡ä»¶èšåˆ
SELECT
    jsonb_object_agg(
        name,
        attributes->'specs'
    ) FILTER (WHERE price > 100) AS premium_specs
FROM products;
```

---

## å…«ã€SQLite 3.45+ JSONç‰¹æ€§ ğŸ†•

### 8.1 JSONæ“ä½œç¬¦å¢å¼º

```sql
-- SQLite 3.45+: ->> æ“ä½œç¬¦ï¼ˆè¿”å›æ–‡æœ¬ï¼‰
SELECT
    product_id,
    attributes->>'name' AS name,           -- è¿”å›TEXT
    attributes->'specs'->'weight' AS weight -- è¿”å›JSON
FROM products;

-- json_eachéå†
SELECT
    p.product_id,
    j.key AS spec_name,
    j.value AS spec_value
FROM products p, json_each(p.attributes, '$.specs') j;

-- json_group_arrayèšåˆ
SELECT
    category,
    json_group_array(json_object('id', id, 'name', name)) AS products
FROM products
GROUP BY category;

-- json_validéªŒè¯
SELECT * FROM products WHERE json_valid(attributes);
```

### 8.2 JSONä¸å…¨æ–‡æœç´¢ç»“åˆ

```sql
-- SQLite 3.45+: JSON + FTS5
CREATE VIRTUAL TABLE products_fts USING fts5(
    name,
    description,
    content='products',
    content_rowid='product_id'
);

-- è”åˆæŸ¥è¯¢
SELECT
    p.product_id,
    p.attributes->>'brand' AS brand,
    highlight(products_fts, 0, '<b>', '</b>') AS name_highlight
FROM products p
JOIN products_fts f ON p.product_id = f.rowid
WHERE products_fts MATCH 'laptop';
```

---

## ä¹ã€ç›¸å…³èµ„æº

### ç›¸å…³æ–‡æ¡£

- [SQL:2016æ ‡å‡†è¯¦è§£](../02-SQLæ ‡å‡†æ¼”è¿›/02.04-SQL-2016æ ‡å‡†è¯¦è§£.md)
- [SQL:2023æ ‡å‡†è¯¦è§£](../02-SQLæ ‡å‡†æ¼”è¿›/02.05-SQL-2023æ ‡å‡†è¯¦è§£.md)
- [å¤æ‚æŸ¥è¯¢æ¡ˆä¾‹](../07-å®è·µæ¡ˆä¾‹/07.01-å¤æ‚æŸ¥è¯¢æ¡ˆä¾‹.md) - RAGç³»ç»ŸJSONåº”ç”¨

### å¤–éƒ¨èµ„æº

- [PostgreSQL 18 JSON Functions](https://www.postgresql.org/docs/current/functions-json.html)
- [SQLite JSON1 Extension](https://www.sqlite.org/json1.html)
- [pgvector](https://github.com/pgvector/pgvector)

---

**ç»´æŠ¤è€…**: SQL Standards Team
**æœ€åæ›´æ–°**: 2025-12-01
