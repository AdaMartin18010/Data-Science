# æ•°æ®æŸ¥è¯¢è¯­è¨€(DQL)

> **åˆ›å»ºæ—¥æœŸ**ï¼š2025-01-15
> **æœ€åæ›´æ–°**ï¼š2025-01-15
> **ç‰ˆæœ¬**ï¼šv1.0.0
> **éš¾åº¦**ï¼šâ­â­â­
> **åº”ç”¨åœºæ™¯**ï¼šæ•°æ®æŸ¥è¯¢ã€æ•°æ®åˆ†æã€æŠ¥è¡¨ç”Ÿæˆ

---

## ğŸ“‹ ç›®å½•

- [æ•°æ®æŸ¥è¯¢è¯­è¨€(DQL)](#æ•°æ®æŸ¥è¯¢è¯­è¨€dql)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ä¸€ã€æ¦‚è¿°](#ä¸€æ¦‚è¿°)
    - [1.1 SELECTè¯­å¥æ‰§è¡Œé¡ºåºæ€ç»´å¯¼å›¾](#11-selectè¯­å¥æ‰§è¡Œé¡ºåºæ€ç»´å¯¼å›¾)
    - [1.2 SELECTè¯­å¥æ‰§è¡Œæµç¨‹å›¾](#12-selectè¯­å¥æ‰§è¡Œæµç¨‹å›¾)
    - [1.3 DQLæ“ä½œå¯¹æ¯”çŸ©é˜µ](#13-dqlæ“ä½œå¯¹æ¯”çŸ©é˜µ)
  - [äºŒã€SELECTåŸºæœ¬è¯­æ³•](#äºŒselectåŸºæœ¬è¯­æ³•)
    - [2.1 åŸºæœ¬æŸ¥è¯¢](#21-åŸºæœ¬æŸ¥è¯¢)
    - [2.2 åœºæ™¯ç¤ºä¾‹ï¼šå­¦ç”Ÿä¿¡æ¯æŸ¥è¯¢](#22-åœºæ™¯ç¤ºä¾‹å­¦ç”Ÿä¿¡æ¯æŸ¥è¯¢)
  - [ä¸‰ã€WHEREå­å¥](#ä¸‰whereå­å¥)
    - [3.1 æ¡ä»¶è¿‡æ»¤](#31-æ¡ä»¶è¿‡æ»¤)
  - [å››ã€JOINæ“ä½œ](#å››joinæ“ä½œ)
    - [4.1 JOINç±»å‹](#41-joinç±»å‹)
    - [4.1.1 åœºæ™¯ç¤ºä¾‹ï¼šå­¦ç”Ÿé€‰è¯¾ä¿¡æ¯æŸ¥è¯¢](#411-åœºæ™¯ç¤ºä¾‹å­¦ç”Ÿé€‰è¯¾ä¿¡æ¯æŸ¥è¯¢)
  - [äº”ã€GROUP BYå’ŒHAVING](#äº”group-byå’Œhaving)
    - [5.1 åˆ†ç»„æŸ¥è¯¢](#51-åˆ†ç»„æŸ¥è¯¢)
  - [å…­ã€ORDER BY](#å…­order-by)
    - [6.1 æ’åº](#61-æ’åº)
  - [ä¸ƒã€å­æŸ¥è¯¢](#ä¸ƒå­æŸ¥è¯¢)
    - [7.1 å­æŸ¥è¯¢ç±»å‹](#71-å­æŸ¥è¯¢ç±»å‹)
  - [å…«ã€ç›¸å…³èµ„æº](#å…«ç›¸å…³èµ„æº)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)

---

## ä¸€ã€æ¦‚è¿°

**æ•°æ®æŸ¥è¯¢è¯­è¨€ï¼ˆDQL, Data Query Languageï¼‰**ç”¨äºä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®ï¼ŒSELECTæ˜¯å”¯ä¸€çš„DQLè¯­å¥ã€‚

**SELECTè¯­å¥ç»“æ„**ï¼š

```sql
SELECT [DISTINCT] select_list
FROM table_list
[WHERE condition]
[GROUP BY group_list]
[HAVING condition]
[ORDER BY order_list];
```

### 1.1 SELECTè¯­å¥æ‰§è¡Œé¡ºåºæ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((SELECTæ‰§è¡Œé¡ºåº))
    æ‰§è¡Œé˜¶æ®µ
      FROMå­å¥
        è¡¨æ‰«æ
        è¿æ¥æ“ä½œ
        å­æŸ¥è¯¢æ‰§è¡Œ
      WHEREå­å¥
        æ¡ä»¶è¿‡æ»¤
        ç´¢å¼•ä½¿ç”¨
        è°“è¯ä¸‹æ¨
      GROUP BYå­å¥
        åˆ†ç»„æ“ä½œ
        èšåˆè®¡ç®—
        HAVINGè¿‡æ»¤
      SELECTå­å¥
        åˆ—é€‰æ‹©
        è¡¨è¾¾å¼è®¡ç®—
        å‡½æ•°è°ƒç”¨
      ORDER BYå­å¥
        æ’åºæ“ä½œ
        ç´¢å¼•ä½¿ç”¨
        TOP Nä¼˜åŒ–
      DISTINCT
        å»é‡æ“ä½œ
        æ’åºå»é‡
        å“ˆå¸Œå»é‡
```

### 1.2 SELECTè¯­å¥æ‰§è¡Œæµç¨‹å›¾

```mermaid
flowchart TD
    A[SELECTæŸ¥è¯¢] --> B[FROMå­å¥]
    B --> C[è¡¨æ‰«æ/è¿æ¥]
    C --> D[WHEREå­å¥]
    D --> E{æ¡ä»¶è¿‡æ»¤}
    E -->|é€šè¿‡| F[GROUP BYå­å¥]
    E -->|ä¸é€šè¿‡| G[ä¸¢å¼ƒè¡Œ]
    F --> H[åˆ†ç»„èšåˆ]
    H --> I[HAVINGå­å¥]
    I --> J{HAVINGè¿‡æ»¤}
    J -->|é€šè¿‡| K[SELECTå­å¥]
    J -->|ä¸é€šè¿‡| G
    K --> L[åˆ—é€‰æ‹©/è®¡ç®—]
    L --> M[ORDER BYå­å¥]
    M --> N[æ’åº]
    N --> O[DISTINCT]
    O --> P[å»é‡]
    P --> Q[è¿”å›ç»“æœ]
    G --> Q
```

### 1.3 DQLæ“ä½œå¯¹æ¯”çŸ©é˜µ

| æ“ä½œç±»å‹ | SQLè¯­å¥ | å¤æ‚åº¦ | æ€§èƒ½å½±å“ | ä¼˜åŒ–ç­–ç•¥ |
|---------|---------|--------|---------|---------|
| **ç®€å•æŸ¥è¯¢** | SELECT * FROM table | â­ | ä½ | ç´¢å¼•ä¼˜åŒ– |
| **æ¡ä»¶æŸ¥è¯¢** | SELECT ... WHERE ... | â­â­ | ä¸­ | ç´¢å¼•ã€è°“è¯ä¸‹æ¨ |
| **è¿æ¥æŸ¥è¯¢** | SELECT ... JOIN ... | â­â­â­ | é«˜ | è¿æ¥é¡ºåºã€ç´¢å¼• |
| **åˆ†ç»„æŸ¥è¯¢** | SELECT ... GROUP BY ... | â­â­â­ | ä¸­-é«˜ | ç´¢å¼•ã€ç‰©åŒ– |
| **å­æŸ¥è¯¢** | SELECT ... (SELECT ...) | â­â­â­â­ | é«˜ | å­æŸ¥è¯¢ä¼˜åŒ– |
| **çª—å£å‡½æ•°** | SELECT ... OVER ... | â­â­â­â­ | ä¸­-é«˜ | åˆ†åŒºä¼˜åŒ– |

---

## äºŒã€SELECTåŸºæœ¬è¯­æ³•

### 2.1 åŸºæœ¬æŸ¥è¯¢

**åŸºæœ¬SELECT**ï¼š

```sql
SELECT * FROM Student;
SELECT student_id, name FROM Student;
```

### 2.2 åœºæ™¯ç¤ºä¾‹ï¼šå­¦ç”Ÿä¿¡æ¯æŸ¥è¯¢

**ä¸šåŠ¡éœ€æ±‚**ï¼šæŸ¥è¯¢å­¦ç”Ÿç®¡ç†ç³»ç»Ÿä¸­çš„å­¦ç”Ÿä¿¡æ¯ã€‚

**æ•°æ®æ¨¡å‹**ï¼š

```mermaid
erDiagram
    Student ||--o{ Enrollment : "é€‰è¯¾"
    Course ||--o{ Enrollment : "è¢«é€‰"
    Student {
        int student_id PK
        string name
        int age
        string major
    }
    Course {
        int course_id PK
        string course_name
    }
    Enrollment {
        int student_id FK
        int course_id FK
        int score
    }
```

**åŸºæœ¬æŸ¥è¯¢ç¤ºä¾‹**ï¼š

```sql
-- æŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿ
SELECT * FROM Student;

-- æŸ¥è¯¢å­¦ç”ŸIDå’Œå§“å
SELECT student_id, name FROM Student;

-- æŸ¥è¯¢ç‰¹å®šä¸“ä¸šçš„å­¦ç”Ÿ
SELECT student_id, name, age
FROM Student
WHERE major = 'Computer Science';
```

---

## ä¸‰ã€WHEREå­å¥

### 3.1 æ¡ä»¶è¿‡æ»¤

**WHEREå­å¥**ï¼š

```sql
SELECT * FROM Student WHERE age > 20;
SELECT * FROM Student WHERE major = 'CS' AND age > 18;
```

---

## å››ã€JOINæ“ä½œ

### 4.1 JOINç±»å‹

### 4.1.1 åœºæ™¯ç¤ºä¾‹ï¼šå­¦ç”Ÿé€‰è¯¾ä¿¡æ¯æŸ¥è¯¢

**ä¸šåŠ¡éœ€æ±‚**ï¼šæŸ¥è¯¢å­¦ç”ŸåŠå…¶é€‰è¯¾ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¯¾ç¨‹åç§°å’Œæˆç»©ã€‚

**JOINæŸ¥è¯¢å®ç°**ï¼š

```sql
-- INNER JOINï¼šåªæŸ¥è¯¢æœ‰é€‰è¯¾è®°å½•çš„å­¦ç”Ÿ
SELECT
    s.student_id,
    s.name,
    c.course_name,
    e.score
FROM Student s
INNER JOIN Enrollment e ON s.student_id = e.student_id
INNER JOIN Course c ON e.course_id = c.course_id
ORDER BY s.name, e.score DESC;

-- LEFT JOINï¼šæŸ¥è¯¢æ‰€æœ‰å­¦ç”Ÿï¼ŒåŒ…æ‹¬æ²¡æœ‰é€‰è¯¾çš„å­¦ç”Ÿ
SELECT
    s.student_id,
    s.name,
    c.course_name,
    e.score
FROM Student s
LEFT JOIN Enrollment e ON s.student_id = e.student_id
LEFT JOIN Course c ON e.course_id = c.course_id
ORDER BY s.name;

-- RIGHT JOINï¼šæŸ¥è¯¢æ‰€æœ‰è¯¾ç¨‹ï¼ŒåŒ…æ‹¬æ²¡æœ‰è¢«é€‰çš„è¯¾ç¨‹
SELECT
    c.course_name,
    s.name,
    e.score
FROM Enrollment e
RIGHT JOIN Course c ON e.course_id = c.course_id
LEFT JOIN Student s ON e.student_id = s.student_id
ORDER BY c.course_name;
```

**JOINæ‰§è¡Œæµç¨‹æ—¶åºå›¾**ï¼š

```mermaid
sequenceDiagram
    participant Client
    participant QueryEngine
    participant JoinOperator
    participant Storage

    Client->>QueryEngine: SELECT with JOIN
    QueryEngine->>Storage: è¯»å–Studentè¡¨
    Storage-->>QueryEngine: è¿”å›Studentæ•°æ®
    QueryEngine->>Storage: è¯»å–Enrollmentè¡¨
    Storage-->>QueryEngine: è¿”å›Enrollmentæ•°æ®
    QueryEngine->>JoinOperator: æ‰§è¡ŒINNER JOIN
    JoinOperator->>JoinOperator: åŒ¹é…student_id
    JoinOperator->>Storage: è¯»å–Courseè¡¨
    Storage-->>JoinOperator: è¿”å›Courseæ•°æ®
    JoinOperator->>JoinOperator: æ‰§è¡Œç¬¬äºŒä¸ªJOIN
    JoinOperator-->>QueryEngine: è¿”å›è¿æ¥ç»“æœ
    QueryEngine-->>Client: è¿”å›æœ€ç»ˆç»“æœ
```

---

## äº”ã€GROUP BYå’ŒHAVING

### 5.1 åˆ†ç»„æŸ¥è¯¢

**GROUP BY**ï¼š

```sql
SELECT major, COUNT(*) as count
FROM Student
GROUP BY major
HAVING COUNT(*) > 10;
```

---

## å…­ã€ORDER BY

### 6.1 æ’åº

**ORDER BY**ï¼š

```sql
SELECT * FROM Student
ORDER BY age DESC, name ASC;
```

---

## ä¸ƒã€å­æŸ¥è¯¢

### 7.1 å­æŸ¥è¯¢ç±»å‹

**å­æŸ¥è¯¢**ï¼š

```sql
-- æ ‡é‡å­æŸ¥è¯¢
SELECT name, (SELECT COUNT(*) FROM Enrollment WHERE student_id = s.student_id) as course_count
FROM Student s;

-- ç›¸å…³å­æŸ¥è¯¢
SELECT * FROM Student s
WHERE EXISTS (SELECT 1 FROM Enrollment e WHERE e.student_id = s.student_id);
```

---

## å…«ã€ç›¸å…³èµ„æº

### ç›¸å…³æ–‡æ¡£

- [æ•°æ®å®šä¹‰è¯­è¨€(DDL)](./04.01-æ•°æ®å®šä¹‰è¯­è¨€(DDL).md) - DDLè¯­æ³•
- [æ•°æ®æ“ä½œè¯­è¨€(DML)](./04.02-æ•°æ®æ“ä½œè¯­è¨€(DML).md) - DMLè¯­æ³•
- [çª—å£å‡½æ•°è¯¦è§£](../05-é«˜çº§ç‰¹æ€§/05.01-çª—å£å‡½æ•°è¯¦è§£.md) - çª—å£å‡½æ•°

---

**ç»´æŠ¤è€…**: SQL Standards Team
**æœ€åæ›´æ–°**: 2025-01-15
