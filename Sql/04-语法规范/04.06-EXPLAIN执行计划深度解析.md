# EXPLAINæ‰§è¡Œè®¡åˆ’æ·±åº¦è§£æ

> **åˆ›å»ºæ—¥æœŸ**ï¼š2025-12-04
> **æ•°æ®åº“**ï¼šPostgreSQL 18 / MySQL 8.4 / SQLite 3.47.x
> **éš¾åº¦**ï¼šâ­â­â­â­

---

## ğŸ“‹ æ¦‚è¿°

æ·±å…¥è§£æå„æ•°æ®åº“çš„EXPLAINè¾“å‡ºï¼ŒæŒæ¡æ‰§è¡Œè®¡åˆ’åˆ†æå’Œä¼˜åŒ–æŠ€å·§ã€‚

---

## ğŸ“‘ ç›®å½•

- [EXPLAINæ‰§è¡Œè®¡åˆ’æ·±åº¦è§£æ](#explainæ‰§è¡Œè®¡åˆ’æ·±åº¦è§£æ)
  - [ğŸ“‹ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [ä¸€ã€PostgreSQLæ‰§è¡Œè®¡åˆ’](#ä¸€postgresqlæ‰§è¡Œè®¡åˆ’)
    - [1.1 åŸºæœ¬ç”¨æ³•](#11-åŸºæœ¬ç”¨æ³•)
    - [1.2 å…³é”®æŒ‡æ ‡è§£è¯»](#12-å…³é”®æŒ‡æ ‡è§£è¯»)
    - [1.3 å¸¸è§èŠ‚ç‚¹ç±»å‹](#13-å¸¸è§èŠ‚ç‚¹ç±»å‹)
  - [äºŒã€MySQLæ‰§è¡Œè®¡åˆ’](#äºŒmysqlæ‰§è¡Œè®¡åˆ’)
    - [2.1 EXPLAINæ ¼å¼](#21-explainæ ¼å¼)
    - [2.2 å…³é”®å­—æ®µè§£è¯»](#22-å…³é”®å­—æ®µè§£è¯»)
  - [ä¸‰ã€SQLiteæ‰§è¡Œè®¡åˆ’](#ä¸‰sqliteæ‰§è¡Œè®¡åˆ’)
    - [3.1 EXPLAIN QUERY PLAN](#31-explain-query-plan)
    - [3.2 EXPLAINè¯¦ç»†å­—èŠ‚ç ](#32-explainè¯¦ç»†å­—èŠ‚ç )
  - [å››ã€ä¼˜åŒ–æ¡ˆä¾‹](#å››ä¼˜åŒ–æ¡ˆä¾‹)
    - [4.1 ç´¢å¼•ä¼˜åŒ–](#41-ç´¢å¼•ä¼˜åŒ–)
    - [4.2 JOINä¼˜åŒ–](#42-joinä¼˜åŒ–)
    - [4.3 å­æŸ¥è¯¢ä¼˜åŒ–](#43-å­æŸ¥è¯¢ä¼˜åŒ–)

---

## ä¸€ã€PostgreSQLæ‰§è¡Œè®¡åˆ’

### 1.1 åŸºæœ¬ç”¨æ³•

```sql
-- åŸºç¡€EXPLAIN
EXPLAIN
SELECT * FROM users WHERE age > 25;

-- å¸¦æˆæœ¬ä¿¡æ¯
EXPLAIN (COSTS ON)
SELECT ...;

-- å®é™…æ‰§è¡Œï¼ˆåŒ…å«çœŸå®æ•°æ®ï¼‰
EXPLAIN (ANALYZE, BUFFERS, VERBOSE, WAL, TIMING)
SELECT ...;
```

### 1.2 å…³é”®æŒ‡æ ‡è§£è¯»

```sql
EXPLAIN (ANALYZE, BUFFERS)
SELECT u.name, COUNT(o.order_id)
FROM users u
LEFT JOIN orders o ON u.user_id = o.user_id
GROUP BY u.user_id, u.name;

/*
Hash Right Join  (cost=1234.56..5678.90 rows=10000 width=40)
                 (actual time=12.345..56.789 rows=10000 loops=1)
  Hash Cond: (o.user_id = u.user_id)
  Buffers: shared hit=789 read=123 dirtied=45 written=12
  ->  Seq Scan on orders o  (cost=0.00..2345.67 rows=100000 width=8)
                            (actual time=0.012..15.678 rows=100000 loops=1)
        Buffers: shared hit=567 read=78
  ->  Hash  (cost=987.65..987.65 rows=20000 width=36)
            (actual time=11.234..11.234 rows=20000 loops=1)
        Buckets: 32768  Batches: 1  Memory Usage: 1234kB
        Buffers: shared hit=222 read=45
        ->  Seq Scan on users u  (cost=0.00..987.65 rows=20000 width=36)
                               (actual time=0.008..8.901 rows=20000 loops=1)
              Buffers: shared hit=222 read=45

Planning Time: 0.456 ms
Execution Time: 58.123 ms
*/
```

**æŒ‡æ ‡è¯¦è§£**ï¼š

```text
PostgreSQL EXPLAINæŒ‡æ ‡å®Œå…¨è§£æ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. cost=å¯åŠ¨æˆæœ¬..æ€»æˆæœ¬
   â€¢ å¯åŠ¨æˆæœ¬ï¼šè¿”å›ç¬¬ä¸€è¡Œå‰çš„ä»£ä»·
   â€¢ æ€»æˆæœ¬ï¼šè¿”å›æ‰€æœ‰è¡Œçš„ä»£ä»·
   â€¢ å•ä½ï¼šä»»æ„å•ä½ï¼ˆç›¸å¯¹å€¼ï¼Œç”¨äºæ¯”è¾ƒï¼‰
   â€¢ ç¤ºä¾‹ï¼šcost=1234.56..5678.90
     - å¯åŠ¨æˆæœ¬1234.56
     - æ€»æˆæœ¬5678.90

2. rows=ä¼°ç®—è¡Œæ•°
   â€¢ ä¼˜åŒ–å™¨ä¼°è®¡è¿”å›çš„è¡Œæ•°
   â€¢ åŸºäºç»Ÿè®¡ä¿¡æ¯ï¼ˆpg_statsï¼‰
   â€¢ å‡†ç¡®æ€§å½±å“è®¡åˆ’è´¨é‡
   â€¢ ç¤ºä¾‹ï¼šrows=10000è¡¨ç¤ºä¼°è®¡1ä¸‡è¡Œ

3. width=å¹³å‡è¡Œå®½åº¦ï¼ˆå­—èŠ‚ï¼‰
   â€¢ æ¯è¡Œçš„å¹³å‡å¤§å°
   â€¢ ç”¨äºå†…å­˜ä¼°ç®—
   â€¢ ç¤ºä¾‹ï¼šwidth=40è¡¨ç¤ºæ¯è¡Œ40å­—èŠ‚

4. actual time=å¯åŠ¨æ—¶é—´..æ€»æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
   â€¢ å®é™…æµ‹é‡çš„æ—¶é—´ï¼ˆANALYZEæ—¶æœ‰ï¼‰
   â€¢ å¯åŠ¨æ—¶é—´ï¼šç¬¬ä¸€è¡Œè¿”å›æ—¶é—´
   â€¢ æ€»æ—¶é—´ï¼šæ‰€æœ‰è¡Œè¿”å›æ—¶é—´
   â€¢ ç¤ºä¾‹ï¼šactual time=12.345..56.789

5. loops=å¾ªç¯æ¬¡æ•°
   â€¢ èŠ‚ç‚¹æ‰§è¡Œçš„æ¬¡æ•°
   â€¢ >1è¡¨ç¤ºåœ¨å¾ªç¯ä¸­ï¼ˆå¦‚Nested Loopï¼‰
   â€¢ å®é™…æ—¶é—´ = actual time Ã— loops

6. Buffersç¼“å†²åŒºç»Ÿè®¡
   â€¢ shared hit: å…±äº«ç¼“å­˜å‘½ä¸­é¡µæ•°
   â€¢ shared read: ä»ç£ç›˜è¯»å–é¡µæ•°
   â€¢ dirtied: è„é¡µæ•°
   â€¢ written: å†™å…¥ç£ç›˜é¡µæ•°
   â€¢ ç¤ºä¾‹ï¼šBuffers: shared hit=789 read=123
     - ç¼“å­˜å‘½ä¸­ç‡ = 789/(789+123) = 86.5%

7. Planning Time vs Execution Time
   â€¢ Planning Time: æŸ¥è¯¢è§„åˆ’æ—¶é—´
   â€¢ Execution Time: å®é™…æ‰§è¡Œæ—¶é—´
   â€¢ Planning Timeè¿‡é«˜ â†’ è€ƒè™‘prepared statement

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æ€§èƒ½åˆ†æchecklistï¼š
â–¡ actual timeæ˜¯å¦åˆç†ï¼Ÿ
â–¡ rowsä¼°ç®—æ˜¯å¦å‡†ç¡®ï¼ˆä¸actual rowså¯¹æ¯”ï¼‰ï¼Ÿ
â–¡ ç¼“å­˜å‘½ä¸­ç‡æ˜¯å¦è¶³å¤Ÿé«˜ï¼ˆ>90%ï¼‰ï¼Ÿ
â–¡ æ˜¯å¦æœ‰Seq Scanåº”è¯¥ç”¨Index Scanï¼Ÿ
â–¡ JOINç®—æ³•æ˜¯å¦åˆé€‚ï¼ˆHash/Merge/Nested Loopï¼‰ï¼Ÿ
â–¡ æ˜¯å¦æœ‰Sortæº¢å‡ºåˆ°ç£ç›˜ï¼ˆexternal sortï¼‰ï¼Ÿ
```

### 1.3 å¸¸è§èŠ‚ç‚¹ç±»å‹

```text
PostgreSQLæ‰§è¡Œè®¡åˆ’èŠ‚ç‚¹ç±»å‹
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

æ‰«æèŠ‚ç‚¹ï¼ˆScan Nodesï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ èŠ‚ç‚¹ç±»å‹             â”‚ è¯´æ˜                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Seq Scan             â”‚ å…¨è¡¨é¡ºåºæ‰«æï¼ˆæœ€æ…¢ï¼‰                   â”‚
â”‚ Index Scan           â”‚ ç´¢å¼•æ‰«æ+å›è¡¨                          â”‚
â”‚ Index Only Scan      â”‚ è¦†ç›–ç´¢å¼•æ‰«æï¼ˆå¿«ï¼‰                     â”‚
â”‚ Bitmap Index Scan    â”‚ ä½å›¾ç´¢å¼•æ‰«æ                           â”‚
â”‚ Bitmap Heap Scan     â”‚ ä½å›¾å †æ‰«æ                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¿æ¥èŠ‚ç‚¹ï¼ˆJoin Nodesï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ èŠ‚ç‚¹ç±»å‹             â”‚ é€‚ç”¨åœºæ™¯                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Nested Loop          â”‚ å°è¡¨+å¤§è¡¨ï¼Œæœ‰ç´¢å¼•                      â”‚
â”‚ Hash Join            â”‚ ç­‰å€¼è¿æ¥ï¼Œå†…å­˜å……è¶³                     â”‚
â”‚ Merge Join           â”‚ å·²æ’åºæ•°æ®ï¼Œç­‰å€¼è¿æ¥                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

èšåˆèŠ‚ç‚¹ï¼ˆAggregate Nodesï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ èŠ‚ç‚¹ç±»å‹             â”‚ è¯´æ˜                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ HashAggregate        â”‚ Hashèšåˆï¼ˆå¿«ï¼‰                         â”‚
â”‚ GroupAggregate       â”‚ å·²æ’åºæ•°æ®èšåˆ                         â”‚
â”‚ WindowAgg            â”‚ çª—å£å‡½æ•°                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ’åºèŠ‚ç‚¹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ èŠ‚ç‚¹ç±»å‹             â”‚ è¯´æ˜                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Sort                 â”‚ å†…å­˜æ’åºï¼ˆquicksortï¼‰                  â”‚
â”‚ Sort (external merge)â”‚ ç£ç›˜æ’åºï¼ˆå½’å¹¶æ’åºï¼Œæ…¢ï¼ï¼‰             â”‚
â”‚ Incremental Sort     â”‚ å¢é‡æ’åºï¼ˆPostgreSQL 13+ï¼‰             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€MySQLæ‰§è¡Œè®¡åˆ’

### 2.1 EXPLAINæ ¼å¼

```sql
-- MySQL EXPLAIN

EXPLAIN FORMAT=TREE
SELECT u.name, COUNT(o.order_id)
FROM users u
LEFT JOIN orders o ON u.user_id = o.user_id
WHERE u.age > 25
GROUP BY u.user_id, u.name;

/*
-> Table scan on <temporary>
    -> Aggregate using temporary table
        -> Nested loop left join
            -> Filter: (u.age > 25)
                -> Index range scan on u using idx_age
            -> Index lookup on o using idx_user_id (user_id=u.user_id)
*/

-- JSONæ ¼å¼ï¼ˆè¯¦ç»†ï¼‰
EXPLAIN FORMAT=JSON
SELECT ...;
```

### 2.2 å…³é”®å­—æ®µè§£è¯»

```sql
EXPLAIN
SELECT * FROM users WHERE age > 25;

/*
+----+-------------+-------+-------+----------+---------+------+------+-------------+
| id | select_type | table | type  | key      | ref     | rows | Extra           |
+----+-------------+-------+-------+----------+---------+------+------+-------------+
|  1 | SIMPLE      | users | range | idx_age  | NULL    | 3000 | Using where     |
+----+-------------+-------+-------+----------+---------+------+------+-------------+
*/
```

**å­—æ®µè§£æ**ï¼š

```text
MySQL EXPLAINå­—æ®µè¯¦è§£
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

typeåˆ—ï¼ˆè®¿é—®ç±»å‹ï¼Œä»ä¼˜åˆ°åŠ£ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç±»å‹        â”‚ è¯´æ˜                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ system      â”‚ è¡¨åªæœ‰ä¸€è¡Œï¼ˆç³»ç»Ÿè¡¨ï¼‰                             â”‚
â”‚ const       â”‚ ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•ç­‰å€¼æŸ¥è¯¢ï¼ˆæœ€å¿«ï¼‰                   â”‚
â”‚ eq_ref      â”‚ å”¯ä¸€ç´¢å¼•æŸ¥æ‰¾ï¼ˆJOINä¸­ï¼‰                           â”‚
â”‚ ref         â”‚ éå”¯ä¸€ç´¢å¼•æŸ¥æ‰¾                                   â”‚
â”‚ range       â”‚ ç´¢å¼•èŒƒå›´æ‰«æ                                     â”‚
â”‚ index       â”‚ å…¨ç´¢å¼•æ‰«æ                                       â”‚
â”‚ ALL         â”‚ å…¨è¡¨æ‰«æï¼ˆæœ€æ…¢ï¼Œéœ€ä¼˜åŒ–ï¼‰                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Extraåˆ—ï¼ˆé¢å¤–ä¿¡æ¯ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¿¡æ¯                 â”‚ è¯´æ˜                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Using index          â”‚ è¦†ç›–ç´¢å¼•ï¼ˆä¼˜ï¼‰                         â”‚
â”‚ Using where          â”‚ WHEREè¿‡æ»¤ï¼ˆæ­£å¸¸ï¼‰                      â”‚
â”‚ Using temporary      â”‚ ä½¿ç”¨ä¸´æ—¶è¡¨ï¼ˆå¯èƒ½æ…¢ï¼‰                   â”‚
â”‚ Using filesort       â”‚ æ–‡ä»¶æ’åºï¼ˆå¯èƒ½æ…¢ï¼‰                     â”‚
â”‚ Using index conditionâ”‚ ç´¢å¼•æ¡ä»¶ä¸‹æ¨ï¼ˆICPï¼Œä¼˜ï¼‰                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¼˜åŒ–ç›®æ ‡ï¼š
â€¢ typeå°½é‡è¾¾åˆ°refæˆ–æ›´å¥½
â€¢ é¿å…ALLï¼ˆå…¨è¡¨æ‰«æï¼‰
â€¢ é¿å…Using filesortå’ŒUsing temporary
â€¢ ä¼˜å…ˆUsing indexï¼ˆè¦†ç›–ç´¢å¼•ï¼‰
```

---

## ä¸‰ã€SQLiteæ‰§è¡Œè®¡åˆ’

### 3.1 EXPLAIN QUERY PLAN

```sql
-- SQLiteæŸ¥è¯¢è®¡åˆ’

EXPLAIN QUERY PLAN
SELECT u.name, o.total
FROM users u
JOIN orders o ON u.user_id = o.user_id
WHERE u.age > 25;

/*
QUERY PLAN
|--SEARCH u USING INDEX idx_users_age (age>?)
`--SEARCH o USING INDEX idx_orders_user (user_id=?)
*/
```

**è¾“å‡ºè§£æ**ï¼š

```text
SQLite EXPLAIN QUERY PLANè¾“å‡ºè§£æ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

å…³é”®è¯å«ä¹‰ï¼š

SCANï¼šå…¨è¡¨æ‰«æ
â€¢ SCAN usersï¼šé¡ºåºæ‰«æusersè¡¨çš„æ‰€æœ‰è¡Œ
â€¢ æ€§èƒ½ï¼šO(n)ï¼Œæœ€æ…¢
â€¢ ä¼˜åŒ–ï¼šæ·»åŠ ç´¢å¼•

SEARCHï¼šç´¢å¼•æŸ¥æ‰¾
â€¢ SEARCH users USING INDEX idx_name (name=?)ï¼šä½¿ç”¨idx_nameç´¢å¼•
â€¢ æ€§èƒ½ï¼šO(log n)ï¼Œå¿«
â€¢ æœ€ä½³å®è·µ

SEARCH ... USING INTEGER PRIMARY KEYï¼šä¸»é”®æŸ¥æ‰¾
â€¢ æœ€å¿«çš„æŸ¥æ‰¾æ–¹å¼
â€¢ ç›´æ¥B-TreeæŸ¥æ‰¾
â€¢ æ€§èƒ½ï¼šO(log n)

USE TEMP B-TREE FOR ORDER BYï¼šä¸´æ—¶æ’åº
â€¢ éœ€è¦åˆ›å»ºä¸´æ—¶B-Treeæ’åº
â€¢ å¯èƒ½æ…¢ï¼ˆå¦‚æœæ•°æ®é‡å¤§ï¼‰
â€¢ ä¼˜åŒ–ï¼šæ·»åŠ è¦†ç›–ORDER BYçš„ç´¢å¼•

AUTOMATIC COVERING INDEXï¼šè‡ªåŠ¨è¦†ç›–ç´¢å¼•
â€¢ SQLiteè‡ªåŠ¨ç”Ÿæˆä¸´æ—¶ç´¢å¼•
â€¢ åªåœ¨æœ¬æ¬¡æŸ¥è¯¢æœ‰æ•ˆ
â€¢ æç¤ºï¼šåº”è¯¥åˆ›å»ºæ°¸ä¹…ç´¢å¼•

ç¤ºä¾‹åˆ†æï¼š

-- æŸ¥è¯¢
SELECT * FROM users WHERE email = 'alice@example.com';

-- è®¡åˆ’1ï¼ˆæ— ç´¢å¼•ï¼‰
SCAN users
-- éœ€è¦æ‰«ææ‰€æœ‰è¡Œï¼Œæ…¢

-- è®¡åˆ’2ï¼ˆæœ‰ç´¢å¼•ï¼‰
SEARCH users USING INDEX idx_users_email (email=?)
-- ä½¿ç”¨ç´¢å¼•ï¼Œå¿«
```

### 3.2 EXPLAINè¯¦ç»†å­—èŠ‚ç 

```sql
EXPLAIN
SELECT name FROM users WHERE id = 123;

/*
addr  opcode         p1    p2    p3    p4             comment
----  -------------  ----  ----  ----  -------------  -------
0     Init           0     11    0                    Start
1     OpenRead       0     2     0     2              root=2; users
2     Integer        123   1     0                    r[1]=123
3     SeekGE         0     10    1     1              key=r[1]
4     IdxGT          0     10    1     1              key=r[1]
5     Column         0     1     2                    r[2]=users.name
6     ResultRow      2     1     0                    output=r[2]
7     Next           0     4     0
8     Close          0     0     0
9     Halt           0     0     0
10    Transaction    0     0     1     0
11    Goto           0     1     0
*/
```

**å­—èŠ‚ç è§£æ**ï¼š

```text
VDBEæ“ä½œç è¯¦è§£
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

å¸¸ç”¨æ“ä½œç ï¼š

Init p1 p2 p3
â€¢ åˆå§‹åŒ–ç¨‹åºï¼Œè·³è½¬åˆ°p2
â€¢ p1: è¿”å›å€¼
â€¢ p2: è·³è½¬åœ°å€ï¼ˆé€šå¸¸æ˜¯Transactionï¼‰

OpenRead p1 p2 p3 p4
â€¢ æ‰“å¼€è¡¨æˆ–ç´¢å¼•ç”¨äºè¯»å–
â€¢ p1: æ¸¸æ ‡ç¼–å·
â€¢ p2: æ ¹é¡µé¢å·
â€¢ p4: åˆ—æ•°

SeekGE p1 p2 p3 p4
â€¢ åœ¨æ¸¸æ ‡p1ä¸ŠæŸ¥æ‰¾ >= r[p3]çš„è®°å½•
â€¢ å¦‚æœæœªæ‰¾åˆ°ï¼Œè·³è½¬åˆ°p2
â€¢ ç”¨äºç´¢å¼•æŸ¥æ‰¾

Column p1 p2 p3
â€¢ ä»æ¸¸æ ‡p1è¯»å–åˆ—p2åˆ°å¯„å­˜å™¨r[p3]

ResultRow p1 p2 p3
â€¢ è¾“å‡ºå¯„å­˜å™¨r[p1]åˆ°r[p1+p2-1]çš„å€¼

Next p1 p2 p3
â€¢ ç§»åŠ¨æ¸¸æ ‡p1åˆ°ä¸‹ä¸€è¡Œ
â€¢ å¦‚æœæœ‰æ•°æ®ï¼Œè·³è½¬åˆ°p2ï¼ˆå¾ªç¯ï¼‰

Halt p1 p2 p3
â€¢ åœæ­¢æ‰§è¡Œ
â€¢ p1: è¿”å›ç 

æ€§èƒ½åˆ†æï¼š
â€¢ æ“ä½œç æ•°é‡ï¼šè¶Šå°‘è¶Šå¿«
â€¢ SeekGE vs Rewind+Nextï¼šSeekGEæ›´å¿«ï¼ˆç›´æ¥å®šä½ï¼‰
â€¢ Columnæ•°é‡ï¼šåªè¯»å–éœ€è¦çš„åˆ—
```

---

## å››ã€ä¼˜åŒ–æ¡ˆä¾‹

### 4.1 ç´¢å¼•ä¼˜åŒ–

```sql
-- æ¡ˆä¾‹ï¼šæ…¢æŸ¥è¯¢ä¼˜åŒ–

-- åŸæŸ¥è¯¢
SELECT name, email FROM users WHERE age > 25 AND city = 'NYC';

-- PostgreSQLè®¡åˆ’ï¼ˆä¼˜åŒ–å‰ï¼‰
/*
Seq Scan on users  (cost=0.00..5678.90 rows=3000)
  Filter: ((age > 25) AND (city = 'NYC'))
  Rows Removed by Filter: 97000
*/
-- é—®é¢˜ï¼šå…¨è¡¨æ‰«æï¼Œè¿‡æ»¤æ‰97%çš„è¡Œ

-- ä¼˜åŒ–ï¼šåˆ›å»ºå¤åˆç´¢å¼•
CREATE INDEX idx_users_city_age ON users(city, age);

-- PostgreSQLè®¡åˆ’ï¼ˆä¼˜åŒ–åï¼‰
/*
Index Scan using idx_users_city_age on users  (cost=0.42..123.45 rows=3000)
  Index Cond: ((city = 'NYC') AND (age > 25))
*/
-- æ”¹è¿›ï¼šä½¿ç”¨ç´¢å¼•ï¼Œæ— éœ€è¿‡æ»¤

-- æ€§èƒ½æå‡ï¼š5678.90 â†’ 123.45 = 46å€
```

### 4.2 JOINä¼˜åŒ–

```sql
-- æ¡ˆä¾‹ï¼šJOINé¡ºåºä¼˜åŒ–

-- åŸæŸ¥è¯¢ï¼ˆ3è¡¨JOINï¼‰
SELECT *
FROM large_table l  -- 1000ä¸‡è¡Œ
JOIN medium_table m ON l.id = m.large_id  -- 100ä¸‡è¡Œ
JOIN small_table s ON m.id = s.medium_id  -- 1ä¸‡è¡Œ
WHERE s.category = 'A';  -- è¿‡æ»¤åˆ°100è¡Œ

-- PostgreSQLè®¡åˆ’ï¼ˆä¼˜åŒ–å‰ï¼‰
/*
Hash Join  (cost=huge...)
  ->  Hash Join
        ->  Seq Scan on large_table l
        ->  Hash
              ->  Seq Scan on medium_table m
  ->  Hash
        ->  Seq Scan on small_table s
              Filter: (category = 'A')

æ‰§è¡Œæ—¶é—´ï¼š60ç§’
*/

-- ä¼˜åŒ–ï¼šå…ˆè¿‡æ»¤å°è¡¨
SELECT *
FROM small_table s
JOIN medium_table m ON s.medium_id = m.id
JOIN large_table l ON m.large_id = l.id
WHERE s.category = 'A';

-- PostgreSQLè®¡åˆ’ï¼ˆä¼˜åŒ–åï¼‰
/*
Nested Loop
  ->  Nested Loop
        ->  Index Scan on small_table s
              Index Cond: (category = 'A')
              Rows: 100
        ->  Index Scan on medium_table m
              Index Cond: (id = s.medium_id)
  ->  Index Scan on large_table l
        Index Cond: (id = m.large_id)

æ‰§è¡Œæ—¶é—´ï¼š0.5ç§’ï¼ˆ120å€æå‡ï¼ï¼‰
*/

-- å…³é”®ï¼š
-- 1. å…ˆè¿‡æ»¤åˆ°100è¡Œ
-- 2. ä½¿ç”¨Nested Loopï¼ˆå°ç»“æœé›†é«˜æ•ˆï¼‰
-- 3. æ¯ä¸ªJOINéƒ½ä½¿ç”¨ç´¢å¼•
```

### 4.3 å­æŸ¥è¯¢ä¼˜åŒ–

```sql
-- æ¡ˆä¾‹ï¼šINå­æŸ¥è¯¢ä¼˜åŒ–

-- åŸæŸ¥è¯¢ï¼ˆæ…¢ï¼‰
SELECT *
FROM orders
WHERE user_id IN (
    SELECT user_id FROM users WHERE city = 'NYC'
);

-- PostgreSQLè®¡åˆ’ï¼ˆæœªä¼˜åŒ–ï¼‰
/*
Seq Scan on orders  (cost=0.00..huge)
  Filter: (SubPlan 1)
  SubPlan 1
    ->  Seq Scan on users
          Filter: (city = 'NYC')
-- ç›¸å…³å­æŸ¥è¯¢ï¼Œæ‰§è¡ŒNæ¬¡
*/

-- è‡ªåŠ¨ä¼˜åŒ–ä¸ºSemi-Join
/*
Hash Semi Join  (cost=123.45..456.78)
  Hash Cond: (orders.user_id = users.user_id)
  ->  Seq Scan on orders
  ->  Hash
        ->  Seq Scan on users
              Filter: (city = 'NYC')
-- åªæ‰§è¡Œ1æ¬¡ï¼Œæ€§èƒ½æå‡100å€
*/

-- æ‰‹åŠ¨ä¼˜åŒ–ï¼šä½¿ç”¨EXISTS
SELECT o.*
FROM orders o
WHERE EXISTS (
    SELECT 1 FROM users u
    WHERE u.user_id = o.user_id AND u.city = 'NYC'
);

-- æˆ–è€…ï¼šæ˜¾å¼JOIN
SELECT DISTINCT o.*
FROM orders o
JOIN users u ON o.user_id = u.user_id
WHERE u.city = 'NYC';
```

---

**æ‰§è¡Œè®¡åˆ’è§£æå®Œæˆï¼**

æœ¬æ–‡æ¡£æä¾›ï¼š

- âœ… PostgreSQL EXPLAINå®Œæ•´æŒ‡æ ‡è§£æ
- âœ… MySQL EXPLAINå­—æ®µè¯¦è§£
- âœ… SQLite VDBEå­—èŠ‚ç åˆ†æ
- âœ… 3ä¸ªå®é™…ä¼˜åŒ–æ¡ˆä¾‹ï¼ˆ46x-120xæå‡ï¼‰
- âœ… èŠ‚ç‚¹ç±»å‹å®Œå…¨å‚è€ƒ
- âœ… æ€§èƒ½åˆ†æchecklist

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**æœ€åæ›´æ–°**: 2025-12-04
**ç»´æŠ¤è€…**: SQL Standards Team
