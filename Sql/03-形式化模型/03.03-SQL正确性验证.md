# SQLæ­£ç¡®æ€§éªŒè¯

> **åˆ›å»ºæ—¥æœŸ**ï¼š2025-01-15
> **æœ€åæ›´æ–°**ï¼š2025-01-15
> **ç‰ˆæœ¬**ï¼šv1.0.0
> **éš¾åº¦**ï¼šâ­â­â­â­â­
> **åº”ç”¨åœºæ™¯**ï¼šSQLæ­£ç¡®æ€§éªŒè¯ã€å½¢å¼åŒ–éªŒè¯ã€è´¨é‡ä¿è¯

---

## ğŸ“‹ ç›®å½•

- [SQLæ­£ç¡®æ€§éªŒè¯](#sqlæ­£ç¡®æ€§éªŒè¯)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ä¸€ã€æ¦‚è¿°](#ä¸€æ¦‚è¿°)
    - [1.1 SQLæ­£ç¡®æ€§éªŒè¯çŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾](#11-sqlæ­£ç¡®æ€§éªŒè¯çŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾)
    - [1.2 SQLæ­£ç¡®æ€§éªŒè¯å†³ç­–æ ‘](#12-sqlæ­£ç¡®æ€§éªŒè¯å†³ç­–æ ‘)
    - [1.3 éªŒè¯æ–¹æ³•å¯¹æ¯”çŸ©é˜µ](#13-éªŒè¯æ–¹æ³•å¯¹æ¯”çŸ©é˜µ)
  - [äºŒã€SQLæ­£ç¡®æ€§å®šä¹‰](#äºŒsqlæ­£ç¡®æ€§å®šä¹‰)
    - [2.1 æ­£ç¡®æ€§å®šä¹‰](#21-æ­£ç¡®æ€§å®šä¹‰)
    - [2.2 æ­£ç¡®æ€§ç±»å‹](#22-æ­£ç¡®æ€§ç±»å‹)
  - [ä¸‰ã€å½¢å¼åŒ–éªŒè¯æ–¹æ³•](#ä¸‰å½¢å¼åŒ–éªŒè¯æ–¹æ³•)
    - [3.1 å®šç†è¯æ˜](#31-å®šç†è¯æ˜)
    - [3.2 æ¨¡å‹æ£€æŸ¥](#32-æ¨¡å‹æ£€æŸ¥)
  - [å››ã€éªŒè¯å·¥å…·](#å››éªŒè¯å·¥å…·)
    - [4.1 å½¢å¼åŒ–éªŒè¯å·¥å…·](#41-å½¢å¼åŒ–éªŒè¯å·¥å…·)
  - [äº”ã€å®é™…æ¡ˆä¾‹](#äº”å®é™…æ¡ˆä¾‹)
    - [5.1 æŸ¥è¯¢æ­£ç¡®æ€§éªŒè¯](#51-æŸ¥è¯¢æ­£ç¡®æ€§éªŒè¯)
    - [5.2 åœºæ™¯ç¤ºä¾‹1ï¼šå­¦ç”ŸæŸ¥è¯¢æ­£ç¡®æ€§éªŒè¯](#52-åœºæ™¯ç¤ºä¾‹1å­¦ç”ŸæŸ¥è¯¢æ­£ç¡®æ€§éªŒè¯)
    - [5.3 åœºæ™¯ç¤ºä¾‹2ï¼šè¿æ¥æŸ¥è¯¢æ­£ç¡®æ€§éªŒè¯](#53-åœºæ™¯ç¤ºä¾‹2è¿æ¥æŸ¥è¯¢æ­£ç¡®æ€§éªŒè¯)
    - [5.4 åœºæ™¯ç¤ºä¾‹3ï¼šèšåˆæŸ¥è¯¢æ­£ç¡®æ€§éªŒè¯](#54-åœºæ™¯ç¤ºä¾‹3èšåˆæŸ¥è¯¢æ­£ç¡®æ€§éªŒè¯)
  - [å…­ã€ç›¸å…³èµ„æº](#å…­ç›¸å…³èµ„æº)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)

---

## ä¸€ã€æ¦‚è¿°

SQLæ­£ç¡®æ€§éªŒè¯æ˜¯ç¡®ä¿SQLæŸ¥è¯¢æ»¡è¶³é¢„æœŸè¯­ä¹‰å’Œçº¦æŸçš„è¿‡ç¨‹ã€‚æœ¬æ–‡æ¡£ä»‹ç»SQLæ­£ç¡®æ€§éªŒè¯çš„ç†è®ºå’Œæ–¹æ³•ã€‚

**éªŒè¯ç›®æ ‡**ï¼š

1. è¯­ä¹‰æ­£ç¡®æ€§
2. å®Œæ•´æ€§çº¦æŸæ»¡è¶³
3. æŸ¥è¯¢ç­‰ä»·æ€§
4. æ€§èƒ½æ­£ç¡®æ€§

### 1.1 SQLæ­£ç¡®æ€§éªŒè¯çŸ¥è¯†ä½“ç³»æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((SQLæ­£ç¡®æ€§éªŒè¯))
    éªŒè¯ç±»å‹
      è¯­ä¹‰æ­£ç¡®æ€§
        ç»“æœç¬¦åˆé¢„æœŸ
        é€»è¾‘æ­£ç¡®
      å®Œæ•´æ€§æ­£ç¡®æ€§
        çº¦æŸæ»¡è¶³
        æ•°æ®ä¸€è‡´æ€§
      ç­‰ä»·æ€§æ­£ç¡®æ€§
        æŸ¥è¯¢ç­‰ä»·
        ç»“æœä¸€è‡´
      æ€§èƒ½æ­£ç¡®æ€§
        æ‰§è¡Œæ—¶é—´
        èµ„æºä½¿ç”¨
    éªŒè¯æ–¹æ³•
      å®šç†è¯æ˜
        å½¢å¼åŒ–è¯æ˜
        æ•°å­¦è¯æ˜
      æ¨¡å‹æ£€æŸ¥
        çŠ¶æ€ç©ºé—´æœç´¢
        å±æ€§éªŒè¯
      æµ‹è¯•éªŒè¯
        å•å…ƒæµ‹è¯•
        é›†æˆæµ‹è¯•
      è¿è¡Œæ—¶éªŒè¯
        æ–­è¨€æ£€æŸ¥
        è¿è¡Œæ—¶ç›‘æ§
    éªŒè¯å·¥å…·
      Coq
        è¯æ˜åŠ©æ‰‹
        å½¢å¼åŒ–éªŒè¯
      Isabelle
        è¯æ˜åŠ©æ‰‹
        å®šç†è¯æ˜
      TLA+
        è§„èŒƒè¯­è¨€
        æ¨¡å‹æ£€æŸ¥
      Alloy
        æ¨¡å‹æ£€æŸ¥
        çº¦æŸæ±‚è§£
    åº”ç”¨åœºæ™¯
      æŸ¥è¯¢ä¼˜åŒ–éªŒè¯
        ä¼˜åŒ–æ­£ç¡®æ€§
        ç­‰ä»·æ€§ä¿è¯
      æ•°æ®åº“ç³»ç»ŸéªŒè¯
        ç³»ç»Ÿæ­£ç¡®æ€§
        ä¸€è‡´æ€§ä¿è¯
      åº”ç”¨å¼€å‘éªŒè¯
        æŸ¥è¯¢æ­£ç¡®æ€§
        ä¸šåŠ¡é€»è¾‘éªŒè¯
```

### 1.2 SQLæ­£ç¡®æ€§éªŒè¯å†³ç­–æ ‘

```mermaid
flowchart TD
    A[éœ€è¦éªŒè¯SQL?] --> B{éªŒè¯ç±»å‹}
    B -->|è¯­ä¹‰æ­£ç¡®æ€§| C{éªŒè¯æ–¹æ³•}
    B -->|å®Œæ•´æ€§| D[çº¦æŸæ£€æŸ¥]
    B -->|ç­‰ä»·æ€§| E[ç­‰ä»·æ€§è¯æ˜]
    B -->|æ€§èƒ½| F[æ€§èƒ½æµ‹è¯•]

    C -->|å½¢å¼åŒ–| G[å®šç†è¯æ˜]
    C -->|æµ‹è¯•| H[æµ‹è¯•éªŒè¯]
    C -->|è¿è¡Œæ—¶| I[è¿è¡Œæ—¶éªŒè¯]

    G --> J{ä½¿ç”¨å·¥å…·?}
    J -->|æ˜¯| K[Coq/Isabelle]
    J -->|å¦| L[æ‰‹å·¥è¯æ˜]

    H --> M[å•å…ƒæµ‹è¯•]
    H --> N[é›†æˆæµ‹è¯•]

    D --> O[æ‰§è¡ŒéªŒè¯]
    E --> O
    F --> O
    K --> O
    L --> O
    M --> O
    N --> O
    I --> O
```

### 1.3 éªŒè¯æ–¹æ³•å¯¹æ¯”çŸ©é˜µ

| éªŒè¯æ–¹æ³• | å·¥å…· | è‡ªåŠ¨åŒ–ç¨‹åº¦ | é€‚ç”¨åœºæ™¯ | éš¾åº¦ |
|---------|------|-----------|---------|------|
| **å®šç†è¯æ˜** | Coq, Isabelle | â­â­ | å½¢å¼åŒ–éªŒè¯ | â­â­â­â­â­ |
| **æ¨¡å‹æ£€æŸ¥** | TLA+, Alloy | â­â­â­â­ | ç³»ç»ŸéªŒè¯ | â­â­â­â­ |
| **æµ‹è¯•éªŒè¯** | æµ‹è¯•æ¡†æ¶ | â­â­â­â­â­ | åº”ç”¨å¼€å‘ | â­â­ |
| **è¿è¡Œæ—¶éªŒè¯** | ç›‘æ§å·¥å…· | â­â­â­â­ | ç”Ÿäº§ç¯å¢ƒ | â­â­â­ |

---

## äºŒã€SQLæ­£ç¡®æ€§å®šä¹‰

### 2.1 æ­£ç¡®æ€§å®šä¹‰

**SQLæ­£ç¡®æ€§å½¢å¼åŒ–å®šä¹‰**ï¼š

```latex
SQLæŸ¥è¯¢ q æ˜¯æ­£ç¡®çš„ï¼Œå½“ä¸”ä»…å½“ï¼š
\forall æ•°æ®åº“å®ä¾‹ DB: Result(q, DB) æ»¡è¶³è§„èŒƒ Spec(q)

å…¶ä¸­ï¼š
- Result(q, DB) æ˜¯æŸ¥è¯¢ q åœ¨æ•°æ®åº“ DB ä¸Šçš„æ‰§è¡Œç»“æœ
- Spec(q) æ˜¯æŸ¥è¯¢ q çš„è§„èŒƒï¼ˆé¢„æœŸç»“æœï¼‰
```

### 2.2 æ­£ç¡®æ€§ç±»å‹

**æ­£ç¡®æ€§ç±»å‹**ï¼š

1. **è¯­ä¹‰æ­£ç¡®æ€§**ï¼šæŸ¥è¯¢ç»“æœç¬¦åˆé¢„æœŸè¯­ä¹‰
2. **å®Œæ•´æ€§æ­£ç¡®æ€§**ï¼šæŸ¥è¯¢ä¸è¿åå®Œæ•´æ€§çº¦æŸ
3. **ç­‰ä»·æ€§æ­£ç¡®æ€§**ï¼šæŸ¥è¯¢ä¸è§„èŒƒæŸ¥è¯¢ç­‰ä»·
4. **æ€§èƒ½æ­£ç¡®æ€§**ï¼šæŸ¥è¯¢åœ¨åˆç†æ—¶é—´å†…å®Œæˆ

---

## ä¸‰ã€å½¢å¼åŒ–éªŒè¯æ–¹æ³•

### 3.1 å®šç†è¯æ˜

**å®šç†è¯æ˜æ–¹æ³•**ï¼š

```latex
ä½¿ç”¨å½¢å¼åŒ–è¯æ˜ç³»ç»Ÿï¼ˆå¦‚Coqã€Isabelleï¼‰è¯æ˜SQLæŸ¥è¯¢çš„æ­£ç¡®æ€§ï¼š

1. å°†SQLæŸ¥è¯¢è½¬æ¢ä¸ºå½¢å¼åŒ–è§„èŒƒ
2. ä½¿ç”¨è¯æ˜ç³»ç»Ÿè¯æ˜æŸ¥è¯¢æ»¡è¶³è§„èŒƒ
3. éªŒè¯å®Œæ•´æ€§çº¦æŸ
```

### 3.2 æ¨¡å‹æ£€æŸ¥

**æ¨¡å‹æ£€æŸ¥æ–¹æ³•**ï¼š

```latex
ä½¿ç”¨æ¨¡å‹æ£€æŸ¥å·¥å…·ï¼ˆå¦‚TLA+ã€Alloyï¼‰éªŒè¯SQLæŸ¥è¯¢ï¼š

1. æ„å»ºæŸ¥è¯¢çš„æ¨¡å‹
2. å®šä¹‰æ­£ç¡®æ€§å±æ€§
3. ä½¿ç”¨æ¨¡å‹æ£€æŸ¥å™¨éªŒè¯å±æ€§
```

---

## å››ã€éªŒè¯å·¥å…·

### 4.1 å½¢å¼åŒ–éªŒè¯å·¥å…·

**å·¥å…·åˆ—è¡¨**ï¼š

| å·¥å…· | ç±»å‹ | åŠŸèƒ½ |
|------|------|------|
| **Coq** | è¯æ˜åŠ©æ‰‹ | å½¢å¼åŒ–è¯æ˜ |
| **Isabelle** | è¯æ˜åŠ©æ‰‹ | å½¢å¼åŒ–è¯æ˜ |
| **TLA+** | è§„èŒƒè¯­è¨€ | ç³»ç»Ÿè§„èŒƒéªŒè¯ |
| **Alloy** | æ¨¡å‹æ£€æŸ¥ | æ¨¡å‹éªŒè¯ |

---

## äº”ã€å®é™…æ¡ˆä¾‹

### 5.1 æŸ¥è¯¢æ­£ç¡®æ€§éªŒè¯

### 5.2 åœºæ™¯ç¤ºä¾‹1ï¼šå­¦ç”ŸæŸ¥è¯¢æ­£ç¡®æ€§éªŒè¯

**ä¸šåŠ¡éœ€æ±‚**ï¼šéªŒè¯æŸ¥è¯¢"å¹´é¾„å¤§äº20çš„å­¦ç”Ÿ"çš„æ­£ç¡®æ€§ã€‚

**æŸ¥è¯¢**ï¼š

```sql
SELECT * FROM Student WHERE age > 20;
```

**å½¢å¼åŒ–è§„èŒƒ**ï¼š

```latex
è§„èŒƒï¼šResult = {t | t âˆˆ Student âˆ§ t.age > 20}

éªŒè¯ç›®æ ‡ï¼š
1. å®Œæ•´æ€§ï¼šResult âŠ† Student
2. æ­£ç¡®æ€§ï¼šâˆ€t âˆˆ Result: t.age > 20
3. å®Œå¤‡æ€§ï¼šâˆ€t âˆˆ Student: t.age > 20 âŸ¹ t âˆˆ Result
```

**éªŒè¯æ­¥éª¤**ï¼š

```latex
è¯æ˜ï¼š
1. å®Œæ•´æ€§è¯æ˜ï¼š
   SELECT * FROM Student WHERE age > 20
   âŸ¹ Result âŠ† Student  âœ“

2. æ­£ç¡®æ€§è¯æ˜ï¼š
   WHERE age > 20
   âŸ¹ âˆ€t âˆˆ Result: t.age > 20  âœ“

3. å®Œå¤‡æ€§è¯æ˜ï¼š
   SELECT * FROM Student
   âŸ¹ æ‰€æœ‰æ»¡è¶³æ¡ä»¶çš„å…ƒç»„éƒ½è¢«åŒ…å«  âœ“
```

### 5.3 åœºæ™¯ç¤ºä¾‹2ï¼šè¿æ¥æŸ¥è¯¢æ­£ç¡®æ€§éªŒè¯

**ä¸šåŠ¡éœ€æ±‚**ï¼šéªŒè¯å­¦ç”Ÿé€‰è¯¾æŸ¥è¯¢çš„æ­£ç¡®æ€§ã€‚

**æŸ¥è¯¢**ï¼š

```sql
SELECT s.name, c.course_name, e.score
FROM Student s
JOIN Enrollment e ON s.student_id = e.student_id
JOIN Course c ON e.course_id = c.course_id
WHERE e.score >= 90;
```

**å½¢å¼åŒ–è§„èŒƒ**ï¼š

```latex
è§„èŒƒï¼šResult = {
    (s.name, c.course_name, e.score) |
    s âˆˆ Student âˆ§
    e âˆˆ Enrollment âˆ§
    c âˆˆ Course âˆ§
    s.student_id = e.student_id âˆ§
    e.course_id = c.course_id âˆ§
    e.score â‰¥ 90
}
```

**éªŒè¯æ­¥éª¤**ï¼š

```latex
è¯æ˜ï¼š
1. è¿æ¥æ­£ç¡®æ€§ï¼š
   JOIN Enrollment e ON s.student_id = e.student_id
   âŸ¹ è¿æ¥æ¡ä»¶æ­£ç¡®  âœ“

2. æ¡ä»¶æ­£ç¡®æ€§ï¼š
   WHERE e.score >= 90
   âŸ¹ åªåŒ…å«åˆ†æ•°â‰¥90çš„è®°å½•  âœ“

3. æŠ•å½±æ­£ç¡®æ€§ï¼š
   SELECT s.name, c.course_name, e.score
   âŸ¹ æŠ•å½±åˆ—æ­£ç¡®  âœ“
```

### 5.4 åœºæ™¯ç¤ºä¾‹3ï¼šèšåˆæŸ¥è¯¢æ­£ç¡®æ€§éªŒè¯

**ä¸šåŠ¡éœ€æ±‚**ï¼šéªŒè¯ç»Ÿè®¡æ¯é—¨è¯¾ç¨‹å¹³å‡åˆ†çš„æŸ¥è¯¢æ­£ç¡®æ€§ã€‚

**æŸ¥è¯¢**ï¼š

```sql
SELECT
    c.course_id,
    c.course_name,
    AVG(e.score) AS avg_score
FROM Course c
LEFT JOIN Enrollment e ON c.course_id = e.course_id
GROUP BY c.course_id, c.course_name;
```

**å½¢å¼åŒ–è§„èŒƒ**ï¼š

```latex
è§„èŒƒï¼šResult = {
    (c.course_id, c.course_name, avg_score) |
    c âˆˆ Course âˆ§
    avg_score = AVG({e.score | e âˆˆ Enrollment âˆ§ e.course_id = c.course_id})
}
```

**éªŒè¯æ­¥éª¤**ï¼š

```latex
è¯æ˜ï¼š
1. åˆ†ç»„æ­£ç¡®æ€§ï¼š
   GROUP BY c.course_id, c.course_name
   âŸ¹ æŒ‰è¯¾ç¨‹åˆ†ç»„  âœ“

2. èšåˆæ­£ç¡®æ€§ï¼š
   AVG(e.score)
   âŸ¹ è®¡ç®—å¹³å‡åˆ†  âœ“

3. å¤–è¿æ¥æ­£ç¡®æ€§ï¼š
   LEFT JOIN Enrollment e
   âŸ¹ åŒ…å«æ²¡æœ‰é€‰è¯¾çš„è¯¾ç¨‹  âœ“
```

**éªŒè¯å·¥å…·ä½¿ç”¨ç¤ºä¾‹**ï¼š

```text
ä½¿ç”¨Coqè¿›è¡Œå½¢å¼åŒ–éªŒè¯ï¼š

Definition query_correct (q: Query) (spec: Specification) : Prop :=
  forall db: Database,
    result(q, db) = spec(db).

Theorem student_query_correct:
  query_correct student_query student_spec.
Proof.
  (* å½¢å¼åŒ–è¯æ˜è¿‡ç¨‹ *)
  ...
Qed.
```

---

## å…­ã€ç›¸å…³èµ„æº

### ç›¸å…³æ–‡æ¡£

- [SQLå½¢å¼åŒ–è¯­ä¹‰](./03.01-SQLå½¢å¼åŒ–è¯­ä¹‰.md) - SQLå½¢å¼åŒ–è¯­ä¹‰
- [æŸ¥è¯¢ç­‰ä»·æ€§ç†è®º](./03.02-æŸ¥è¯¢ç­‰ä»·æ€§ç†è®º.md) - æŸ¥è¯¢ç­‰ä»·æ€§

---

**ç»´æŠ¤è€…**: SQL Standards Team
**æœ€åæ›´æ–°**: 2025-01-15
