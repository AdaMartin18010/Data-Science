# ä»£ä»·æ¨¡å‹ç†è®º

> **åˆ›å»ºæ—¥æœŸ**ï¼š2025-12-01
> **æœ€åæ›´æ–°**ï¼š2025-12-01
> **ç‰ˆæœ¬**ï¼šv1.0.0
> **éš¾åº¦**ï¼šâ­â­â­â­â­
> **åº”ç”¨åœºæ™¯**ï¼šæŸ¥è¯¢ä¼˜åŒ–ã€æ‰§è¡Œè®¡åˆ’é€‰æ‹©ã€æ€§èƒ½é¢„æµ‹

---

## ğŸ“‹ ç›®å½•

- [ä»£ä»·æ¨¡å‹ç†è®º](#ä»£ä»·æ¨¡å‹ç†è®º)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [ä¸€ã€æ¦‚è¿°](#ä¸€æ¦‚è¿°)
    - [1.1 ä»£ä»·æ¨¡å‹å®šä¹‰](#11-ä»£ä»·æ¨¡å‹å®šä¹‰)
    - [1.2 ä»£ä»·æ¨¡å‹çŸ¥è¯†ä½“ç³»](#12-ä»£ä»·æ¨¡å‹çŸ¥è¯†ä½“ç³»)
  - [äºŒã€ä»£ä»·æ¨¡å‹æ•°å­¦å®šä¹‰](#äºŒä»£ä»·æ¨¡å‹æ•°å­¦å®šä¹‰)
    - [2.1 åŸºæœ¬ä»£ä»·å‡½æ•°](#21-åŸºæœ¬ä»£ä»·å‡½æ•°)
    - [2.2 æ“ä½œç¬¦ä»£ä»·æ¨¡å‹](#22-æ“ä½œç¬¦ä»£ä»·æ¨¡å‹)
    - [2.3 ç»„åˆä»£ä»·è®¡ç®—](#23-ç»„åˆä»£ä»·è®¡ç®—)
  - [ä¸‰ã€ç»Ÿè®¡ä¿¡æ¯ä¸åŸºæ•°ä¼°è®¡](#ä¸‰ç»Ÿè®¡ä¿¡æ¯ä¸åŸºæ•°ä¼°è®¡)
    - [3.1 ç»Ÿè®¡ä¿¡æ¯ç±»å‹](#31-ç»Ÿè®¡ä¿¡æ¯ç±»å‹)
    - [3.2 é€‰æ‹©ç‡ä¼°è®¡](#32-é€‰æ‹©ç‡ä¼°è®¡)
    - [3.3 è¿æ¥åŸºæ•°ä¼°è®¡](#33-è¿æ¥åŸºæ•°ä¼°è®¡)
  - [å››ã€è®¿é—®è·¯å¾„ä»£ä»·](#å››è®¿é—®è·¯å¾„ä»£ä»·)
    - [4.1 é¡ºåºæ‰«æä»£ä»·](#41-é¡ºåºæ‰«æä»£ä»·)
    - [4.2 ç´¢å¼•æ‰«æä»£ä»·](#42-ç´¢å¼•æ‰«æä»£ä»·)
    - [4.3 ä½å›¾æ‰«æä»£ä»·](#43-ä½å›¾æ‰«æä»£ä»·)
  - [äº”ã€è¿æ¥ç®—æ³•ä»£ä»·](#äº”è¿æ¥ç®—æ³•ä»£ä»·)
    - [5.1 åµŒå¥—å¾ªç¯è¿æ¥](#51-åµŒå¥—å¾ªç¯è¿æ¥)
    - [5.2 å“ˆå¸Œè¿æ¥](#52-å“ˆå¸Œè¿æ¥)
    - [5.3 æ’åºåˆå¹¶è¿æ¥](#53-æ’åºåˆå¹¶è¿æ¥)
    - [5.4 è¿æ¥ç®—æ³•é€‰æ‹©å†³ç­–æ ‘](#54-è¿æ¥ç®—æ³•é€‰æ‹©å†³ç­–æ ‘)
  - [å…­ã€ä»£ä»·ä¼°è®¡å‡†ç¡®æ€§åˆ†æ](#å…­ä»£ä»·ä¼°è®¡å‡†ç¡®æ€§åˆ†æ)
    - [6.1 ä¼°è®¡è¯¯å·®æ¥æº](#61-ä¼°è®¡è¯¯å·®æ¥æº)
    - [6.2 å‡†ç¡®æ€§åº¦é‡](#62-å‡†ç¡®æ€§åº¦é‡)
    - [6.3 è¯¯å·®ä¼ æ’­åˆ†æ](#63-è¯¯å·®ä¼ æ’­åˆ†æ)
  - [ä¸ƒã€ä¼˜åŒ–å™¨æ­£ç¡®æ€§è¯æ˜](#ä¸ƒä¼˜åŒ–å™¨æ­£ç¡®æ€§è¯æ˜)
    - [7.1 ä¼˜åŒ–å™¨æ­£ç¡®æ€§å®šä¹‰](#71-ä¼˜åŒ–å™¨æ­£ç¡®æ€§å®šä¹‰)
    - [7.2 å±€éƒ¨æœ€ä¼˜æ€§è¯æ˜](#72-å±€éƒ¨æœ€ä¼˜æ€§è¯æ˜)
    - [7.3 å…¨å±€æœ€ä¼˜æ€§åˆ†æ](#73-å…¨å±€æœ€ä¼˜æ€§åˆ†æ)
  - [å…«ã€2025å‘é‡æ£€ç´¢ä»£ä»·æ¨¡å‹](#å…«2025å‘é‡æ£€ç´¢ä»£ä»·æ¨¡å‹)
    - [8.1 å‘é‡ç´¢å¼•ä»£ä»·æ¨¡å‹](#81-å‘é‡ç´¢å¼•ä»£ä»·æ¨¡å‹)
    - [8.2 æ··åˆæŸ¥è¯¢ä»£ä»·ä¼°è®¡](#82-æ··åˆæŸ¥è¯¢ä»£ä»·ä¼°è®¡)
    - [8.3 ä»£ä»·æ¨¡å‹å¯¹æ¯”çŸ©é˜µ](#83-ä»£ä»·æ¨¡å‹å¯¹æ¯”çŸ©é˜µ)
  - [ä¹ã€ç›¸å…³èµ„æº](#ä¹ç›¸å…³èµ„æº)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)
    - [ç»å…¸è®ºæ–‡](#ç»å…¸è®ºæ–‡)

---

## ä¸€ã€æ¦‚è¿°

### 1.1 ä»£ä»·æ¨¡å‹å®šä¹‰

**ä»£ä»·æ¨¡å‹ï¼ˆCost Modelï¼‰**æ˜¯æŸ¥è¯¢ä¼˜åŒ–å™¨ç”¨äºä¼°è®¡æŸ¥è¯¢æ‰§è¡Œè®¡åˆ’ä»£ä»·çš„æ•°å­¦æ¨¡å‹ï¼Œç”¨äºåœ¨å¤šä¸ªç­‰ä»·æ‰§è¡Œè®¡åˆ’ä¸­é€‰æ‹©æœ€ä¼˜æ–¹æ¡ˆã€‚

**å½¢å¼åŒ–å®šä¹‰**ï¼š

```text
ä»£ä»·æ¨¡å‹ C: Plan â†’ â„âº

å…¶ä¸­:
- Plan æ˜¯æ‰€æœ‰å¯èƒ½æ‰§è¡Œè®¡åˆ’çš„é›†åˆ
- C(p) è¡¨ç¤ºè®¡åˆ’ p çš„ä¼°è®¡ä»£ä»·
- ä¼˜åŒ–ç›®æ ‡: æ‰¾åˆ° p* = argmin_{p âˆˆ Plans(q)} C(p)
```

### 1.2 ä»£ä»·æ¨¡å‹çŸ¥è¯†ä½“ç³»

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä»£ä»·æ¨¡å‹çŸ¥è¯†ä½“ç³»                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              ä»£ä»·æ¨¡å‹
                                 â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                      â”‚                      â”‚
          â–¼                      â–¼                      â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  è¾“å…¥     â”‚          â”‚  è®¡ç®—     â”‚          â”‚  è¾“å‡º     â”‚
    â”‚          â”‚          â”‚          â”‚          â”‚          â”‚
    â”‚ ç»Ÿè®¡ä¿¡æ¯  â”‚          â”‚ ä»£ä»·å‡½æ•°  â”‚          â”‚ æ‰§è¡Œè®¡åˆ’  â”‚
    â”‚ ç³»ç»Ÿå‚æ•°  â”‚          â”‚ ä»£ä»·ä¼°è®¡  â”‚          â”‚ ä»£ä»·é¢„æµ‹  â”‚
    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                      â”‚
     â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”
     â”‚    â”‚    â”‚            â”‚    â”‚    â”‚            â”‚    â”‚    â”‚
     â–¼    â–¼    â–¼            â–¼    â–¼    â–¼            â–¼    â–¼    â–¼
   è¡Œæ•° ç›´æ–¹å›¾ ç›¸å…³æ€§    I/Oä»£ä»· CPUä»£ä»· å†…å­˜ä»£ä»·   æœ€ä¼˜è®¡åˆ’ ä»£ä»·å€¼ ç½®ä¿¡åº¦
    â”‚    â”‚    â”‚            â”‚    â”‚    â”‚            â”‚    â”‚    â”‚
    â”‚    â”‚    â”‚            â”‚    â”‚    â”‚            â”‚    â”‚    â”‚
    â–¼    â–¼    â–¼            â–¼    â–¼    â–¼            â–¼    â–¼    â–¼
  pg_class histogram correlation  seq_page_cost  é€‰æ‹©è®¡åˆ’  æ€»ä»£ä»·  ä¼°è®¡
  reltuples most_common n_distinct cpu_tuple_cost æ‰§è¡Œ      è¯¯å·®    è¯¯å·®èŒƒå›´
```

---

## äºŒã€ä»£ä»·æ¨¡å‹æ•°å­¦å®šä¹‰

### 2.1 åŸºæœ¬ä»£ä»·å‡½æ•°

**å®šä¹‰2.1 æ€»ä»£ä»·å‡½æ•°**ï¼š

```text
C_total(p) = C_io(p) + w_cpu Ã— C_cpu(p) + w_mem Ã— C_mem(p)

å…¶ä¸­:
- C_io(p)  : I/Oä»£ä»·ï¼ˆç£ç›˜è¯»å†™ï¼‰
- C_cpu(p) : CPUä»£ä»·ï¼ˆè®¡ç®—å¤„ç†ï¼‰
- C_mem(p) : å†…å­˜ä»£ä»·ï¼ˆå†…å­˜åˆ†é…ï¼‰
- w_cpu, w_mem : æƒé‡ç³»æ•°ï¼ˆç›¸å¯¹äºI/Oçš„æ¯”ä¾‹ï¼‰
```

**PostgreSQLä»£ä»·å‚æ•°**ï¼š

| å‚æ•° | é»˜è®¤å€¼ | å«ä¹‰ |
|------|--------|------|
| `seq_page_cost` | 1.0 | é¡ºåºè¯»å–ä¸€ä¸ªé¡µé¢çš„ä»£ä»· |
| `random_page_cost` | 4.0 | éšæœºè¯»å–ä¸€ä¸ªé¡µé¢çš„ä»£ä»· |
| `cpu_tuple_cost` | 0.01 | å¤„ç†ä¸€ä¸ªå…ƒç»„çš„CPUä»£ä»· |
| `cpu_index_tuple_cost` | 0.005 | å¤„ç†ä¸€ä¸ªç´¢å¼•å…ƒç»„çš„ä»£ä»· |
| `cpu_operator_cost` | 0.0025 | æ‰§è¡Œä¸€ä¸ªæ“ä½œç¬¦çš„ä»£ä»· |

### 2.2 æ“ä½œç¬¦ä»£ä»·æ¨¡å‹

**å®šä¹‰2.2 æ‰«ææ“ä½œä»£ä»·**ï¼š

```text
é¡ºåºæ‰«æ:
C_seq(R) = pages(R) Ã— seq_page_cost + tuples(R) Ã— cpu_tuple_cost

ç´¢å¼•æ‰«æ:
C_idx(R, pred) = selectivity(pred) Ã— pages(R) Ã— random_page_cost
               + selectivity(pred) Ã— tuples(R) Ã— cpu_index_tuple_cost
               + height(index) Ã— random_page_cost
```

**å®šä¹‰2.3 è¿æ¥æ“ä½œä»£ä»·**ï¼š

```text
åµŒå¥—å¾ªç¯è¿æ¥:
C_nl(R, S, Î¸) = C_scan(R) + |R| Ã— C_scan(S) + |R| Ã— |S| Ã— cpu_operator_cost

å“ˆå¸Œè¿æ¥:
C_hash(R, S, Î¸) = C_scan(R) + C_scan(S)
                + 3 Ã— (pages(R) + pages(S)) Ã— seq_page_cost  # æ„å»º+æ¢æµ‹+æº¢å‡º
                + (|R| + |S|) Ã— cpu_tuple_cost

æ’åºåˆå¹¶è¿æ¥:
C_merge(R, S, Î¸) = C_sort(R) + C_sort(S) + (|R| + |S|) Ã— cpu_tuple_cost
```

### 2.3 ç»„åˆä»£ä»·è®¡ç®—

**å®šç†2.1 ä»£ä»·å¯åŠ æ€§**ï¼š

```text
å¯¹äºæ‰§è¡Œè®¡åˆ’æ ‘ T = op(Tâ‚, Tâ‚‚, ..., Tâ‚™)ï¼Œæ€»ä»£ä»·ä¸º:

C(T) = C_op(Tâ‚, Tâ‚‚, ..., Tâ‚™) + Î£áµ¢ C(Táµ¢)

å…¶ä¸­ C_op æ˜¯æ“ä½œç¬¦è‡ªèº«çš„ä»£ä»·ï¼ŒC(Táµ¢) æ˜¯å­è®¡åˆ’çš„ä»£ä»·ã€‚
```

**è¯æ˜**ï¼š

```text
æ‰§è¡Œè®¡åˆ’çš„æ‰§è¡Œæ˜¯è‡ªåº•å‘ä¸Šçš„:
1. é¦–å…ˆæ‰§è¡Œæ‰€æœ‰å­è®¡åˆ’ Tâ‚, Tâ‚‚, ..., Tâ‚™
2. ç„¶åæ‰§è¡Œæ“ä½œç¬¦ op

æ€»èµ„æºæ¶ˆè€— = å­è®¡åˆ’èµ„æºæ¶ˆè€— + æ“ä½œç¬¦èµ„æºæ¶ˆè€—
           = Î£áµ¢ C(Táµ¢) + C_op(Tâ‚, Tâ‚‚, ..., Tâ‚™)

ç”±äºèµ„æºæ¶ˆè€—æ˜¯å¯åŠ çš„ï¼ˆI/Oæ¬¡æ•°ã€CPUæ—¶é—´ç­‰ï¼‰ï¼Œ
å› æ­¤ä»£ä»·å‡½æ•°ä¹Ÿæ˜¯å¯åŠ çš„ã€‚

Q.E.D.
```

---

## ä¸‰ã€ç»Ÿè®¡ä¿¡æ¯ä¸åŸºæ•°ä¼°è®¡

### 3.1 ç»Ÿè®¡ä¿¡æ¯ç±»å‹

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ç»Ÿè®¡ä¿¡æ¯å±‚æ¬¡ç»“æ„                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                            ç»Ÿè®¡ä¿¡æ¯
                               â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                      â”‚                      â”‚
        â–¼                      â–¼                      â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  è¡¨çº§ç»Ÿè®¡  â”‚          â”‚  åˆ—çº§ç»Ÿè®¡  â”‚          â”‚  ç´¢å¼•ç»Ÿè®¡  â”‚
  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
        â”‚                      â”‚                      â”‚
   â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”
   â”‚    â”‚    â”‚            â”‚    â”‚    â”‚            â”‚    â”‚    â”‚
   â–¼    â–¼    â–¼            â–¼    â–¼    â–¼            â–¼    â–¼    â–¼
 è¡Œæ•°  é¡µæ•° å¯è§è¡Œ       å”¯ä¸€å€¼ ç©ºå€¼  ç›´æ–¹å›¾      é«˜åº¦  å¶å­  èšç°‡
reltuples relpages       n_distinct null_frac     tree_height pages
                         most_common_vals         correlation
                         most_common_freqs
```

**PostgreSQLç»Ÿè®¡ä¿¡æ¯ç¤ºä¾‹**ï¼š

```sql
-- æŸ¥çœ‹è¡¨çº§ç»Ÿè®¡
SELECT
    relname,
    reltuples::bigint AS row_estimate,
    relpages AS page_count
FROM pg_class
WHERE relname = 'orders';

-- æŸ¥çœ‹åˆ—çº§ç»Ÿè®¡
SELECT
    attname,
    n_distinct,
    null_frac,
    correlation
FROM pg_stats
WHERE tablename = 'orders';
```

### 3.2 é€‰æ‹©ç‡ä¼°è®¡

**å®šä¹‰3.1 é€‰æ‹©ç‡**ï¼š

```text
é€‰æ‹©ç‡ sel(pred, R) = |Ïƒ_pred(R)| / |R|

å…¶ä¸­:
- Ïƒ_pred(R) æ˜¯æ»¡è¶³è°“è¯çš„å…ƒç»„é›†åˆ
- |R| æ˜¯å…³ç³»Rçš„å…ƒç»„æ€»æ•°
- 0 â‰¤ sel(pred, R) â‰¤ 1
```

**é€‰æ‹©ç‡ä¼°è®¡å…¬å¼**ï¼š

```text
ç­‰å€¼è°“è¯ (A = v):
sel(A = v) = 1 / n_distinct(A)  -- å‡åŒ€åˆ†å¸ƒå‡è®¾

èŒƒå›´è°“è¯ (A > v):
sel(A > v) = (max(A) - v) / (max(A) - min(A))  -- å‡åŒ€åˆ†å¸ƒ

INè°“è¯ (A IN (vâ‚, vâ‚‚, ...)):
sel(A IN (...)) = k / n_distinct(A)  -- kæ˜¯INåˆ—è¡¨é•¿åº¦

LIKEè°“è¯ (A LIKE 'prefix%'):
sel(A LIKE 'prefix%') â‰ˆ 1 / |prefix|  -- å¯å‘å¼ä¼°è®¡

ç»„åˆè°“è¯:
sel(pâ‚ AND pâ‚‚) = sel(pâ‚) Ã— sel(pâ‚‚)  -- ç‹¬ç«‹æ€§å‡è®¾
sel(pâ‚ OR pâ‚‚) = sel(pâ‚) + sel(pâ‚‚) - sel(pâ‚) Ã— sel(pâ‚‚)
sel(NOT p) = 1 - sel(p)
```

### 3.3 è¿æ¥åŸºæ•°ä¼°è®¡

**å®šä¹‰3.2 è¿æ¥åŸºæ•°**ï¼š

```text
|R â‹ˆ_Î¸ S| = sel(Î¸) Ã— |R| Ã— |S|

å¯¹äºç­‰å€¼è¿æ¥ R.A = S.B:
sel(R.A = S.B) = 1 / max(n_distinct(R.A), n_distinct(S.B))

å› æ­¤:
|R â‹ˆ_{R.A=S.B} S| = |R| Ã— |S| / max(n_distinct(R.A), n_distinct(S.B))
```

**å¤šè¡¨è¿æ¥åŸºæ•°**ï¼š

```text
|Râ‚ â‹ˆ Râ‚‚ â‹ˆ ... â‹ˆ Râ‚™| = Î áµ¢ |Ráµ¢| Ã— Î â±¼ sel(Î¸â±¼)

å…¶ä¸­ Î¸â±¼ æ˜¯æ‰€æœ‰è¿æ¥æ¡ä»¶ã€‚
```

---

## å››ã€è®¿é—®è·¯å¾„ä»£ä»·

### 4.1 é¡ºåºæ‰«æä»£ä»·

**å®šä¹‰4.1 é¡ºåºæ‰«æä»£ä»·æ¨¡å‹**ï¼š

```text
C_seq(R) = pages(R) Ã— seq_page_cost
         + tuples(R) Ã— cpu_tuple_cost
         + tuples(R) Ã— qual_cost  -- è°“è¯è¯„ä¼°ä»£ä»·

å…¶ä¸­:
- pages(R) = ceil(tuples(R) Ã— tuple_size / page_size)
- qual_cost = Î£ cpu_operator_cost Ã— complexity(op)
```

**SQLéªŒè¯**ï¼š

```sql
-- æŸ¥çœ‹é¡ºåºæ‰«æä»£ä»·
EXPLAIN (ANALYZE, COSTS, BUFFERS)
SELECT * FROM orders WHERE order_date > '2025-01-01';

-- è¾“å‡ºç¤ºä¾‹:
-- Seq Scan on orders  (cost=0.00..1234.56 rows=10000 width=128)
--   Filter: (order_date > '2025-01-01'::date)
--   Rows Removed by Filter: 90000
--   Buffers: shared hit=500
```

### 4.2 ç´¢å¼•æ‰«æä»£ä»·

**å®šä¹‰4.2 B-treeç´¢å¼•æ‰«æä»£ä»·æ¨¡å‹**ï¼š

```text
C_idx(R, pred) = C_traverse + C_leaf_scan + C_heap_fetch

å…¶ä¸­:
C_traverse = height(index) Ã— random_page_cost
C_leaf_scan = sel(pred) Ã— leaf_pages(index) Ã— random_page_cost
C_heap_fetch = sel(pred) Ã— tuples(R) Ã— random_page_cost Ã— (1 - correlationÂ²)
             -- correlationå½±å“å †è®¿é—®çš„éšæœºæ€§
```

**ç´¢å¼•é€‰æ‹©å†³ç­–å› ç´ **ï¼š

```text
ä½¿ç”¨ç´¢å¼•æ‰«æçš„æ¡ä»¶:
1. sel(pred) < threshold (é€šå¸¸ < 15%)
2. correlation(index_col) è¾ƒé«˜ (å‡å°‘éšæœºI/O)
3. è¦†ç›–ç´¢å¼• (æ— éœ€å›è¡¨)

ä»£ä»·æ¯”è¾ƒ:
è‹¥ C_idx(R, pred) < C_seq(R)ï¼Œé€‰æ‹©ç´¢å¼•æ‰«æ
å¦åˆ™é€‰æ‹©é¡ºåºæ‰«æ
```

### 4.3 ä½å›¾æ‰«æä»£ä»·

**å®šä¹‰4.3 ä½å›¾æ‰«æä»£ä»·æ¨¡å‹**ï¼š

```text
C_bitmap(R, pred) = C_bitmap_index_scan + C_bitmap_heap_scan

C_bitmap_index_scan = height(index) Ã— random_page_cost
                    + sel(pred) Ã— leaf_pages(index) Ã— seq_page_cost

C_bitmap_heap_scan = estimated_pages Ã— seq_page_cost
                   + sel(pred) Ã— tuples(R) Ã— cpu_tuple_cost

å…¶ä¸­:
estimated_pages = min(pages(R), sel(pred) Ã— pages(R) Ã— 2)
-- ä½å›¾å°†éšæœºI/Oè½¬æ¢ä¸ºé¡ºåºI/O
```

---

## äº”ã€è¿æ¥ç®—æ³•ä»£ä»·

### 5.1 åµŒå¥—å¾ªç¯è¿æ¥

**å®šä¹‰5.1 åµŒå¥—å¾ªç¯è¿æ¥ä»£ä»·**ï¼š

```text
ç®€å•åµŒå¥—å¾ªç¯:
C_nl(R, S) = C_scan(R) + |R| Ã— C_scan(S)
           + |R| Ã— |S| Ã— cpu_operator_cost

ç´¢å¼•åµŒå¥—å¾ªç¯:
C_inl(R, S) = C_scan(R) + |R| Ã— C_idx_lookup(S)
            + |R| Ã— sel(Î¸) Ã— |S| Ã— cpu_tuple_cost

å…¶ä¸­ C_idx_lookup(S) = height(index) Ã— random_page_cost + k
     k æ˜¯å¹³å‡åŒ¹é…å…ƒç»„æ•°
```

**é€‚ç”¨åœºæ™¯**ï¼š

```text
é€‚åˆä½¿ç”¨åµŒå¥—å¾ªç¯:
1. å¤–è¡¨å¾ˆå° (|R| < 1000)
2. å†…è¡¨æœ‰é«˜æ•ˆç´¢å¼•
3. é€‰æ‹©ç‡å¾ˆä½ (sel(Î¸) < 0.01)
```

### 5.2 å“ˆå¸Œè¿æ¥

**å®šä¹‰5.2 å“ˆå¸Œè¿æ¥ä»£ä»·æ¨¡å‹**ï¼š

```text
å†…å­˜å“ˆå¸Œè¿æ¥ (Rå®Œå…¨è£…å…¥å†…å­˜):
C_hash_mem(R, S) = C_scan(R) + C_scan(S)
                 + |R| Ã— cpu_operator_cost  -- æ„å»ºå“ˆå¸Œè¡¨
                 + |S| Ã— cpu_operator_cost  -- æ¢æµ‹å“ˆå¸Œè¡¨

ç£ç›˜å“ˆå¸Œè¿æ¥ (éœ€è¦åˆ†åŒº):
C_hash_disk(R, S) = C_scan(R) + C_scan(S)
                  + 2 Ã— (pages(R) + pages(S)) Ã— seq_page_cost  -- å†™å…¥ä¸´æ—¶æ–‡ä»¶
                  + 2 Ã— (pages(R) + pages(S)) Ã— seq_page_cost  -- è¯»å–ä¸´æ—¶æ–‡ä»¶
                  + (|R| + |S|) Ã— cpu_operator_cost

åˆ†åŒºæ•°:
num_partitions = ceil(size(R) / work_mem)
```

### 5.3 æ’åºåˆå¹¶è¿æ¥

**å®šä¹‰5.3 æ’åºåˆå¹¶è¿æ¥ä»£ä»·æ¨¡å‹**ï¼š

```text
C_merge(R, S) = C_sort(R) + C_sort(S) + C_merge_scan(R, S)

æ’åºä»£ä»·:
C_sort(R) =
  è‹¥ size(R) â‰¤ work_mem:
    2 Ã— pages(R) Ã— seq_page_cost + |R| Ã— logâ‚‚(|R|) Ã— cpu_operator_cost
  å¦åˆ™:
    2 Ã— pages(R) Ã— seq_page_cost Ã— ceil(log_{M}(pages(R)))
    -- M = work_mem / page_size

åˆå¹¶æ‰«æä»£ä»·:
C_merge_scan(R, S) = pages(R) + pages(S) + (|R| + |S|) Ã— cpu_tuple_cost
```

### 5.4 è¿æ¥ç®—æ³•é€‰æ‹©å†³ç­–æ ‘

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      è¿æ¥ç®—æ³•é€‰æ‹©å†³ç­–æ ‘                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                         è¿æ¥æ“ä½œ
                            â”‚
                            â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ å†…è¡¨æœ‰ç´¢å¼•ä¸”    â”‚
                   â”‚ é€‰æ‹©ç‡ < 1%?    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ æ˜¯          â”‚             â”‚ å¦
              â–¼             â”‚             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ ç´¢å¼•åµŒå¥—å¾ªç¯     â”‚     â”‚    â”‚ æ„å»ºè¡¨å¯è£…å…¥    â”‚
    â”‚ Index NL Join   â”‚     â”‚    â”‚ work_mem?       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚             â”‚
                            â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   â”‚ æ˜¯      â”‚         â”‚ å¦
                            â”‚   â–¼         â”‚         â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ å“ˆå¸Œè¿æ¥   â”‚     â”‚    â”‚ æ•°æ®å·²æ’åº?â”‚
                        â”‚ Hash Join â”‚     â”‚    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚          â”‚
                                          â”‚    â”Œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”
                                          â”‚    â”‚ æ˜¯  â”‚     â”‚ å¦
                                          â”‚    â–¼     â”‚     â–¼
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚ åˆå¹¶è¿æ¥   â”‚ â”‚ â”‚ å¤–éƒ¨æ’åº  â”‚
                                      â”‚ Merge Joinâ”‚ â”‚ â”‚ + åˆå¹¶    â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â”‚
                                                    â”‚
                                          ä»£ä»·æ¯”è¾ƒé€‰æ‹©æœ€ä¼˜

é€‰æ‹©å…¬å¼:
optimal_join = argmin { C_nl, C_hash, C_merge }
```

---

## å…­ã€ä»£ä»·ä¼°è®¡å‡†ç¡®æ€§åˆ†æ

### 6.1 ä¼°è®¡è¯¯å·®æ¥æº

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ä»£ä»·ä¼°è®¡è¯¯å·®æ¥æº                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¯¯å·®æ¥æº                         å½±å“ç¨‹åº¦        è§£å†³æ–¹æ¡ˆ
â”€â”€â”€â”€â”€â”€â”€â”€â”€                        â”€â”€â”€â”€â”€â”€â”€â”€        â”€â”€â”€â”€â”€â”€â”€â”€

1. ç»Ÿè®¡ä¿¡æ¯è¿‡æ—¶                   â­â­â­â­â­      å®šæœŸ ANALYZE
   - æ•°æ®åˆ†å¸ƒå˜åŒ–
   - è¡Œæ•°ä¼°è®¡ä¸å‡†

2. ç‹¬ç«‹æ€§å‡è®¾å¤±æ•ˆ                 â­â­â­â­        å¤šåˆ—ç»Ÿè®¡ä¿¡æ¯
   - åˆ—ç›¸å…³æ€§è¢«å¿½ç•¥                              æ‰©å±•ç»Ÿè®¡
   - ç»„åˆè°“è¯ä¼°è®¡ä¸å‡†

3. å‡åŒ€åˆ†å¸ƒå‡è®¾                   â­â­â­          ç›´æ–¹å›¾
   - æ•°æ®å€¾æ–œ                                   MCVåˆ—è¡¨
   - çƒ­ç‚¹æ•°æ®

4. å‚æ•°ä¼°è®¡è¯¯å·®                   â­â­            æ ¡å‡†ä»£ä»·å‚æ•°
   - seq_page_cost                              ç¡¬ä»¶æµ‹è¯•
   - random_page_cost

5. ç¼“å­˜æ•ˆåº”                       â­â­            effective_cache_size
   - çƒ­æ•°æ®åœ¨ç¼“å­˜                               ç¼“å­˜é¢„çƒ­
   - å®é™…I/Oå‡å°‘
```

### 6.2 å‡†ç¡®æ€§åº¦é‡

**å®šä¹‰6.1 ä¼°è®¡è¯¯å·®**ï¼š

```text
ç›¸å¯¹è¯¯å·®:
RE(estimated, actual) = |estimated - actual| / actual

Q-error (å¸¸ç”¨äºåŸºæ•°ä¼°è®¡):
Q_error = max(estimated/actual, actual/estimated)

å¯¹æ•°è¯¯å·®:
log_error = |log(estimated) - log(actual)|
```

**è¯¯å·®åˆ†ç±»**ï¼š

| è¯¯å·®èŒƒå›´ | åˆ†ç±» | å½±å“ |
|---------|------|------|
| Q-error < 2 | ä¼˜ç§€ | è®¡åˆ’é€‰æ‹©æ­£ç¡® |
| Q-error < 10 | è‰¯å¥½ | è®¡åˆ’åŸºæœ¬æ­£ç¡® |
| Q-error < 100 | ä¸­ç­‰ | å¯èƒ½é€‰é”™è¿æ¥é¡ºåº |
| Q-error > 100 | è¾ƒå·® | è®¡åˆ’å¯èƒ½å¾ˆå·® |

### 6.3 è¯¯å·®ä¼ æ’­åˆ†æ

**å®šç†6.1 è¯¯å·®ä¼ æ’­**ï¼š

```text
è®¾åŸºæ•°ä¼°è®¡çš„ç›¸å¯¹è¯¯å·®ä¸º Îµï¼Œåˆ™:

å•è¡¨é€‰æ‹©:
|Ïƒ_p(R)|_est = (1 + Îµ) Ã— |Ïƒ_p(R)|_actual

ä¸¤è¡¨è¿æ¥ (å‡è®¾ä¸¤è¡¨è¯¯å·®ç‹¬ç«‹):
|R â‹ˆ S|_est = (1 + Îµ_R) Ã— (1 + Îµ_S) Ã— |R â‹ˆ S|_actual

å¤šè¡¨è¿æ¥ (nè¡¨):
è¯¯å·®å¯èƒ½æŒ‡æ•°çº§æ”¾å¤§: (1 + Îµ)^n

ä¾‹: è‹¥ Îµ = 2 (ä¼°è®¡ä¸ºå®é™…çš„3å€), 4è¡¨è¿æ¥:
    è¯¯å·®å› å­ = 3^4 = 81
```

**è¯¯å·®ç´¯ç§¯ç¤ºä¾‹**ï¼š

```text
æŸ¥è¯¢: A â‹ˆ B â‹ˆ C â‹ˆ D

å‡è®¾æ¯ä¸ªè¿æ¥åŸºæ•°ä¼°è®¡è¯¯å·®ä¸º2x:

|A|_est = 2 Ã— |A|_actual
|A â‹ˆ B|_est = 4 Ã— |A â‹ˆ B|_actual
|A â‹ˆ B â‹ˆ C|_est = 8 Ã— |A â‹ˆ B â‹ˆ C|_actual
|A â‹ˆ B â‹ˆ C â‹ˆ D|_est = 16 Ã— |A â‹ˆ B â‹ˆ C â‹ˆ D|_actual

è¯¯å·®æ”¾å¤§16å€ï¼
```

---

## ä¸ƒã€ä¼˜åŒ–å™¨æ­£ç¡®æ€§è¯æ˜

### 7.1 ä¼˜åŒ–å™¨æ­£ç¡®æ€§å®šä¹‰

**å®šä¹‰7.1 ä¼˜åŒ–å™¨æ­£ç¡®æ€§**ï¼š

```text
ä¼˜åŒ–å™¨ O æ˜¯æ­£ç¡®çš„ï¼Œå½“ä¸”ä»…å½“:

1. è¯­ä¹‰ä¿æŒæ€§:
   âˆ€ æŸ¥è¯¢ q, è®¡åˆ’ p = O(q):
   result(p, db) = result(q, db)

2. ä»£ä»·æœ€ä¼˜æ€§:
   âˆ€ æŸ¥è¯¢ q, è®¡åˆ’ p = O(q):
   p = argmin_{p' âˆˆ equivalent_plans(q)} C(p')
```

### 7.2 å±€éƒ¨æœ€ä¼˜æ€§è¯æ˜

**å®šç†7.1 åŠ¨æ€è§„åˆ’æœ€ä¼˜æ€§**ï¼š

```text
ä½¿ç”¨åŠ¨æ€è§„åˆ’çš„æŸ¥è¯¢ä¼˜åŒ–å™¨ï¼ˆå¦‚System Ré£æ ¼ï¼‰æ‰¾åˆ°çš„è®¡åˆ’æ˜¯å±€éƒ¨æœ€ä¼˜çš„ã€‚

è¯æ˜:

è®¾ P(S) è¡¨ç¤ºå…³ç³»é›†åˆSçš„æœ€ä¼˜è®¡åˆ’ã€‚

é€’å½’å®šä¹‰:
P({R}) = best_access_path(R)
P(S) = min_{R âŠ‚ S, R â‰  âˆ…, R â‰  S} { cost(join(P(R), P(S-R))) }

ç”±æœ€ä¼˜å­ç»“æ„æ€§è´¨:
è‹¥ P(S) æ˜¯æœ€ä¼˜çš„ï¼Œåˆ™ P(R) å’Œ P(S-R) ä¹Ÿæ˜¯å„è‡ªçš„æœ€ä¼˜è§£ã€‚

åè¯æ³•:
å‡è®¾ P(R) ä¸æ˜¯æœ€ä¼˜çš„ï¼Œå­˜åœ¨æ›´å¥½çš„ P'(R)ã€‚
åˆ™ join(P'(R), P(S-R)) çš„ä»£ä»·æ›´ä½ï¼Œ
è¿™ä¸ P(S) æ˜¯æœ€ä¼˜è§£çŸ›ç›¾ã€‚

å› æ­¤ï¼ŒåŠ¨æ€è§„åˆ’æ‰¾åˆ°çš„è®¡åˆ’æ˜¯æœ€ä¼˜çš„ã€‚

Q.E.D.
```

### 7.3 å…¨å±€æœ€ä¼˜æ€§åˆ†æ

**å®šç†7.2 å…¨å±€æœ€ä¼˜æ€§é™åˆ¶**ï¼š

```text
ä¼ ç»Ÿä¼˜åŒ–å™¨åªèƒ½ä¿è¯åœ¨ä»¥ä¸‹å‡è®¾ä¸‹çš„æœ€ä¼˜æ€§:

1. ä»£ä»·æ¨¡å‹å‡†ç¡®: C_est(p) = C_actual(p)
2. æœç´¢ç©ºé—´å®Œæ•´: æ‰€æœ‰ç­‰ä»·è®¡åˆ’éƒ½è¢«è€ƒè™‘
3. å•ç›®æ ‡ä¼˜åŒ–: åªä¼˜åŒ–æ‰§è¡Œæ—¶é—´

å®é™…é™åˆ¶:
1. åŸºæ•°ä¼°è®¡è¯¯å·® â†’ ä»£ä»·æ¨¡å‹ä¸å‡†ç¡®
2. å¯å‘å¼å‰ªæ â†’ å¯èƒ½é”™è¿‡æœ€ä¼˜è®¡åˆ’
3. å¤šç›®æ ‡æƒè¡¡ â†’ æ—¶é—´ vs å†…å­˜ vs å¹¶è¡Œåº¦
```

**ä»£ä»·é©±åŠ¨ä¼˜åŒ–å™¨æ­£ç¡®æ€§æ¡ä»¶**ï¼š

```text
è®¾å®é™…ä»£ä»·ä¸º C_realï¼Œä¼°è®¡ä»£ä»·ä¸º C_estï¼Œåˆ™:

ä¼˜åŒ–å™¨é€‰æ‹©çš„è®¡åˆ’ p* = argmin C_est(p)

è‹¥ C_real(p*) ä¹Ÿæ¥è¿‘æœ€ä¼˜ï¼Œéœ€è¦:
|C_est(p) - C_real(p)| / C_real(p) < Îµ

å…¶ä¸­ Îµ æ˜¯å¯æ¥å—çš„è¯¯å·®é˜ˆå€¼ã€‚

åœ¨å®è·µä¸­ï¼Œå½“ Îµ < 0.5 (50%è¯¯å·®) æ—¶ï¼Œ
ä¼˜åŒ–å™¨é€šå¸¸èƒ½é€‰æ‹©è¾ƒå¥½çš„è®¡åˆ’ã€‚
```

---

## å…«ã€2025å‘é‡æ£€ç´¢ä»£ä»·æ¨¡å‹

### 8.1 å‘é‡ç´¢å¼•ä»£ä»·æ¨¡å‹

**å®šä¹‰8.1 HNSWç´¢å¼•ä»£ä»·æ¨¡å‹**ï¼š

```text
C_hnsw(n, d, k, ef_search) =
    C_traversal + C_distance + C_heap_maintenance

å…¶ä¸­:
C_traversal = log(n) Ã— M Ã— random_page_cost
  -- M: HNSWè¿æ¥æ•°, log(n): å¹³å‡å±‚æ•°

C_distance = ef_search Ã— d Ã— cpu_operator_cost
  -- ef_search: æœç´¢å®½åº¦, d: å‘é‡ç»´åº¦

C_heap_maintenance = ef_search Ã— log(k) Ã— cpu_operator_cost
  -- ç»´æŠ¤top-kå †

æ€»ä»£ä»·:
C_hnsw â‰ˆ O(log(n) Ã— M + ef_search Ã— (d + log(k)))
```

**å®šä¹‰8.2 IVFç´¢å¼•ä»£ä»·æ¨¡å‹**ï¼š

```text
C_ivf(n, d, k, nprobe, nlist) =
    C_centroid_search + C_cluster_scan + C_distance

å…¶ä¸­:
C_centroid_search = nlist Ã— d Ã— cpu_operator_cost
  -- æœç´¢æœ€è¿‘è´¨å¿ƒ

C_cluster_scan = nprobe Ã— (n/nlist) Ã— random_page_cost
  -- æ‰«æå€™é€‰ç°‡

C_distance = nprobe Ã— (n/nlist) Ã— d Ã— cpu_operator_cost
  -- è·ç¦»è®¡ç®—

æ€»ä»£ä»·:
C_ivf â‰ˆ O(nlist Ã— d + nprobe Ã— n/nlist Ã— d)
```

### 8.2 æ··åˆæŸ¥è¯¢ä»£ä»·ä¼°è®¡

**å®šä¹‰8.3 æ··åˆæŸ¥è¯¢ä»£ä»·**ï¼š

```text
æ··åˆæŸ¥è¯¢: SELECT * FROM docs
          WHERE category = 'tech'
          ORDER BY embedding <=> query_vec
          LIMIT k

C_hybrid = C_filter + C_vector + C_combine

ç­–ç•¥1: å…ˆè¿‡æ»¤åå‘é‡æ£€ç´¢
C_hybrid_1 = C_filter + C_hnsw(filtered_count)

ç­–ç•¥2: å…ˆå‘é‡åè¿‡æ»¤
C_hybrid_2 = C_hnsw(n) + C_filter(retrieved_count)

ç­–ç•¥3: å¹¶è¡Œæ‰§è¡Œ
C_hybrid_3 = max(C_filter, C_hnsw) + C_merge
```

### 8.3 ä»£ä»·æ¨¡å‹å¯¹æ¯”çŸ©é˜µ

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ä»£ä»·æ¨¡å‹å¯¹æ¯”çŸ©é˜µ                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ“ä½œç±»å‹      â”‚  I/Oå¤æ‚åº¦       â”‚  CPUå¤æ‚åº¦       â”‚  å…¸å‹åœºæ™¯          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é¡ºåºæ‰«æ      â”‚ O(pages)        â”‚ O(n)            â”‚ å…¨è¡¨æŸ¥è¯¢           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ B-treeç´¢å¼•    â”‚ O(log n + k)    â”‚ O(log n + k)    â”‚ èŒƒå›´æŸ¥è¯¢           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å“ˆå¸Œç´¢å¼•      â”‚ O(1)            â”‚ O(1)            â”‚ ç­‰å€¼æŸ¥è¯¢           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åµŒå¥—å¾ªç¯      â”‚ O(n Ã— m)        â”‚ O(n Ã— m)        â”‚ å°è¡¨è¿æ¥           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å“ˆå¸Œè¿æ¥      â”‚ O(n + m)        â”‚ O(n + m)        â”‚ ç­‰å€¼è¿æ¥           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åˆå¹¶è¿æ¥      â”‚ O(n + m)        â”‚ O(n log n)      â”‚ å·²æ’åºæ•°æ®         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ HNSWå‘é‡æ£€ç´¢  â”‚ O(log n Ã— M)    â”‚ O(ef Ã— d)       â”‚ KNNæ£€ç´¢            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ IVFå‘é‡æ£€ç´¢   â”‚ O(nprobe Ã— n/L) â”‚ O(nprobe Ã— n Ã— d/L)â”‚ å¤§è§„æ¨¡å‘é‡       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¹ã€ç›¸å…³èµ„æº

### ç›¸å…³æ–‡æ¡£

- [SQLå½¢å¼åŒ–è¯­ä¹‰](./03.01-SQLå½¢å¼åŒ–è¯­ä¹‰.md) - æŸ¥è¯¢è¯­ä¹‰åŸºç¡€
- [æŸ¥è¯¢ç­‰ä»·æ€§ç†è®º](./03.02-æŸ¥è¯¢ç­‰ä»·æ€§ç†è®º.md) - æŸ¥è¯¢ä¼˜åŒ–åŸºç¡€
- [SQLæ­£ç¡®æ€§éªŒè¯](./03.03-SQLæ­£ç¡®æ€§éªŒè¯.md) - éªŒè¯æ–¹æ³•
- [SQLçŸ¥è¯†ä½“ç³»å…³ç³»å›¾è°±](../09-æ•´åˆèµ„æº/09.04-SQLçŸ¥è¯†ä½“ç³»å…³ç³»å›¾è°±.md) - çŸ¥è¯†ä½“ç³»

### ç»å…¸è®ºæ–‡

- P. Selinger et al., "Access Path Selection in a Relational Database Management System", SIGMOD 1979
- V. Leis et al., "How Good Are Query Optimizers, Really?", VLDB 2015
- A. Kipf et al., "Learned Cardinalities", CIDR 2019
- R. Marcus et al., "Neo: A Learned Query Optimizer", VLDB 2019

---

**ç»´æŠ¤è€…**: SQL Standards Team
**æœ€åæ›´æ–°**: 2025-12-01
