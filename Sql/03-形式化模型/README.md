# 形式化模型

> **创建日期**：2025-01-15
> **最后更新**：2025-12-01
> **状态**：✅ 已完成 + 2025大学课程对标增强

---

## 📋 目录

- [形式化模型](#形式化模型)
  - [📋 目录](#-目录)
  - [概述](#概述)
  - [文档列表](#文档列表)
    - [核心形式化理论](#核心形式化理论)
    - [优化与执行理论 (2025新增)](#优化与执行理论-2025新增)
  - [知识依赖图](#知识依赖图)
  - [形式化层次](#形式化层次)
  - [与其他模块的关联](#与其他模块的关联)
  - [学习路径建议](#学习路径建议)
    - [基础路径（理解SQL语义）](#基础路径理解sql语义)
    - [优化路径（查询优化）](#优化路径查询优化)
    - [系统路径（数据库内核）](#系统路径数据库内核)
    - [理论路径（形式化证明）](#理论路径形式化证明)

---

## 概述

本模块包含SQL的形式化理论基础，涵盖语义定义、查询优化理论、正确性验证和范畴论建模等核心内容。

**2025增强**：新增执行引擎、并发控制、分布式数据库的形式化理论，对标CMU 15-445/721和MIT 6.830课程。

**核心主题**：

| 主题 | 文档 | 难度 | 关键概念 | 对标课程 |
|------|------|------|---------|---------|
| 形式化语义 | 03.01 | ⭐⭐⭐⭐ | 指称语义、操作语义 | Stanford CS145 |
| 查询等价性 | 03.02 | ⭐⭐⭐⭐⭐ | 等价变换、重写规则 | CMU 15-445 |
| 正确性验证 | 03.03 | ⭐⭐⭐⭐⭐ | 定理证明、模型检查 | 形式方法 |
| 代数对应 | 03.04 | ⭐⭐⭐⭐ | 关系代数、SQL映射 | CS基础 |
| 范畴论 | 03.05 | ⭐⭐⭐⭐⭐ | 函子、自然变换 | 数学基础 |
| 代价模型 | 03.06 | ⭐⭐⭐⭐⭐ | 代价估计、优化器 | CMU 15-445 |
| 执行引擎 🆕 | 03.08 | ⭐⭐⭐⭐⭐ | Volcano模型、向量化 | CMU 15-445 |
| 并发控制 🆕 | 03.09 | ⭐⭐⭐⭐⭐ | 2PL、MVCC、死锁 | MIT 6.830 |
| 分布式 🆕 | 03.10 | ⭐⭐⭐⭐⭐ | CAP、2PC、Raft | CMU 15-721 |

---

## 文档列表

### 核心形式化理论

| 文档 | 描述 | 前置依赖 | 形式化级别 |
|------|------|---------|-----------|
| [03.01 SQL形式化语义](./03.01-SQL形式化语义.md) | 指称语义、操作语义定义 | 01.01, 01.02 | L4 |
| [03.02 查询等价性理论](./03.02-查询等价性理论.md) | 等价变换规则、重写证明 | 03.01 | L4 |
| [03.03 SQL正确性验证](./03.03-SQL正确性验证.md) | 定理证明、模型检查 | 03.01, 03.02 | L5 |
| [03.04 关系代数与SQL对应](./03.04-关系代数与SQL对应.md) | 代数操作到SQL的映射 | 01.02 | L3 |
| [03.05 SQL的范畴论梳理](./03.05-SQL的范畴论梳理.md) | 范畴论建模、函子 | 数学基础 | L5 |

### 优化与执行理论 (2025新增)

| 文档 | 描述 | 对标课程 | 形式化级别 |
|------|------|---------|-----------|
| [03.06 代价模型理论](./03.06-代价模型理论.md) | 代价估计、统计信息 | CMU 15-445 | L4 |
| [03.08 执行引擎形式化理论](./03.08-执行引擎形式化理论.md) 🆕 | Volcano模型、物理算子 | CMU 15-445 | L4 |
| [03.09 并发控制形式化理论](./03.09-并发控制形式化理论.md) 🆕 | 2PL正确性、MVCC | MIT 6.830 | L4 |
| [03.10 分布式数据库形式化理论](./03.10-分布式数据库形式化理论.md) 🆕 | CAP、分布式事务 | CMU 15-721 | L4 |

---

## 知识依赖图

```text
┌─────────────────────────────────────────────────────────────────────────────┐
│                        形式化模型知识依赖图                                   │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌──────────────────┐                                                       │
│  │ 01.* 理论基础     │  ← 关系模型、关系代数、事务理论                        │
│  └────────┬─────────┘                                                       │
│           │                                                                 │
│           ▼                                                                 │
│  ┌──────────────────┐                                                       │
│  │ 03.01 形式化语义  │  ← 指称语义 [[Q]] : Query → P(Tuple)                  │
│  └────────┬─────────┘                                                       │
│           │                                                                 │
│     ┌─────┴──────┬────────────────┬─────────────────┐                       │
│     │            │                │                 │                       │
│     ▼            ▼                ▼                 ▼                       │
│ ┌────────┐  ┌────────┐      ┌────────┐        ┌────────┐                    │
│ │03.02   │  │03.04   │      │03.05   │        │03.06   │                    │
│ │查询等价 │  │代数对应 │      │范畴论  │        │代价模型 │                    │
│ └───┬────┘  └────────┘      └────────┘        └───┬────┘                    │
│     │                                             │                         │
│     ▼                                             ▼                         │
│ ┌────────┐                                   ┌────────┐                     │
│ │03.03   │                                   │03.08   │  ← Volcano模型      │
│ │正确性  │                                   │执行引擎 │                     │
│ │验证    │                                   └───┬────┘                     │
│ └────────┘                                       │                          │
│                     ┌────────────────────────────┴───────────┐              │
│                     │                                        │              │
│                     ▼                                        ▼              │
│               ┌────────┐                               ┌────────┐           │
│               │03.09   │  ← 2PL/MVCC正确性             │03.10   │ ← CAP     │
│               │并发控制 │                               │分布式  │           │
│               └────────┘                               └────────┘           │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 形式化层次

```text
形式化级别定义 (参见 09.05-统一概念定义框架)
─────────────────────────────────────────────────

L1: 描述性     ← 自然语言描述
L2: 半形式化   ← 有符号定义
L3: 形式化     ← 有公理和推导规则
L4: 可验证     ← 有完整证明
L5: 机器验证   ← 可用证明助手验证

本模块文档形式化层次分布:
─────────────────────────────────────
     ┌─────────────────────────────────────────────────┐
  L5 │ 03.03 正确性验证 │ 03.05 范畴论                  │
     ├─────────────────────────────────────────────────┤
  L4 │ 03.01 03.02 03.06 03.08 03.09 03.10            │ ← 主体
     ├─────────────────────────────────────────────────┤
  L3 │ 03.04 代数对应                                  │
     └─────────────────────────────────────────────────┘
```

---

## 与其他模块的关联

```text
┌─────────────────────────────────────────────────────────────────────┐
│                        模块间关联矩阵                                │
├─────────────────┬───────────────────────────────────────────────────┤
│ 本模块文档       │ 关联的其他模块文档                                 │
├─────────────────┼───────────────────────────────────────────────────┤
│ 03.01 形式化语义 │ ← 01.01 关系模型（理论基础）                       │
│                 │ ← 01.02 关系代数（操作语义）                       │
│                 │ → 04.* 语法规范（语义实现）                        │
├─────────────────┼───────────────────────────────────────────────────┤
│ 03.02 查询等价   │ ← 01.02 关系代数（等价规则）                       │
│                 │ → 07.* 实践案例（优化应用）                        │
├─────────────────┼───────────────────────────────────────────────────┤
│ 03.06 代价模型   │ → 06.* 数据库实现（优化器实现）                    │
│                 │ → 09.07 决策推理规则（代价决策）                   │
├─────────────────┼───────────────────────────────────────────────────┤
│ 03.08 执行引擎   │ ← 03.06 代价模型（算子选择）                       │
│                 │ → 06.* 数据库实现（执行差异）                      │
├─────────────────┼───────────────────────────────────────────────────┤
│ 03.09 并发控制   │ ← 01.05 事务理论（ACID）                          │
│                 │ → 06.* 数据库实现（隔离级别实现）                  │
├─────────────────┼───────────────────────────────────────────────────┤
│ 03.10 分布式     │ ← 01.05 事务理论（分布式事务）                     │
│                 │ → 06.* 数据库实现（Citus/CockroachDB）             │
└─────────────────┴───────────────────────────────────────────────────┘
```

---

## 学习路径建议

### 基础路径（理解SQL语义）

```text
01.01 关系模型 → 01.02 关系代数 → 03.01 形式化语义 → 03.04 代数对应
```

### 优化路径（查询优化）

```text
03.01 → 03.02 查询等价 → 03.06 代价模型 → 03.08 执行引擎
```

### 系统路径（数据库内核）

```text
03.08 执行引擎 → 03.09 并发控制 → 03.10 分布式
```

### 理论路径（形式化证明）

```text
03.01 → 03.02 → 03.03 正确性验证 → 03.05 范畴论
```

---

**维护者**: SQL Standards Team
**最后更新**: 2025-12-01
