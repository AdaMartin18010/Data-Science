# 1.2.1 MySQLå½¢å¼æ¨¡å‹

## ğŸ“‘ ç›®å½•

- [1.2.1 MySQLå½¢å¼æ¨¡å‹](#121-mysqlå½¢å¼æ¨¡å‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1. å½¢å¼æ¨¡å‹å®šä¹‰](#11-å½¢å¼æ¨¡å‹å®šä¹‰)
    - [1.2. MySQLå½¢å¼åŒ–ç‰¹å¾](#12-mysqlå½¢å¼åŒ–ç‰¹å¾)
  - [2. å…³ç³»æ¨¡å‹åŸºç¡€](#2-å…³ç³»æ¨¡å‹åŸºç¡€)
    - [2.1. å…³ç³»æ¨¡å‹å®šä¹‰](#21-å…³ç³»æ¨¡å‹å®šä¹‰)
      - [2.1.1. å…³ç³»å®šä¹‰](#211-å…³ç³»å®šä¹‰)
      - [2.1.2. å…³ç³»æ¨¡å¼](#212-å…³ç³»æ¨¡å¼)
    - [2.2. å…³ç³»ä»£æ•°](#22-å…³ç³»ä»£æ•°)
      - [2.2.1. åŸºæœ¬è¿ç®—](#221-åŸºæœ¬è¿ç®—)
      - [2.2.2. æ‰©å±•è¿ç®—](#222-æ‰©å±•è¿ç®—)
    - [2.3. å…³ç³»æ¼”ç®—](#23-å…³ç³»æ¼”ç®—)
      - [2.3.1. å…ƒç»„å…³ç³»æ¼”ç®—](#231-å…ƒç»„å…³ç³»æ¼”ç®—)
      - [2.3.2. åŸŸå…³ç³»æ¼”ç®—](#232-åŸŸå…³ç³»æ¼”ç®—)
  - [3. ERå»ºæ¨¡](#3-erå»ºæ¨¡)
    - [3.1. ERæ¨¡å‹åŸºç¡€](#31-eræ¨¡å‹åŸºç¡€)
      - [3.1.1. å®ä½“](#311-å®ä½“)
      - [3.1.2. å±æ€§](#312-å±æ€§)
      - [3.1.3. å…³ç³»](#313-å…³ç³»)
    - [3.2. ERåˆ°å…³ç³»æ¨¡å‹è½¬æ¢](#32-eråˆ°å…³ç³»æ¨¡å‹è½¬æ¢)
      - [3.2.1. å®ä½“è½¬æ¢](#321-å®ä½“è½¬æ¢)
      - [3.2.2. å…³ç³»è½¬æ¢](#322-å…³ç³»è½¬æ¢)
    - [3.3. ERå»ºæ¨¡å·¥å…·](#33-erå»ºæ¨¡å·¥å…·)
  - [4. çº¦æŸä¸å®Œæ•´æ€§](#4-çº¦æŸä¸å®Œæ•´æ€§)
    - [4.1. å®ä½“å®Œæ•´æ€§](#41-å®ä½“å®Œæ•´æ€§)
      - [4.1.1. ä¸»é”®çº¦æŸ](#411-ä¸»é”®çº¦æŸ)
      - [4.1.2. å”¯ä¸€çº¦æŸ](#412-å”¯ä¸€çº¦æŸ)
    - [4.2. å‚ç…§å®Œæ•´æ€§](#42-å‚ç…§å®Œæ•´æ€§)
      - [4.2.1. å¤–é”®çº¦æŸ](#421-å¤–é”®çº¦æŸ)
      - [4.2.2. å¼•ç”¨åŠ¨ä½œ](#422-å¼•ç”¨åŠ¨ä½œ)
    - [4.3. ç”¨æˆ·å®šä¹‰å®Œæ•´æ€§](#43-ç”¨æˆ·å®šä¹‰å®Œæ•´æ€§)
      - [4.3.1. æ£€æŸ¥çº¦æŸ](#431-æ£€æŸ¥çº¦æŸ)
      - [4.3.2. éç©ºçº¦æŸ](#432-éç©ºçº¦æŸ)
  - [5. èŒƒå¼ç†è®º](#5-èŒƒå¼ç†è®º)
    - [5.1. å‡½æ•°ä¾èµ–](#51-å‡½æ•°ä¾èµ–)
      - [5.1.1. å‡½æ•°ä¾èµ–å®šä¹‰](#511-å‡½æ•°ä¾èµ–å®šä¹‰)
      - [5.1.2. Armstrongå…¬ç†](#512-armstrongå…¬ç†)
    - [5.2. ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰](#52-ç¬¬ä¸€èŒƒå¼1nf)
      - [5.2.1. 1NFå®šä¹‰](#521-1nfå®šä¹‰)
      - [5.2.2. 1NFç¤ºä¾‹](#522-1nfç¤ºä¾‹)
    - [5.3. ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰](#53-ç¬¬äºŒèŒƒå¼2nf)
      - [5.3.1. 2NFå®šä¹‰](#531-2nfå®šä¹‰)
      - [5.3.2. 2NFåˆ†è§£](#532-2nfåˆ†è§£)
    - [5.4. ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰](#54-ç¬¬ä¸‰èŒƒå¼3nf)
      - [5.4.1. 3NFå®šä¹‰](#541-3nfå®šä¹‰)
      - [5.4.2. 3NFåˆ†è§£](#542-3nfåˆ†è§£)
    - [5.5. BCNFèŒƒå¼](#55-bcnfèŒƒå¼)
      - [5.5.1. BCNFå®šä¹‰](#551-bcnfå®šä¹‰)
      - [5.5.2. BCNFåˆ¤å®š](#552-bcnfåˆ¤å®š)
  - [6. MySQLå®ç°ç‰¹æ€§](#6-mysqlå®ç°ç‰¹æ€§)
    - [6.1. å­˜å‚¨å¼•æ“æ”¯æŒ](#61-å­˜å‚¨å¼•æ“æ”¯æŒ)
    - [6.2. çº¦æŸå®ç°](#62-çº¦æŸå®ç°)
    - [6.3. ç´¢å¼•æ”¯æŒ](#63-ç´¢å¼•æ”¯æŒ)
  - [7. å®é™…åº”ç”¨æ¡ˆä¾‹](#7-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [7.1. é‡‘èè¡Œä¸šï¼šè´¦æˆ·-äº¤æ˜“ERå»ºæ¨¡](#71-é‡‘èè¡Œä¸šè´¦æˆ·-äº¤æ˜“erå»ºæ¨¡)
    - [7.2. ç”µå•†è¡Œä¸šï¼šè®¢å•ç³»ç»Ÿå»ºæ¨¡](#72-ç”µå•†è¡Œä¸šè®¢å•ç³»ç»Ÿå»ºæ¨¡)
    - [7.3. åŒ»ç–—è¡Œä¸šï¼šæ‚£è€…-å°±è¯ŠERå»ºæ¨¡](#73-åŒ»ç–—è¡Œä¸šæ‚£è€…-å°±è¯Šerå»ºæ¨¡)
  - [8. å½¢å¼åŒ–å®šä¹‰ä¸è¯æ˜](#8-å½¢å¼åŒ–å®šä¹‰ä¸è¯æ˜)
    - [8.1. å…³ç³»æ¨¡å‹å½¢å¼åŒ–](#81-å…³ç³»æ¨¡å‹å½¢å¼åŒ–)
    - [8.2. èŒƒå¼ç†è®ºå½¢å¼åŒ–](#82-èŒƒå¼ç†è®ºå½¢å¼åŒ–)
  - [9. å¤šè¡¨å¾](#9-å¤šè¡¨å¾)
  - [10. æ€»ç»“ä¸å±•æœ›](#10-æ€»ç»“ä¸å±•æœ›)
    - [10.1. æ€»ç»“](#101-æ€»ç»“)
    - [10.2. å‘å±•è¶‹åŠ¿](#102-å‘å±•è¶‹åŠ¿)
    - [10.3. æœ€ä½³å®è·µ](#103-æœ€ä½³å®è·µ)

---

## 1. æ¦‚è¿°

### 1.1. å½¢å¼æ¨¡å‹å®šä¹‰

**å½¢å¼æ¨¡å‹ï¼ˆFormal Modelï¼‰**æ˜¯ä½¿ç”¨æ•°å­¦ç¬¦å·å’Œé€»è¾‘è§„åˆ™ç²¾ç¡®æè¿°ç³»ç»Ÿè¡Œä¸ºçš„æ¨¡å‹ã€‚

**MySQLå½¢å¼æ¨¡å‹çš„æ ¸å¿ƒè¦ç´ **ï¼š

1. **å…³ç³»æ¨¡å‹**ï¼šåŸºäºé›†åˆè®ºçš„å…³ç³»æ•°æ®æ¨¡å‹
2. **å®Œæ•´æ€§çº¦æŸ**ï¼šå®ä½“å®Œæ•´æ€§ã€å‚ç…§å®Œæ•´æ€§ã€ç”¨æˆ·å®šä¹‰å®Œæ•´æ€§
3. **èŒƒå¼ç†è®º**ï¼šæ•°æ®åº“è§„èŒƒåŒ–ç†è®º
4. **æŸ¥è¯¢æ¨¡å‹**ï¼šå…³ç³»ä»£æ•°å’Œå…³ç³»æ¼”ç®—

### 1.2. MySQLå½¢å¼åŒ–ç‰¹å¾

**MySQLå½¢å¼åŒ–ç‰¹å¾**ï¼š

1. **å…³ç³»æ¨¡å‹å…¼å®¹**ï¼šå®Œå…¨ç¬¦åˆSQLæ ‡å‡†å’Œå…³ç³»æ¨¡å‹ç†è®º
2. **ACIDäº‹åŠ¡**ï¼šæ”¯æŒåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§
3. **å®Œæ•´æ€§çº¦æŸ**ï¼šæ”¯æŒä¸»é”®ã€å¤–é”®ã€å”¯ä¸€ã€æ£€æŸ¥ç­‰çº¦æŸ
4. **èŒƒå¼æ”¯æŒ**ï¼šæ”¯æŒ1NFåˆ°BCNFçš„è§„èŒƒåŒ–è®¾è®¡

---

## 2. å…³ç³»æ¨¡å‹åŸºç¡€

### 2.1. å…³ç³»æ¨¡å‹å®šä¹‰

#### 2.1.1. å…³ç³»å®šä¹‰

**å…³ç³»ï¼ˆRelationï¼‰**æ˜¯ä¸€ä¸ªäºŒç»´è¡¨ï¼Œç”±è¡Œï¼ˆå…ƒç»„ï¼‰å’Œåˆ—ï¼ˆå±æ€§ï¼‰ç»„æˆã€‚

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾å…³ç³» $R$ ä¸ºï¼š

$$R = (A_1, A_2, \ldots, A_n)$$

å…¶ä¸­ $A_i$ æ˜¯å±æ€§ï¼Œ$A_i \in D_i$ï¼ˆ$D_i$ æ˜¯å±æ€§åŸŸï¼‰ã€‚

**å…³ç³»å®ä¾‹**ï¼š

$$r(R) = \{t_1, t_2, \ldots, t_m\}$$

å…¶ä¸­ $t_i = (a_{i1}, a_{i2}, \ldots, a_{in})$ æ˜¯å…ƒç»„ã€‚

**å…³ç³»æ€§è´¨**ï¼š

1. **åŸå­æ€§**ï¼šæ¯ä¸ªå±æ€§å€¼éƒ½æ˜¯åŸå­çš„ï¼Œä¸å¯å†åˆ†
2. **å”¯ä¸€æ€§**ï¼šå…³ç³»ä¸­ä¸å­˜åœ¨é‡å¤çš„å…ƒç»„
3. **æ— åºæ€§**ï¼šå…ƒç»„å’Œå±æ€§çš„é¡ºåºæ— å…³ç´§è¦

**ç¤ºä¾‹**ï¼š

```sql
-- å­¦ç”Ÿå…³ç³»
CREATE TABLE Student (
    student_id INT PRIMARY KEY,
    name VARCHAR(50),
    age INT,
    major VARCHAR(50)
);

-- å…³ç³»å®ä¾‹
-- Student = {
--   (1, 'Alice', 20, 'Computer Science'),
--   (2, 'Bob', 21, 'Mathematics'),
--   (3, 'Charlie', 19, 'Physics')
-- }
```

#### 2.1.2. å…³ç³»æ¨¡å¼

**å…³ç³»æ¨¡å¼ï¼ˆRelation Schemaï¼‰**æ˜¯å…³ç³»çš„ç»“æ„å®šä¹‰ã€‚

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾å…³ç³»æ¨¡å¼ $R$ ä¸ºï¼š

$$R(A_1: D_1, A_2: D_2, \ldots, A_n: D_n)$$

å…¶ä¸­ $A_i$ æ˜¯å±æ€§åï¼Œ$D_i$ æ˜¯å±æ€§åŸŸã€‚

**æ•°æ®åº“æ¨¡å¼**ï¼š

$$\text{Database Schema} = \{R_1, R_2, \ldots, R_k\}$$

å…¶ä¸­ $R_i$ æ˜¯å…³ç³»æ¨¡å¼ã€‚

### 2.2. å…³ç³»ä»£æ•°

#### 2.2.1. åŸºæœ¬è¿ç®—

**åŸºæœ¬å…³ç³»ä»£æ•°è¿ç®—**ï¼š

1. **é€‰æ‹©ï¼ˆSelectionï¼‰**ï¼š$\sigma_{P}(R)$
   - ä»å…³ç³» $R$ ä¸­é€‰æ‹©æ»¡è¶³æ¡ä»¶ $P$ çš„å…ƒç»„
   - $$\sigma_{P}(R) = \{t | t \in R \land P(t)\}$$

2. **æŠ•å½±ï¼ˆProjectionï¼‰**ï¼š$\pi_{A}(R)$
   - ä»å…³ç³» $R$ ä¸­é€‰æ‹©å±æ€§é›†åˆ $A$ çš„åˆ—
   - $$\pi_{A}(R) = \{t[A] | t \in R\}$$

3. **å¹¶ï¼ˆUnionï¼‰**ï¼š$R \cup S$
   - ä¸¤ä¸ªå…³ç³»çš„å¹¶é›†
   - $$R \cup S = \{t | t \in R \lor t \in S\}$$

4. **å·®ï¼ˆDifferenceï¼‰**ï¼š$R - S$
   - ä¸¤ä¸ªå…³ç³»çš„å·®é›†
   - $$R - S = \{t | t \in R \land t \notin S\}$$

5. **ç¬›å¡å°”ç§¯ï¼ˆCartesian Productï¼‰**ï¼š$R \times S$
   - ä¸¤ä¸ªå…³ç³»çš„ç¬›å¡å°”ç§¯
   - $$R \times S = \{(r, s) | r \in R \land s \in S\}$$

6. **è¿æ¥ï¼ˆJoinï¼‰**ï¼š$R \bowtie_{P} S$
   - ä¸¤ä¸ªå…³ç³»çš„è¿æ¥
   - $$R \bowtie_{P} S = \sigma_{P}(R \times S)$$

**SQLå®ç°ç¤ºä¾‹**ï¼š

```sql
-- é€‰æ‹©ï¼šå¹´é¾„å¤§äº20çš„å­¦ç”Ÿ
SELECT * FROM Student WHERE age > 20;
-- å…³ç³»ä»£æ•°ï¼šÏƒ_{age > 20}(Student)

-- æŠ•å½±ï¼šé€‰æ‹©å§“åå’Œä¸“ä¸š
SELECT name, major FROM Student;
-- å…³ç³»ä»£æ•°ï¼šÏ€_{name, major}(Student)

-- å¹¶ï¼šä¸¤ä¸ªå­¦ç”Ÿè¡¨çš„å¹¶é›†
SELECT * FROM Student1
UNION
SELECT * FROM Student2;
-- å…³ç³»ä»£æ•°ï¼šStudent1 âˆª Student2

-- å·®ï¼šStudent1ä¸­ä¸åœ¨Student2ä¸­çš„å­¦ç”Ÿ
SELECT * FROM Student1
WHERE student_id NOT IN (SELECT student_id FROM Student2);
-- å…³ç³»ä»£æ•°ï¼šStudent1 - Student2

-- ç¬›å¡å°”ç§¯
SELECT * FROM Student, Course;
-- å…³ç³»ä»£æ•°ï¼šStudent Ã— Course

-- è¿æ¥ï¼šå­¦ç”Ÿé€‰è¯¾
SELECT * FROM Student s
JOIN Enrollment e ON s.student_id = e.student_id;
-- å…³ç³»ä»£æ•°ï¼šStudent â‹ˆ_{Student.student_id = Enrollment.student_id} Enrollment
```

#### 2.2.2. æ‰©å±•è¿ç®—

**æ‰©å±•å…³ç³»ä»£æ•°è¿ç®—**ï¼š

1. **è‡ªç„¶è¿æ¥ï¼ˆNatural Joinï¼‰**ï¼š$R \bowtie S$
   - è‡ªåŠ¨åŒ¹é…ç›¸åŒå±æ€§åçš„è¿æ¥
   - $$R \bowtie S = \pi_{R \cup S}(\sigma_{R.A = S.A}(R \times S))$$

2. **å¤–è¿æ¥ï¼ˆOuter Joinï¼‰**ï¼š
   - **å·¦å¤–è¿æ¥**ï¼š$R \mathrel{\rlap{\bowtie}\mkern-1.5mu\bowtie} S$
   - **å³å¤–è¿æ¥**ï¼š$R \bowtie\mkern-1.5mu\mathrel{\rlap{\bowtie}} S$
   - **å…¨å¤–è¿æ¥**ï¼š$R \mathrel{\rlap{\bowtie}\mkern-1.5mu\bowtie\mkern-1.5mu\mathrel{\rlap{\bowtie}}} S$

3. **é™¤ï¼ˆDivisionï¼‰**ï¼š$R \div S$
   - å…³ç³»é™¤æ³•è¿ç®—
   - $$R \div S = \{t | \forall s \in S, (t, s) \in R\}$$

4. **èšåˆï¼ˆAggregationï¼‰**ï¼š$\gamma_{A, F}(R)$
   - åˆ†ç»„èšåˆè¿ç®—
   - å…¶ä¸­ $A$ æ˜¯åˆ†ç»„å±æ€§ï¼Œ$F$ æ˜¯èšåˆå‡½æ•°

**SQLå®ç°ç¤ºä¾‹**ï¼š

```sql
-- è‡ªç„¶è¿æ¥
SELECT * FROM Student NATURAL JOIN Enrollment;
-- å…³ç³»ä»£æ•°ï¼šStudent â‹ˆ Enrollment

-- å·¦å¤–è¿æ¥
SELECT * FROM Student s
LEFT JOIN Enrollment e ON s.student_id = e.student_id;
-- å…³ç³»ä»£æ•°ï¼šStudent â‹ˆâ‹ˆ Enrollment

-- åˆ†ç»„èšåˆ
SELECT major, COUNT(*) as count, AVG(age) as avg_age
FROM Student
GROUP BY major;
-- å…³ç³»ä»£æ•°ï¼šÎ³_{major, COUNT(*), AVG(age)}(Student)
```

### 2.3. å…³ç³»æ¼”ç®—

#### 2.3.1. å…ƒç»„å…³ç³»æ¼”ç®—

**å…ƒç»„å…³ç³»æ¼”ç®—ï¼ˆTuple Relational Calculusï¼‰**ä½¿ç”¨å…ƒç»„å˜é‡è¡¨ç¤ºæŸ¥è¯¢ã€‚

**å½¢å¼åŒ–å®šä¹‰**ï¼š

$$\{t | P(t)\}$$

å…¶ä¸­ $t$ æ˜¯å…ƒç»„å˜é‡ï¼Œ$P(t)$ æ˜¯è°“è¯ã€‚

**ç¤ºä¾‹**ï¼š

```sql
-- æŸ¥è¯¢å¹´é¾„å¤§äº20çš„å­¦ç”Ÿ
-- å…ƒç»„å…³ç³»æ¼”ç®—ï¼š{t | Student(t) âˆ§ t.age > 20}
SELECT * FROM Student WHERE age > 20;

-- æŸ¥è¯¢é€‰è¯¾çš„å­¦ç”Ÿ
-- å…ƒç»„å…³ç³»æ¼”ç®—ï¼š{t | âˆƒe (Enrollment(e) âˆ§ e.student_id = t.student_id)}
SELECT DISTINCT s.* FROM Student s
WHERE EXISTS (SELECT 1 FROM Enrollment e WHERE e.student_id = s.student_id);
```

#### 2.3.2. åŸŸå…³ç³»æ¼”ç®—

**åŸŸå…³ç³»æ¼”ç®—ï¼ˆDomain Relational Calculusï¼‰**ä½¿ç”¨åŸŸå˜é‡è¡¨ç¤ºæŸ¥è¯¢ã€‚

**å½¢å¼åŒ–å®šä¹‰**ï¼š

$$\{<x_1, x_2, \ldots, x_n> | P(x_1, x_2, \ldots, x_n)\}$$

å…¶ä¸­ $x_i$ æ˜¯åŸŸå˜é‡ï¼Œ$P$ æ˜¯è°“è¯ã€‚

---

## 3. ERå»ºæ¨¡

### 3.1. ERæ¨¡å‹åŸºç¡€

#### 3.1.1. å®ä½“

**å®ä½“ï¼ˆEntityï¼‰**æ˜¯ç°å®ä¸–ç•Œä¸­å¯ä»¥åŒºåˆ†çš„äº‹ç‰©ã€‚

**å®ä½“ç±»å‹**ï¼š

1. **å¼ºå®ä½“**ï¼šæœ‰ä¸»é”®çš„å®ä½“
2. **å¼±å®ä½“**ï¼šä¾èµ–å…¶ä»–å®ä½“çš„å®ä½“

**ç¤ºä¾‹**ï¼š

```mermaid
erDiagram
    STUDENT {
        int student_id PK
        string name
        int age
    }
    COURSE {
        int course_id PK
        string title
        int credits
    }
```

#### 3.1.2. å±æ€§

**å±æ€§ï¼ˆAttributeï¼‰**æ˜¯å®ä½“çš„ç‰¹å¾ã€‚

**å±æ€§ç±»å‹**ï¼š

1. **ç®€å•å±æ€§**ï¼šä¸å¯å†åˆ†çš„å±æ€§
2. **å¤åˆå±æ€§**ï¼šå¯ä»¥åˆ†è§£çš„å±æ€§
3. **å¤šå€¼å±æ€§**ï¼šå¯ä»¥æœ‰å¤šä¸ªå€¼çš„å±æ€§
4. **æ´¾ç”Ÿå±æ€§**ï¼šå¯ä»¥ä»å…¶ä»–å±æ€§è®¡ç®—å¾—åˆ°çš„å±æ€§

**é”®å±æ€§**ï¼š

1. **ä¸»é”®ï¼ˆPrimary Keyï¼‰**ï¼šå”¯ä¸€æ ‡è¯†å®ä½“çš„å±æ€§
2. **å€™é€‰é”®ï¼ˆCandidate Keyï¼‰**ï¼šå¯ä»¥ä½œä¸ºä¸»é”®çš„å±æ€§
3. **å¤–é”®ï¼ˆForeign Keyï¼‰**ï¼šå¼•ç”¨å…¶ä»–å®ä½“ä¸»é”®çš„å±æ€§

#### 3.1.3. å…³ç³»

**å…³ç³»ï¼ˆRelationshipï¼‰**æ˜¯å®ä½“ä¹‹é—´çš„å…³è”ã€‚

**å…³ç³»ç±»å‹**ï¼š

1. **ä¸€å¯¹ä¸€ï¼ˆ1:1ï¼‰**ï¼šä¸€ä¸ªå®ä½“å®ä¾‹å¯¹åº”å¦ä¸€ä¸ªå®ä½“å®ä¾‹
2. **ä¸€å¯¹å¤šï¼ˆ1:Nï¼‰**ï¼šä¸€ä¸ªå®ä½“å®ä¾‹å¯¹åº”å¤šä¸ªå®ä½“å®ä¾‹
3. **å¤šå¯¹å¤šï¼ˆM:Nï¼‰**ï¼šå¤šä¸ªå®ä½“å®ä¾‹å¯¹åº”å¤šä¸ªå®ä½“å®ä¾‹

**å…³ç³»åŸºæ•°**ï¼š

- **æœ€å°åŸºæ•°**ï¼šå‚ä¸å…³ç³»çš„æœ€å°å®ä½“æ•°
- **æœ€å¤§åŸºæ•°**ï¼šå‚ä¸å…³ç³»çš„æœ€å¤§å®ä½“æ•°

**ç¤ºä¾‹**ï¼š

```mermaid
erDiagram
    STUDENT ||--o{ ENROLLMENT : "enrolls"
    COURSE ||--o{ ENROLLMENT : "has"
    STUDENT {
        int student_id PK
        string name
    }
    COURSE {
        int course_id PK
        string title
    }
    ENROLLMENT {
        int student_id FK
        int course_id FK
        date enrollment_date
        string grade
    }
```

### 3.2. ERåˆ°å…³ç³»æ¨¡å‹è½¬æ¢

#### 3.2.1. å®ä½“è½¬æ¢

**å¼ºå®ä½“è½¬æ¢**ï¼š

- å®ä½“è½¬æ¢ä¸ºå…³ç³»
- å®ä½“çš„å±æ€§è½¬æ¢ä¸ºå…³ç³»çš„å±æ€§
- å®ä½“çš„ä¸»é”®è½¬æ¢ä¸ºå…³ç³»çš„ä¸»é”®

**å¼±å®ä½“è½¬æ¢**ï¼š

- å¼±å®ä½“è½¬æ¢ä¸ºå…³ç³»
- å¼±å®ä½“çš„éƒ¨åˆ†é”®å’Œä¾èµ–å®ä½“çš„ä¸»é”®ç»„æˆå¤åˆä¸»é”®

**ç¤ºä¾‹**ï¼š

```sql
-- å¼ºå®ä½“ï¼šStudent
CREATE TABLE Student (
    student_id INT PRIMARY KEY,
    name VARCHAR(50),
    age INT
);

-- å¼±å®ä½“ï¼šDependentï¼ˆä¾èµ–Employeeï¼‰
CREATE TABLE Dependent (
    employee_id INT,
    dependent_name VARCHAR(50),
    relationship VARCHAR(20),
    PRIMARY KEY (employee_id, dependent_name),
    FOREIGN KEY (employee_id) REFERENCES Employee(employee_id)
);
```

#### 3.2.2. å…³ç³»è½¬æ¢

**1:1å…³ç³»è½¬æ¢**ï¼š

- åœ¨ä»»ä¸€å®ä½“å…³ç³»ä¸­æ·»åŠ å¤–é”®
- å¤–é”®æ·»åŠ å”¯ä¸€çº¦æŸ

**1:Nå…³ç³»è½¬æ¢**ï¼š

- åœ¨Nç«¯å®ä½“å…³ç³»ä¸­æ·»åŠ å¤–é”®
- å¤–é”®å¼•ç”¨1ç«¯å®ä½“çš„ä¸»é”®

**M:Nå…³ç³»è½¬æ¢**ï¼š

- åˆ›å»ºæ–°çš„å…³ç³»è¡¨
- æ–°è¡¨åŒ…å«ä¸¤ä¸ªå®ä½“çš„ä¸»é”®ä½œä¸ºå¤–é”®
- ä¸¤ä¸ªå¤–é”®ç»„æˆå¤åˆä¸»é”®

**ç¤ºä¾‹**ï¼š

```sql
-- 1:1å…³ç³»ï¼šStudent - StudentProfile
CREATE TABLE Student (
    student_id INT PRIMARY KEY,
    name VARCHAR(50)
);

CREATE TABLE StudentProfile (
    student_id INT PRIMARY KEY,
    address VARCHAR(100),
    phone VARCHAR(20),
    FOREIGN KEY (student_id) REFERENCES Student(student_id)
);

-- 1:Nå…³ç³»ï¼šDepartment - Employee
CREATE TABLE Department (
    dept_id INT PRIMARY KEY,
    dept_name VARCHAR(50)
);

CREATE TABLE Employee (
    employee_id INT PRIMARY KEY,
    name VARCHAR(50),
    dept_id INT,
    FOREIGN KEY (dept_id) REFERENCES Department(dept_id)
);

-- M:Nå…³ç³»ï¼šStudent - Course
CREATE TABLE Student (
    student_id INT PRIMARY KEY,
    name VARCHAR(50)
);

CREATE TABLE Course (
    course_id INT PRIMARY KEY,
    title VARCHAR(100)
);

CREATE TABLE Enrollment (
    student_id INT,
    course_id INT,
    enrollment_date DATE,
    grade VARCHAR(2),
    PRIMARY KEY (student_id, course_id),
    FOREIGN KEY (student_id) REFERENCES Student(student_id),
    FOREIGN KEY (course_id) REFERENCES Course(course_id)
);
```

### 3.3. ERå»ºæ¨¡å·¥å…·

**å¸¸ç”¨ERå»ºæ¨¡å·¥å…·**ï¼š

1. **MySQL Workbench**ï¼šMySQLå®˜æ–¹å·¥å…·
2. **dbdiagram.io**ï¼šåœ¨çº¿ERå›¾å·¥å…·
3. **Lucidchart**ï¼šåœ¨çº¿å›¾è¡¨å·¥å…·
4. **draw.io**ï¼šå…è´¹å›¾è¡¨å·¥å…·
5. **ER/Studio**ï¼šä¸“ä¸šæ•°æ®å»ºæ¨¡å·¥å…·

---

## 4. çº¦æŸä¸å®Œæ•´æ€§

### 4.1. å®ä½“å®Œæ•´æ€§

#### 4.1.1. ä¸»é”®çº¦æŸ

**ä¸»é”®ï¼ˆPrimary Keyï¼‰**å”¯ä¸€æ ‡è¯†å…³ç³»ä¸­çš„æ¯ä¸ªå…ƒç»„ã€‚

**ä¸»é”®æ€§è´¨**ï¼š

1. **å”¯ä¸€æ€§**ï¼šä¸»é”®å€¼å¿…é¡»å”¯ä¸€
2. **éç©ºæ€§**ï¼šä¸»é”®å€¼ä¸èƒ½ä¸ºNULL
3. **ä¸å¯å˜æ€§**ï¼šä¸»é”®å€¼ä¸åº”æ”¹å˜

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾å…³ç³» $R$ çš„ä¸»é”®ä¸º $K$ï¼š

$$\forall t_1, t_2 \in R: t_1[K] = t_2[K] \Rightarrow t_1 = t_2$$

$$\forall t \in R: t[K] \neq \text{NULL}$$

**MySQLå®ç°**ï¼š

```sql
-- å•åˆ—ä¸»é”®
CREATE TABLE Student (
    student_id INT PRIMARY KEY,
    name VARCHAR(50)
);

-- å¤åˆä¸»é”®
CREATE TABLE Enrollment (
    student_id INT,
    course_id INT,
    enrollment_date DATE,
    PRIMARY KEY (student_id, course_id)
);

-- è‡ªå¢ä¸»é”®
CREATE TABLE Student (
    student_id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50)
);
```

#### 4.1.2. å”¯ä¸€çº¦æŸ

**å”¯ä¸€çº¦æŸï¼ˆUnique Constraintï¼‰**ä¿è¯å±æ€§å€¼çš„å”¯ä¸€æ€§ã€‚

**å”¯ä¸€çº¦æŸä¸ä¸»é”®çš„åŒºåˆ«**ï¼š

1. å”¯ä¸€çº¦æŸå…è®¸NULLå€¼ï¼ˆMySQLä¸­å¤šä¸ªNULLå€¼è§†ä¸ºä¸åŒï¼‰
2. ä¸€ä¸ªè¡¨å¯ä»¥æœ‰å¤šä¸ªå”¯ä¸€çº¦æŸï¼Œä½†åªèƒ½æœ‰ä¸€ä¸ªä¸»é”®

**MySQLå®ç°**ï¼š

```sql
-- å”¯ä¸€çº¦æŸ
CREATE TABLE User (
    user_id INT PRIMARY KEY,
    username VARCHAR(50) UNIQUE,
    email VARCHAR(100) UNIQUE
);

-- å¤åˆå”¯ä¸€çº¦æŸ
CREATE TABLE UserRole (
    user_id INT,
    role_id INT,
    UNIQUE (user_id, role_id)
);
```

### 4.2. å‚ç…§å®Œæ•´æ€§

#### 4.2.1. å¤–é”®çº¦æŸ

**å¤–é”®ï¼ˆForeign Keyï¼‰**æ˜¯å¼•ç”¨å…¶ä»–å…³ç³»ä¸»é”®çš„å±æ€§ã€‚

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾å…³ç³» $R_1$ çš„å¤–é”® $FK$ å¼•ç”¨å…³ç³» $R_2$ çš„ä¸»é”® $PK$ï¼š

$$\forall t_1 \in R_1: t_1[FK] \in \pi_{PK}(R_2) \lor t_1[FK] = \text{NULL}$$

**MySQLå®ç°**ï¼š

```sql
-- å¤–é”®çº¦æŸ
CREATE TABLE Department (
    dept_id INT PRIMARY KEY,
    dept_name VARCHAR(50)
);

CREATE TABLE Employee (
    employee_id INT PRIMARY KEY,
    name VARCHAR(50),
    dept_id INT,
    FOREIGN KEY (dept_id) REFERENCES Department(dept_id)
);

-- å‘½åå¤–é”®çº¦æŸ
CREATE TABLE Employee (
    employee_id INT PRIMARY KEY,
    name VARCHAR(50),
    dept_id INT,
    CONSTRAINT fk_dept FOREIGN KEY (dept_id) REFERENCES Department(dept_id)
);
```

#### 4.2.2. å¼•ç”¨åŠ¨ä½œ

**å¼•ç”¨åŠ¨ä½œï¼ˆReferential Actionsï¼‰**å®šä¹‰å¤–é”®å¼•ç”¨çš„è¡Œä¸ºã€‚

**å¼•ç”¨åŠ¨ä½œç±»å‹**ï¼š

1. **CASCADE**ï¼šçº§è”åˆ é™¤/æ›´æ–°
2. **SET NULL**ï¼šè®¾ç½®ä¸ºNULL
3. **SET DEFAULT**ï¼šè®¾ç½®ä¸ºé»˜è®¤å€¼
4. **RESTRICT**ï¼šé™åˆ¶åˆ é™¤/æ›´æ–°ï¼ˆé»˜è®¤ï¼‰
5. **NO ACTION**ï¼šä¸æ‰§è¡Œä»»ä½•åŠ¨ä½œ

**MySQLå®ç°**ï¼š

```sql
-- CASCADEï¼šçº§è”åˆ é™¤
CREATE TABLE Employee (
    employee_id INT PRIMARY KEY,
    name VARCHAR(50),
    dept_id INT,
    FOREIGN KEY (dept_id) REFERENCES Department(dept_id)
    ON DELETE CASCADE
    ON UPDATE CASCADE
);

-- SET NULLï¼šè®¾ç½®ä¸ºNULL
CREATE TABLE Employee (
    employee_id INT PRIMARY KEY,
    name VARCHAR(50),
    dept_id INT,
    FOREIGN KEY (dept_id) REFERENCES Department(dept_id)
    ON DELETE SET NULL
    ON UPDATE SET NULL
);

-- RESTRICTï¼šé™åˆ¶åˆ é™¤
CREATE TABLE Employee (
    employee_id INT PRIMARY KEY,
    name VARCHAR(50),
    dept_id INT,
    FOREIGN KEY (dept_id) REFERENCES Department(dept_id)
    ON DELETE RESTRICT
    ON UPDATE RESTRICT
);
```

### 4.3. ç”¨æˆ·å®šä¹‰å®Œæ•´æ€§

#### 4.3.1. æ£€æŸ¥çº¦æŸ

**æ£€æŸ¥çº¦æŸï¼ˆCheck Constraintï¼‰**å®šä¹‰å±æ€§å€¼çš„æ¡ä»¶ã€‚

**MySQLå®ç°**ï¼š

```sql
-- æ£€æŸ¥çº¦æŸï¼ˆMySQL 8.0.16+ï¼‰
CREATE TABLE Student (
    student_id INT PRIMARY KEY,
    name VARCHAR(50),
    age INT CHECK (age >= 18 AND age <= 100),
    grade VARCHAR(2) CHECK (grade IN ('A', 'B', 'C', 'D', 'F'))
);

-- å‘½åæ£€æŸ¥çº¦æŸ
CREATE TABLE Student (
    student_id INT PRIMARY KEY,
    name VARCHAR(50),
    age INT,
    CONSTRAINT chk_age CHECK (age >= 18 AND age <= 100)
);
```

#### 4.3.2. éç©ºçº¦æŸ

**éç©ºçº¦æŸï¼ˆNOT NULL Constraintï¼‰**ä¿è¯å±æ€§å€¼ä¸ä¸ºNULLã€‚

**MySQLå®ç°**ï¼š

```sql
-- éç©ºçº¦æŸ
CREATE TABLE Student (
    student_id INT PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL,
    phone VARCHAR(20)  -- å…è®¸NULL
);
```

---

## 5. èŒƒå¼ç†è®º

### 5.1. å‡½æ•°ä¾èµ–

#### 5.1.1. å‡½æ•°ä¾èµ–å®šä¹‰

**å‡½æ•°ä¾èµ–ï¼ˆFunctional Dependencyï¼‰**æ˜¯å±æ€§ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾å…³ç³» $R$ï¼Œå±æ€§é›†åˆ $X, Y \subseteq R$ï¼š

$$X \to Y$$

è¡¨ç¤ºå¦‚æœå¯¹äº $R$ ä¸­çš„ä»»æ„ä¸¤ä¸ªå…ƒç»„ $t_1, t_2$ï¼Œå¦‚æœ $t_1[X] = t_2[X]$ï¼Œåˆ™ $t_1[Y] = t_2[Y]$ã€‚

**å‡½æ•°ä¾èµ–ç±»å‹**ï¼š

1. **å®Œå…¨å‡½æ•°ä¾èµ–**ï¼š$X \to Y$ï¼Œä¸” $Y$ ä¸ä¾èµ–äº $X$ çš„ä»»ä½•çœŸå­é›†
2. **éƒ¨åˆ†å‡½æ•°ä¾èµ–**ï¼š$X \to Y$ï¼Œä½† $Y$ ä¾èµ–äº $X$ çš„æŸä¸ªçœŸå­é›†
3. **ä¼ é€’å‡½æ•°ä¾èµ–**ï¼š$X \to Y$ï¼Œ$Y \to Z$ï¼Œä½† $Y \nrightarrow X$

**ç¤ºä¾‹**ï¼š

```sql
-- å…³ç³»ï¼šStudentCourse
-- å±æ€§ï¼šstudent_id, course_id, student_name, course_title, grade
-- å‡½æ•°ä¾èµ–ï¼š
-- {student_id} â†’ {student_name}  -- å®Œå…¨å‡½æ•°ä¾èµ–
-- {course_id} â†’ {course_title}   -- å®Œå…¨å‡½æ•°ä¾èµ–
-- {student_id, course_id} â†’ {grade}  -- å®Œå…¨å‡½æ•°ä¾èµ–
-- {student_id, course_id} â†’ {student_name}  -- éƒ¨åˆ†å‡½æ•°ä¾èµ–
```

#### 5.1.2. Armstrongå…¬ç†

**Armstrongå…¬ç†**æ˜¯å‡½æ•°ä¾èµ–çš„æ¨ç†è§„åˆ™ã€‚

**Armstrongå…¬ç†**ï¼š

1. **è‡ªåæ€§ï¼ˆReflexivityï¼‰**ï¼šå¦‚æœ $Y \subseteq X$ï¼Œåˆ™ $X \to Y$
2. **å¢å¹¿æ€§ï¼ˆAugmentationï¼‰**ï¼šå¦‚æœ $X \to Y$ï¼Œåˆ™ $XZ \to YZ$
3. **ä¼ é€’æ€§ï¼ˆTransitivityï¼‰**ï¼šå¦‚æœ $X \to Y$ ä¸” $Y \to Z$ï¼Œåˆ™ $X \to Z$

**æ¨å¯¼è§„åˆ™**ï¼š

1. **åˆå¹¶ï¼ˆUnionï¼‰**ï¼šå¦‚æœ $X \to Y$ ä¸” $X \to Z$ï¼Œåˆ™ $X \to YZ$
2. **åˆ†è§£ï¼ˆDecompositionï¼‰**ï¼šå¦‚æœ $X \to YZ$ï¼Œåˆ™ $X \to Y$ ä¸” $X \to Z$
3. **ä¼ªä¼ é€’ï¼ˆPseudo-transitivityï¼‰**ï¼šå¦‚æœ $X \to Y$ ä¸” $WY \to Z$ï¼Œåˆ™ $WX \to Z$

### 5.2. ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰

#### 5.2.1. 1NFå®šä¹‰

**ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰**è¦æ±‚å…³ç³»çš„æ¯ä¸ªå±æ€§éƒ½æ˜¯åŸå­çš„ã€‚

**å½¢å¼åŒ–å®šä¹‰**ï¼š

å…³ç³» $R$ æ»¡è¶³1NFï¼Œå½“ä¸”ä»…å½“ï¼š

$$\forall A \in R: \text{dom}(A) \text{ is atomic}$$

**1NFè¦æ±‚**ï¼š

1. æ¯ä¸ªå±æ€§å€¼éƒ½æ˜¯åŸå­çš„ï¼Œä¸å¯å†åˆ†
2. æ¯ä¸ªå±æ€§éƒ½æœ‰å”¯ä¸€çš„åç§°
3. å±æ€§çš„é¡ºåºæ— å…³ç´§è¦
4. å…ƒç»„çš„é¡ºåºæ— å…³ç´§è¦

#### 5.2.2. 1NFç¤ºä¾‹

**è¿å1NFçš„ç¤ºä¾‹**ï¼š

```sql
-- è¿å1NFï¼šphoneå±æ€§åŒ…å«å¤šä¸ªå€¼
CREATE TABLE Student (
    student_id INT PRIMARY KEY,
    name VARCHAR(50),
    phone VARCHAR(100)  -- å¯èƒ½åŒ…å«å¤šä¸ªç”µè¯å·ç ï¼Œå¦‚ "123-456-7890, 098-765-4321"
);
```

**ç¬¦åˆ1NFçš„ç¤ºä¾‹**ï¼š

```sql
-- ç¬¦åˆ1NFï¼šå°†å¤šå€¼å±æ€§åˆ†ç¦»
CREATE TABLE Student (
    student_id INT PRIMARY KEY,
    name VARCHAR(50)
);

CREATE TABLE StudentPhone (
    student_id INT,
    phone VARCHAR(20),
    PRIMARY KEY (student_id, phone),
    FOREIGN KEY (student_id) REFERENCES Student(student_id)
);
```

### 5.3. ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰

#### 5.3.1. 2NFå®šä¹‰

**ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰**è¦æ±‚å…³ç³»æ»¡è¶³1NFï¼Œä¸”æ‰€æœ‰éä¸»å±æ€§å®Œå…¨å‡½æ•°ä¾èµ–äºä¸»é”®ã€‚

**å½¢å¼åŒ–å®šä¹‰**ï¼š

å…³ç³» $R$ æ»¡è¶³2NFï¼Œå½“ä¸”ä»…å½“ï¼š

1. $R$ æ»¡è¶³1NF
2. $\forall A \in \text{non-key}(R): \text{key}(R) \to A$ æ˜¯å®Œå…¨å‡½æ•°ä¾èµ–

**2NFè¦æ±‚**ï¼š

- æ¶ˆé™¤éƒ¨åˆ†å‡½æ•°ä¾èµ–
- éä¸»å±æ€§å¿…é¡»å®Œå…¨ä¾èµ–äºä¸»é”®

#### 5.3.2. 2NFåˆ†è§£

**2NFåˆ†è§£ç®—æ³•**ï¼š

1. è¯†åˆ«éƒ¨åˆ†å‡½æ•°ä¾èµ–
2. å°†å…³ç³»åˆ†è§£ä¸ºå¤šä¸ªå…³ç³»
3. æ¯ä¸ªå…³ç³»çš„ä¸»é”®éƒ½æ˜¯å®Œå…¨å‡½æ•°ä¾èµ–

**ç¤ºä¾‹**ï¼š

```sql
-- è¿å2NFçš„å…³ç³»ï¼šOrderItem
-- å±æ€§ï¼šorder_id, product_id, product_name, quantity, price
-- å‡½æ•°ä¾èµ–ï¼š
-- {order_id, product_id} â†’ {quantity, price}  -- å®Œå…¨å‡½æ•°ä¾èµ–
-- {order_id, product_id} â†’ {product_name}     -- éƒ¨åˆ†å‡½æ•°ä¾èµ–ï¼ˆproduct_id â†’ product_nameï¼‰

-- åˆ†è§£ä¸º2NFï¼š
CREATE TABLE Product (
    product_id INT PRIMARY KEY,
    product_name VARCHAR(100)
);

CREATE TABLE OrderItem (
    order_id INT,
    product_id INT,
    quantity INT,
    price DECIMAL(10, 2),
    PRIMARY KEY (order_id, product_id),
    FOREIGN KEY (product_id) REFERENCES Product(product_id)
);
```

### 5.4. ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰

#### 5.4.1. 3NFå®šä¹‰

**ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰**è¦æ±‚å…³ç³»æ»¡è¶³2NFï¼Œä¸”æ‰€æœ‰éä¸»å±æ€§ä¸ä¼ é€’ä¾èµ–äºä¸»é”®ã€‚

**å½¢å¼åŒ–å®šä¹‰**ï¼š

å…³ç³» $R$ æ»¡è¶³3NFï¼Œå½“ä¸”ä»…å½“ï¼š

1. $R$ æ»¡è¶³2NF
2. $\forall A \in \text{non-key}(R): \neg \exists X \subseteq \text{key}(R), Y \subseteq \text{non-key}(R): \text{key}(R) \to X \to Y \to A$ï¼ˆä¼ é€’ä¾èµ–ï¼‰

**3NFè¦æ±‚**ï¼š

- æ¶ˆé™¤ä¼ é€’å‡½æ•°ä¾èµ–
- éä¸»å±æ€§ä¸ä¾èµ–äºå…¶ä»–éä¸»å±æ€§

#### 5.4.2. 3NFåˆ†è§£

**3NFåˆ†è§£ç®—æ³•**ï¼š

1. è¯†åˆ«ä¼ é€’å‡½æ•°ä¾èµ–
2. å°†å…³ç³»åˆ†è§£ä¸ºå¤šä¸ªå…³ç³»
3. æ¯ä¸ªå…³ç³»æ¶ˆé™¤ä¼ é€’ä¾èµ–

**ç¤ºä¾‹**ï¼š

```sql
-- è¿å3NFçš„å…³ç³»ï¼šEmployee
-- å±æ€§ï¼šemployee_id, name, dept_id, dept_name, dept_location
-- å‡½æ•°ä¾èµ–ï¼š
-- {employee_id} â†’ {name, dept_id}
-- {dept_id} â†’ {dept_name, dept_location}
-- ä¼ é€’ä¾èµ–ï¼š{employee_id} â†’ {dept_id} â†’ {dept_name, dept_location}

-- åˆ†è§£ä¸º3NFï¼š
CREATE TABLE Department (
    dept_id INT PRIMARY KEY,
    dept_name VARCHAR(50),
    dept_location VARCHAR(100)
);

CREATE TABLE Employee (
    employee_id INT PRIMARY KEY,
    name VARCHAR(50),
    dept_id INT,
    FOREIGN KEY (dept_id) REFERENCES Department(dept_id)
);
```

### 5.5. BCNFèŒƒå¼

#### 5.5.1. BCNFå®šä¹‰

**BCNFï¼ˆBoyce-Codd Normal Formï¼‰**è¦æ±‚å…³ç³»çš„æ¯ä¸ªå‡½æ•°ä¾èµ–çš„å·¦éƒ¨éƒ½æ˜¯è¶…é”®ã€‚

**å½¢å¼åŒ–å®šä¹‰**ï¼š

å…³ç³» $R$ æ»¡è¶³BCNFï¼Œå½“ä¸”ä»…å½“ï¼š

$$\forall X \to Y \in F^+: X \text{ is a superkey of } R$$

å…¶ä¸­ $F^+$ æ˜¯å‡½æ•°ä¾èµ–é›†çš„é—­åŒ…ã€‚

**BCNFä¸3NFçš„å…³ç³»**ï¼š

- BCNFæ¯”3NFæ›´ä¸¥æ ¼
- æ»¡è¶³BCNFçš„å…³ç³»ä¸€å®šæ»¡è¶³3NF
- æ»¡è¶³3NFçš„å…³ç³»ä¸ä¸€å®šæ»¡è¶³BCNF

#### 5.5.2. BCNFåˆ¤å®š

**BCNFåˆ¤å®šç®—æ³•**ï¼š

1. è®¡ç®—å‡½æ•°ä¾èµ–é›†çš„é—­åŒ…
2. æ£€æŸ¥æ¯ä¸ªå‡½æ•°ä¾èµ–çš„å·¦éƒ¨æ˜¯å¦ä¸ºè¶…é”®
3. å¦‚æœæ‰€æœ‰å‡½æ•°ä¾èµ–çš„å·¦éƒ¨éƒ½æ˜¯è¶…é”®ï¼Œåˆ™æ»¡è¶³BCNF

**ç¤ºä¾‹**ï¼š

```sql
-- è¿åBCNFçš„å…³ç³»ï¼šTeaching
-- å±æ€§ï¼šstudent_id, course_id, instructor_id
-- å‡½æ•°ä¾èµ–ï¼š
-- {student_id, course_id} â†’ {instructor_id}
-- {instructor_id, course_id} â†’ {student_id}
-- {instructor_id} â†’ {course_id}  -- è¿åBCNFï¼ˆinstructor_idä¸æ˜¯è¶…é”®ï¼‰

-- åˆ†è§£ä¸ºBCNFï¼š
CREATE TABLE CourseInstructor (
    course_id INT,
    instructor_id INT,
    PRIMARY KEY (course_id, instructor_id)
);

CREATE TABLE Enrollment (
    student_id INT,
    course_id INT,
    instructor_id INT,
    PRIMARY KEY (student_id, course_id),
    FOREIGN KEY (course_id, instructor_id) REFERENCES CourseInstructor(course_id, instructor_id)
);
```

---

## 6. MySQLå®ç°ç‰¹æ€§

### 6.1. å­˜å‚¨å¼•æ“æ”¯æŒ

**MySQLæ”¯æŒå¤šç§å­˜å‚¨å¼•æ“**ï¼š

1. **InnoDB**ï¼šæ”¯æŒACIDäº‹åŠ¡ã€å¤–é”®çº¦æŸã€è¡Œçº§é”
2. **MyISAM**ï¼šé«˜é€ŸæŸ¥è¯¢ã€è¡¨çº§é”ã€ä¸æ”¯æŒäº‹åŠ¡
3. **Memory**ï¼šå†…å­˜å­˜å‚¨ã€ä¸´æ—¶è¡¨
4. **Archive**ï¼šå½’æ¡£å­˜å‚¨ã€å‹ç¼©

**å­˜å‚¨å¼•æ“å¯¹çº¦æŸçš„æ”¯æŒ**ï¼š

| çº¦æŸç±»å‹ | InnoDB | MyISAM | Memory | Archive |
|---------|--------|--------|--------|---------|
| ä¸»é”®çº¦æŸ | âœ… | âœ… | âœ… | âœ… |
| å¤–é”®çº¦æŸ | âœ… | âŒ | âŒ | âŒ |
| å”¯ä¸€çº¦æŸ | âœ… | âœ… | âœ… | âœ… |
| æ£€æŸ¥çº¦æŸ | âœ… (8.0.16+) | âœ… (8.0.16+) | âœ… (8.0.16+) | âœ… (8.0.16+) |
| éç©ºçº¦æŸ | âœ… | âœ… | âœ… | âœ… |

### 6.2. çº¦æŸå®ç°

**MySQLçº¦æŸå®ç°**ï¼š

```sql
-- åˆ›å»ºè¡¨æ—¶å®šä¹‰çº¦æŸ
CREATE TABLE Student (
    student_id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE,
    age INT CHECK (age >= 18 AND age <= 100),
    dept_id INT,
    CONSTRAINT fk_dept FOREIGN KEY (dept_id) REFERENCES Department(dept_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE
) ENGINE=InnoDB;

-- ä¿®æ”¹è¡¨æ·»åŠ çº¦æŸ
ALTER TABLE Student
ADD CONSTRAINT chk_age CHECK (age >= 18 AND age <= 100);

-- åˆ é™¤çº¦æŸ
ALTER TABLE Student
DROP CONSTRAINT chk_age;
```

### 6.3. ç´¢å¼•æ”¯æŒ

**MySQLç´¢å¼•ç±»å‹**ï¼š

1. **ä¸»é”®ç´¢å¼•**ï¼šè‡ªåŠ¨åˆ›å»ºï¼Œå”¯ä¸€ä¸”éç©º
2. **å”¯ä¸€ç´¢å¼•**ï¼šä¿è¯å”¯ä¸€æ€§
3. **æ™®é€šç´¢å¼•**ï¼šæé«˜æŸ¥è¯¢æ€§èƒ½
4. **å…¨æ–‡ç´¢å¼•**ï¼šæ”¯æŒå…¨æ–‡æœç´¢
5. **ç©ºé—´ç´¢å¼•**ï¼šæ”¯æŒç©ºé—´æ•°æ®

**ç´¢å¼•å®ç°**ï¼š

```sql
-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_name ON Student(name);
CREATE UNIQUE INDEX idx_email ON Student(email);

-- å¤åˆç´¢å¼•
CREATE INDEX idx_dept_age ON Student(dept_id, age);

-- åˆ é™¤ç´¢å¼•
DROP INDEX idx_name ON Student;
```

---

## 7. å®é™…åº”ç”¨æ¡ˆä¾‹

### 7.1. é‡‘èè¡Œä¸šï¼šè´¦æˆ·-äº¤æ˜“ERå»ºæ¨¡

**åœºæ™¯**ï¼šé“¶è¡Œè´¦æˆ·ç®¡ç†ç³»ç»Ÿ

**ERæ¨¡å‹**ï¼š

```mermaid
erDiagram
    ACCOUNT ||--o{ TRANSACTION : "has"
    ACCOUNT {
        int account_id PK
        string account_number UK
        string customer_name
        decimal balance
        date open_date
    }
    TRANSACTION {
        int transaction_id PK
        int account_id FK
        decimal amount
        string transaction_type
        date transaction_date
        string description
    }
```

**å…³ç³»æ¨¡å‹**ï¼š

```sql
-- è´¦æˆ·è¡¨
CREATE TABLE Account (
    account_id INT AUTO_INCREMENT PRIMARY KEY,
    account_number VARCHAR(20) UNIQUE NOT NULL,
    customer_name VARCHAR(100) NOT NULL,
    balance DECIMAL(15, 2) NOT NULL DEFAULT 0.00,
    open_date DATE NOT NULL,
    CHECK (balance >= 0)
) ENGINE=InnoDB;

-- äº¤æ˜“è¡¨
CREATE TABLE Transaction (
    transaction_id INT AUTO_INCREMENT PRIMARY KEY,
    account_id INT NOT NULL,
    amount DECIMAL(15, 2) NOT NULL,
    transaction_type ENUM('DEPOSIT', 'WITHDRAWAL', 'TRANSFER') NOT NULL,
    transaction_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    description VARCHAR(255),
    FOREIGN KEY (account_id) REFERENCES Account(account_id)
        ON DELETE RESTRICT
        ON UPDATE CASCADE,
    CHECK (amount > 0)
) ENGINE=InnoDB;

-- ç´¢å¼•
CREATE INDEX idx_account_number ON Account(account_number);
CREATE INDEX idx_transaction_date ON Transaction(transaction_date);
CREATE INDEX idx_account_transaction ON Transaction(account_id, transaction_date);
```

**èŒƒå¼åˆ†æ**ï¼š

- **1NF**ï¼šâœ… æ‰€æœ‰å±æ€§éƒ½æ˜¯åŸå­çš„
- **2NF**ï¼šâœ… æ‰€æœ‰éä¸»å±æ€§å®Œå…¨ä¾èµ–äºä¸»é”®
- **3NF**ï¼šâœ… æ²¡æœ‰ä¼ é€’ä¾èµ–
- **BCNF**ï¼šâœ… æ‰€æœ‰å‡½æ•°ä¾èµ–çš„å·¦éƒ¨éƒ½æ˜¯è¶…é”®

### 7.2. ç”µå•†è¡Œä¸šï¼šè®¢å•ç³»ç»Ÿå»ºæ¨¡

**åœºæ™¯**ï¼šç”µå•†è®¢å•ç®¡ç†ç³»ç»Ÿ

**ERæ¨¡å‹**ï¼š

```mermaid
erDiagram
    CUSTOMER ||--o{ ORDER : "places"
    ORDER ||--o{ ORDER_ITEM : "contains"
    PRODUCT ||--o{ ORDER_ITEM : "in"
    ORDER {
        int order_id PK
        int customer_id FK
        date order_date
        decimal total_amount
        string status
    }
    ORDER_ITEM {
        int order_id FK
        int product_id FK
        int quantity
        decimal unit_price
        decimal subtotal
    }
    PRODUCT {
        int product_id PK
        string product_name
        decimal price
        int stock
    }
```

**å…³ç³»æ¨¡å‹**ï¼š

```sql
-- å®¢æˆ·è¡¨
CREATE TABLE Customer (
    customer_id INT AUTO_INCREMENT PRIMARY KEY,
    customer_name VARCHAR(100) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    phone VARCHAR(20),
    address VARCHAR(255)
) ENGINE=InnoDB;

-- äº§å“è¡¨
CREATE TABLE Product (
    product_id INT AUTO_INCREMENT PRIMARY KEY,
    product_name VARCHAR(200) NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    stock INT NOT NULL DEFAULT 0,
    CHECK (price > 0),
    CHECK (stock >= 0)
) ENGINE=InnoDB;

-- è®¢å•è¡¨
CREATE TABLE Order (
    order_id INT AUTO_INCREMENT PRIMARY KEY,
    customer_id INT NOT NULL,
    order_date DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    total_amount DECIMAL(12, 2) NOT NULL,
    status ENUM('PENDING', 'PAID', 'SHIPPED', 'DELIVERED', 'CANCELLED') NOT NULL DEFAULT 'PENDING',
    FOREIGN KEY (customer_id) REFERENCES Customer(customer_id)
        ON DELETE RESTRICT
        ON UPDATE CASCADE,
    CHECK (total_amount >= 0)
) ENGINE=InnoDB;

-- è®¢å•é¡¹è¡¨
CREATE TABLE OrderItem (
    order_id INT NOT NULL,
    product_id INT NOT NULL,
    quantity INT NOT NULL,
    unit_price DECIMAL(10, 2) NOT NULL,
    subtotal DECIMAL(12, 2) NOT NULL,
    PRIMARY KEY (order_id, product_id),
    FOREIGN KEY (order_id) REFERENCES Order(order_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE,
    FOREIGN KEY (product_id) REFERENCES Product(product_id)
        ON DELETE RESTRICT
        ON UPDATE CASCADE,
    CHECK (quantity > 0),
    CHECK (unit_price > 0),
    CHECK (subtotal = quantity * unit_price)
) ENGINE=InnoDB;

-- ç´¢å¼•
CREATE INDEX idx_customer_email ON Customer(email);
CREATE INDEX idx_order_date ON Order(order_date);
CREATE INDEX idx_order_status ON Order(status);
CREATE INDEX idx_order_customer ON Order(customer_id, order_date);
```

### 7.3. åŒ»ç–—è¡Œä¸šï¼šæ‚£è€…-å°±è¯ŠERå»ºæ¨¡

**åœºæ™¯**ï¼šåŒ»é™¢æ‚£è€…å°±è¯Šç®¡ç†ç³»ç»Ÿ

**ERæ¨¡å‹**ï¼š

```mermaid
erDiagram
    PATIENT ||--o{ APPOINTMENT : "makes"
    DOCTOR ||--o{ APPOINTMENT : "treats"
    APPOINTMENT ||--o{ PRESCRIPTION : "results_in"
    MEDICATION ||--o{ PRESCRIPTION : "prescribed_in"
    PATIENT {
        int patient_id PK
        string patient_name
        date birth_date
        string gender
        string phone
    }
    DOCTOR {
        int doctor_id PK
        string doctor_name
        string specialty
        string license_number UK
    }
    APPOINTMENT {
        int appointment_id PK
        int patient_id FK
        int doctor_id FK
        date appointment_date
        string diagnosis
        string notes
    }
    PRESCRIPTION {
        int prescription_id PK
        int appointment_id FK
        int medication_id FK
        int dosage
        string frequency
    }
```

**å…³ç³»æ¨¡å‹**ï¼š

```sql
-- æ‚£è€…è¡¨
CREATE TABLE Patient (
    patient_id INT AUTO_INCREMENT PRIMARY KEY,
    patient_name VARCHAR(100) NOT NULL,
    birth_date DATE NOT NULL,
    gender ENUM('M', 'F', 'OTHER') NOT NULL,
    phone VARCHAR(20),
    address VARCHAR(255),
    CHECK (birth_date <= CURDATE())
) ENGINE=InnoDB;

-- åŒ»ç”Ÿè¡¨
CREATE TABLE Doctor (
    doctor_id INT AUTO_INCREMENT PRIMARY KEY,
    doctor_name VARCHAR(100) NOT NULL,
    specialty VARCHAR(50) NOT NULL,
    license_number VARCHAR(50) UNIQUE NOT NULL,
    phone VARCHAR(20)
) ENGINE=InnoDB;

-- é¢„çº¦è¡¨
CREATE TABLE Appointment (
    appointment_id INT AUTO_INCREMENT PRIMARY KEY,
    patient_id INT NOT NULL,
    doctor_id INT NOT NULL,
    appointment_date DATETIME NOT NULL,
    diagnosis VARCHAR(255),
    notes TEXT,
    FOREIGN KEY (patient_id) REFERENCES Patient(patient_id)
        ON DELETE RESTRICT
        ON UPDATE CASCADE,
    FOREIGN KEY (doctor_id) REFERENCES Doctor(doctor_id)
        ON DELETE RESTRICT
        ON UPDATE CASCADE
) ENGINE=InnoDB;

-- è¯ç‰©è¡¨
CREATE TABLE Medication (
    medication_id INT AUTO_INCREMENT PRIMARY KEY,
    medication_name VARCHAR(100) NOT NULL,
    manufacturer VARCHAR(100),
    unit_price DECIMAL(10, 2),
    CHECK (unit_price >= 0)
) ENGINE=InnoDB;

-- å¤„æ–¹è¡¨
CREATE TABLE Prescription (
    prescription_id INT AUTO_INCREMENT PRIMARY KEY,
    appointment_id INT NOT NULL,
    medication_id INT NOT NULL,
    dosage INT NOT NULL,
    frequency VARCHAR(50) NOT NULL,
    FOREIGN KEY (appointment_id) REFERENCES Appointment(appointment_id)
        ON DELETE CASCADE
        ON UPDATE CASCADE,
    FOREIGN KEY (medication_id) REFERENCES Medication(medication_id)
        ON DELETE RESTRICT
        ON UPDATE CASCADE,
    CHECK (dosage > 0)
) ENGINE=InnoDB;

-- ç´¢å¼•
CREATE INDEX idx_patient_name ON Patient(patient_name);
CREATE INDEX idx_appointment_date ON Appointment(appointment_date);
CREATE INDEX idx_appointment_patient ON Appointment(patient_id, appointment_date);
CREATE INDEX idx_appointment_doctor ON Appointment(doctor_id, appointment_date);
```

---

## 8. å½¢å¼åŒ–å®šä¹‰ä¸è¯æ˜

### 8.1. å…³ç³»æ¨¡å‹å½¢å¼åŒ–

**å…³ç³»æ¨¡å‹å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾æ•°æ®åº“ $D = (R, C, I)$ï¼Œå…¶ä¸­ï¼š

- $R = \{R_1, R_2, \ldots, R_n\}$ï¼šå…³ç³»é›†åˆ
- $C = \{C_1, C_2, \ldots, C_m\}$ï¼šçº¦æŸé›†åˆ
- $I = \{I_1, I_2, \ldots, I_k\}$ï¼šç´¢å¼•é›†åˆ

**å…³ç³» $R_i$ çš„å½¢å¼åŒ–å®šä¹‰**ï¼š

$$R_i = (A_{i1}: D_{i1}, A_{i2}: D_{i2}, \ldots, A_{in}: D_{in})$$

å…¶ä¸­ $A_{ij}$ æ˜¯å±æ€§ï¼Œ$D_{ij}$ æ˜¯å±æ€§åŸŸã€‚

**å…³ç³»å®ä¾‹**ï¼š

$$r_i(R_i) = \{t_1, t_2, \ldots, t_m\}$$

å…¶ä¸­ $t_j = (a_{j1}, a_{j2}, \ldots, a_{jn})$ æ˜¯å…ƒç»„ã€‚

### 8.2. èŒƒå¼ç†è®ºå½¢å¼åŒ–

**å‡½æ•°ä¾èµ–å½¢å¼åŒ–**ï¼š

è®¾å…³ç³» $R$ï¼Œå±æ€§é›†åˆ $X, Y \subseteq R$ï¼š

$$X \to Y \iff \forall t_1, t_2 \in R: t_1[X] = t_2[X] \Rightarrow t_1[Y] = t_2[Y]$$

**èŒƒå¼å½¢å¼åŒ–**ï¼š

- **1NF**ï¼š$\forall A \in R: \text{dom}(A) \text{ is atomic}$
- **2NF**ï¼š$R \text{ satisfies 1NF} \land \forall A \in \text{non-key}(R): \text{key}(R) \to A \text{ is full FD}$
- **3NF**ï¼š$R \text{ satisfies 2NF} \land \neg \exists \text{transitive dependency}$
- **BCNF**ï¼š$\forall X \to Y \in F^+: X \text{ is a superkey}$

---

## 9. å¤šè¡¨å¾

æœ¬ä¸»é¢˜æ”¯æŒå¤šç§è¡¨å¾æ–¹å¼ï¼š

1. **ç¬¦å·è¡¨å¾**ï¼šå½¢å¼åŒ–å®šä¹‰ã€æ•°å­¦å…¬å¼
2. **å›¾ç»“æ„**ï¼šERå›¾ã€å…³ç³»å›¾
3. **ä»£ç å®ç°**ï¼šSQL DDLè¯­å¥
4. **è‡ªç„¶è¯­è¨€**ï¼šæ¦‚å¿µå®šä¹‰ã€è®¾è®¡åŸåˆ™
5. **è¡¨æ ¼**ï¼šçº¦æŸå¯¹æ¯”ã€èŒƒå¼å¯¹æ¯”

---

## 10. æ€»ç»“ä¸å±•æœ›

### 10.1. æ€»ç»“

MySQLå½¢å¼æ¨¡å‹åŸºäºå…³ç³»æ¨¡å‹ç†è®ºï¼Œæä¾›äº†ï¼š

1. **ç†è®ºåŸºç¡€**ï¼šå…³ç³»æ¨¡å‹ã€å…³ç³»ä»£æ•°ã€å…³ç³»æ¼”ç®—
2. **è®¾è®¡æ–¹æ³•**ï¼šERå»ºæ¨¡ã€èŒƒå¼ç†è®º
3. **å®Œæ•´æ€§ä¿è¯**ï¼šå®ä½“å®Œæ•´æ€§ã€å‚ç…§å®Œæ•´æ€§ã€ç”¨æˆ·å®šä¹‰å®Œæ•´æ€§
4. **å®ç°æ”¯æŒ**ï¼šå¤šç§å­˜å‚¨å¼•æ“ã€çº¦æŸæ”¯æŒã€ç´¢å¼•ä¼˜åŒ–

### 10.2. å‘å±•è¶‹åŠ¿

1. **JSONæ”¯æŒ**ï¼šMySQL 5.7+æ”¯æŒJSONæ•°æ®ç±»å‹
2. **æ£€æŸ¥çº¦æŸ**ï¼šMySQL 8.0.16+æ”¯æŒCHECKçº¦æŸ
3. **çª—å£å‡½æ•°**ï¼šMySQL 8.0+æ”¯æŒçª—å£å‡½æ•°
4. **CTEæ”¯æŒ**ï¼šMySQL 8.0+æ”¯æŒå…¬å…±è¡¨è¡¨è¾¾å¼

### 10.3. æœ€ä½³å®è·µ

1. **è§„èŒƒåŒ–è®¾è®¡**ï¼šéµå¾ªèŒƒå¼ç†è®ºï¼Œé¿å…æ•°æ®å†—ä½™
2. **åˆç†ä½¿ç”¨çº¦æŸ**ï¼šåˆ©ç”¨çº¦æŸä¿è¯æ•°æ®å®Œæ•´æ€§
3. **ç´¢å¼•ä¼˜åŒ–**ï¼šä¸ºå¸¸ç”¨æŸ¥è¯¢åˆ›å»ºåˆé€‚çš„ç´¢å¼•
4. **å­˜å‚¨å¼•æ“é€‰æ‹©**ï¼šæ ¹æ®åº”ç”¨åœºæ™¯é€‰æ‹©åˆé€‚çš„å­˜å‚¨å¼•æ“

---

[è¿”å›MySQLå¯¼èˆª](README.md)
