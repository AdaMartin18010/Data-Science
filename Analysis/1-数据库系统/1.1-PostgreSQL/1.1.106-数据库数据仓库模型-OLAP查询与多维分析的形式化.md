# 1.1.106-数据库数据仓库模型-OLAP查询与多维分析的形式化

## 摘要

- 目标：刻画维度建模（星型/雪花）与OLAP操作（切片/切块/钻取/汇总）的形式语义与实现实践。

## 问题定义（形式化）

- 事实表 F 与维表 {D_k}，星型模式下查询等价为在维度约束上的分组聚合。

## 最小示例（可运行）

```sql
-- 事实与维度
CREATE TABLE dim_date (d date primary key, ym date, y int);
CREATE TABLE dim_product (id int primary key, category text);
CREATE TABLE fact_sales (d date, product_id int, amount numeric);

-- OLAP：按月/品类汇总
SELECT dd.ym, dp.category, sum(fs.amount)
FROM fact_sales fs
JOIN dim_date dd ON fs.d = dd.d
JOIN dim_product dp ON fs.product_id = dp.id
GROUP BY dd.ym, dp.category;
```

## 实务要点

- 维度缓慢变化：SCD2保留历史；主键+有效期管理。
- 物化视图：常用聚合做MV；增量刷新与分区配合。
- 索引与分区：时间分区+维度键索引，提升裁剪与聚合性能。

## 交叉引用

- `1.1.60-物化视图选择-查询重写等价与代价界.md`
- `1.1.59-表分区与分区裁剪-语义与等价.md`
- `03-高级特性/03.04-数据仓库与OLAP.md`
