---
title: 1.1.91-数据库审计与合规-完整性约束与审计轨迹的形式化
slug: 1.1.91-数据库审计与合规-完整性约束与审计轨迹的形式化
tags: []
pg_version: 16
status: draft
last_review: 2025-09-12
owner: TBD
---

﻿# 1.1.91 数据库审计与合规：完整性约束与審计轨迹的形式化

## 1. 范畴

- 合规域：访问/变更留痕、数据保留与删除、职责分离、敏感操作审批；
- 审计对象：DDL、DML、登录与权限变更、策略变更（RLS/策略）。

## 2. 事件与轨迹

- 事件模型：`(ts, actor, action, object, before, after, outcome, correlation_id)`；
- 轨迹持久化：审计表/外部日志系统（WORM/对象存储）。

```sql
CREATE TABLE audit_log (
  id bigserial PRIMARY KEY,
  ts timestamptz NOT NULL DEFAULT now(),
  actor text,
  action text,
  object text,
  before jsonb,
  after jsonb,
  outcome text,
  correlation_id text
);
```

## 3. 审计来源

- 服务器日志（`log_statement`, `log_connections` 等）；
- 触发器：对关键表记录 before/after；
- 扩展：pgaudit 等。

## 4. 报表与查询

```sql
-- 近7天敏感表变更
SELECT ts, actor, action, object
FROM audit_log
WHERE object LIKE 'app.customers%'
  AND ts >= now() - interval '7 days'
ORDER BY ts DESC;
```

## 5. 合规策略

- 保留策略：分层留存（热/温/冷）、到期归档与删除；
- 不可抵赖：WORM/对象存储与签名；
- 职责分离：审计管理员与业务管理员分权；
- 审批：变更前置审批与变更后复盘。

## 6. 交叉引用

- `1.1.90-数据库安全模型-访问控制与信息流安全的形式化.md`
- `04-部署运维/04.05-备份与恢复.md`
