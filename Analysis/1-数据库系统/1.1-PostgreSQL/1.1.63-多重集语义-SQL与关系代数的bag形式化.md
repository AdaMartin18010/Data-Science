# 1.1.63 多重集语义：SQL 与关系代数的 Bag 形式化（纯形式化）

## 目录

1. Bag 语义与计数
2. 等价律差异
3. 稳定性与去重

## 1. Bag

- 元组带计数 c∈\(\mathbb{N}\)；操作以半环 (\(\mathbb{N}, +, \times\)) 聚合：
  - 并：计数相加；
  - 连接：计数相乘；
  - 投影：按投影键汇总计数相加；

## 2. 等价差异

- 定理 2.1：在 Bag 语义下，交换律与结合律保持；但差集与选择/投影的可交换性受计数影响需受限版本；
- 命题 2.2：去重（DISTINCT）为从 Bag 到 Set 的映射，非线性，破坏若干等价。

## 3. 稳定性

- 定理 3.1：若查询仅由 +/× 闭合运算构成，则对输入多重集微扰满足 Lipschitz 稳定；DISTINCT 处不满足。
