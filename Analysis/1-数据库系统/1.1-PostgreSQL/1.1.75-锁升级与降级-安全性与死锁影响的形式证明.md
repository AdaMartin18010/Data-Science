# 1.1.75 锁升级与降级：安全性与死锁影响的形式证明（纯形式化）

## 目录

1. 模型与升级/降级操作
2. 安全性条件
3. 对死锁与调度的影响

## 1. 模型

- 升级：共享→排他；降级：排他→共享；
- 资源图与锁兼容矩阵给定（S兼容S，X与任意不兼容）。

## 2. 安全性

- 定理 2.1（升级安全性）：若在升级前持有的共享锁覆盖的读集合未被外部并发写入（无潜在写—写冲突）且升级原子完成，则升级不破坏可串行化。
  证明纲要：升级仅加强互斥，不引入新可见性边，冲突图不新增导致环的边。□
- 定理 2.2（降级安全性）：若降级发生在提交后或对只读后缀阶段，且无其他事务依赖该写锁的不可见性保证，则降级不破坏恢复性。

## 3. 死锁与调度

- 命题 3.1：并发升级可能形成升级—升级环（S→X等待），需采用全序或尝试—回退策略打破循环等待；
- 命题 3.2：允许降级可缓解资源竞争但不改变2PL下的可串行化结论。
