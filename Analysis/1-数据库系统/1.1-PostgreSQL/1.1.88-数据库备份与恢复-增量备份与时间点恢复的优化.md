# 1.1.88-数据库备份与恢复-增量备份与时间点恢复的优化

## 摘要

- 目标：以最小存储与恢复时间达成可靠 RPO/RTO。聚焦基于WAL的增量备份与时间点恢复（PITR）最小实践。

## 问题定义（形式化）

- 给定全量基线B、WAL序列W与目标时间t*，在存储约束S下，选择备份计划P以最小化恢复时间 Cost_restore(P, t*)，同时满足RPO≤δ。

## 最小示例（可运行）

```bash
# 1) 基线备份（示例使用pg_basebackup）
pg_basebackup -D /backup/base_2025_09_11 -F tar -X stream -z -P

# 2) 持续归档WAL（postgresql.conf）
archive_mode = on
archive_command = 'copy "%p" "C:\\pg_wal_archive\\%f"'

# 3) PITR 恢复到指定时间（postgresql.conf / recovery.signal）
restore_command = 'copy "C:\\pg_wal_archive\\%f" "%p"'
recovery_target_time = '2025-09-11 10:00:00+08'
```

## 实务要点

- 基线频率：按变更率与存储成本选择（周/双周）；高变更场景提高归档粒度。
- WAL保留：确保覆盖最近多份基线间隔；存储上限触发滚动清理。
- 恢复演练：季度演练校验恢复窗口、脚本可重复性与监控告警。

## 交叉引用

- `1.1.57-ARIES日志恢复-正确性与不变式.md`
- `1.1.16-性能调优与监控.md`
- `04-部署运维/04.03-备份恢复与灾备.md`
