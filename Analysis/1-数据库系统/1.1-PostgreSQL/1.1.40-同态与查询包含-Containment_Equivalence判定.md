# 1.1.40 同态与查询包含：Containment/Equivalence 判定（纯形式化）

## 目录

1. 查询语法片段（SPJ/含投影）
2. 同态与包含映射
3. 包含与等价的判定准则
4. 复杂度与边界

## 1. 语法片段

- 选择-投影-连接（SPJ）无聚合的正查询。

## 2. 同态

- 定义 2.1（同态）：从查询 Q2 的变量/常量到 Q1 的映射 h，使谓词与连接关系在 h 下保真。

## 3. 判定

- 定理 3.1（Chandra-Merlin）：Q1 ⊆ Q2 当且仅当存在从 Q2 到 Q1 的同态映射。
  证明纲要：
  - 必要性：若 Q1 ⊆ Q2，构造见证映射使 Q2 的原子在 Q1 中成立；
  - 充分性：同态保证对任意实例，Q2 的解可映入 Q1 的解，得包含。
- 推论 3.2：Q1≡Q2 当且仅当 Q1⊆Q2 且 Q2⊆Q1。

## 4. 复杂度

- 命题 4.1：SPJ 包含判定为 NP 完全；等价判定在 Π^p_2 中（取决于片段）。
