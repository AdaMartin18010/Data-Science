# 1.1.12 PostgreSQL与主流数据库系统对比分析

## 目录

- [1.1.12 PostgreSQL与主流数据库系统对比分析](#1112-postgresql与主流数据库系统对比分析)
  - [目录](#目录)
  - [1. MySQL/InnoDB对比](#1-mysqlinnodb对比)
    - [1.1 MVCC实现差异](#11-mvcc实现差异)
    - [1.2 锁机制](#12-锁机制)
    - [1.3 分布式能力](#13-分布式能力)
    - [1.4 存储引擎](#14-存储引擎)
    - [1.5 工程案例与对比表](#15-工程案例与对比表)
    - [1.6 定理与推论](#16-定理与推论)
  - [2. TiDB对比](#2-tidb对比)
    - [2.1 分布式事务与一致性](#21-分布式事务与一致性)
    - [2.2 调度与存储架构](#22-调度与存储架构)
    - [2.3 事务协议对比](#23-事务协议对比)
    - [2.4 工程案例与对比表](#24-工程案例与对比表)
    - [2.5 定理与推论](#25-定理与推论)
  - [3. CockroachDB对比](#3-cockroachdb对比)
  - [4. MongoDB对比](#4-mongodb对比)
  - [5. 关键特性、理论极限、工程实现对比](#5-关键特性理论极限工程实现对比)
  - [6. 适用场景与未来趋势](#6-适用场景与未来趋势)

## 1. MySQL/InnoDB对比

### 1.1 MVCC实现差异

- PostgreSQL：多版本存储于主表，VACUUM清理旧版本。
- InnoDB：多版本通过undo log链表维护，历史版本存于undo页，自动清理。

### 1.2 锁机制

- PostgreSQL：行级锁（MVCC下读不加锁），支持表锁、advisory lock。
- InnoDB：行级锁+间隙锁（Gap Lock），防止幻读，读已提交/可重复读隔离级别。

### 1.3 分布式能力

- PostgreSQL：原生不支持分布式事务，依赖扩展（Citus、XL等）。
- InnoDB：单机为主，分布式需依赖MySQL Group Replication、TiDB等方案。

### 1.4 存储引擎

- PostgreSQL：单一堆表存储，支持插件化表访问方法（如zheap、cstore_fdw）。
- MySQL：多存储引擎（InnoDB、MyISAM、RocksDB等），可按表选择。

### 1.5 工程案例与对比表

| 特性         | PostgreSQL         | MySQL/InnoDB         |
|--------------|--------------------|----------------------|
| MVCC实现     | 主表多版本+VACUUM  | undo log链表         |
| 锁机制       | 行锁/表锁/无Gap锁  | 行锁+间隙锁          |
| 幻读防护     | SI/SSI需显式锁     | Gap Lock自动防护     |
| 分布式能力   | 依赖扩展           | 需外部方案           |
| 存储引擎     | 单一+插件化        | 多引擎可选           |

### 1.6 定理与推论

**定理 1.6.1**：InnoDB的Gap Lock可防止幻读，但会降低并发度。

**证明**：Gap Lock锁定范围，防止插入/删除导致幻读，但增加锁冲突。$\square$

**推论**：PostgreSQL在高并发读写下吞吐量优于InnoDB，但幻读防护需显式加锁。

## 2. TiDB对比

### 2.1 分布式事务与一致性

- PostgreSQL：原生单机事务，分布式需扩展（Citus/XL）。
- TiDB：原生分布式事务，Percolator协议，支持全局快照隔离（SI）。

### 2.2 调度与存储架构

- PostgreSQL：主从复制/分区表，扩展方案需手动分片。
- TiDB：分布式调度器（PD），自动分片（Region），多副本Raft一致性。

### 2.3 事务协议对比

- PostgreSQL扩展多用2PC，存在阻塞与脑裂风险。
- TiDB采用Percolator，两阶段提交+乐观锁，支持大规模分布式并发。

### 2.4 工程案例与对比表

| 特性         | PostgreSQL         | TiDB                  |
|--------------|--------------------|-----------------------|
| 分布式事务   | 需扩展/2PC         | 原生/Percolator       |
| 一致性模型   | SI/SSI（扩展）     | SI（全局）+Raft强一致 |
| 分片机制     | 手动/扩展          | 自动Region分片        |
| 调度         | 静态/扩展          | 动态/PD调度           |
| 容错         | 依赖扩展           | 多副本Raft            |

### 2.5 定理与推论

**定理 2.5.1**：Percolator协议可在大规模分布式环境下实现全局快照隔离。

**证明**：Percolator通过预写锁+两阶段提交，结合全局时间戳分配，保证所有节点读写一致。$\square$

**推论**：TiDB适合大规模弹性扩展场景，PostgreSQL适合单机/中小规模分布式。

## 3. CockroachDB对比

- 分布式SQL、Raft一致性、全局事务等

## 4. MongoDB对比

- 文档模型、弱一致性、分片机制等

## 5. 关键特性、理论极限、工程实现对比

- 表格、LaTeX公式、图表

## 6. 适用场景与未来趋势

- OLTP/OLAP/HTAP/AI等场景下的优劣势
