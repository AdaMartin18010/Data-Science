# 1.1.36 VACUUM 与可见性不变式：垃圾回收正确性（纯形式化）

## 目录

1. 可见性不变式与版本生命周期
2. 安全删除与空间回收条件
3. 冻结（Freeze）与时间线推进

## 1. 可见性不变式

- 不变式 1.1：对任意已提交事务 i，其创建版本的 ts_w 小于所有后续快照，且删除 ts_d 正确界定可见区间。
- 不变式 1.2：VACUUM 不改变对任何活动事务的可见集合。

## 2. 安全删除

- 定理 2.1（安全删除条件）：若不存在快照 s 使 ts_w ≤ s < ts_d，且无未决指针引用，则该版本可删除。
  证明纲要：删除后对任何 s 的可见集合不变。
- 定理 2.2（索引可达性维护）：对索引条目，删除条件与主版本一致，保持查找完备与无悬挂。

## 3. 冻结与时间线

- 定义 3.1（冻结阈值）：当 ts_w 小于全局安全水位，版本可冻结以避免回绕问题。
- 定理 3.2（冻结正确性）：冻结不改变可见性判定，仅替换时间戳域的表示；保持不变式1.1与1.2。
