---
title: 1.1.70-行级安全-RLS策略语义与不可逃逸性证明
slug: 1.1.70-行级安全-RLS策略语义与不可逃逸性证明
tags: []
pg_version: 16
status: draft
last_review: 2025-09-12
owner: TBD
---

﻿# 1.1.70-行级安全-RLS策略语义与不可逃逸性证明

## 摘要

- 目标：为RLS策略给出语义化定义与“不可逃逸”判据，确保任意SQL路径均受策略约束。

## 问题定义（形式化）

- 关系 R 带策略谓词 φ(user, row)。不可逃逸性：对任意查询/函数/视图组合 Q，结果集 ⊆ { r∈R | φ(u,r) }。
- 判据：策略在所有访问路径上被内联；禁止拥有者绕过；SECURITY DEFINER函数需额外约束。

## 最小示例（可运行）

```sql
-- 启用RLS并定义策略
ALTER TABLE orders ENABLE ROW LEVEL SECURITY;
CREATE POLICY p_customer ON orders
USING (customer_id = current_setting('app.user_id')::bigint);

-- 运行前设置应用上下文
SELECT set_config('app.user_id','123', true);
SELECT count(*) FROM orders;  -- 仅统计customer_id=123的行
```

## 实务要点

- 默认拒绝：为避免遗漏，初始策略应窄化；对写操作分别定义 USING/ WITH CHECK。
- 逃逸路径：视图、函数、复制、外部表等均需验证策略生效。
- 审计：记录策略命中率与拒绝事件，检测异常访问模式。

## 交叉引用

- `1.1.90-数据库安全模型-访问控制与信息流安全的形式化.md`
- `1.1.91-数据库审计与合规-完整性约束与审计轨迹的形式化.md`
- `04-部署运维/04.04-安全与合规.md`
