# 08.04-最佳实践总结

## 建模

- 选择恰当的数据类型（范围/数组/JSONB/枚举）；
- 主外键与唯一约束完善，必要时用排他约束；
- 分区按时间/范围设计，确保裁剪生效；
- 高频路径冗余列 + 表达式索引。

## 查询

- 避免 `SELECT *`，仅取所需列；
- 结合 `EXPLAIN (ANALYZE, BUFFERS)` 校验计划与基数；
- 连接顺序受统计影响，保持统计新鲜；
- 窗口函数保证排序唯一性。

## 并发

- 短事务、幂等重试，避免长时间持锁；
- 热点拆分与队列化；
- 需要可串行化时优先使用 SSI；
- 谨慎使用 `SKIP LOCKED`，配合监控。

## 运维

- 自动化 `VACUUM/ANALYZE` 基线；
- 监控连接/命中率/WAL/检查点/Autovacuum；
- 备份策略：全量 + WAL 归档 + 演练；
- 版本与参数变更先预生产灰度验证。

## 安全

- RLS 与最小权限；
- 加密（传输/静态），敏感数据脱敏；
- 审计与告警留痕。

## 交叉引用

- `04-部署运维/04.04-监控与诊断.md`
- `04-部署运维/04.05-备份与恢复.md`
- `1.1.52-窗口聚合语义-稳定性与等价变换.md`
