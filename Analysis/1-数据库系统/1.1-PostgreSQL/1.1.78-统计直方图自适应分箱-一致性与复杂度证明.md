---
title: 1.1.78-统计直方图自适应分箱-一致性与复杂度证明
slug: 1.1.78-统计直方图自适应分箱-一致性与复杂度证明
tags: []
pg_version: 16
status: draft
last_review: 2025-09-12
owner: TBD
---

﻿# 1.1.78-统计直方图自适应分箱-一致性与复杂度证明

## 摘要

- 目标：给出自适应分箱策略在样本量趋近时的一致性条件，以及实现复杂度界与最小实践。

## 问题定义（形式化）

- 样本 X₁..Xₙ，分箱数 k(n) 随 n 增长。估计密度 \hat{p}ₙ(x) 的一致性条件：k(n)→∞ 且 k(n)/n→0。
- 代价：构建复杂度 O(n log n + k)；查询选择率估计误差界与采样误差项分解。

## 最小示例（可运行）

```sql
-- 统计目标列直方图（示例：ANALYZE 收集统计信息）
ALTER TABLE orders ALTER COLUMN amount SET STATISTICS 200; -- 提高桶数上限
ANALYZE orders (amount);

-- 观察估计影响
EXPLAIN SELECT * FROM orders WHERE amount BETWEEN 100 AND 200;
```

## 实务要点

- 桶数与误差：提高统计目标列的统计目标值，以更精细近似分布。
- 非均匀分布：对长尾/多峰分布使用表达式直方图或多列统计（见多列相关）。
- 更新节奏：数据分布漂移时主动 ANALYZE，并结合增量采样策略。

## 交叉引用

- `1.1.49-选择率估计误差-敏感性与上界.md`
- `1.1.76-多列相关-多元正态近似与误差分析.md`
- `02-查询处理/02.03-统计信息与选择率估计.md`
