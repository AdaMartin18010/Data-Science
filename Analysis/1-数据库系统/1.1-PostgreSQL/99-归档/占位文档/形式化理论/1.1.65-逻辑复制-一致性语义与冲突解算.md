---
title: 1.1.65-逻辑复制-一致性语义与冲突解算
slug: 1.1.65-逻辑复制-一致性语义与冲突解算
tags: []
pg_version: 16
status: draft
last_review: 2025-09-12
owner: TBD
---

﻿# 1.1.65-逻辑复制-一致性语义与冲突解算

## 摘要

- 目标：定义逻辑复制在多主/单主拓扑下的一致性语义，并给出冲突解算与回放顺序的最小实践。

## 问题定义（形式化）

- 事件序列以 (txid, lsn, timeline) 标识，复制回放需要满足约束 R：同事务内操作保序，跨节点依据冲突解算函数 g 合并。
- g 示例：LWW（最大时间戳胜）、CRDT合并、应用自定义合并（幂等、结合、交换）。

## 最小示例（可运行）

```sql
-- 发布/订阅（单主示例）
CREATE PUBLICATION app_pub FOR TABLE orders, order_items;
CREATE SUBSCRIPTION app_sub
  CONNECTION 'host=primary port=5432 dbname=app user=replicator password=***'
  PUBLICATION app_pub WITH (create_slot = true, enabled = true);
```

## 实务要点

- 键与时间：行级唯一键与更新时间戳必备；冲突策略明确并可审计。
- 回放隔离：订阅端回放与应用写分离；必要时序列化关键表的写入。
- 监控：复制延迟、冲突次数与回退路径；出错可重放或人工合并。

## 交叉引用

- `1.1.77-逻辑复制冲突策略-Last-Write-Wins与合并函数比较.md`
- `1.1.31-分布式一致性与CAP-形式化刻画与权衡.md`
- `1.1.73-CRDT与最终一致-会合半格与收敛性证明.md`
