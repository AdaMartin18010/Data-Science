# 1.1.33 关系约束与规范化：函数依赖与范式证明

## 1. 定义

- 函数依赖（FD）：在模式 R 上，X→Y 表示任意合法实例中，若两元组在 X 上相同，则在 Y 上也相同。
- 闭包与最小覆盖：F 的闭包 F⁺，属性集 X 的闭包 X⁺；最小覆盖为无冗余且右部单属性的等价FD集。

## 2. Armstrong 公理与推理

- 自反性、增补性、传递性；其完备性保证对 FD 的所有逻辑蕴含可由此推得。

## 3. 无损分解与保持依赖

- 无损分解判据：R 分解为 R1, R2 无损，当且仅当 (R1∩R2)→R1 或 (R1∩R2)→R2 在 F⁺ 中成立。
- 保持依赖：分解后所有FD可由各分片上的投影FD并集推得。

## 4. 3NF 与 BCNF 判据

- 候选键：最小属性集 K 使 K⁺ 覆盖所有属性。
- BCNF：对任意非平凡 FD X→Y，X 为某候选键。
- 3NF：对任意非平凡 FD X→A，X 为候选键或 A 为主属性（属于某候选键）。

## 5. 构造与证明纲要

- 3NF 合成算法：以最小覆盖为基础构造模式集合，若无候选键则附加；保持依赖且无损（可证）。
- BCNF 分解：迭代选择违背FD进行分解，保持无损，但可能不保持依赖；
- 证明要点：
  - 无损性由连接依赖与判据等价给出；
  - 保持依赖通过最小覆盖投影集合等价性证明。

## 6. 示例

```text
R(A,B,C,D), F = { A→B, B→C, CD→A }
1) 求候选键：
  - A⁺={A,B,C}; A 非键
  - CD⁺={C,D,A,B} 覆盖全部 → {C,D} 为候选键
2) 检查BCNF：
  - A→B 违背（A非键） → 分解 R1(A,B), R2(A,C,D)
3) 在 R2 上检查：
  - B→C 不在 R2；CD→A 满足键条件 → 结束
```

## 7. 工程建议

- 规范化到 3NF/BCNF 与性能折中：对于热点查询可在保持一致性的前提下做受控反范式化；
- 使用唯一约束/外键/检查约束强化语义；
- 借助工具求闭包/候选键，避免手算失误。

## 8. 交叉引用

- `1.1.60-物化视图选择-查询重写等价与代价界.md`
- `1.1.47-增量物化视图-代数差分与正确性.md`
- `1.1.52-窗口聚合语义-稳定性与等价变换.md`
