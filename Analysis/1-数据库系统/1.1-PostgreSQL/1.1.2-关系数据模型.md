---
title: 1.1.2-关系数据模型
slug: 1.1.2-关系数据模型
tags: []
pg_version: 16
status: draft
last_review: 2025-09-12
owner: TBD
---

# 关系数据模型

## 1. 定义

**中文**: 关系数据模型是基于数学集合论的数据模型，将数据组织为二维表格（关系），通过关系代数和关系演算进行数据操作。

**English**: The relational data model is a data model based on mathematical set theory that organizes data as two-dimensional tables (relations), with data manipulation performed through relational algebra and relational calculus.

## 2. 形式化定义

```latex
\newcommand{\rel}{\mathcal{R}}
\newcommand{\attr}{\mathcal{A}}
\newcommand{\tuple}{\mathcal{T}}

\rel = \{t_1, t_2, \ldots, t_n\}

其中每个元组 t_i = (a_1, a_2, \ldots, a_m) \in \domain_1 \times \domain_2 \times \ldots \times \domain_m
```

## 3. 核心属性

- **原子性**: 每个属性值都是原子的，不可再分
- **唯一性**: 关系中不存在重复的元组
- **无序性**: 元组和属性的顺序无关紧要
- **完整性**: 支持实体完整性、参照完整性和域完整性约束

### 3.1 约束与语义

- 实体完整性：主键/唯一约束保证唯一性；
- 参照完整性：外键 + 参照动作（RESTRICT/NO ACTION/SET NULL/SET DEFAULT/CASCADE）；
- 域完整性：NOT NULL/类型/检查约束 `CHECK(...)`；
- 业务完整性：排他约束、部分唯一（带 WHERE 谓词）。

## 4. 理论基础

### 4.1 关系代数

```latex
\begin{theorem}[关系代数完备性]
关系代数包含以下基本运算：
1. 选择运算 \sigma_p(R)
2. 投影运算 \pi_A(R)
3. 并运算 R \cup S
4. 差运算 R - S
5. 笛卡尔积 R \times S
6. 连接运算 R \bowtie S
\end{theorem}
```

### 4.2 函数依赖理论

```latex
\begin{theorem}[Armstrong公理]
函数依赖满足以下公理：
1. 自反性：如果 Y \subseteq X，则 X \rightarrow Y
2. 增广性：如果 X \rightarrow Y，则 XZ \rightarrow YZ
3. 传递性：如果 X \rightarrow Y 且 Y \rightarrow Z，则 X \rightarrow Z
\end{theorem}
```

### 4.3 范式与规范化

- 1NF/2NF/3NF/BCNF 定义与依赖关系；
- 关键码、候选键、主属性；
- 规范化目标：减少冗余与异常（更新/插入/删除）。

## 5. 算法实现

### 5.1 关系创建

```sql
-- 关系定义
CREATE TABLE employees (
    emp_id INTEGER PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    dept_id INTEGER REFERENCES departments(dept_id),
    salary DECIMAL(10,2) CHECK (salary > 0)
);

-- 约束定义
ALTER TABLE employees 
ADD CONSTRAINT emp_salary_check 
CHECK (salary BETWEEN 0 AND 1000000);
```

#### 5.1.1 参照完整性与参照动作

```sql
CREATE TABLE departments (
  dept_id INTEGER PRIMARY KEY,
  dept_name TEXT UNIQUE NOT NULL
);

CREATE TABLE employees (
  emp_id INTEGER PRIMARY KEY,
  name TEXT NOT NULL,
  dept_id INTEGER,
  CONSTRAINT fk_emp_dept
    FOREIGN KEY (dept_id) REFERENCES departments(dept_id)
    ON UPDATE CASCADE ON DELETE SET NULL
);
```

#### 5.1.2 部分唯一与业务约束

```sql
CREATE UNIQUE INDEX uniq_active_username
ON users(username)
WHERE deleted_at IS NULL;

ALTER TABLE orders
ADD CONSTRAINT chk_amount_positive CHECK (amount > 0);
```

### 5.2 关系操作

```sql
-- 选择运算
SELECT * FROM employees WHERE salary > 50000;

-- 投影运算
SELECT emp_id, name, dept_id FROM employees;

-- 连接运算
SELECT e.name, d.dept_name 
FROM employees e 
JOIN departments d ON e.dept_id = d.dept_id;
```

#### 5.3 Bag/NULL 语义与外连接

- SQL 采用多重集（Bag）语义，`UNION ALL` 保留重复；
- NULL 引入三值逻辑（TRUE/FALSE/UNKNOWN）；
- 外连接会引入 NULL，聚合/谓词需留意三值逻辑；详见 `1.1.63`、`1.1.71`。

```sql
-- 外连接与三值逻辑影响示例
SELECT c.id, o.amount
FROM customers c LEFT JOIN orders o ON o.customer_id = c.id
WHERE o.status = 'paid' OR o.status IS NULL; -- 注意语义
```

## 6. 应用实例

### 6.1 企业数据管理

```sql
-- 员工管理系统
CREATE TABLE departments (
    dept_id INTEGER PRIMARY KEY,
    dept_name VARCHAR(50) UNIQUE NOT NULL
);

CREATE TABLE employees (
    emp_id INTEGER PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    dept_id INTEGER REFERENCES departments(dept_id),
    salary DECIMAL(10,2)
);

-- 查询示例
SELECT d.dept_name, AVG(e.salary) as avg_salary
FROM departments d
JOIN employees e ON d.dept_id = e.dept_id
GROUP BY d.dept_id, d.dept_name;
```

### 6.2 反规范化与物化

- 反规范化：为查询性能引入冗余列（需维护一致性）；
- 物化视图：加速聚合与连接，结合刷新策略；详见 `1.1.60` 与增量物化相关内容。

```sql
CREATE MATERIALIZED VIEW mv_dept_avg AS
SELECT d.dept_id, avg(e.salary) AS avg_salary
FROM departments d JOIN employees e ON e.dept_id = d.dept_id
GROUP BY d.dept_id;

-- 定期刷新
REFRESH MATERIALIZED VIEW CONCURRENTLY mv_dept_avg;
```

## 7. 性能分析

- **选择运算**: O(n)
- **投影运算**: O(n)
- **连接运算**: O(n×m)
- **排序操作**: O(n log n)
  - 具体开销依赖索引、选择率、统计信息与执行计划（Nested Loop/Hash Join/Merge Join）。

## 8. 相关概念

### 8.1 上位概念

- **数据模型**: 更广泛的数据组织方式
- **集合论**: 数学基础理论

### 8.2 下位概念

- **关系模式**: 关系的结构定义
- **元组**: 关系中的一行数据
- **属性**: 关系中的一列数据
- **主键**: 唯一标识元组的属性集合
  - 候选键/主键；代理键（surrogate key）与自然键（natural key）。

### 8.3 平行概念

- **层次数据模型**: 树形结构数据模型
- **网状数据模型**: 图结构数据模型

## 9. 扩展主题

- 分区与键策略：范围/列表/哈希分区；分区键与查询裁剪；
- 索引设计：B-Tree/GiST/GiN/BRIN 选择；部分/表达式索引；
- 统计与代价：选择率估计、扩展统计、代价模型；
- 安全与RLS：行级安全策略对计划与可见性的影响。

```sql
-- 范围分区示例
CREATE TABLE events (
  id bigserial PRIMARY KEY,
  ts timestamptz NOT NULL,
  payload jsonb
) PARTITION BY RANGE (ts);

CREATE TABLE events_2025_09
  PARTITION OF events
  FOR VALUES FROM ('2025-09-01') TO ('2025-10-01');
```

## 10. 参考文献

1. Codd, E. F. (1970). A relational model of data for large shared data banks. Communications of the ACM, 13(6), 377-387.
2. Date, C. J. (2003). An introduction to database systems (8th ed.). Addison-Wesley.

## 11. Wikidata对齐

- **ID**: Q186929 (relational database)
- **属性**: relational database, database theory
- **链接**: <https://en.wikipedia.org/wiki/Relational_model>
