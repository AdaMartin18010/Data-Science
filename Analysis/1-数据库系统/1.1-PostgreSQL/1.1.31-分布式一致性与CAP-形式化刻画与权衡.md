---
title: 1.1.31-分布式一致性与CAP-形式化刻画与权衡
slug: 1.1.31-分布式一致性与CAP-形式化刻画与权衡
tags: []
pg_version: 16
status: draft
last_review: 2025-09-12
owner: TBD
---

# 1.1.31 分布式一致性与CAP：形式化刻画与权衡（纯形式化）

本文件刻画线性化/顺序一致/最终一致等关系，并给出在网络分区假设下CAP权衡的抽象表述。

## 目录

1. 一致性关系的偏序
2. 线性化的定义与判定
3. 最终一致的收敛性质
4. CAP的抽象命题
5. 副本延迟与可用性的界限

## 1. 一致性关系的偏序

- 定义 1.1：一致性关系\(\preceq\)按可观测约束强弱构成偏序：线性化\(\preceq\)顺序一致\(\preceq\)可串行化（因对象/事务语义不同）。

## 2. 线性化的定义与判定

- 定义 2.1：存在线性序\(\le\)扩展实时先后，使每操作与规范顺序一致。
- 定理 2.2（判定充分条件）：若读写单调且每对象操作互斥线性，则线性化可判定。

## 3. 最终一致的收敛性质

- 定义 3.1：无新更新时，各副本状态极限相等。
- 命题 3.2：弱一致读可通过会话保证加强用户体验而不改变收敛性。

## 4. CAP的抽象命题

- 命题 4.1（直觉版）：在非零概率网络分区下，不可能同时提供强一致与可用（对每请求及时响应）。
- 纲要：在分区两侧对同一键并发写入，要求强一致需协调等待，违背可用；若响应则可能违背一致。

## 5. 副本延迟与可用性的界限

- 定理 5.1：在最大往返时延\(\Lambda\)与分区窗口\(\Pi\)存在时，强一致需代价至少\(\Omega(\Lambda)\)的等待。

## 6. CAP 不可兼得：严格表述与证明纲要

### 6.1 模型与性质

- 异步消息传递系统，网络可能永久或临时分区；节点可靠，操作为读/写单键寄存器。
- 线性化（强一致）：存在扩展实时顺序的全序与规范一致。
- 可用性：每个请求在有限时间内返回响应（非崩溃节点）。

### 6.2 不可能性定理（Gilbert–Lynch 直觉版）

- 定理 6.1：若系统在任意分区下保持可用，则无法保证线性化。
  证明纲要：考虑两个副本 A、B，网络分区将其分隔。对同一键同时在 A 与 B 发起写入 \(w_A\) 与 \(w_B\)。若系统必须可用，则两侧均需在有限时间内响应提交。之后在各自分区内的读将各自返回本地最近提交值。分区愈合后，无法将既定响应嵌入单一线性序同时保留实时因果，违反线性化。故不可兼得。□

### 6.3 界限与折衷

- 在有上界往返延迟与可控故障模型下，可获得条件化一致（如因果/会话保证）与退化可用性的权衡，但不违反定理6.1的基本结论。
