---
title: 时序监控
slug: 时序监控
tags: []
pg_version: 16
status: draft
last_review: 2025-09-12
owner: TBD
---

# 案例：时序监控（占位）

## 架构

- 指标采集 → PostgreSQL 分区表 → BRIN 索引/聚合 → 报表

## 关键点

- 分区策略、压缩与保留策略、聚合物化与查询裁剪

## 验证

- 查询延迟、存储成本、写入吞吐与保留合规

## 最小可复现（占位）

```sql
CREATE TABLE metrics(
  ts timestamptz NOT NULL,
  name text NOT NULL,
  value double precision,
  PRIMARY KEY (ts, name)
) PARTITION BY RANGE (ts);
-- 创建每日分区（示意）
-- CREATE TABLE metrics_20250911 PARTITION OF metrics FOR VALUES FROM ('2025-09-11') TO ('2025-09-12');
CREATE INDEX ON metrics USING brin (ts);

-- 查询裁剪演示
EXPLAIN SELECT avg(value) FROM metrics WHERE ts >= now() - interval '1 day' AND name = 'cpu';
```
