# 案例：金融账务一致性（占位）

## 架构

- 分区账务表、审计轨迹、逻辑复制到审计库

## 关键点

- 事务边界、幂等补偿、对账与回放

## 验证

- 端到端对账一致、恢复演练通过（RTO/RPO 记录）

## 最小可复现（占位）

```sql
CREATE TABLE accounts(id bigint primary key, balance numeric);
CREATE TABLE ledger(id bigserial primary key, account_id bigint, delta numeric, ts timestamptz);

-- 事务边界保证一致性
BEGIN;
UPDATE accounts SET balance = balance + :delta WHERE id = :account_id;
INSERT INTO ledger(account_id, delta, ts) VALUES(:account_id, :delta, now());
COMMIT;

-- 对账检查（示意）：
-- SELECT a.id, a.balance, SUM(l.delta) FROM accounts a JOIN ledger l ON l.account_id=a.id GROUP BY a.id HAVING a.balance <> SUM(l.delta);
```
