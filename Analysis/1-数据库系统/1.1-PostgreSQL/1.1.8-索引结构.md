---
title: 1.1.8-索引结构
slug: 1.1.8-索引结构
tags: []
pg_version: 16
status: draft
last_review: 2025-09-12
owner: TBD
---

# 索引结构

## 1. 定义

**中文**: 索引结构是数据库系统中用于加速数据访问的数据结构，通过建立键值到数据位置的映射关系提高查询性能。

**English**: Index structures are data structures in database systems used to accelerate data access by establishing mapping relationships between keys and data locations to improve query performance.

## 2. 形式化定义

```latex
\newcommand{\index}{\mathcal{I}}
\newcommand{\key}{\mathcal{K}}
\newcommand{\pointer}{\mathcal{P}}

\index = \{(k_1, p_1), (k_2, p_2), \ldots, (k_n, p_n)\}

其中：
k_i \in \key: 索引键值
p_i \in \pointer: 指向数据的指针
```

## 3. 核心属性

- **快速查找**: O(log n) 时间复杂度
- **空间效率**: 合理的存储开销
- **动态更新**: 支持插入、删除、更新
- **并发安全**: 支持并发访问

## 4. 理论基础

### 4.1 B+树理论

```latex
\begin{theorem}[B+树性质]
B+树满足以下性质：
1. 所有叶子节点在同一层
2. 非叶子节点只存储键值
3. 叶子节点包含所有数据
4. 支持范围查询和顺序访问
\end{theorem}
```

### 4.2 哈希索引理论

```latex
\begin{theorem}[哈希索引]
哈希索引通过哈希函数实现：
1. 平均查找时间：O(1)
2. 不支持范围查询
3. 哈希冲突处理
4. 动态扩展机制
\end{theorem}
```

## 5. 算法实现

### 5.1 B+树索引

```sql
-- 创建B+树索引
CREATE INDEX idx_emp_id ON employees(emp_id);
CREATE INDEX idx_emp_name ON employees(name);
CREATE INDEX idx_emp_dept_salary ON employees(dept_id, salary);

-- 查看索引信息
SELECT 
    indexname,
    indexdef
FROM pg_indexes 
WHERE tablename = 'employees';

-- 查看索引使用统计
SELECT 
    schemaname,
    tablename,
    indexname,
    idx_scan,
    idx_tup_read,
    idx_tup_fetch
FROM pg_stat_user_indexes 
WHERE tablename = 'employees';
```

### 5.2 哈希索引

```sql
-- 创建哈希索引
CREATE INDEX idx_emp_id_hash ON employees USING hash(emp_id);

-- 查看哈希索引
SELECT 
    indexname,
    indexdef
FROM pg_indexes 
WHERE indexname LIKE '%hash%';
```

### 5.3 位图索引

```sql
-- 创建位图索引（通过部分索引实现）
CREATE INDEX idx_emp_status_bitmap ON employees(emp_id) 
WHERE status = 'active';

-- 创建GIN索引（用于数组和JSON）
CREATE INDEX idx_emp_skills_gin ON employees USING gin(skills);
CREATE INDEX idx_emp_data_gin ON employees USING gin(data);
```

## 6. 应用实例

### 6.1 复合索引优化

```sql
-- 创建复合索引优化多列查询
CREATE INDEX idx_emp_dept_salary_date ON employees(dept_id, salary, hire_date);

-- 查询优化示例
-- 这个查询可以使用上述索引
SELECT name, salary 
FROM employees 
WHERE dept_id = 1 AND salary > 50000 
ORDER BY hire_date;

-- 查看执行计划
EXPLAIN (ANALYZE) 
SELECT name, salary 
FROM employees 
WHERE dept_id = 1 AND salary > 50000 
ORDER BY hire_date;
```

### 6.2 部分索引优化

```sql
-- 为高薪员工创建部分索引
CREATE INDEX idx_emp_high_salary ON employees(name, dept_id) 
WHERE salary > 100000;

-- 为活跃用户创建部分索引
CREATE INDEX idx_emp_active ON employees(emp_id, last_login) 
WHERE status = 'active';

-- 查询优化
SELECT name, dept_id 
FROM employees 
WHERE salary > 100000 AND dept_id = 1;
```

### 6.3 函数索引

```sql
-- 创建函数索引
CREATE INDEX idx_emp_name_lower ON employees(LOWER(name));
CREATE INDEX idx_emp_email_domain ON employees(SUBSTRING(email FROM '@.*'));

-- 查询优化
SELECT * FROM employees WHERE LOWER(name) = 'john doe';
SELECT * FROM employees WHERE email LIKE '%@gmail.com';
```

## 7. 性能分析

- **查找性能**: B+树 O(log n)，哈希 O(1)
- **插入性能**: B+树 O(log n)，哈希 O(1)
- **空间开销**: 索引大小约为表大小的10-30%
- **维护成本**: 插入、更新、删除时需要维护索引

## 8. 相关概念

- **上位概念**: 查询优化、数据访问
- **下位概念**: B+树、哈希表、位图索引
- **平行概念**: 全文索引、空间索引

## 9. 参考文献

1. Comer, D. (1979). The ubiquitous B-tree. ACM Computing Surveys, 11(2), 121-137.
2. PostgreSQL Global Development Group. (2024). PostgreSQL 16.2 Documentation.

## 10. Wikidata对齐

- **ID**: Q186929 (database index)
- **属性**: database concept, data structure
- **链接**: <https://en.wikipedia.org/wiki/Database_index>
