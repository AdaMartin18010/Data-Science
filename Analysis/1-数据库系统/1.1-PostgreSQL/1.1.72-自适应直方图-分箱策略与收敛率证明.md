---
title: 1.1.72-自适应直方图-分箱策略与收敛率证明
slug: 1.1.72-自适应直方图-分箱策略与收敛率证明
tags: []
pg_version: 16
status: draft
last_review: 2025-09-12
owner: TBD
---

﻿# 1.1.72-自适应直方图-分箱策略与收敛率证明

## 摘要

- 目标：比较等频/等宽/混合策略的收敛率，给出在有限样本下的误差上界与实现建议。

## 问题定义（形式化）

- 样本分布P，估计 \hat{P}_k 由 k 个自适应桶给出。误差度量 d(P, \hat{P}_k) 的上界由 VC 维与样本量 n 决定：O(√(k/n))。

## 最小示例（可运行）

```sql
-- 调高统计目标，允许更多桶
ALTER TABLE orders ALTER COLUMN created_at SET STATISTICS 300;
ANALYZE orders (created_at);

-- 观察时间范围查询估计改善
EXPLAIN SELECT * FROM orders
WHERE created_at BETWEEN date '2025-09-01' AND date '2025-09-30';
```

## 实务要点

- 混合策略：热点区等频、冷门区等宽，兼顾精度与构建成本。
- 动态更新：写入高峰后主动 ANALYZE，避免统计滞后导致计划抖动。
- 多列配合：与多列统计结合，改善合取谓词的联合估计。

## 交叉引用

- `1.1.78-统计直方图自适应分箱-一致性与复杂度证明.md`
- `1.1.49-选择率估计误差-敏感性与上界.md`
- `02-查询处理/02.03-统计信息与选择率估计.md`
