# PostgreSQL 模块：对齐与升级计划（持续执行）

## 目标

- **课程对齐**：对齐国际著名大学课程（如 MIT 6.830/6.814、CMU 15-445/15-721、Stanford CS346、UCB CS186）核心知识点与实验。
- **Wiki对齐**：对齐国际主流 Wiki 体系与术语（SQL/JSON、MVCC、WAL、复制、分区、统计与优化器等）。
- **版本对齐**：对齐 PostgreSQL 最新稳定版与关键新特性，形成“特性→文档→案例→验证”的闭环。
- **形式化增强**：补强一致性、复制、隔离级别、优化器与代价模型等的形式化分析与（半）证明。
- **案例与行业**：补全金融、电商、实时流、图/时序/空间与向量检索等场景的端到端案例。
- **架构与运维**：标准化部署、HA、监控、备份恢复、升级、容量与 SLO/SLA。

## 版本与基线

- 目标版本：PostgreSQL 17.x（最新稳定小版本）。
- 关键主题（样例）：
  - SQL/JSON 标准增强（如 JSON_TABLE）、MERGE RETURNING、COPY ON_ERROR。
  - 逻辑复制改进（订阅创建、复制槽与故障转移流程优化）。
  - VACUUM/IO/索引并行构建与查询优化相关性能改进。
  - 备份还原（pg_basebackup 增量）、诊断与 EXPLAIN 扩展、预定义角色与 TLS 选项。

## 里程碑与范围

M1（对齐框架搭建，1-2 周）：

- 建立追踪矩阵与术语表；锁定 17.x 特性清单；盘点本仓既有文档差距。

M2（内容补强-基础，2-4 周）：

- 完成课程→文档映射；Wiki→文档映射；版本→文档映射的第一轮覆盖（≥80%）。
- 完成关键章节的形式化骨架与可验证脚本占位（TLA+ 规范纲要/SQL 等价变换草案）。

M3（案例与工程化，2-4 周）：

- 行业案例最少 5 篇（金融风控、实时推荐、图/时序、向量检索、备份恢复演练）。
- 运维与架构基线方案（复制/分区/HA/监控/备份/容量/变更流程）。

M4（验证与质量关闭，1-2 周）：

- 交叉审阅、链接与引用校验、术语一致性检查、质量门禁达标，生成发布说明。

## 对齐工作包（WBS）

1) 大学课程对齐

   - 课程：MIT 6.830/6.814、CMU 15-445/15-721、Stanford CS346、UCB CS186。
   - 产出：
     - 课程→章节映射表（概念/实验/阅读材料→本仓文件）。
     - 缺口任务单（新建/补充/改写）。

2) Wiki 对齐

   - 维度：事务/隔离、MVCC、WAL/恢复、复制、分区与裁剪、统计与代价模型、SQL/JSON、MERGE、性能与诊断。
   - 产出：
     - 术语表与同义词规范；
     - 条目→仓内文档映射（含证据链接与版本标注）。

3) 版本与新特性对齐（17.x）

   - 维度：功能/行为、兼容性/迁移、性能、可观测性/运维、安全与角色。
   - 产出：
     - 特性卡片（Feature Card）：背景→用法→兼容→性能→验证。
     - PoC/脚本：`sql/feature_tests/*.sql`；`bench/feature_bench/*.md`。

4) 形式化增强

   - 主题：
     - 隔离级别与异常谱（基于 SI/SSI/2PL 的可串行化判据）；
     - WAL/ARIES 与恢复正确性要点；
     - 逻辑复制一致性与幂等性；
     - 查询重写等价性与代价模型边界；
     - RLS 与信息流安全的策略不可逃逸性。
   - 产出：
     - 规范纲要：`spec/*.tla`（或 Coq/Lean 草案占位），
     - 语义与不变式说明、可验证示例与期望反例集。

5) 案例与行业应用

   - 金融（账务一致、审计轨迹、分区归档）、电商（促销与并发）、实时流（流式ETL+物化视图）、
     图/时序/空间、向量检索与混合查询（RAG/多模态）；
   - 产出：端到端样例：架构图、SQL、基准与指标、回滚与演练记录。

6) 部署运维与架构实践

   - 复制/HA、分区与裁剪、备份恢复（含增量）、监控告警、容量与变更管理（蓝绿/金丝雀/读流量切换）。
   - 产出：SOP、Runbook、参数基线、Dashboards、演练脚本与频率。

## 执行机制与节奏

- 双周迭代：每两周完成一轮“收敛→发布候选→审阅修复”。
- 质量门禁：
  - 交叉引用通过率≥99%，无断链；
  - 术语一致性得分≥95%；
  - 代码/脚本可执行性抽测通过；
  - 形式化规范语法检查通过（若有）。
- 角色分工：内容负责人、技术审校、运维审校、形式化审校。

## 产出物与目录放置（建议）

- `00-项目导航/对齐追踪矩阵.md`（本计划的执行看板与追踪）
- `99-归档/变更记录/`（Changelog 与差异对照）
- `sql/feature_tests/*.sql`（新特性与行为回归）
- `bench/feature_bench/*.md`（性能评测与方法）
- `spec/*.tla`（或其他证明工具占位）

## 检查清单（每迭代）

- [ ] 更新版本与特性来源（Release Notes/Commit/官方Blog）。
- [ ] 追踪矩阵状态刷新并关闭完成项。
- [ ] 术语表差异消解与自动化检查通过。
- [ ] 链接校验、图表与脚本可执行性抽测通过。
- [ ] 生成迭代小结与下轮计划。

## 风险与缓解

- 上游版本小版本频繁：以 LTS/企业发行版节奏作为辅参；变更以特性卡片化管理。
- 形式化工具门槛：采用分层策略（直觉证明→半形式→可机助验证），逐步收敛。
- 跨场景样例复杂：以可复现最小子集为基线，逐步扩容。

## 附：首轮行动项（建议）

- 完成 17.x 特性清单与样例 SQL；
- 优先补齐 SQL/JSON、MERGE、逻辑复制改进、VACUUM/IO、增量备份等章节占位；
- 启动隔离级别与查询重写的形式化骨架；
- 建立金融账务与向量检索两条示范链路。
