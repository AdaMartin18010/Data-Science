# 1.1.48 谓词锁与幽灵现象：形式化与消除条件（纯形式化）

## 目录

1. 幽灵现象的形式化
2. 谓词锁与范围锁
3. 消除条件与充分性
4. 与 SSI 的关系

## 1. 幽灵形式化

- 定义 1.1：两事务 T1, T2，谓词 P 上的查询 Q_P；若 T1 在其快照/锁保护下两次执行 Q_P 结果不同，且差异源于 P 匹配的新元组插入/删除，则称为幽灵。

## 2. 谓词锁

- 定义 2.1：谓词锁 L(P) 保护满足 P 的集合的插入/删除；范围锁将谓词离散化为键区间集合覆盖。

## 3. 消除条件

- 定理 3.1：若对任一活跃事务 T，存在覆盖集 {L(P_i)} 使得对所有可能插入的键 k，若 P(k) 为真则与某 P_i 的保护区间冲突，则幽灵被消除。
  证明纲要：反证。若幽灵发生，则存在未覆盖的插入导致 P 为真，不与任何 P_i 冲突，违背覆盖假设。□

## 4. 与 SSI 的关系

- 命题 4.1：SSI 通过检测危险结构并中止可避免导致不可串行化的幽灵，但并非显式谓词覆盖；
- 命题 4.2：范围/谓词锁提供构造性覆盖，代价是更强的并发限制。
