# 1.1.74-可自维护物化视图-可维护性判据与构造

## 摘要

- 目标：给出在不访问基表的前提下，基于增量变化自维护物化视图的判据与构造方法。

## 问题定义（形式化）

- 视图 V = Q(R₁..Rₙ)。若存在 ΔV=f(ΔR₁..ΔRₙ,V) 使得 V' = V ⊕ ΔV，无需读取R，则称 V 可自维护。
- 判据：当 Q 为投影选择连接并满足键依赖/外键完整性，且增量传播闭包可构造时，自维护成立。

## 最小示例（可运行）

```sql
-- 订单与明细，维护聚合物化视图
CREATE MATERIALIZED VIEW mv_order_sum AS
SELECT o.id, sum(oi.amount) AS total
FROM orders o JOIN order_items oi ON oi.order_id = o.id
GROUP BY o.id;

-- 变更后增量刷新（仅示意）
REFRESH MATERIALIZED VIEW CONCURRENTLY mv_order_sum;
```

## 实务要点

- 物化视图日志：结合触发器/变更流记录 ΔR，减少全量刷新频率。
- 键依赖：确保连接键与唯一性，避免增量传播歧义。
- 一致性：使用 CONCURRENTLY 或分区化MV，降低锁竞争与刷新开销。

## 交叉引用

- `1.1.60-物化视图选择-查询重写等价与代价界.md`
- `1.1.79-可自维护物化视图-键依赖与传递更新的严格证明.md`
- `02-查询处理/02.04-查询重写与等价性.md`
