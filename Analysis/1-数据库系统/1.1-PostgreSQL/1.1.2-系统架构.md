---
title: 1.1.2-系统架构
slug: 1.1.2-系统架构
tags: []
pg_version: 16
status: draft
last_review: 2025-09-12
owner: TBD
---

﻿# 1.1.2-系统架构

## 摘要

- 总览PostgreSQL系统架构：进程模型、内存/存储、查询处理、事务与恢复。

## 架构要点

- 进程：postmaster、后台进程、会话进程；
- 内存：共享缓冲、WAL缓冲、work_mem；
- 查询：解析→重写→优化→执行；
- 事务：MVCC、锁管理、SSI；
- 恢复：WAL、检查点、PITR。

## 分层视图

- 计算层：解析/重写/优化/执行、并行执行器、JIT；
- 存储层：缓冲管理、表/索引（B-Tree/GiST/GiN/BRIN）、TOAST；
- 持久化：WAL、检查点、崩溃恢复、归档；
- 并发控制：锁（LWLock/Heavyweight）、快照、SSI；
- 扩展与生态：FDW、扩展（pgvector、AGE、pg_stat_statements、auto_explain）。

## 关键路径与指标

- 查询路径：Plan Time、Execution Time、共享块命中率、回表比例；
- 写路径：WAL写入速率、检查点持续时间/频率、后台写入与Autovacuum；
- 并发：等待事件（`wait_event_type`）、锁冲突、长事务；
- 复制：WAL sender/receiver 状态、byte_lag、apply_lag。

## 示例（可运行）

```sql
SELECT * FROM pg_stat_activity;
SELECT * FROM pg_stat_bgwriter;
SELECT * FROM pg_stat_statements ORDER BY total_time DESC LIMIT 10; -- 需扩展
```

## 交叉引用

- `01-核心基础/01.01-系统架构与设计原理.md`
- `1.1.47-事务隔离理论-完整版.md`、`1.1.57-ARIES日志恢复-正确性与不变式.md`
- `04-部署运维/04.04-监控与诊断.md`、`04-部署运维/04.06-性能调优实践.md`
