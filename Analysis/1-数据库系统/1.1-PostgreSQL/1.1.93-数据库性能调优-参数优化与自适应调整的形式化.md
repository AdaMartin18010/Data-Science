# 1.1.93 数据库性能调优：参数优化与自适应调整的形式化

## 1. 目标与方法

- 以“测量→瓶颈定位→参数/结构优化→回归验证”为闭环，结合自适应策略（统计/代价修正、索引/计划守护）。

## 2. 参数基线

- 内存：`shared_buffers`、`work_mem`、`maintenance_work_mem`；
- IO/缓存：`effective_cache_size`、`random_page_cost`；
- WAL/检查点：`checkpoint_timeout`、`max_wal_size`、`checkpoint_completion_target`；
- 并行：`max_parallel_workers_per_gather`、`parallel_leader_participation`；
- 连接：`max_connections`、连接池（pgBouncer）。

## 3. 调优策略

- 查询级：索引/重写、统计刷新、稳定排序、限制结果集；
- 会话级：启停 `enable_*` 进行诊断，不作为长期方案；
- 系统级：内存/WAL/检查点参数按工作负载曲线调整；
- 存储级：表/索引膨胀治理、分区、填充因子。

## 4. 自适应调整

- 反馈学习：采集实际基数与耗时，触发统计/索引/参数微调（见 `1.1.83`）；
- 守护：监测TP95/TP99退化，切换到稳定计划或限制 join 折叠；
- 鲁棒性：对阈值翻转敏感查询保留冗余索引（见 `1.1.49`、`1.1.82`）。

## 5. 指标与流程

- 观测：`pg_stat_*`、命中率、WAL速率、检查点时长、Autovacuum 延迟、复制延迟；
- 流程：基线测量→瓶颈定位→局部优化→回归→灰度→推广。

## 6. 交叉引用

- `02-查询处理/02.04-执行计划与性能调优.md`
- `04-部署运维/04.04-监控与诊断.md`
- `1.1.83-查询优化器自适应-反馈学习与代价模型修正.md`
- `1.1.49-选择率估计误差-敏感性与上界.md`
