# 1.1.52 窗口聚合语义：稳定性与等价变换（纯形式化）

## 目录

1. 窗口定义与分区/排序
2. 窗口聚合稳定性
3. 等价与可交换条件

## 1. 定义

- 分区键 G，序键 O，窗口框架 F；
- 结果为对每个元组计算 f(Ctx(G,O,F))。

## 2. 稳定性

- 定理 2.1：若排序键 O 为全序且不含并列，则窗口结果对 O 的稳定，微扰不改变相对顺序时输出不变。
- 命题 2.2：存在并列时需稳定排序或补充决策以保证确定性。

## 3. 等价

- 定理 3.1（选择与窗口）：若选择谓词 φ 仅依赖于 G 与 O 之外的常量且与 f 无交互侧效应，则 σ_φ 与窗口计算可交换于同一帧定义域。
- 定理 3.2（投影与窗口）：当投影保留 G、O 及 f 所需属性，窗口结果不变。
