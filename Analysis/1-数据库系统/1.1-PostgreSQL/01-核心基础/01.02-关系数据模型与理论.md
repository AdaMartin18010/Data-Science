---
title: 01.02-关系数据模型与理论
slug: 01.02-关系数据模型与理论
tags: []
pg_version: 16
status: draft
last_review: 2025-09-12
owner: TBD
---

# 关系数据模型与理论

## 1. 定义与形式化

### 1.1 概念定义

**中文定义**: 关系数据模型是基于数学集合论的数据模型，将数据组织为二维表格（关系），通过关系代数和关系演算进行数据操作。PostgreSQL完全实现了关系数据模型，支持完整的SQL标准。

**English Definition**: The relational data model is a data model based on mathematical set theory that organizes data as two-dimensional tables (relations), with data manipulation performed through relational algebra and relational calculus. PostgreSQL fully implements the relational data model and supports complete SQL standards.

### 1.2 形式化定义

```latex
% 数学符号定义
\newcommand{\rel}{\mathcal{R}}
\newcommand{\attr}{\mathcal{A}}
\newcommand{\tuple}{\mathcal{T}}
\newcommand{\domain}{\mathcal{D}}
\newcommand{\schema}{\mathcal{S}}

% 关系的形式化定义
\rel = \{t_1, t_2, \ldots, t_n\}

其中每个元组 t_i = (a_1, a_2, \ldots, a_m) \in \domain_1 \times \domain_2 \times \ldots \times \domain_m

% 关系模式定义
\schema = (\rel, \attr, \domain)
```

### 1.3 核心属性

- **原子性**: 每个属性值都是原子的，不可再分
- **唯一性**: 关系中不存在重复的元组
- **无序性**: 元组和属性的顺序无关紧要
- **完整性**: 支持实体完整性、参照完整性和域完整性约束

## 2. 理论基础

### 2.1 关系代数

```latex
\begin{theorem}[关系代数完备性]
关系代数包含以下基本运算：
1. 选择运算 \sigma_p(R) = \{t | t \in R \land p(t)\}
2. 投影运算 \pi_A(R) = \{t[A] | t \in R\}
3. 并运算 R \cup S = \{t | t \in R \lor t \in S\}
4. 差运算 R - S = \{t | t \in R \land t \notin S\}
5. 笛卡尔积 R \times S = \{(r,s) | r \in R \land s \in S\}
6. 连接运算 R \bowtie_p S = \sigma_p(R \times S)
\end{theorem}
```

### 2.2 函数依赖理论

```latex
\begin{theorem}[Armstrong公理]
函数依赖满足以下公理：
1. 自反性：如果 Y \subseteq X，则 X \rightarrow Y
2. 增广性：如果 X \rightarrow Y，则 XZ \rightarrow YZ
3. 传递性：如果 X \rightarrow Y 且 Y \rightarrow Z，则 X \rightarrow Z
\end{theorem}

\begin{proof}
基于集合论和逻辑推理，可以证明这些公理的正确性。
\end{proof}
```

### 2.3 范式理论

```latex
\begin{theorem}[范式层次]
关系范式满足以下层次结构：
1. 1NF: 每个属性都是原子的
2. 2NF: 满足1NF且每个非主属性完全函数依赖于主键
3. 3NF: 满足2NF且每个非主属性不传递依赖于主键
4. BCNF: 满足3NF且每个函数依赖的决定因素都是超键
\end{theorem}
```

## 3. PostgreSQL实现

### 3.1 数据类型系统

```sql
-- 基本数据类型
CREATE TABLE example_table (
    id INTEGER PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    salary DECIMAL(10,2),
    hire_date DATE,
    active BOOLEAN DEFAULT TRUE,
    profile JSONB,
    tags TEXT[]
);

-- 自定义数据类型
CREATE TYPE employee_status AS ENUM ('active', 'inactive', 'terminated');
CREATE TYPE address AS (
    street VARCHAR(100),
    city VARCHAR(50),
    postal_code VARCHAR(10)
);
```

### 3.2 约束系统

```sql
-- 实体完整性约束
CREATE TABLE employees (
    emp_id INTEGER PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE,
    dept_id INTEGER REFERENCES departments(dept_id),
    salary DECIMAL(10,2) CHECK (salary > 0),
    CONSTRAINT emp_salary_check CHECK (salary >= 0 AND salary <= 1000000)
);

-- 参照完整性约束
CREATE TABLE departments (
    dept_id INTEGER PRIMARY KEY,
    dept_name VARCHAR(50) NOT NULL,
    manager_id INTEGER REFERENCES employees(emp_id)
);
```

### 3.3 关系操作实现

```sql
-- 选择操作
SELECT * FROM employees WHERE salary > 50000;

-- 投影操作
SELECT name, dept_id FROM employees;

-- 连接操作
SELECT e.name, d.dept_name
FROM employees e
JOIN departments d ON e.dept_id = d.dept_id;

-- 并操作
SELECT name FROM employees_2023
UNION
SELECT name FROM employees_2024;

-- 差操作
SELECT name FROM employees_2023
EXCEPT
SELECT name FROM employees_2024;
```

## 4. 高级特性

### 4.1 视图系统

```sql
-- 简单视图
CREATE VIEW emp_summary AS
SELECT 
    dept_id,
    COUNT(*) as emp_count,
    AVG(salary) as avg_salary,
    MAX(salary) as max_salary
FROM employees
GROUP BY dept_id;

-- 可更新视图
CREATE VIEW emp_public AS
SELECT emp_id, name, dept_id
FROM employees
WHERE active = true;

-- 物化视图
CREATE MATERIALIZED VIEW emp_stats AS
SELECT 
    dept_id,
    COUNT(*) as emp_count,
    AVG(salary) as avg_salary
FROM employees
GROUP BY dept_id;
```

### 4.2 继承系统

```sql
-- 表继承
CREATE TABLE person (
    id SERIAL PRIMARY KEY,
    name VARCHAR(50),
    birth_date DATE
);

CREATE TABLE employee (
    salary DECIMAL(10,2),
    hire_date DATE
) INHERITS (person);

CREATE TABLE customer (
    credit_limit DECIMAL(10,2),
    registration_date DATE
) INHERITS (person);
```

### 4.3 分区表

```sql
-- 范围分区
CREATE TABLE sales (
    id SERIAL,
    sale_date DATE,
    amount DECIMAL(10,2)
) PARTITION BY RANGE (sale_date);

CREATE TABLE sales_2023 PARTITION OF sales
FOR VALUES FROM ('2023-01-01') TO ('2024-01-01');

CREATE TABLE sales_2024 PARTITION OF sales
FOR VALUES FROM ('2024-01-01') TO ('2025-01-01');

-- 列表分区
CREATE TABLE products (
    id SERIAL,
    category VARCHAR(50),
    name VARCHAR(100)
) PARTITION BY LIST (category);

CREATE TABLE electronics PARTITION OF products
FOR VALUES IN ('laptop', 'phone', 'tablet');
```

## 5. 性能优化

### 5.1 索引优化

```sql
-- B+树索引
CREATE INDEX idx_emp_salary ON employees (salary);

-- 复合索引
CREATE INDEX idx_emp_dept_salary ON employees (dept_id, salary);

-- 部分索引
CREATE INDEX idx_high_salary ON employees (salary) WHERE salary > 100000;

-- 表达式索引
CREATE INDEX idx_name_lower ON employees (LOWER(name));
```

### 5.2 查询优化

```sql
-- 使用EXPLAIN分析查询计划
EXPLAIN (ANALYZE, BUFFERS) 
SELECT e.name, d.dept_name
FROM employees e
JOIN departments d ON e.dept_id = d.dept_id
WHERE e.salary > 50000;

-- 统计信息更新
ANALYZE employees;

-- 查询重写
SELECT name, salary
FROM employees
WHERE dept_id IN (
    SELECT dept_id FROM departments WHERE budget > 1000000
);
```

## 6. 实际应用案例

### 6.1 电商系统设计

```sql
-- 商品表
CREATE TABLE products (
    product_id SERIAL PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    price DECIMAL(10,2) NOT NULL,
    category_id INTEGER REFERENCES categories(category_id),
    stock_quantity INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT NOW()
);

-- 订单表
CREATE TABLE orders (
    order_id SERIAL PRIMARY KEY,
    customer_id INTEGER REFERENCES customers(customer_id),
    order_date TIMESTAMP DEFAULT NOW(),
    total_amount DECIMAL(10,2),
    status VARCHAR(20) DEFAULT 'pending'
);

-- 订单详情表
CREATE TABLE order_items (
    order_id INTEGER REFERENCES orders(order_id),
    product_id INTEGER REFERENCES products(product_id),
    quantity INTEGER NOT NULL,
    unit_price DECIMAL(10,2) NOT NULL,
    PRIMARY KEY (order_id, product_id)
);
```

### 6.2 金融系统设计

```sql
-- 账户表
CREATE TABLE accounts (
    account_id SERIAL PRIMARY KEY,
    customer_id INTEGER REFERENCES customers(customer_id),
    account_type VARCHAR(20) NOT NULL,
    balance DECIMAL(15,2) DEFAULT 0,
    currency VARCHAR(3) DEFAULT 'USD',
    created_at TIMESTAMP DEFAULT NOW()
);

-- 交易表
CREATE TABLE transactions (
    transaction_id SERIAL PRIMARY KEY,
    from_account_id INTEGER REFERENCES accounts(account_id),
    to_account_id INTEGER REFERENCES accounts(account_id),
    amount DECIMAL(15,2) NOT NULL,
    transaction_type VARCHAR(20) NOT NULL,
    transaction_date TIMESTAMP DEFAULT NOW(),
    status VARCHAR(20) DEFAULT 'pending'
);
```

## 7. 相关概念

### 7.1 上位概念

- **数据模型**: 更广泛的数据组织方式
- **数据库理论**: 数据库系统的理论基础
- **集合论**: 数学基础理论

### 7.2 下位概念

- **关系**: 二维表格结构
- **元组**: 表中的行
- **属性**: 表中的列
- **域**: 属性的取值范围

### 7.3 平行概念

- **层次数据模型**: 树形结构数据模型
- **网状数据模型**: 图结构数据模型
- **对象数据模型**: 面向对象数据模型

## 8. 参考文献

1. Codd, E. F. (1970). A relational model of data for large shared data banks. Communications of the ACM, 13(6), 377-387.
2. Date, C. J. (2003). An Introduction to Database Systems (8th ed.). Addison-Wesley.
3. PostgreSQL Global Development Group. (2024). PostgreSQL 16.2 Documentation. <https://www.postgresql.org/docs/16/>
4. Silberschatz, A., Galvin, P. B., & Gagne, G. (2018). Operating System Concepts (10th ed.). John Wiley & Sons.

## 9. Wikidata对齐

- **Wikidata ID**: Q192490
- **相关属性**:
  - P31: Q176165 (instance of: database management system)
  - P178: Q9366 (developer: PostgreSQL Global Development Group)
  - P277: Q193321 (programmed in: C)
  - P348: 16.2 (software version)
- **外部链接**:
  - <https://www.postgresql.org/docs/current/ddl.html>
  - <https://www.postgresql.org/docs/current/dml.html>
