---
title: 1.1.15-图数据库
slug: 1.1.15-图数据库
tags: []
pg_version: 16
status: draft
last_review: 2025-09-12
owner: TBD
---

# 图数据库

## 1. 定义

**中文**: 图数据库是专门用于存储和查询图结构数据的数据库系统，支持节点、边和复杂关系的高效处理。

**English**: Graph databases are specialized database systems for storing and querying graph-structured data, supporting efficient processing of nodes, edges, and complex relationships.

## 2. 形式化定义

```latex
\newcommand{\graph}{\mathcal{G}}
\newcommand{\vertex}{\mathcal{V}}
\newcommand{\edge}{\mathcal{E}}

\graph = (\vertex, \edge)

其中：
\vertex = \{v_1, v_2, \ldots, v_n\}: 顶点集合
\edge = \{(v_i, v_j) | v_i, v_j \in \vertex\}: 边集合
```

## 3. 核心属性

- **关系建模**: 自然表达复杂关系
- **遍历性能**: 高效的图遍历算法
- **模式灵活性**: 动态图结构支持
- **查询表达能力**: 复杂路径查询

## 4. 理论基础

```latex
\begin{theorem}[图遍历算法]
图数据库支持以下核心算法：
1. 深度优先搜索(DFS)：O(V + E) 时间复杂度
2. 广度优先搜索(BFS)：O(V + E) 时间复杂度
3. 最短路径算法：Dijkstra O(V² + E)
4. 连通分量算法：Union-Find O(V + E)
\end{theorem}
```

## 5. 算法实现

### 5.1 图数据存储

```sql
-- 创建顶点表
CREATE TABLE users (
    user_id INTEGER PRIMARY KEY,
    name VARCHAR(100),
    age INTEGER,
    location VARCHAR(100)
);

-- 创建边表
CREATE TABLE friendships (
    friendship_id SERIAL PRIMARY KEY,
    user1_id INTEGER REFERENCES users(user_id),
    user2_id INTEGER REFERENCES users(user_id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 5.2 图查询

```sql
-- 使用递归CTE进行图遍历
WITH RECURSIVE friend_paths AS (
    -- 基础情况：直接朋友
    SELECT 
        user1_id as start_user,
        user2_id as end_user,
        ARRAY[user1_id, user2_id] as path,
        1 as depth
    FROM friendships
    WHERE user1_id = 1001
    
    UNION ALL
    
    -- 递归情况：朋友的朋友
    SELECT 
        fp.start_user,
        f.user2_id,
        fp.path || f.user2_id,
        fp.depth + 1
    FROM friend_paths fp
    JOIN friendships f ON fp.end_user = f.user1_id
    WHERE fp.depth < 3
    AND f.user2_id != ALL(fp.path)
)
SELECT DISTINCT end_user, depth
FROM friend_paths
ORDER BY depth, end_user;
```

### 5.3 图分析

```sql
-- 计算用户中心性
WITH user_degrees AS (
    SELECT 
        user_id,
        COUNT(*) as degree
    FROM (
        SELECT user1_id as user_id FROM friendships
        UNION ALL
        SELECT user2_id as user_id FROM friendships
    ) all_connections
    GROUP BY user_id
)
SELECT 
    u.name,
    ud.degree,
    CASE 
        WHEN ud.degree > 50 THEN '高影响力'
        WHEN ud.degree > 20 THEN '中等影响力'
        ELSE '普通用户'
    END as influence_level
FROM users u
JOIN user_degrees ud ON u.user_id = ud.user_id
ORDER BY ud.degree DESC;
```

## 6. 应用实例

### 6.1 社交网络分析

```sql
-- 影响力传播分析
WITH RECURSIVE influence_spread AS (
    SELECT 
        from_node as influencer,
        to_node as influenced,
        1 as level
    FROM relationships
    WHERE rel_type = 'follows' AND from_node = 1001
    
    UNION ALL
    
    SELECT 
        is.influencer,
        r.to_node,
        is.level + 1
    FROM influence_spread is
    JOIN relationships r ON is.influenced = r.from_node
    WHERE r.rel_type = 'follows' AND is.level < 3
)
SELECT level, COUNT(DISTINCT influenced) as reach_count
FROM influence_spread
GROUP BY level
ORDER BY level;
```

### 6.2 推荐系统

```sql
-- 基于图的推荐算法
WITH user_similarity AS (
    SELECT 
        u1.user_id as user1,
        u2.user_id as user2,
        COUNT(DISTINCT f1.user2_id) as common_friends
    FROM users u1
    JOIN friendships f1 ON u1.user_id = f1.user1_id
    JOIN friendships f2 ON f1.user2_id = f2.user1_id
    JOIN users u2 ON f2.user2_id = u2.user_id
    WHERE u1.user_id != u2.user_id
    GROUP BY u1.user_id, u2.user_id
    HAVING COUNT(DISTINCT f1.user2_id) > 2
)
SELECT 
    us.user2 as recommended_user,
    u.name as recommended_name,
    us.common_friends as similarity_score
FROM user_similarity us
JOIN users u ON us.user2 = u.user_id
WHERE us.user1 = 1001
ORDER BY us.common_friends DESC
LIMIT 10;
```

## 7. 性能分析

- **遍历性能**: O(V + E) 基础复杂度
- **存储开销**: 节点 + 边 + 属性数据
- **查询延迟**: 取决于图大小和查询复杂度
- **扩展性**: 支持分布式图处理

## 8. 相关概念

- **上位概念**: 数据库系统、图论
- **下位概念**: 图遍历、路径查询、图算法
- **平行概念**: 关系数据库、文档数据库

## 9. 参考文献

1. Angles, R., & Gutierrez, C. (2008). Survey of graph database models.
2. PostgreSQL Global Development Group. (2024). PostgreSQL 16.2 Documentation.

## 10. Wikidata对齐

- **ID**: Q186929 (graph database)
- **属性**: database concept, graph theory
- **链接**: <https://en.wikipedia.org/wiki/Graph_database>
