# 1.1.69 两阶段加锁：可串行化的严格证明（纯形式化）

## 目录

1. 模型与2PL/严格2PL定义
2. 可串行化严格证明
3. 死锁关系与必要条件

## 1. 定义

- 2PL：每事务分为加锁增长阶段与解锁收缩阶段，解锁后不再加新锁；
- 严格2PL：直到提交/回滚才释放写锁（或所有锁）。

## 2. 证明

- 定理 2.1（2PL可串行化）：任一遵循2PL的调度冲突图无环。
  证明：若存在环，则存在回边对应解锁后再次加锁的因果，违背增长-收缩分段；以锁持有顺序诱导偏序，拓扑化得串行顺序。□
- 定理 2.2（严格2PL恢复性）：严格2PL 保证无级联回滚与可恢复性。
  证明：写锁至提交才释放，其他事务不读未提交写的版本，故无级联。□

## 3. 死锁

- 命题 3.1：2PL 可产生死锁；
- 命题 3.2：为避免死锁需破坏Coffman条件之一，如加全局键序（防循环等待）。
