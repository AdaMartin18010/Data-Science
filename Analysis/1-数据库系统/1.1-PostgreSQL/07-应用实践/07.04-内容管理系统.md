---
title: 07.04-内容管理系统
slug: 07.04-内容管理系统
tags: []
pg_version: 16
status: draft
last_review: 2025-09-12
owner: TBD
---

﻿# 07.04-内容管理系统

> 面向 PostgreSQL 的 CMS 落地示例：数据模型、权限与RLS、全文与标签、缓存与发布工作流、典型SQL与SOP。

## 概述

CMS 涉及作者/内容/版本/发布/检索/权限控制，PostgreSQL 可通过 JSONB、全文、RLS、分区与物化视图支撑高效实现。

## 关键概念

- 内容版本：主表 + 版本表（审稿/回滚）
- 权限/RLS：作者自有、编辑审阅、公开发布
- 全文与标签：`tsvector`/`GIN` 与标签多对多
- 发布工作流：草稿 → 审核 → 发布 → 归档

## 实践要点

```sql
-- 模型
CREATE TABLE author (
  id bigserial PRIMARY KEY,
  name text NOT NULL
);
CREATE TABLE article (
  id bigserial PRIMARY KEY,
  author_id bigint NOT NULL REFERENCES author(id),
  title text NOT NULL,
  body  text NOT NULL,
  tags  text[] NOT NULL DEFAULT '{}',
  status text NOT NULL CHECK (status IN ('draft','review','published','archived')),
  published_at timestamptz
);
CREATE INDEX idx_article_tags_gin ON article USING gin (tags);
CREATE INDEX idx_article_fts ON article USING gin (to_tsvector('simple', title || ' ' || body));

-- 全文检索
SELECT id, title
FROM article
WHERE to_tsvector('simple', title || ' ' || body) @@ plainto_tsquery('simple', $1)
ORDER BY published_at DESC
LIMIT 20;

-- RLS（示例草案）
ALTER TABLE article ENABLE ROW LEVEL SECURITY;
CREATE POLICY own_or_published ON article
  USING (author_id = current_setting('app.user_id')::bigint OR status = 'published');

-- 发布物化
CREATE MATERIALIZED VIEW mv_article_recent AS
SELECT id, title, published_at
FROM article WHERE status = 'published'
ORDER BY published_at DESC
LIMIT 1000;
```

SOP：

- 写入路径：草稿保存→提交审核→变更状态→刷新物化视图；
- 缓存：热门列表与详情页结合应用缓存/ETag；
- 归档：按月份分区或迁移归档表。

## 参考

- `03-高级特性/03.02-安全机制与访问控制.md`
- `02-查询处理/02.02-索引结构与优化.md`
