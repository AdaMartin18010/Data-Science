---
title: 1.1.73-CRDT与最终一致-会合半格与收敛性证明
slug: 1.1.73-CRDT与最终一致-会合半格与收敛性证明
tags: []
pg_version: 16
status: draft
last_review: 2025-09-12
owner: TBD
---

﻿# 1.1.73-CRDT与最终一致-会合半格与收敛性证明

## 摘要

- 目标：以会合半格（join-semilattice）建模CRDT状态，给出并发更新在任意到达顺序下的收敛性充分条件。

## 问题定义（形式化）

- 状态集合 (S, ⊔) 为半格，更新为单调、通胀映射 u: S→S，副本间以 ⊔ 合并。
- 定理：若 (S, ⊔) 交换、结合、幂等，且所有更新单调并最终传播，则所有副本极限状态相同（强收敛）。

## 最小示例（可运行）

```sql
-- 逻辑示例：以JSONB存储CRDT G-Counter（各副本计数向量），合并取逐位最大
-- 注意：此为概念示例，生产更建议在应用层实现CRDT并落库

-- 表：副本id与计数向量
CREATE TABLE crdt_counter (
  key text primary key,
  value jsonb not null -- {"replicaA": 10, "replicaB": 7}
);

-- 合并（逐位最大）：value = jsonb深度合并取max（示意）
-- 实际可用PL/pgSQL函数遍历键并取GREATEST
```

## 实务要点

- 决策：是否接受“最终一致”与“丢弃次序信息”；冲突语义应由幂等合并函数决定。
- 存储：选择能表达幂等合并的结构（集合、最大时间戳、向量时钟）。
- 与事务：跨分区/跨站点写入时CRDT可减少协调，但读一致性需单独设计。

## 交叉引用

- `1.1.31-分布式一致性与CAP-形式化刻画与权衡.md`
- `1.1.62-线性化与串行化-对象与事务一致性的形式关系.md`
- `04-部署运维/04.02-分布式与复制.md`
