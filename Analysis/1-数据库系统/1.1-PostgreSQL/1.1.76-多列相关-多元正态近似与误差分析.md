# 1.1.76-多列相关-多元正态近似与误差分析

## 摘要

- 目标：在选择率估计中建模多列相关，给出多元正态近似条件与误差上界，指导多列统计与索引设计。

## 问题定义（形式化）

- 设特征向量 X∈R^d，联合分布近似 N(μ, Σ)。对谓词 P: aᵀX∈[l,u]，估计 Pr(P) 的闭式与误差项 ε(Σ̂)。
- 误差来源：协方差估计偏差、非高斯尾部、离群点；鲁棒估计 Σ̃ 减小上界。

## 最小示例（可运行）

```sql
-- 启用多列统计（PostgreSQL 10+）
CREATE STATISTICS stat_orders_multi (dependencies, mcv) ON customer_id, status, created_at FROM orders;
ANALYZE orders;

-- 观察计划估计改善
EXPLAIN SELECT * FROM orders
WHERE customer_id = 123 AND status = 'paid'
  AND created_at >= date '2025-09-01' AND created_at < date '2025-10-01';
```

## 实务要点

- 何时启用多列统计：当 AND 条件列间强相关或包含函数依赖时。
- 索引与统计协同：复合索引前缀与选择列顺序匹配；统计用于估计，索引用于执行。
- 鲁棒性：定期 ANALYZE；异常漂移时重建统计，避免阈值翻转导致计划错误。

## 交叉引用

- `1.1.49-选择率估计误差-敏感性与上界.md`
- `1.1.82-索引选择与代价模型-多目标优化的Pareto最优性.md`
- `02-查询处理/02.03-统计信息与选择率估计.md`
