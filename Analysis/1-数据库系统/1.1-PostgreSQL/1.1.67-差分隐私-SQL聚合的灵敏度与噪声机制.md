# 1.1.67-差分隐私-SQL聚合的灵敏度与噪声机制

## 摘要

- 目标：在SQL聚合上应用(ε,δ)-差分隐私，给出灵敏度界与噪声机制选择建议。

## 问题定义（形式化）

- 相邻数据库 D,D' 相差一条记录。查询 f 的L₁灵敏度 Δ₁ = max‖f(D)-f(D')‖₁。
- 机制：Laplace(Δ₁/ε) 或 Gaussian(σ=√(2 ln(1.25/δ))·Δ₂/ε)。

## 最小示例（可运行）

```sql
-- 概念示例：在应用层添加拉普拉斯噪声后写回或返回
-- 这里以SQL展示聚合目标，噪声建议在应用层注入以便审计与配额
SELECT avg(amount) AS avg_amount, count(*) AS n
FROM orders
WHERE created_at >= date '2025-09-01';
```

## 实务要点

- 裁剪与配额：对 SUM/AVG 先做值裁剪，限制最大贡献度，再加噪；控制查询预算。
- 组合性：多次查询的隐私损耗按高级组合定理累积；集中管理ε/δ。
- 审计：记录噪声参数与预算消耗，满足合规检查。

## 交叉引用

- `1.1.91-数据库审计与合规-完整性约束与审计轨迹的形式化.md`
- `03-高级特性/03.02-可观测与审计.md`
- `02-查询处理/02.05-安全与隐私.md`
