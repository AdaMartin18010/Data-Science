---
title: 1.1.85-数据库缓存策略-工作集理论与最优替换算法
slug: 1.1.85-数据库缓存策略-工作集理论与最优替换算法
tags: []
pg_version: 16
status: draft
last_review: 2025-09-12
owner: TBD
---

﻿# 1.1.85-数据库缓存策略-工作集理论与最优替换算法

## 摘要

- 目标：基于工作集理论刻画缓存命中行为，对比LRU/LFU/ARC等替换策略并给出参数化建议。

## 问题定义（形式化）

- 访问序列 A，缓存容量 C。命中率 H 由工作集窗口 ω 与热点集大小决定；最优Belady作对照上界。

## 最小示例（可运行）

```sql
-- 观察共享缓冲命中
SELECT blks_hit, blks_read, blks_hit::float/(blks_hit+blks_read+1) AS hit
FROM pg_stat_database WHERE datname = current_database();

-- 基于扩展：pg_buffercache（需安装）可观测热点关系
```

## 实务要点

- 参数：shared_buffers、effective_cache_size 与工作集匹配；
- 策略：顺序扫描引入readahead；混合负载考虑ARC/Clock-Sweep近似；
- 诊断：命中率与IO放大、热点表/索引尺寸对比。

## 交叉引用

- `1.1.16-性能调优与监控.md`
- `02-查询处理/02.01-查询优化器原理.md`
- `04-部署运维/04.01-性能调优与监控.md`
