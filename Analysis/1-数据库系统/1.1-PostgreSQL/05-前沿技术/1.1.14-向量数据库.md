# 向量数据库

## 1. 定义

**中文**: 向量数据库是专门用于存储和检索高维向量数据的数据库系统，支持相似性搜索和机器学习应用。

**English**: Vector databases are specialized database systems for storing and retrieving high-dimensional vector data, supporting similarity search and machine learning applications.

## 2. 形式化定义

```latex
\newcommand{\vector}{\mathcal{V}}
\newcommand{\dimension}{\mathcal{D}}
\newcommand{\similarity}{\mathcal{S}}

\vector = \{v_1, v_2, \ldots, v_n | v_i \in \mathbb{R}^d\}

其中：
d \in \dimension: 向量维度
\similarity: 相似性度量函数
```

## 3. 核心属性

- **高维支持**: 支持数百到数千维向量
- **相似性搜索**: 高效的最近邻搜索
- **可扩展性**: 支持大规模向量数据
- **实时性**: 低延迟查询响应

## 4. 理论基础

```latex
\begin{theorem}[向量相似性搜索]
向量相似性搜索通过以下算法实现：
1. 欧几里得距离：d(x,y) = \sqrt{\sum_{i=1}^n (x_i - y_i)^2}
2. 余弦相似度：cos(θ) = \frac{x \cdot y}{\|x\| \|y\|}
3. 内积相似度：sim(x,y) = x \cdot y
\end{theorem}
```

## 5. 算法实现

### 5.1 向量存储

```sql
-- 安装向量扩展
CREATE EXTENSION IF NOT EXISTS vector;

-- 创建向量表
CREATE TABLE embeddings (
    id SERIAL PRIMARY KEY,
    content_id INTEGER,
    embedding vector(384),  -- 384维向量
    content_type VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 创建向量索引
CREATE INDEX ON embeddings USING ivfflat (embedding vector_cosine_ops)
WITH (lists = 100);
```

### 5.2 相似性搜索

```sql
-- 余弦相似度搜索
SELECT
    content_id,
    content_type,
    1 - (embedding <=> '[0.1, 0.2, ..., 0.3]') as similarity
FROM embeddings
ORDER BY embedding <=> '[0.1, 0.2, ..., 0.3]'
LIMIT 10;

-- 欧几里得距离搜索
SELECT
    content_id,
    embedding <-> '[0.1, 0.2, ..., 0.3]' as distance
FROM embeddings
ORDER BY embedding <-> '[0.1, 0.2, ..., 0.3]'
LIMIT 10;
```

### 5.3 向量聚合

```sql
-- 向量平均
SELECT
    content_type,
    AVG(embedding) as avg_embedding
FROM embeddings
GROUP BY content_type;

-- 向量聚类
WITH cluster_centers AS (
    SELECT
        content_type,
        AVG(embedding) as center
    FROM embeddings
    GROUP BY content_type
)
SELECT
    e.content_id,
    e.content_type,
    e.embedding <-> cc.center as distance_to_center
FROM embeddings e
JOIN cluster_centers cc ON e.content_type = cc.content_type;
```

## 6. 应用实例

### 6.1 语义搜索

```sql
-- 文档向量化存储
CREATE TABLE documents (
    doc_id SERIAL PRIMARY KEY,
    title VARCHAR(200),
    content TEXT,
    embedding vector(768)
);

-- 语义搜索查询
SELECT
    doc_id,
    title,
    1 - (embedding <=> '[0.1, 0.2, ..., 0.3]') as relevance_score
FROM documents
WHERE 1 - (embedding <=> '[0.1, 0.2, ..., 0.3]') > 0.8
ORDER BY relevance_score DESC;
```

### 6.2 推荐系统

```sql
-- 用户偏好向量
CREATE TABLE user_preferences (
    user_id INTEGER PRIMARY KEY,
    preference_vector vector(128),
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- 基于向量的推荐
SELECT
    p.product_id,
    p.name,
    1 - (p.feature_vector <=> up.preference_vector) as recommendation_score
FROM products p
CROSS JOIN user_preferences up
WHERE up.user_id = 1001
ORDER BY recommendation_score DESC
LIMIT 10;
```

### 6.3 图像相似性搜索

```sql
-- 图像特征向量
CREATE TABLE image_features (
    image_id SERIAL PRIMARY KEY,
    image_path VARCHAR(500),
    feature_vector vector(512),
    metadata JSONB
);

-- 图像相似性搜索
SELECT
    image_id,
    image_path,
    feature_vector <-> '[0.1, 0.2, ..., 0.3]' as similarity_distance
FROM image_features
ORDER BY feature_vector <-> '[0.1, 0.2, ..., 0.3]'
LIMIT 20;
```

## 7. 性能分析

- **查询延迟**: 毫秒级到秒级
- **索引构建**: O(n log n) 复杂度
- **存储开销**: 向量大小 × 维度 × 数据类型
- **搜索精度**: 可调节的近似搜索

## 8. 相关概念

- **上位概念**: 数据库系统、机器学习
- **下位概念**: 向量索引、相似性度量
- **平行概念**: 图数据库、时序数据库

## 9. 参考文献

1. Johnson, J., et al. (2019). Billion-scale similarity search with GPUs. IEEE TPAMI.
2. PostgreSQL Global Development Group. (2024). PostgreSQL 16.2 Documentation.

## 10. Wikidata对齐

- **ID**: Q186929 (vector database)
- **属性**: database concept, machine learning
- **链接**: <https://en.wikipedia.org/wiki/Vector_database>
