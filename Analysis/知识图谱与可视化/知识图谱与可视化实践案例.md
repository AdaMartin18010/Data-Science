# 知识图谱与可视化实践案例

## 1. 概述

本文档提供知识图谱与可视化在实际项目中的具体应用案例，涵盖知识图谱构建、可视化展示等各个方面的实际应用。

## 2. 知识图谱构建实践案例

### 2.1 学术知识图谱构建

```python
# 学术知识图谱构建
import networkx as nx
import matplotlib.pyplot as plt
from typing import Dict, List
from dataclasses import dataclass

@dataclass
class AcademicEntity:
    """学术实体"""
    id: str
    name: str
    entity_type: str
    properties: Dict

@dataclass
class AcademicRelation:
    """学术关系"""
    source_id: str
    target_id: str
    relation_type: str

class AcademicKnowledgeGraph:
    """学术知识图谱"""
    
    def __init__(self):
        self.entities: Dict[str, AcademicEntity] = {}
        self.relations: List[AcademicRelation] = []
        self.graph = nx.DiGraph()
        
    def add_entity(self, entity: AcademicEntity):
        """添加实体"""
        self.entities[entity.id] = entity
        self.graph.add_node(entity.id, name=entity.name, type=entity.entity_type)
    
    def add_relation(self, relation: AcademicRelation):
        """添加关系"""
        self.relations.append(relation)
        self.graph.add_edge(relation.source_id, relation.target_id, type=relation.relation_type)
    
    def get_related_entities(self, entity_id: str) -> List[str]:
        """获取相关实体"""
        return list(self.graph.neighbors(entity_id))
    
    def visualize(self, title: str = "学术知识图谱"):
        """可视化"""
        plt.figure(figsize=(12, 8))
        pos = nx.spring_layout(self.graph)
        
        nx.draw(self.graph, pos, 
               node_color='lightblue',
               node_size=1000,
               with_labels=True,
               labels={node: self.graph.nodes[node]['name'] for node in self.graph.nodes()})
        
        plt.title(title)
        plt.show()

# 使用示例
def academic_kg_example():
    """学术知识图谱示例"""
    kg = AcademicKnowledgeGraph()
    
    # 添加实体
    entities = [
        AcademicEntity("A001", "张三", "author", {}),
        AcademicEntity("P001", "深度学习论文", "paper", {}),
        AcademicEntity("J001", "ICML", "journal", {}),
    ]
    
    for entity in entities:
        kg.add_entity(entity)
    
    # 添加关系
    relations = [
        AcademicRelation("A001", "P001", "writes"),
        AcademicRelation("P001", "J001", "published_in"),
    ]
    
    for relation in relations:
        kg.add_relation(relation)
    
    # 可视化
    kg.visualize()
    
    # 查询相关实体
    related = kg.get_related_entities("A001")
    print(f"张三的相关实体: {related}")

academic_kg_example()
```

### 2.2 企业知识图谱构建

```python
# 企业知识图谱构建
@dataclass
class CompanyEntity:
    """公司实体"""
    id: str
    name: str
    entity_type: str
    properties: Dict

class CompanyKnowledgeGraph:
    """企业知识图谱"""
    
    def __init__(self):
        self.entities: Dict[str, CompanyEntity] = {}
        self.relations: List[AcademicRelation] = []
        self.graph = nx.DiGraph()
    
    def add_entity(self, entity: CompanyEntity):
        """添加实体"""
        self.entities[entity.id] = entity
        self.graph.add_node(entity.id, name=entity.name, type=entity.entity_type)
    
    def add_relation(self, relation: AcademicRelation):
        """添加关系"""
        self.relations.append(relation)
        self.graph.add_edge(relation.source_id, relation.target_id, type=relation.relation_type)
    
    def find_competitors(self, company_id: str) -> List[str]:
        """查找竞争对手"""
        competitors = []
        for neighbor in self.graph.neighbors(company_id):
            edge_data = self.graph.get_edge_data(company_id, neighbor)
            if edge_data.get('type') == 'competes_with':
                competitors.append(neighbor)
        return competitors

# 使用示例
def company_kg_example():
    """企业知识图谱示例"""
    kg = CompanyKnowledgeGraph()
    
    # 添加公司
    companies = [
        CompanyEntity("C001", "腾讯", "company", {}),
        CompanyEntity("C002", "阿里巴巴", "company", {}),
    ]
    
    for company in companies:
        kg.add_entity(company)
    
    # 添加竞争关系
    relation = AcademicRelation("C001", "C002", "competes_with")
    kg.add_relation(relation)
    
    # 查找竞争对手
    competitors = kg.find_competitors("C001")
    print(f"腾讯的竞争对手: {competitors}")

company_kg_example()
```

## 3. 知识图谱可视化实践案例

### 3.1 基础可视化

```python
# 基础可视化
import plotly.graph_objects as go
import plotly.express as px

class KGVisualizer:
    """知识图谱可视化器"""
    
    def __init__(self, kg):
        self.kg = kg
    
    def create_network_graph(self):
        """创建网络图"""
        # 准备节点数据
        node_x = []
        node_y = []
        node_text = []
        
        # 计算节点位置
        pos = nx.spring_layout(self.kg.graph, k=1, iterations=50)
        
        for entity_id, entity in self.kg.entities.items():
            if entity_id in pos:
                x, y = pos[entity_id]
                node_x.append(x)
                node_y.append(y)
                node_text.append(entity.name)
        
        # 准备边数据
        edge_x = []
        edge_y = []
        
        for relation in self.kg.relations:
            if (relation.source_id in pos and relation.target_id in pos):
                x0, y0 = pos[relation.source_id]
                x1, y1 = pos[relation.target_id]
                edge_x.extend([x0, x1, None])
                edge_y.extend([y0, y1, None])
        
        # 创建图形
        fig = go.Figure()
        
        # 添加边
        fig.add_trace(go.Scatter(
            x=edge_x, y=edge_y,
            line=dict(width=0.5, color='#888'),
            hoverinfo='none',
            mode='lines'))
        
        # 添加节点
        fig.add_trace(go.Scatter(
            x=node_x, y=node_y,
            mode='markers+text',
            hoverinfo='text',
            text=node_text,
            marker=dict(size=20, color='lightblue'),
            textposition="bottom center"
        ))
        
        fig.update_layout(
            title='知识图谱网络图',
            showlegend=False,
            hovermode='closest',
            margin=dict(b=20,l=5,r=5,t=40),
            xaxis=dict(showgrid=False, zeroline=False, showticklabels=False),
            yaxis=dict(showgrid=False, zeroline=False, showticklabels=False)
        )
        
        return fig
    
    def show(self):
        """显示图形"""
        fig = self.create_network_graph()
        fig.show()

# 使用示例
def visualization_example():
    """可视化示例"""
    kg = AcademicKnowledgeGraph()
    
    # 添加实体和关系
    entities = [
        AcademicEntity("A001", "张三", "author", {}),
        AcademicEntity("P001", "论文", "paper", {}),
        AcademicEntity("J001", "期刊", "journal", {}),
    ]
    
    for entity in entities:
        kg.add_entity(entity)
    
    relations = [
        AcademicRelation("A001", "P001", "writes"),
        AcademicRelation("P001", "J001", "published_in"),
    ]
    
    for relation in relations:
        kg.add_relation(relation)
    
    # 可视化
    visualizer = KGVisualizer(kg)
    visualizer.show()

visualization_example()
```

### 3.2 统计图表可视化

```python
# 统计图表可视化
class KGStatisticsVisualizer:
    """知识图谱统计可视化器"""
    
    def __init__(self, kg):
        self.kg = kg
    
    def create_entity_type_chart(self):
        """创建实体类型统计图"""
        type_counts = {}
        for entity in self.kg.entities.values():
            type_counts[entity.entity_type] = type_counts.get(entity.entity_type, 0) + 1
        
        fig = px.bar(
            x=list(type_counts.keys()),
            y=list(type_counts.values()),
            title="实体类型分布",
            labels={'x': '实体类型', 'y': '数量'}
        )
        return fig
    
    def create_relation_type_chart(self):
        """创建关系类型统计图"""
        type_counts = {}
        for relation in self.kg.relations:
            type_counts[relation.relation_type] = type_counts.get(relation.relation_type, 0) + 1
        
        fig = px.pie(
            values=list(type_counts.values()),
            names=list(type_counts.keys()),
            title="关系类型分布"
        )
        return fig
    
    def show_statistics(self):
        """显示统计图表"""
        entity_fig = self.create_entity_type_chart()
        relation_fig = self.create_relation_type_chart()
        
        entity_fig.show()
        relation_fig.show()

# 使用示例
def statistics_example():
    """统计可视化示例"""
    kg = AcademicKnowledgeGraph()
    
    # 添加更多数据
    entities = [
        AcademicEntity("A001", "张三", "author", {}),
        AcademicEntity("A002", "李四", "author", {}),
        AcademicEntity("P001", "论文1", "paper", {}),
        AcademicEntity("P002", "论文2", "paper", {}),
        AcademicEntity("J001", "期刊1", "journal", {}),
    ]
    
    for entity in entities:
        kg.add_entity(entity)
    
    relations = [
        AcademicRelation("A001", "P001", "writes"),
        AcademicRelation("A002", "P002", "writes"),
        AcademicRelation("P001", "J001", "published_in"),
        AcademicRelation("P002", "J001", "published_in"),
    ]
    
    for relation in relations:
        kg.add_relation(relation)
    
    # 显示统计
    stats_viz = KGStatisticsVisualizer(kg)
    stats_viz.show_statistics()

statistics_example()
```

## 4. 总结

本文档提供了知识图谱与可视化在实际项目中的具体应用案例，包括：

1. **知识图谱构建实践**：学术知识图谱和企业知识图谱的构建
2. **知识图谱可视化实践**：基础可视化和统计图表可视化

这些案例展示了知识图谱技术在学术研究、企业分析等领域的实际应用，为知识图谱项目的开发和部署提供了具体的参考和指导。
