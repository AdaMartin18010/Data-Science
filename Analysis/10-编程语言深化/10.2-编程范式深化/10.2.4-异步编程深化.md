# 10.2.4-å¼‚æ­¥ç¼–ç¨‹æ·±åŒ–

## ğŸ“‘ ç›®å½•

- [10.2.4-å¼‚æ­¥ç¼–ç¨‹æ·±åŒ–](#1024-å¼‚æ­¥ç¼–ç¨‹æ·±åŒ–)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
- [1. æ¦‚è¿°](#1-æ¦‚è¿°)
- [2. å¼‚æ­¥ç¼–ç¨‹åŸºç¡€](#2-å¼‚æ­¥ç¼–ç¨‹åŸºç¡€)
  - [2.1. åŒæ­¥ vs å¼‚æ­¥](#21-åŒæ­¥-vs-å¼‚æ­¥)
- [3. äº‹ä»¶å¾ªç¯](#3-äº‹ä»¶å¾ªç¯)
- [4. å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹](#4-å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹)
  - [4.1. åç¨‹ (Coroutines)](#41-åç¨‹-(coroutines))
  - [4.2. Future/Promise](#42-futurepromise)
- [5. å¼‚æ­¥I/Oæ“ä½œ](#5-å¼‚æ­¥ioæ“ä½œ)
  - [5.1. æ–‡ä»¶æ“ä½œ](#51-æ–‡ä»¶æ“ä½œ)
  - [5.2. ç½‘ç»œè¯·æ±‚](#52-ç½‘ç»œè¯·æ±‚)
- [6. å¼‚æ­¥æ§åˆ¶æµ](#6-å¼‚æ­¥æ§åˆ¶æµ)
  - [6.1. æ¡ä»¶æ‰§è¡Œ](#61-æ¡ä»¶æ‰§è¡Œ)
  - [6.2. å¾ªç¯å’Œè¿­ä»£](#62-å¾ªç¯å’Œè¿­ä»£)
- [7. å¼‚æ­¥é”™è¯¯å¤„ç†](#7-å¼‚æ­¥é”™è¯¯å¤„ç†)
  - [7.1. å¼‚å¸¸å¤„ç†](#71-å¼‚å¸¸å¤„ç†)
  - [7.2. è¶…æ—¶å¤„ç†](#72-è¶…æ—¶å¤„ç†)
- [8. å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼](#8-å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼)
  - [8.1. ç”Ÿäº§è€…-æ¶ˆè´¹è€…](#81-ç”Ÿäº§è€…-æ¶ˆè´¹è€…)
  - [8.2. å·¥ä½œæ± ](#82-å·¥ä½œæ± )
- [9. å¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µ](#9-å¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µ)
  - [9.1. é¿å…é˜»å¡æ“ä½œ](#91-é¿å…é˜»å¡æ“ä½œ)
- [10. èµ„æºç®¡ç†](#10-èµ„æºç®¡ç†)
- [11. å¼‚æ­¥ç¼–ç¨‹ä¸å¹¶å‘](#11-å¼‚æ­¥ç¼–ç¨‹ä¸å¹¶å‘)
  - [11.1. å¹¶å‘ vs å¹¶è¡Œ](#111-å¹¶å‘-vs-å¹¶è¡Œ)
- [12. æ€»ç»“](#12-æ€»ç»“)
---


## 1. æ¦‚è¿°

å¼‚æ­¥ç¼–ç¨‹æ˜¯ä¸€ç§éé˜»å¡çš„ç¼–ç¨‹èŒƒå¼ï¼Œå…è®¸ç¨‹åºåœ¨ç­‰å¾…I/Oæ“ä½œæ—¶æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œæé«˜ç¨‹åºçš„å¹¶å‘æ€§èƒ½ã€‚

## 2. å¼‚æ­¥ç¼–ç¨‹åŸºç¡€

### 2.1. åŒæ­¥ vs å¼‚æ­¥

```python
# åŒæ­¥ç¼–ç¨‹
def sync_read_file():
    with open('file.txt', 'r') as f:
        content = f.read()  # é˜»å¡ç›´åˆ°è¯»å–å®Œæˆ
    return content

# å¼‚æ­¥ç¼–ç¨‹
async def async_read_file():
    async with aiofiles.open('file.txt', 'r') as f:
        content = await f.read()  # éé˜»å¡ï¼Œå¯ä»¥åˆ‡æ¢ä»»åŠ¡
    return content
```

## 3. äº‹ä»¶å¾ªç¯

```python
import asyncio

async def main():
    task1 = asyncio.create_task(async_read_file())
    task2 = asyncio.create_task(async_read_file())

# å¹¶å‘æ‰§è¡Œ
    results = await asyncio.gather(task1, task2)
    return results

asyncio.run(main())
```

## 4. å¼‚æ­¥ç¼–ç¨‹æ¨¡å‹

### 4.1. åç¨‹ (Coroutines)

```python
async def coroutine_example():
    print("å¼€å§‹")
    await asyncio.sleep(1)  # éé˜»å¡ç­‰å¾…
    print("ç»“æŸ")

async def main():
    task1 = asyncio.create_task(coroutine_example())
    task2 = asyncio.create_task(coroutine_example())
    await asyncio.gather(task1, task2)
```

### 4.2. Future/Promise

```python
async def fetch_data():
    await asyncio.sleep(1)  # æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚
    return {"data": "result"}

async def main():
    future = asyncio.create_task(fetch_data())
    print("å…¶ä»–å·¥ä½œ...")
    result = await future
    print(result)
```

## 5. å¼‚æ­¥I/Oæ“ä½œ

### 5.1. æ–‡ä»¶æ“ä½œ

```python
import aiofiles

async def read_files():
    tasks = []
    for filename in ['file1.txt', 'file2.txt', 'file3.txt']:
        task = asyncio.create_task(read_file(filename))
        tasks.append(task)

    contents = await asyncio.gather(*tasks)
    return contents

async def read_file(filename):
    async with aiofiles.open(filename, 'r') as f:
        return await f.read()
```

### 5.2. ç½‘ç»œè¯·æ±‚

```python
import aiohttp

async def fetch_urls():
    urls = [
        'https://api.example.com/data1',
        'https://api.example.com/data2',
        'https://api.example.com/data3'
    ]

    async with aiohttp.ClientSession() as session:
        tasks = []
        for url in urls:
            task = asyncio.create_task(fetch_url(session, url))
            tasks.append(task)

        results = await asyncio.gather(*tasks)
        return results

async def fetch_url(session, url):
    async with session.get(url) as response:
        return await response.json()
```

## 6. å¼‚æ­¥æ§åˆ¶æµ

### 6.1. æ¡ä»¶æ‰§è¡Œ

```python
async def conditional_task():
    if await check_condition():
        result = await process_data()
    else:
        result = await alternative_process()
    return result
```

### 6.2. å¾ªç¯å’Œè¿­ä»£

```python
async def process_items(items):
    results = []
    for item in items:
        result = await process_item(item)
        results.append(result)
    return results
```

## 7. å¼‚æ­¥é”™è¯¯å¤„ç†

### 7.1. å¼‚å¸¸å¤„ç†

```python
async def robust_operation():
    try:
        result = await risky_operation()
        return result
    except Exception as e:
        print(f"é”™è¯¯: {e}")
        return None
```

### 7.2. è¶…æ—¶å¤„ç†

```python
async def timeout_example():
    try:
        result = await asyncio.wait_for(slow_operation(), timeout=2.0)
        return result
    except asyncio.TimeoutError:
        return "æ“ä½œè¶…æ—¶"
```

## 8. å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼

### 8.1. ç”Ÿäº§è€…-æ¶ˆè´¹è€…

```python
async def producer(queue):
    for i in range(10):
        item = f"item_{i}"
        await queue.put(item)
        await asyncio.sleep(0.1)
    await queue.put(None)  # ç»“æŸä¿¡å·

async def consumer(queue):
    while True:
        item = await queue.get()
        if item is None:
            break
        print(f"å¤„ç†: {item}")
        await asyncio.sleep(0.2)
        queue.task_done()
```

### 8.2. å·¥ä½œæ± 

```python
async def worker_pool():
    semaphore = asyncio.Semaphore(3)  # é™åˆ¶å¹¶å‘æ•°

    async def worker(worker_id):
        async with semaphore:
            print(f"å·¥ä½œè€… {worker_id} å¼€å§‹")
            await asyncio.sleep(1)
            print(f"å·¥ä½œè€… {worker_id} å®Œæˆ")

    tasks = [worker(i) for i in range(10)]
    await asyncio.gather(*tasks)
```

## 9. å¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µ

### 9.1. é¿å…é˜»å¡æ“ä½œ

```python
# é”™è¯¯ï¼šåœ¨å¼‚æ­¥å‡½æ•°ä¸­ä½¿ç”¨é˜»å¡æ“ä½œ
async def bad_example():
    time.sleep(1)  # é˜»å¡æ•´ä¸ªäº‹ä»¶å¾ªç¯

# æ­£ç¡®ï¼šä½¿ç”¨å¼‚æ­¥æ“ä½œ
async def good_example():
    await asyncio.sleep(1)  # éé˜»å¡
```

## 10. èµ„æºç®¡ç†

```python
async def resource_management():
    async with aiofiles.open('file.txt', 'r') as f:
        content = await f.read()
    return content
```

## 11. å¼‚æ­¥ç¼–ç¨‹ä¸å¹¶å‘

### 11.1. å¹¶å‘ vs å¹¶è¡Œ

```python
# å¹¶å‘ï¼šå¤šä¸ªä»»åŠ¡äº¤æ›¿æ‰§è¡Œ
async def concurrent_tasks():
    tasks = [task1(), task2(), task3()]
    results = await asyncio.gather(*tasks)
    return results

# å¹¶è¡Œï¼šä½¿ç”¨å¤šè¿›ç¨‹
import multiprocessing

def parallel_tasks():
    with multiprocessing.Pool() as pool:
        results = pool.map(cpu_intensive_task, data)
    return results
```

## 12. æ€»ç»“

å¼‚æ­¥ç¼–ç¨‹é€šè¿‡éé˜»å¡I/Oå’Œäº‹ä»¶å¾ªç¯æä¾›é«˜æ•ˆçš„å¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œç‰¹åˆ«é€‚åˆI/Oå¯†é›†å‹åº”ç”¨ã€‚ç†è§£å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼å¯¹äºæ„å»ºé«˜æ€§èƒ½çš„ç°ä»£åº”ç”¨ç¨‹åºè‡³å…³é‡è¦ã€‚

---

**ç›¸å…³é“¾æ¥ï¼š**

- [10.2.1-å‡½æ•°å¼ç¼–ç¨‹æ·±åŒ–](10.2.1-å‡½æ•°å¼ç¼–ç¨‹èŒƒå¼æ·±åŒ–.md)
- [10.2.3-å¹¶å‘ç¼–ç¨‹æ·±åŒ–](10.2.3-å¹¶å‘ç¼–ç¨‹æ·±åŒ–.md)
