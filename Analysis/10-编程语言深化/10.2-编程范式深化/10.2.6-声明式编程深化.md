# 10.2.6-å£°æ˜å¼ç¼–ç¨‹æ·±åŒ–

## ğŸ“‘ ç›®å½•

- [10.2.6-å£°æ˜å¼ç¼–ç¨‹æ·±åŒ–](#1026-å£°æ˜å¼ç¼–ç¨‹æ·±åŒ–)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
- [1. æ¦‚è¿°](#1-æ¦‚è¿°)
- [2. å£°æ˜å¼ç¼–ç¨‹åŸºç¡€](#2-å£°æ˜å¼ç¼–ç¨‹åŸºç¡€)
  - [2.1. æ ¸å¿ƒæ¦‚å¿µ](#21-æ ¸å¿ƒæ¦‚å¿µ)
- [3. åŸºæœ¬ç‰¹å¾](#3-åŸºæœ¬ç‰¹å¾)
- [4. å‡½æ•°å¼å£°æ˜å¼ç¼–ç¨‹](#4-å‡½æ•°å¼å£°æ˜å¼ç¼–ç¨‹)
  - [4.1. é«˜é˜¶å‡½æ•°](#41-é«˜é˜¶å‡½æ•°)
- [5. å‡½æ•°ç»„åˆ](#5-å‡½æ•°ç»„åˆ)
- [6. é€»è¾‘ç¼–ç¨‹](#6-é€»è¾‘ç¼–ç¨‹)
  - [6.1. Prologé£æ ¼é€»è¾‘](#61-prologé£æ ¼é€»è¾‘)
- [7. çº¦æŸç¼–ç¨‹](#7-çº¦æŸç¼–ç¨‹)
- [8. è§„åˆ™å¼•æ“](#8-è§„åˆ™å¼•æ“)
  - [8.1. ç®€å•è§„åˆ™å¼•æ“](#81-ç®€å•è§„åˆ™å¼•æ“)
- [9. å£°æ˜å¼SQL](#9-å£°æ˜å¼sql)
  - [9.1. å£°æ˜å¼æŸ¥è¯¢](#91-å£°æ˜å¼æŸ¥è¯¢)
- [10. å£°æ˜å¼é…ç½®](#10-å£°æ˜å¼é…ç½®)
  - [10.1. YAMLé…ç½®](#101-yamlé…ç½®)
- [11. å£°æ˜å¼UI](#11-å£°æ˜å¼ui)
  - [11.1. å£°æ˜å¼ç•Œé¢å®šä¹‰](#111-å£°æ˜å¼ç•Œé¢å®šä¹‰)
- [12. å£°æ˜å¼æµ‹è¯•](#12-å£°æ˜å¼æµ‹è¯•)
  - [12.1. è¡Œä¸ºé©±åŠ¨å¼€å‘](#121-è¡Œä¸ºé©±åŠ¨å¼€å‘)
- [13. å£°æ˜å¼æ•°æ®å¤„ç†](#13-å£°æ˜å¼æ•°æ®å¤„ç†)
  - [13.1. æ•°æ®ç®¡é“](#131-æ•°æ®ç®¡é“)
- [14. å£°æ˜å¼APIè®¾è®¡](#14-å£°æ˜å¼apiè®¾è®¡)
  - [14.1. RESTful API](#141-restful-api)
- [15. å£°æ˜å¼å·¥ä½œæµ](#15-å£°æ˜å¼å·¥ä½œæµ)
  - [15.1. å·¥ä½œæµå®šä¹‰](#151-å·¥ä½œæµå®šä¹‰)
- [16. æ€»ç»“](#16-æ€»ç»“)
---


## 1. æ¦‚è¿°

å£°æ˜å¼ç¼–ç¨‹æ˜¯ä¸€ç§æè¿°"åšä»€ä¹ˆ"è€Œä¸æ˜¯"æ€ä¹ˆåš"çš„ç¼–ç¨‹èŒƒå¼ï¼Œé€šè¿‡å£°æ˜æ„å›¾å’Œè§„åˆ™æ¥å®ç°ç¨‹åºé€»è¾‘ã€‚

## 2. å£°æ˜å¼ç¼–ç¨‹åŸºç¡€

### 2.1. æ ¸å¿ƒæ¦‚å¿µ

```python
# å£°æ˜å¼ç¼–ç¨‹çš„æ ¸å¿ƒæ€æƒ³
ç¨‹åº = å£°æ˜æ„å›¾ + è§„åˆ™çº¦æŸ + è‡ªåŠ¨æ¨ç†
```

## 3. åŸºæœ¬ç‰¹å¾

```python
# å‘½ä»¤å¼ vs å£°æ˜å¼
# å‘½ä»¤å¼ï¼šæè¿°å¦‚ä½•åš
def imperative_sum(numbers):
    total = 0
    for num in numbers:
        total += num
    return total

# å£°æ˜å¼ï¼šæè¿°åšä»€ä¹ˆ
def declarative_sum(numbers):
    return sum(numbers)  # ç›´æ¥å£°æ˜æ±‚å’Œæ„å›¾
```

## 4. å‡½æ•°å¼å£°æ˜å¼ç¼–ç¨‹

### 4.1. é«˜é˜¶å‡½æ•°

```python
from functools import reduce

# å£°æ˜å¼æ•°æ®å¤„ç†
def declarative_data_processing():
    numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]

# å£°æ˜å¼ç®¡é“å¤„ç†
    result = reduce(
        lambda acc, x: acc + x,
        filter(lambda x: x % 2 == 0,  # è¿‡æ»¤å¶æ•°
        map(lambda x: x * 2, numbers))  # æ˜ å°„è½¬æ¢
    )

    print(f"ç»“æœ: {result}")

declarative_data_processing()
```

## 5. å‡½æ•°ç»„åˆ

```python
from functools import reduce

def compose(*functions):
    """å‡½æ•°ç»„åˆå™¨"""
    def inner(arg):
        return reduce(lambda acc, f: f(acc), reversed(functions), arg)
    return inner

def add_one(x): return x + 1
def multiply_by_two(x): return x * 2
def square(x): return x ** 2

# å£°æ˜å¼å‡½æ•°ç»„åˆ
pipeline = compose(square, multiply_by_two, add_one)
result = pipeline(3)  # ((3 + 1) * 2) ^ 2 = 64
print(f"å‡½æ•°ç»„åˆç»“æœ: {result}")
```

## 6. é€»è¾‘ç¼–ç¨‹

### 6.1. Prologé£æ ¼é€»è¾‘

```python
# ç®€å•çš„é€»è¾‘ç¼–ç¨‹å®ç°
class LogicEngine:
    def __init__(self):
        self.facts = set()
        self.rules = []

    def add_fact(self, fact):
        self.facts.add(fact)

    def add_rule(self, head, body):
        self.rules.append((head, body))

    def query(self, goal):
        if goal in self.facts:
            return True

        for head, body in self.rules:
            if head == goal:
                if all(self.query(subgoal) for subgoal in body):
                    return True

        return False

# ä½¿ç”¨ç¤ºä¾‹
def logic_programming_example():
    engine = LogicEngine()

# æ·»åŠ äº‹å®
    engine.add_fact("parent(john, mary)")
    engine.add_fact("parent(mary, bob)")

# æ·»åŠ è§„åˆ™
    engine.add_rule("grandparent(X, Z)", ["parent(X, Y)", "parent(Y, Z)"])

# æŸ¥è¯¢
    result = engine.query("grandparent(john, bob)")
    print(f"Johnæ˜¯Bobçš„ç¥–çˆ¶: {result}")

logic_programming_example()
```

## 7. çº¦æŸç¼–ç¨‹

```python
from constraint import Problem, AllDifferentConstraint

def constraint_programming_example():
# åˆ›å»ºçº¦æŸé—®é¢˜
    problem = Problem()

# å˜é‡ï¼š8çš‡åé—®é¢˜
    queens = range(8)
    problem.addVariables(queens, range(8))

# çº¦æŸï¼šæ‰€æœ‰çš‡ååœ¨ä¸åŒè¡Œ
    problem.addConstraint(AllDifferentConstraint())

# çº¦æŸï¼šå¯¹è§’çº¿çº¦æŸ
    for i in queens:
        for j in queens:
            if i < j:
                problem.addConstraint(
                    lambda q1, q2, row1=i, row2=j:
                    abs(q1 - q2) != abs(row1 - row2),
                    (i, j)
                )

# æ±‚è§£
    solutions = problem.getSolutions()
    print(f"8çš‡åé—®é¢˜è§£çš„æ•°é‡: {len(solutions)}")

# æ˜¾ç¤ºç¬¬ä¸€ä¸ªè§£
    if solutions:
        solution = solutions[0]
        for row, col in solution.items():
            print(f"çš‡å{row}åœ¨ä½ç½®({row}, {col})")

constraint_programming_example()
```

## 8. è§„åˆ™å¼•æ“

### 8.1. ç®€å•è§„åˆ™å¼•æ“

```python
class RuleEngine:
    def __init__(self):
        self.rules = []
        self.facts = {}

    def add_rule(self, condition, action):
        self.rules.append((condition, action))

    def add_fact(self, key, value):
        self.facts[key] = value

    def execute(self):
        changed = True
        while changed:
            changed = False
            for condition, action in self.rules:
                if condition(self.facts):
                    if action(self.facts):
                        changed = True

# ä½¿ç”¨ç¤ºä¾‹
def rule_engine_example():
    engine = RuleEngine()

# æ·»åŠ äº‹å®
    engine.add_fact("temperature", 25)
    engine.add_fact("humidity", 60)
    engine.add_fact("air_conditioning", False)

# æ·»åŠ è§„åˆ™
    def hot_condition(facts):
        return facts.get("temperature", 0) > 30

    def hot_action(facts):
        if not facts.get("air_conditioning", False):
            facts["air_conditioning"] = True
            print("æ¸©åº¦è¿‡é«˜ï¼Œå¼€å¯ç©ºè°ƒ")
            return True
        return False

    def humid_condition(facts):
        return facts.get("humidity", 0) > 70

    def humid_action(facts):
        if not facts.get("dehumidifier", False):
            facts["dehumidifier"] = True
            print("æ¹¿åº¦è¿‡é«˜ï¼Œå¼€å¯é™¤æ¹¿å™¨")
            return True
        return False

    engine.add_rule(hot_condition, hot_action)
    engine.add_rule(humid_condition, humid_action)

# æ‰§è¡Œè§„åˆ™
    engine.execute()

rule_engine_example()
```

## 9. å£°æ˜å¼SQL

### 9.1. å£°æ˜å¼æŸ¥è¯¢

```python
import sqlite3

def declarative_sql_example():
# åˆ›å»ºæ•°æ®åº“
    conn = sqlite3.connect(":memory:")
    cursor = conn.cursor()

# åˆ›å»ºè¡¨
    cursor.execute("""
        CREATE TABLE employees (
            id INTEGER PRIMARY KEY,
            name TEXT,
            department TEXT,
            salary REAL
        )
    """)

# æ’å…¥æ•°æ®
    employees_data = [
        (1, "Alice", "Engineering", 75000),
        (2, "Bob", "Marketing", 65000),
        (3, "Charlie", "Engineering", 80000),
        (4, "Diana", "HR", 60000),
        (5, "Eve", "Engineering", 90000)
    ]

    cursor.executemany(
        "INSERT INTO employees VALUES (?, ?, ?, ?)",
        employees_data
    )

# å£°æ˜å¼æŸ¥è¯¢ï¼šæ‰¾å‡ºå·¥ç¨‹éƒ¨é—¨å¹³å‡å·¥èµ„è¶…è¿‡70000çš„å‘˜å·¥
    cursor.execute("""
        SELECT name, salary
        FROM employees
        WHERE department = 'Engineering'
        AND salary > (
            SELECT AVG(salary)
            FROM employees
            WHERE department = 'Engineering'
        )
        ORDER BY salary DESC
    """)

    results = cursor.fetchall()
    print("é«˜è–ªå·¥ç¨‹å‘˜å·¥:")
    for name, salary in results:
        print(f"{name}: ${salary:,.2f}")

    conn.close()

declarative_sql_example()
```

## 10. å£°æ˜å¼é…ç½®

### 10.1. YAMLé…ç½®

```python
import yaml
from dataclasses import dataclass
from typing import List, Dict

@dataclass
class DatabaseConfig:
    host: str
    port: int
    name: str
    user: str
    password: str

@dataclass
class AppConfig:
    name: str
    version: str
    debug: bool
    database: DatabaseConfig
    features: List[str]
    settings: Dict[str, str]

def declarative_config_example():
# å£°æ˜å¼é…ç½®
    config_yaml = """
    name: "MyApp"
    version: "1.0.0"
    debug: true
    database:
      host: "localhost"
      port: 5432
      name: "myapp_db"
      user: "admin"
      password: "secret"
    features:
      - "authentication"
      - "authorization"
      - "logging"
    settings:
      theme: "dark"
      language: "en"
      timezone: "UTC"
    """

# è§£æé…ç½®
    config_data = yaml.safe_load(config_yaml)

# è½¬æ¢ä¸ºç»“æ„åŒ–å¯¹è±¡
    db_config = DatabaseConfig(**config_data["database"])
    app_config = AppConfig(
        name=config_data["name"],
        version=config_data["version"],
        debug=config_data["debug"],
        database=db_config,
        features=config_data["features"],
        settings=config_data["settings"]
    )

    print(f"åº”ç”¨é…ç½®: {app_config.name} v{app_config.version}")
    print(f"æ•°æ®åº“: {app_config.database.host}:{app_config.database.port}")
    print(f"åŠŸèƒ½: {', '.join(app_config.features)}")

declarative_config_example()
```

## 11. å£°æ˜å¼UI

### 11.1. å£°æ˜å¼ç•Œé¢å®šä¹‰

```python
from dataclasses import dataclass
from typing import List, Optional

@dataclass
class UIComponent:
    type: str
    id: str
    props: dict
    children: Optional[List['UIComponent']] = None

def declarative_ui_example():
# å£°æ˜å¼UIå®šä¹‰
    ui_structure = UIComponent(
        type="div",
        id="app",
        props={"class": "container"},
        children=[
            UIComponent(
                type="header",
                id="header",
                props={"class": "app-header"},
                children=[
                    UIComponent(
                        type="h1",
                        id="title",
                        props={"text": "æˆ‘çš„åº”ç”¨"}
                    )
                ]
            ),
            UIComponent(
                type="main",
                id="main",
                props={"class": "app-main"},
                children=[
                    UIComponent(
                        type="button",
                        id="submit",
                        props={"text": "æäº¤", "onClick": "handleSubmit"}
                    )
                ]
            )
        ]
    )

# æ¸²æŸ“UIï¼ˆæ¨¡æ‹Ÿï¼‰
    def render_component(component, indent=0):
        spaces = "  " * indent
        print(f"{spaces}{component.type}(id='{component.id}')")
        if component.children:
            for child in component.children:
                render_component(child, indent + 1)

    print("å£°æ˜å¼UIç»“æ„:")
    render_component(ui_structure)

declarative_ui_example()
```

## 12. å£°æ˜å¼æµ‹è¯•

### 12.1. è¡Œä¸ºé©±åŠ¨å¼€å‘

```python
from dataclasses import dataclass
from typing import Callable, List

@dataclass
class Scenario:
    given: str
    when: str
    then: str
    action: Callable

class BDDTestFramework:
    def __init__(self):
        self.scenarios = []

    def scenario(self, description: str):
        def decorator(action: Callable):
            self.scenarios.append(Scenario(
                given="",
                when="",
                then="",
                action=action
            ))
            return action
        return decorator

    def given(self, description: str):
        def decorator(func):
# å­˜å‚¨givenæè¿°
            return func
        return decorator

    def when(self, description: str):
        def decorator(func):
# å­˜å‚¨whenæè¿°
            return func
        return decorator

    def then(self, description: str):
        def decorator(func):
# å­˜å‚¨thenæè¿°
            return func
        return decorator

# ä½¿ç”¨ç¤ºä¾‹
def declarative_testing_example():
    framework = BDDTestFramework()

    @framework.scenario("ç”¨æˆ·ç™»å½•æˆåŠŸ")
    def test_user_login_success():
# Given ç”¨æˆ·å·²æ³¨å†Œ
        user = {"username": "testuser", "password": "password123"}

# When ç”¨æˆ·è¾“å…¥æ­£ç¡®çš„å‡­æ®
        result = login(user["username"], user["password"])

# Then ç”¨æˆ·åº”è¯¥æˆåŠŸç™»å½•
        assert result["success"] == True
        assert result["user"]["username"] == user["username"]

    def login(username, password):
# æ¨¡æ‹Ÿç™»å½•é€»è¾‘
        if username == "testuser" and password == "password123":
            return {
                "success": True,
                "user": {"username": username}
            }
        return {"success": False}

# æ‰§è¡Œæµ‹è¯•
    for scenario in framework.scenarios:
        print(f"æ‰§è¡Œåœºæ™¯: {scenario}")
        try:
            scenario.action()
            print("âœ“ æµ‹è¯•é€šè¿‡")
        except Exception as e:
            print(f"âœ— æµ‹è¯•å¤±è´¥: {e}")

declarative_testing_example()
```

## 13. å£°æ˜å¼æ•°æ®å¤„ç†

### 13.1. æ•°æ®ç®¡é“

```python
from typing import List, Callable, Any
from dataclasses import dataclass

@dataclass
class DataPipeline:
    steps: List[Callable]

    def add_step(self, step: Callable):
        self.steps.append(step)
        return self

    def execute(self, data: Any):
        result = data
        for step in self.steps:
            result = step(result)
        return result

def declarative_data_pipeline():
# å£°æ˜å¼æ•°æ®å¤„ç†ç®¡é“
    pipeline = DataPipeline([])

# å®šä¹‰å¤„ç†æ­¥éª¤
    def filter_even(data):
        return [x for x in data if x % 2 == 0]

    def square_data(data):
        return [x ** 2 for x in data]

    def sum_data(data):
        return sum(data)

# æ„å»ºç®¡é“
    pipeline.add_step(filter_even).add_step(square_data).add_step(sum_data)

# æ‰§è¡Œç®¡é“
    input_data = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
    result = pipeline.execute(input_data)

    print(f"è¾“å…¥: {input_data}")
    print(f"è¾“å‡º: {result}")
    print(f"å¤„ç†æ­¥éª¤: è¿‡æ»¤å¶æ•° -> å¹³æ–¹ -> æ±‚å’Œ")

declarative_data_pipeline()
```

## 14. å£°æ˜å¼APIè®¾è®¡

### 14.1. RESTful API

```python
from flask import Flask, request, jsonify
from functools import wraps

app = Flask(__name__)

def declarative_api_example():
# å£°æ˜å¼APIè·¯ç”±å®šä¹‰
    @app.route('/users', methods=['GET'])
    def get_users():
        """è·å–æ‰€æœ‰ç”¨æˆ·"""
        return jsonify({"users": []})

    @app.route('/users/<int:user_id>', methods=['GET'])
    def get_user(user_id):
        """è·å–ç‰¹å®šç”¨æˆ·"""
        return jsonify({"user_id": user_id})

    @app.route('/users', methods=['POST'])
    def create_user():
        """åˆ›å»ºæ–°ç”¨æˆ·"""
        data = request.get_json()
        return jsonify({"message": "ç”¨æˆ·å·²åˆ›å»º", "data": data})

    @app.route('/users/<int:user_id>', methods=['PUT'])
    def update_user(user_id):
        """æ›´æ–°ç”¨æˆ·"""
        data = request.get_json()
        return jsonify({"message": "ç”¨æˆ·å·²æ›´æ–°", "user_id": user_id})

    @app.route('/users/<int:user_id>', methods=['DELETE'])
    def delete_user(user_id):
        """åˆ é™¤ç”¨æˆ·"""
        return jsonify({"message": "ç”¨æˆ·å·²åˆ é™¤", "user_id": user_id})

# å£°æ˜å¼ä¸­é—´ä»¶
def require_auth(f):
    @wraps(f)
    def decorated_function(*args, **kwargs):
        auth_header = request.headers.get('Authorization')
        if not auth_header:
            return jsonify({"error": "éœ€è¦è®¤è¯"}), 401
        return f(*args, **kwargs)
    return decorated_function

# ä½¿ç”¨ä¸­é—´ä»¶
@app.route('/protected', methods=['GET'])
@require_auth
def protected_resource():
    return jsonify({"message": "å—ä¿æŠ¤çš„èµ„æº"})

# å¯åŠ¨åº”ç”¨
if __name__ == '__main__':
    app.run(debug=True)
```

## 15. å£°æ˜å¼å·¥ä½œæµ

### 15.1. å·¥ä½œæµå®šä¹‰

```python
from dataclasses import dataclass
from typing import List, Dict, Any
from enum import Enum

class TaskStatus(Enum):
    PENDING = "pending"
    RUNNING = "running"
    COMPLETED = "completed"
    FAILED = "failed"

@dataclass
class Task:
    id: str
    name: str
    action: str
    dependencies: List[str]
    status: TaskStatus = TaskStatus.PENDING

class DeclarativeWorkflow:
    def __init__(self):
        self.tasks: Dict[str, Task] = {}

    def add_task(self, task: Task):
        self.tasks[task.id] = task

    def execute(self):
# æ‹“æ‰‘æ’åºæ‰§è¡Œä»»åŠ¡
        completed = set()

        while len(completed) < len(self.tasks):
            for task_id, task in self.tasks.items():
                if task_id in completed:
                    continue

# æ£€æŸ¥ä¾èµ–æ˜¯å¦å®Œæˆ
                if all(dep in completed for dep in task.dependencies):
                    print(f"æ‰§è¡Œä»»åŠ¡: {task.name}")
                    task.status = TaskStatus.RUNNING

# æ¨¡æ‹Ÿä»»åŠ¡æ‰§è¡Œ
                    try:
# è¿™é‡Œæ‰§è¡Œå®é™…ä»»åŠ¡
                        task.status = TaskStatus.COMPLETED
                        completed.add(task_id)
                        print(f"ä»»åŠ¡å®Œæˆ: {task.name}")
                    except Exception as e:
                        task.status = TaskStatus.FAILED
                        print(f"ä»»åŠ¡å¤±è´¥: {task.name} - {e}")

def declarative_workflow_example():
    workflow = DeclarativeWorkflow()

# å£°æ˜å¼å·¥ä½œæµå®šä¹‰
    workflow.add_task(Task("fetch", "è·å–æ•°æ®", "fetch_data", []))
    workflow.add_task(Task("process", "å¤„ç†æ•°æ®", "process_data", ["fetch"]))
    workflow.add_task(Task("validate", "éªŒè¯æ•°æ®", "validate_data", ["process"]))
    workflow.add_task(Task("save", "ä¿å­˜æ•°æ®", "save_data", ["validate"]))
    workflow.add_task(Task("notify", "å‘é€é€šçŸ¥", "send_notification", ["save"]))

# æ‰§è¡Œå·¥ä½œæµ
    print("å¼€å§‹æ‰§è¡Œå£°æ˜å¼å·¥ä½œæµ:")
    workflow.execute()

declarative_workflow_example()
```

## 16. æ€»ç»“

å£°æ˜å¼ç¼–ç¨‹é€šè¿‡æè¿°æ„å›¾å’Œè§„åˆ™ï¼Œè€Œä¸æ˜¯å…·ä½“çš„æ‰§è¡Œæ­¥éª¤ï¼Œæä¾›äº†ä¸€ç§æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ï¼Œä½¿ä»£ç æ›´åŠ æ¸…æ™°ã€å¯ç»´æŠ¤å’Œå¯ç†è§£ã€‚

---

**ç›¸å…³é“¾æ¥ï¼š**

- [10.2.1-å‡½æ•°å¼ç¼–ç¨‹èŒƒå¼æ·±åŒ–](10.2.1-å‡½æ•°å¼ç¼–ç¨‹èŒƒå¼æ·±åŒ–.md)
- [10.2.2-é¢å‘å¯¹è±¡ç¼–ç¨‹èŒƒå¼æ·±åŒ–](10.2.2-é¢å‘å¯¹è±¡ç¼–ç¨‹èŒƒå¼æ·±åŒ–.md)
- [10.2.3-å¹¶å‘ç¼–ç¨‹æ·±åŒ–](10.2.3-å¹¶å‘ç¼–ç¨‹æ·±åŒ–.md)
- [10.2.4-å¼‚æ­¥ç¼–ç¨‹æ·±åŒ–](10.2.4-å¼‚æ­¥ç¼–ç¨‹æ·±åŒ–.md)
- [10.2.5-å“åº”å¼ç¼–ç¨‹æ·±åŒ–](10.2.5-å“åº”å¼ç¼–ç¨‹æ·±åŒ–.md)
