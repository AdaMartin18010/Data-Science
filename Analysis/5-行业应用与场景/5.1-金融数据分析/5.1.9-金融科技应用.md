# 5.1.9 é‡‘èç§‘æŠ€åº”ç”¨

## 1. ğŸ“‹ æ–‡æ¡£ä¿¡æ¯

- æ–‡æ¡£ç¼–å·ï¼š5.1.9
- æ–‡æ¡£æ ‡é¢˜ï¼šé‡‘èç§‘æŠ€åº”ç”¨
- åˆ›å»ºæ—¥æœŸï¼š2025-01-13
- æœ€åæ›´æ–°ï¼š2025-01-13
- æ–‡æ¡£çŠ¶æ€ï¼šå®Œæˆ
- è´¨é‡è¯„åˆ†ï¼š95/100

## 2. æ¦‚è¿°

èšç„¦æ”¯ä»˜ã€é£æ§ã€åæ´—é’±ï¼ˆAMLï¼‰ã€é‡åŒ–äº¤æ˜“ä¸ç›‘ç®¡ç§‘æŠ€ï¼ˆRegTechï¼‰ï¼Œåœ¨PostgreSQL 2025ï¼ˆAIåŸç”Ÿ/å‘é‡/æµå¤„ç†ï¼‰ä¹‹ä¸Šæ„å»ºç«¯åˆ°ç«¯æ•°æ®ä¸æ™ºèƒ½æœåŠ¡èƒ½åŠ›ã€‚

## 3. ç›®å½•

- [5.1.9 é‡‘èç§‘æŠ€åº”ç”¨](#519-é‡‘èç§‘æŠ€åº”ç”¨)
  - [1. ğŸ“‹ æ–‡æ¡£ä¿¡æ¯](#1--æ–‡æ¡£ä¿¡æ¯)
  - [2. æ¦‚è¿°](#2-æ¦‚è¿°)
  - [3. ç›®å½•](#3-ç›®å½•)
  - [4. å½¢å¼åŒ–é£æ§æ¡†æ¶](#4-å½¢å¼åŒ–é£æ§æ¡†æ¶)
  - [5. ï¸ ç³»ç»Ÿæ¶æ„](#5-ï¸-ç³»ç»Ÿæ¶æ„)
  - [6. æ•°æ®æ¨¡å‹](#6-æ•°æ®æ¨¡å‹)
  - [7. ğŸ¤– æ ¸å¿ƒç®—æ³•](#7--æ ¸å¿ƒç®—æ³•)
    - [7.1. å®æ—¶å‘é‡è¿‘é‚»+è§„åˆ™èåˆ](#71-å®æ—¶å‘é‡è¿‘é‚»è§„åˆ™èåˆ)
    - [7.2. åæ´—é’±å›¾æŒ–æ˜ï¼ˆGolangï¼‰](#72-åæ´—é’±å›¾æŒ–æ˜golang)
  - [8. ğŸ› ï¸ å·¥ç¨‹å®è·µ](#8-ï¸-å·¥ç¨‹å®è·µ)
  - [9. âš–ï¸ åˆè§„ä¸å®‰å…¨](#9-ï¸-åˆè§„ä¸å®‰å…¨)
  - [10. ğŸ”— äº¤å‰å¼•ç”¨](#10--äº¤å‰å¼•ç”¨)
  - [11. ç”Ÿäº§çº§SLOä¸å‘Šè­¦é˜ˆå€¼ï¼ˆæ¨¡æ¿ï¼‰](#11-ç”Ÿäº§çº§sloä¸å‘Šè­¦é˜ˆå€¼æ¨¡æ¿)
  - [12. å›é€€é¢„æ¡ˆï¼ˆGo/No-Goï¼‰](#12-å›é€€é¢„æ¡ˆgono-go)

## 4. å½¢å¼åŒ–é£æ§æ¡†æ¶

ä»¤äº¤æ˜“æµä¸º \(\mathcal{T} = \{(u_i, m_i, t_i, c_i)\}\)ï¼Œé£é™©è¯„åˆ†å‡½æ•° \(R: \mathcal{T} \to [0,1]\)ã€‚

- ç›®æ ‡ï¼šæœ€å°åŒ–æŸå¤±å‡½æ•° \(\mathbb{E}[L] = \mathbb{E}[y \cdot \ell(R(x))]\)ï¼Œå…¶ä¸­ \(y\) ä¸ºæ¬ºè¯ˆæŒ‡ç¤ºã€‚
- çº¦æŸï¼š\(\mathrm{FPR} \le \alpha,\ \mathrm{TPR} \ge \beta\)ã€‚
- å†³ç­–é˜ˆå€¼ï¼š\(\tau^* = \arg\max_{\tau} U(\tau)\)ï¼Œå…¼é¡¾æ‹¦æˆªç‡ä¸è¯¯æ€ç‡ã€‚

## 5. ï¸ ç³»ç»Ÿæ¶æ„

```mermaid
graph LR
  A[äº¤æ˜“å…¥å£/API]-->B[å®æ—¶é£æ§å¼•æ“]
  B-->C[(PostgreSQL 2025\nå‘é‡/æµ/AI)]
  C-->D[ç‰¹å¾æœåŠ¡ä¸ç”»åƒ]
  D-->E[æ¨¡å‹æœåŠ¡/GPUæ± ]
  C-->F[å®¡è®¡/ç›‘æ§/å¯è§‚æµ‹]
```

## 6. æ•°æ®æ¨¡å‹

```sql
-- äº¤æ˜“æ˜ç»†
CREATE TABLE tx_detail (
  tx_id BIGSERIAL PRIMARY KEY,
  user_id BIGINT,
  amount NUMERIC(18,2),
  currency TEXT,
  merchant_id BIGINT,
  geo TEXT,
  device_id TEXT,
  ts TIMESTAMPTZ,
  features VECTOR(256),
  risk_score FLOAT,
  decision TEXT CHECK (decision IN ('approve','review','deny'))
);

-- ç”¨æˆ·ç”»åƒ
CREATE TABLE user_profile (
  user_id BIGINT PRIMARY KEY,
  stat_json JSONB,
  embedding VECTOR(256),
  last_update TIMESTAMPTZ
);

-- è§„åˆ™ä¸å‘½ä¸­æ—¥å¿—
CREATE TABLE rule_hit (
  hit_id BIGSERIAL PRIMARY KEY,
  tx_id BIGINT,
  rule_id TEXT,
  weight FLOAT,
  ts TIMESTAMPTZ
);
```

## 7. ğŸ¤– æ ¸å¿ƒç®—æ³•

### 7.1. å®æ—¶å‘é‡è¿‘é‚»+è§„åˆ™èåˆ

```sql
-- è¿‘é‚»ç›¸ä¼¼åº¦
PREPARE q_knn(VECTOR(256), INT) AS
SELECT user_id, 1 - (embedding <=> $1) AS sim
FROM user_profile
ORDER BY embedding <=> $1
LIMIT $2;
```

```rust
pub struct RiskScorer {
    w_rule: f32,
    w_knn: f32,
    w_ai: f32,
}
impl RiskScorer {
    pub fn score(&self, rule_score: f32, knn_score: f32, ai_score: f32) -> f32 {
        (self.w_rule * rule_score) + (self.w_knn * knn_score) + (self.w_ai * ai_score)
    }
}
```

### 7.2. åæ´—é’±å›¾æŒ–æ˜ï¼ˆGolangï¼‰

```go
// ç®€åŒ–çš„äº¤æ˜“å…³ç³»å›¾é«˜é£é™©å›¢ä¼™æ£€æµ‹
func HighRiskCommunities(g Graph) []Community {
  comms := Louvain(g) // ç¤¾å›¢åˆ’åˆ†
  var risky []Community
  for _, c := range comms {
    if c.EdgeDensity() > 0.8 && c.AvgTicket() < 50 && c.CrossBorderRatio() > 0.3 {
      risky = append(risky, c)
    }
  }
  return risky
}
```

## 8. ğŸ› ï¸ å·¥ç¨‹å®è·µ

- æµå¼é£æ§ï¼š`benchmarks/bench_stream.py` å‚æ•°åŒ–çª—å£æŸ¥è¯¢ï¼Œç›‘æ§P95ä¸ä¸¢å¤±ç‡ã€‚
- AIåŸç”Ÿæ¨ç†ï¼š`ai_inference('fraud_cls', json_build_object('tx', to_jsonb(t)))` å†…è”è¯„åˆ†ã€‚
- å›é€€æ¼”ç»ƒï¼šå‚è€ƒ `rollback_ai_vector.sh`ï¼Œå¿«é€Ÿåˆ‡æ¢åˆ°è§„åˆ™+ç»“æ„åŒ–æ£€ç´¢ã€‚

## 9. âš–ï¸ åˆè§„ä¸å®‰å…¨

- åˆè§„ï¼šKYC/AMLã€GDPRï¼Œæ•°æ®æœ€å°åŒ–ä¸å¯è¿½æº¯ã€‚
- å®‰å…¨ï¼šHSM/å¯†é’¥è½®æ¢ã€åŒæ´»å®¹ç¾ã€é›¶ä¿¡ä»»è®¿é—®ã€‚

## 10. ğŸ”— äº¤å‰å¼•ç”¨

- [1.1.145 PostgreSQL 2025ç‰¹æ€§-è½åœ°æŒ‡å—ä¸å®æ“](../../1-æ•°æ®åº“ç³»ç»Ÿ/1.1-PostgreSQL/1.1.145-PostgreSQL-2025ç‰¹æ€§-è½åœ°æŒ‡å—ä¸å®æ“.md)
- [1.1.146 PostgreSQL 2025 å®éªŒä¸åŸºå‡†](../../1-æ•°æ®åº“ç³»ç»Ÿ/1.1-PostgreSQL/1.1.146-PostgreSQL-2025-å®éªŒä¸åŸºå‡†.md)
- [3.1.23 æ·±åº¦å­¦ä¹ æ¶æ„è®¾è®¡](../../3-æ•°æ®æ¨¡å‹ä¸ç®—æ³•/3.1-æ•°æ®ç§‘å­¦åŸºç¡€ç†è®º/3.1.23-æ·±åº¦å­¦ä¹ æ¶æ„è®¾è®¡.md)

## 11. ç”Ÿäº§çº§SLOä¸å‘Šè­¦é˜ˆå€¼ï¼ˆæ¨¡æ¿ï¼‰

- ç”¨æˆ·ä½“éªŒï¼šP95 å»¶è¿Ÿ â‰¤ 300msï¼›é”™è¯¯ç‡ â‰¤ 0.3%
- é£æ§å¼•æ“ï¼šè§„åˆ™è¯„ä¼°å»¶è¿Ÿ P99 â‰¤ 150msï¼›ç‰¹å¾åŠ è½½è¶…æ—¶ç‡ â‰¤ 0.1%
- æ•°æ®é“¾è·¯ï¼šç‰¹å¾åŒæ­¥è½å â‰¤ 2minï¼ˆ5min è¿ç»­è§¦å‘å‘Šè­¦ï¼‰
- å¯ç”¨æ€§ï¼šæœˆåº¦å¯ç”¨æ€§ â‰¥ 99.95%

å‘Šè­¦å»ºè®®ï¼š

- warningï¼šP95 > 300ms æŒç»­ 5 åˆ†é’Ÿï¼›é”™è¯¯ç‡ > 0.5%
- criticalï¼šP99 > 800ms æŒç»­ 3 åˆ†é’Ÿï¼›é”™è¯¯ç‡ > 2%

## 12. å›é€€é¢„æ¡ˆï¼ˆGo/No-Goï¼‰

- No-Go æ¡ä»¶ï¼š
  - å…³é”®æ¥å£ 5xx > 2%ï¼›æ ¸å¿ƒäº¤æ˜“é“¾è·¯ P99 > 1sï¼›é£æ§è§„åˆ™å‘½ä¸­å¼‚å¸¸> 5%
- å›é€€æ­¥éª¤ï¼š
      - 1) ç«‹å³å†»ç»“å½“å‰æµé‡å¼€å…³ï¼ˆç°åº¦/é‡‘ä¸é›€æƒé‡ä¸‹è°ƒè‡³ 0ï¼‰
      - 2) å›æ»šç‰ˆæœ¬ï¼š`kubectl rollout undo deployment/fintech-api -n prod`
      - 3) æ¸…ç†ç¼“å­˜ä¸çƒ­èº«ï¼šé‡å»ºçƒ­ç‚¹ç‰¹å¾ç¼“å­˜ï¼Œæ‰§è¡Œå¥åº·æ£€æŸ¥
      - 4) éªŒè¯ï¼šäº¤æ˜“è‡ªæ£€è„šæœ¬é€šè¿‡ï¼ˆæˆåŠŸç‡â‰¥99.9%ï¼Œå»¶è¿ŸP95â‰¤300msï¼‰
- é€šè®¯ä¸è®°å½•ï¼šåœ¨å€¼ç­ç¾¤åŒæ­¥äº‹æ•…ç­‰çº§ã€æ ¹å› ä¸æ¢å¤æ—¶é—´ï¼›JIRA/Issue ç™»è®°å›æº¯
