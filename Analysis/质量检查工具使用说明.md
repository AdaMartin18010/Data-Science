# 质量检查工具使用说明

## 1. 工具概述

质量检查工具是一个自动化工具，用于检查知识库文档的质量，包括文档结构、内容质量、格式规范性等方面。

### 1.1 主要功能

- **文档结构检查**：检查标题层次、目录完整性
- **内容质量检查**：检查数学公式、代码示例
- **格式规范性检查**：检查格式统一性、命名规范
- **链接有效性检查**：检查内部和外部链接
- **交叉引用检查**：检查交叉引用系统的完整性

### 1.2 检查维度

| 检查维度 | 评分权重 | 检查内容 |
|----------|----------|----------|
| 标题层次 | 20% | 标题层次合理性、标题长度 |
| 代码质量 | 25% | 语法正确性、注释完整性、代码长度 |
| 数学公式 | 20% | LaTeX语法、公式编号 |
| 链接有效性 | 20% | 内部链接、外部链接格式 |
| 格式规范 | 15% | 行长度、空行使用、格式统一性 |

## 2. 安装与配置

### 2.1 环境要求

```bash
# Python 3.7+
python --version

# 安装依赖
pip install markdown
```

### 2.2 工具位置

工具位于：`Analysis/quality_checker.py`

## 3. 使用方法

### 3.1 基本用法

```bash
# 检查单个文件
python quality_checker.py check document.md

# 检查整个目录
python quality_checker.py check-dir ./Analysis/

# 生成HTML报告
python quality_checker.py report ./Analysis/ --format html

# 生成JSON报告
python quality_checker.py report ./Analysis/ --format json
```

### 3.2 命令行参数

```bash
python quality_checker.py [path] [options]

参数:
  path                  要检查的文件或目录路径

选项:
  --format {html,json}  输出格式 (默认: html)
  --output PATH         输出文件路径
  -h, --help           显示帮助信息
```

### 3.3 使用示例

#### 3.3.1 检查单个文档

```bash
# 检查PostgreSQL形式模型文档
python quality_checker.py Analysis/1-数据库系统/1.1-PostgreSQL/1.1.1-形式模型.md

# 输出HTML报告
python quality_checker.py Analysis/1-数据库系统/1.1-PostgreSQL/1.1.1-形式模型.md --format html --output report.html
```

#### 3.3.2 检查整个模块

```bash
# 检查数据库系统模块
python quality_checker.py Analysis/1-数据库系统/ --format html --output database_quality_report.html

# 检查形式科学理论模块
python quality_checker.py Analysis/2-形式科学理论/ --format json --output formal_theory_quality_report.json
```

#### 3.3.3 检查整个知识库

```bash
# 检查整个Analysis目录
python quality_checker.py Analysis/ --format html --output full_quality_report.html
```

## 4. 输出格式

### 4.1 HTML报告

HTML报告包含以下内容：

1. **总体评分**：所有文档的平均质量评分
2. **评分表格**：每个文档的详细评分
3. **问题详情**：具体的问题描述和建议

示例输出：

```html
<!DOCTYPE html>
<html>
<head>
    <title>知识库质量检查报告</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .issue { color: red; }
        .warning { color: orange; }
        .info { color: blue; }
        .success { color: green; }
        .score { font-weight: bold; }
    </style>
</head>
<body>
    <h1>知识库质量检查报告</h1>
    <div class="summary">
        <h2>总体评分: <span class="score">8.9/10</span></h2>
        <p>检查时间: 2024-12-19 15:30:45</p>
        <p>检查文件数: 25</p>
    </div>
    <div class="details">
        <!-- 详细内容 -->
    </div>
</body>
</html>
```

### 4.2 JSON报告

JSON报告包含结构化的数据：

```json
{
  "timestamp": "2024-12-19T15:30:45.123456",
  "summary": {
    "total_files": 25,
    "average_score": 8.9,
    "total_issues": 15
  },
  "details": [
    {
      "file_path": "Analysis/1-数据库系统/1.1-PostgreSQL/1.1.1-形式模型.md",
      "scores": {
        "overall": 9.2,
        "title_hierarchy": 9.5,
        "code_quality": 8.8,
        "math_formulas": 9.0,
        "links": 9.0,
        "format": 9.1
      },
      "issues": [
        {
          "type": "title_hierarchy",
          "description": "标题层次跳跃",
          "severity": "warning",
          "suggestion": "建议保持标题层次连续"
        }
      ]
    }
  ]
}
```

## 5. 问题类型与严重程度

### 5.1 问题类型

| 问题类型 | 描述 | 检查内容 |
|----------|------|----------|
| title_hierarchy | 标题层次问题 | 标题层次跳跃、标题过长 |
| code_quality | 代码质量问题 | 语法错误、注释缺失、代码过长 |
| math_formulas | 数学公式问题 | LaTeX语法错误、公式编号问题 |
| links | 链接问题 | 内部链接无效、外部链接格式错误 |
| format | 格式问题 | 行过长、空行使用不当 |

### 5.2 严重程度

| 严重程度 | 颜色 | 描述 | 扣分 |
|----------|------|------|------|
| error | 红色 | 严重问题，需要立即修复 | 2-3分 |
| warning | 橙色 | 警告问题，建议修复 | 1-2分 |
| info | 蓝色 | 信息提示，可选修复 | 0.5-1分 |

## 6. 评分标准

### 6.1 标题层次评分

- **满分10分**
- 缺少标题：-3分
- 标题层次跳跃：-1分/次
- 标题过长：-0.5分/次

### 6.2 代码质量评分

- **满分10分**
- 语法错误：-2分/次
- 代码过长：-1分/次
- 缺少注释：-0.5分/次

### 6.3 数学公式评分

- **满分10分**
- LaTeX语法错误：-1分/次
- 公式编号问题：-0.5分/次

### 6.4 链接有效性评分

- **满分10分**
- 内部链接无效：-1分/次
- 外部链接格式错误：-0.5分/次

### 6.5 格式规范性评分

- **满分10分**
- 行过长：-0.2分/行
- 空行使用过多：-1分

## 7. 最佳实践

### 7.1 文档结构最佳实践

1. **标题层次**：保持标题层次连续，避免跳跃
2. **标题长度**：控制在100字符以内
3. **目录结构**：确保所有标题都在目录中

### 7.2 代码示例最佳实践

1. **语法正确**：确保代码语法正确
2. **注释完整**：为代码添加适当的注释
3. **长度控制**：避免过长的代码块
4. **格式统一**：保持代码格式统一

### 7.3 数学公式最佳实践

1. **LaTeX语法**：使用正确的LaTeX语法
2. **公式编号**：保持公式编号连续
3. **符号定义**：清晰定义数学符号

### 7.4 链接管理最佳实践

1. **内部链接**：确保内部链接有效
2. **外部链接**：使用正确的URL格式
3. **链接描述**：提供清晰的链接描述

## 8. 持续改进

### 8.1 定期检查

建议定期运行质量检查：

```bash
# 每周检查
python quality_checker.py Analysis/ --format html --output weekly_report.html

# 每月全面检查
python quality_checker.py Analysis/ --format json --output monthly_report.json
```

### 8.2 问题跟踪

1. **记录问题**：记录发现的质量问题
2. **优先级排序**：按严重程度排序问题
3. **制定计划**：制定修复计划
4. **跟踪进度**：跟踪修复进度

### 8.3 质量提升

1. **培训团队**：培训团队成员使用工具
2. **建立标准**：建立质量标准和规范
3. **自动化集成**：将工具集成到CI/CD流程
4. **持续优化**：根据反馈持续优化工具

## 9. 故障排除

### 9.1 常见问题

#### 9.1.1 文件编码问题

```bash
# 如果遇到编码问题，确保文件使用UTF-8编码
file -i document.md
```

#### 9.1.2 依赖问题

```bash
# 安装缺失的依赖
pip install markdown

# 检查Python版本
python --version
```

#### 9.1.3 权限问题

```bash
# 确保有读取文件的权限
chmod +r document.md
```

### 9.2 调试模式

```bash
# 添加调试信息
python -v quality_checker.py document.md
```

## 10. 扩展功能

### 10.1 自定义检查规则

可以通过修改代码添加自定义检查规则：

```python
def custom_check(self, content: str) -> Tuple[float, List[QualityIssue]]:
    """自定义检查规则"""
    issues = []
    score = 10.0
    
    # 添加自定义检查逻辑
    # ...
    
    return score, issues
```

### 10.2 集成到CI/CD

可以将工具集成到CI/CD流程中：

```yaml
# GitHub Actions示例
- name: Quality Check
  run: |
    python quality_checker.py Analysis/ --format json --output quality_report.json
    
- name: Check Quality Score
  run: |
    python -c "
    import json
    with open('quality_report.json') as f:
        data = json.load(f)
    if data['summary']['average_score'] < 8.0:
        exit(1)
    "
```

---

*本工具将帮助确保知识库内容的高质量和一致性，为持续改进提供数据支持。*
