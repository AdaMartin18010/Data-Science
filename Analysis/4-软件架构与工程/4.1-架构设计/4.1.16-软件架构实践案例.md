# 4.1.16 è½¯ä»¶æ¶æ„å®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [4.1.16 è½¯ä»¶æ¶æ„å®è·µæ¡ˆä¾‹](#4116-è½¯ä»¶æ¶æ„å®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [2. å¾®æœåŠ¡æ¶æ„å®è·µæ¡ˆä¾‹](#2-å¾®æœåŠ¡æ¶æ„å®è·µæ¡ˆä¾‹)
    - [2.1. ç”µå•†å¾®æœåŠ¡æ¶æ„è®¾è®¡](#21-ç”µå•†å¾®æœåŠ¡æ¶æ„è®¾è®¡)
  - [3. æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡](#3-æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡)
  - [4. äº‘åŸç”Ÿæ¶æ„å®è·µæ¡ˆä¾‹](#4-äº‘åŸç”Ÿæ¶æ„å®è·µæ¡ˆä¾‹)
    - [4.1. å®¹å™¨åŒ–åº”ç”¨éƒ¨ç½²](#41-å®¹å™¨åŒ–åº”ç”¨éƒ¨ç½²)
  - [5. æœåŠ¡ç½‘æ ¼å®ç°](#5-æœåŠ¡ç½‘æ ¼å®ç°)
  - [6. DevOpså®è·µæ¡ˆä¾‹](#6-devopså®è·µæ¡ˆä¾‹)
    - [6.1. æŒç»­é›†æˆæµæ°´çº¿](#61-æŒç»­é›†æˆæµæ°´çº¿)
  - [7. æ€»ç»“](#7-æ€»ç»“)

---


## 1. æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›è½¯ä»¶æ¶æ„åœ¨å®é™…é¡¹ç›®ä¸­çš„å…·ä½“åº”ç”¨æ¡ˆä¾‹ï¼Œæ¶µç›–å¾®æœåŠ¡æ¶æ„ã€äº‘åŸç”Ÿæ¶æ„ã€DevOpså®è·µç­‰å„ä¸ªæ–¹é¢çš„å®é™…åº”ç”¨ã€‚

## 2. å¾®æœåŠ¡æ¶æ„å®è·µæ¡ˆä¾‹

### 2.1. ç”µå•†å¾®æœåŠ¡æ¶æ„è®¾è®¡

```python
# ç”¨æˆ·æœåŠ¡
class UserService:
    def __init__(self):
        self.users = {}

    def create_user(self, user_data):
        """åˆ›å»ºç”¨æˆ·"""
        user_id = str(uuid.uuid4())
        user = {
            'id': user_id,
            'username': user_data['username'],
            'email': user_data['email'],
            'created_at': datetime.now()
        }
        self.users[user_id] = user
        return user

    def get_user(self, user_id):
        """è·å–ç”¨æˆ·ä¿¡æ¯"""
        return self.users.get(user_id)

    def update_user(self, user_id, user_data):
        """æ›´æ–°ç”¨æˆ·ä¿¡æ¯"""
        if user_id in self.users:
            self.users[user_id].update(user_data)
            return self.users[user_id]
        return None

# è®¢å•æœåŠ¡
class OrderService:
    def __init__(self):
        self.orders = {}

    def create_order(self, order_data):
        """åˆ›å»ºè®¢å•"""
        order_id = str(uuid.uuid4())
        order = {
            'id': order_id,
            'user_id': order_data['user_id'],
            'items': order_data['items'],
            'total_amount': order_data['total_amount'],
            'status': 'pending',
            'created_at': datetime.now()
        }
        self.orders[order_id] = order
        return order

    def get_order(self, order_id):
        """è·å–è®¢å•ä¿¡æ¯"""
        return self.orders.get(order_id)

    def update_order_status(self, order_id, status):
        """æ›´æ–°è®¢å•çŠ¶æ€"""
        if order_id in self.orders:
            self.orders[order_id]['status'] = status
            return self.orders[order_id]
        return None

# å•†å“æœåŠ¡
class ProductService:
    def __init__(self):
        self.products = {}

    def create_product(self, product_data):
        """åˆ›å»ºå•†å“"""
        product_id = str(uuid.uuid4())
        product = {
            'id': product_id,
            'name': product_data['name'],
            'price': product_data['price'],
            'description': product_data['description'],
            'stock': product_data['stock']
        }
        self.products[product_id] = product
        return product

    def get_product(self, product_id):
        """è·å–å•†å“ä¿¡æ¯"""
        return self.products.get(product_id)

    def update_stock(self, product_id, quantity):
        """æ›´æ–°åº“å­˜"""
        if product_id in self.products:
            self.products[product_id]['stock'] -= quantity
            return self.products[product_id]
        return None

# APIç½‘å…³
class APIGateway:
    def __init__(self):
        self.user_service = UserService()
        self.order_service = OrderService()
        self.product_service = ProductService()

    def handle_request(self, method, path, data=None):
        """å¤„ç†APIè¯·æ±‚"""
        if method == 'POST' and path == '/users':
            return self.user_service.create_user(data)
        elif method == 'GET' and path.startswith('/users/'):
            user_id = path.split('/')[-1]
            return self.user_service.get_user(user_id)
        elif method == 'POST' and path == '/orders':
            return self.order_service.create_order(data)
        elif method == 'GET' and path.startswith('/orders/'):
            order_id = path.split('/')[-1]
            return self.order_service.get_order(order_id)
        elif method == 'POST' and path == '/products':
            return self.product_service.create_product(data)
        elif method == 'GET' and path.startswith('/products/'):
            product_id = path.split('/')[-1]
            return self.product_service.get_product(product_id)
        else:
            return {'error': 'Not found'}, 404

# ä½¿ç”¨ç¤ºä¾‹
def microservice_example():
    """å¾®æœåŠ¡æ¶æ„ç¤ºä¾‹"""
# åˆ›å»ºAPIç½‘å…³
    gateway = APIGateway()

# åˆ›å»ºç”¨æˆ·
    user_data = {
        'username': 'john_doe',
        'email': 'john@example.com'
    }
    user = gateway.handle_request('POST', '/users', user_data)
    print(f"åˆ›å»ºç”¨æˆ·: {user}")

# åˆ›å»ºå•†å“
    product_data = {
        'name': 'iPhone 15',
        'price': 999.99,
        'description': 'æœ€æ–°æ¬¾iPhone',
        'stock': 100
    }
    product = gateway.handle_request('POST', '/products', product_data)
    print(f"åˆ›å»ºå•†å“: {product}")

# åˆ›å»ºè®¢å•
    order_data = {
        'user_id': user['id'],
        'items': [{'product_id': product['id'], 'quantity': 1}],
        'total_amount': 999.99
    }
    order = gateway.handle_request('POST', '/orders', order_data)
    print(f"åˆ›å»ºè®¢å•: {order}")

    return gateway, user, product, order
```

## 3. æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡

```python
import random
import time
from threading import Thread

class ServiceRegistry:
    def __init__(self):
        self.services = {}

    def register_service(self, service_name, service_instance):
        """æ³¨å†ŒæœåŠ¡"""
        if service_name not in self.services:
            self.services[service_name] = []
        self.services[service_name].append(service_instance)

    def get_service_instances(self, service_name):
        """è·å–æœåŠ¡å®ä¾‹"""
        return self.services.get(service_name, [])

    def deregister_service(self, service_name, service_instance):
        """æ³¨é”€æœåŠ¡"""
        if service_name in self.services:
            self.services[service_name].remove(service_instance)

class LoadBalancer:
    def __init__(self, registry):
        self.registry = registry

    def round_robin(self, service_name):
        """è½®è¯¢è´Ÿè½½å‡è¡¡"""
        instances = self.registry.get_service_instances(service_name)
        if not instances:
            return None

# ç®€å•çš„è½®è¯¢å®ç°
        current_index = getattr(self, f'{service_name}_index', 0)
        instance = instances[current_index % len(instances)]
        setattr(self, f'{service_name}_index', current_index + 1)
        return instance

    def random_selection(self, service_name):
        """éšæœºé€‰æ‹©è´Ÿè½½å‡è¡¡"""
        instances = self.registry.get_service_instances(service_name)
        if not instances:
            return None
        return random.choice(instances)

    def least_connections(self, service_name):
        """æœ€å°‘è¿æ¥è´Ÿè½½å‡è¡¡"""
        instances = self.registry.get_service_instances(service_name)
        if not instances:
            return None

# é€‰æ‹©è¿æ¥æ•°æœ€å°‘çš„å®ä¾‹
        return min(instances, key=lambda x: x.get_connection_count())

class ServiceInstance:
    def __init__(self, service_name, host, port):
        self.service_name = service_name
        self.host = host
        self.port = port
        self.connection_count = 0
        self.health_status = 'healthy'

    def get_connection_count(self):
        return self.connection_count

    def increment_connections(self):
        self.connection_count += 1

    def decrement_connections(self):
        self.connection_count = max(0, self.connection_count - 1)

    def health_check(self):
        """å¥åº·æ£€æŸ¥"""
# æ¨¡æ‹Ÿå¥åº·æ£€æŸ¥
        if random.random() < 0.95:  # 95%çš„å¥åº·ç‡
            self.health_status = 'healthy'
        else:
            self.health_status = 'unhealthy'
        return self.health_status

# ä½¿ç”¨ç¤ºä¾‹
def service_discovery_example():
    """æœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡ç¤ºä¾‹"""
# åˆ›å»ºæœåŠ¡æ³¨å†Œä¸­å¿ƒ
    registry = ServiceRegistry()

# åˆ›å»ºæœåŠ¡å®ä¾‹
    user_service_1 = ServiceInstance('user-service', '192.168.1.10', 8080)
    user_service_2 = ServiceInstance('user-service', '192.168.1.11', 8080)
    user_service_3 = ServiceInstance('user-service', '192.168.1.12', 8080)

# æ³¨å†ŒæœåŠ¡
    registry.register_service('user-service', user_service_1)
    registry.register_service('user-service', user_service_2)
    registry.register_service('user-service', user_service_3)

# åˆ›å»ºè´Ÿè½½å‡è¡¡å™¨
    load_balancer = LoadBalancer(registry)

# æµ‹è¯•è´Ÿè½½å‡è¡¡
    print("è½®è¯¢è´Ÿè½½å‡è¡¡:")
    for i in range(5):
        instance = load_balancer.round_robin('user-service')
        print(f"è¯·æ±‚ {i+1}: {instance.host}")

    print("\néšæœºè´Ÿè½½å‡è¡¡:")
    for i in range(5):
        instance = load_balancer.random_selection('user-service')
        print(f"è¯·æ±‚ {i+1}: {instance.host}")

    return registry, load_balancer
```

## 4. äº‘åŸç”Ÿæ¶æ„å®è·µæ¡ˆä¾‹

### 4.1. å®¹å™¨åŒ–åº”ç”¨éƒ¨ç½²

```python
import docker
import yaml
import json

class ContainerOrchestrator:
    def __init__(self):
        self.client = docker.from_env()
        self.containers = {}

    def create_container(self, image_name, container_name, ports=None, environment=None):
        """åˆ›å»ºå®¹å™¨"""
        try:
            container = self.client.containers.run(
                image=image_name,
                name=container_name,
                ports=ports or {},
                environment=environment or {},
                detach=True
            )
            self.containers[container_name] = container
            return container
        except Exception as e:
            print(f"åˆ›å»ºå®¹å™¨å¤±è´¥: {e}")
            return None

    def start_container(self, container_name):
        """å¯åŠ¨å®¹å™¨"""
        if container_name in self.containers:
            container = self.containers[container_name]
            container.start()
            return True
        return False

    def stop_container(self, container_name):
        """åœæ­¢å®¹å™¨"""
        if container_name in self.containers:
            container = self.containers[container_name]
            container.stop()
            return True
        return False

    def get_container_status(self, container_name):
        """è·å–å®¹å™¨çŠ¶æ€"""
        if container_name in self.containers:
            container = self.containers[container_name]
            return container.status
        return None

    def get_container_logs(self, container_name):
        """è·å–å®¹å™¨æ—¥å¿—"""
        if container_name in self.containers:
            container = self.containers[container_name]
            return container.logs().decode('utf-8')
        return None

class KubernetesDeployment:
    def __init__(self):
        self.deployments = {}

    def create_deployment_yaml(self, name, image, replicas=3, ports=None):
        """åˆ›å»ºKuberneteséƒ¨ç½²YAML"""
        deployment = {
            'apiVersion': 'apps/v1',
            'kind': 'Deployment',
            'metadata': {
                'name': name
            },
            'spec': {
                'replicas': replicas,
                'selector': {
                    'matchLabels': {
                        'app': name
                    }
                },
                'template': {
                    'metadata': {
                        'labels': {
                            'app': name
                        }
                    },
                    'spec': {
                        'containers': [{
                            'name': name,
                            'image': image,
                            'ports': ports or []
                        }]
                    }
                }
            }
        }

        self.deployments[name] = deployment
        return deployment

    def create_service_yaml(self, name, selector, ports):
        """åˆ›å»ºKubernetesæœåŠ¡YAML"""
        service = {
            'apiVersion': 'v1',
            'kind': 'Service',
            'metadata': {
                'name': name
            },
            'spec': {
                'selector': selector,
                'ports': ports,
                'type': 'ClusterIP'
            }
        }
        return service

    def save_yaml(self, deployment, filename):
        """ä¿å­˜YAMLæ–‡ä»¶"""
        with open(filename, 'w') as f:
            yaml.dump(deployment, f, default_flow_style=False)

# ä½¿ç”¨ç¤ºä¾‹
def cloud_native_example():
    """äº‘åŸç”Ÿæ¶æ„ç¤ºä¾‹"""
# å®¹å™¨ç¼–æ’
    orchestrator = ContainerOrchestrator()

# åˆ›å»ºç”¨æˆ·æœåŠ¡å®¹å™¨
    user_container = orchestrator.create_container(
        image_name='user-service:latest',
        container_name='user-service-1',
        ports={'8080/tcp': 8080},
        environment={'DB_HOST': 'postgres', 'DB_PORT': '5432'}
    )

    if user_container:
        print(f"ç”¨æˆ·æœåŠ¡å®¹å™¨å·²åˆ›å»º: {user_container.id}")
        orchestrator.start_container('user-service-1')
        print(f"å®¹å™¨çŠ¶æ€: {orchestrator.get_container_status('user-service-1')}")

# Kuberneteséƒ¨ç½²
    k8s = KubernetesDeployment()

# åˆ›å»ºç”¨æˆ·æœåŠ¡éƒ¨ç½²
    user_deployment = k8s.create_deployment_yaml(
        name='user-service',
        image='user-service:latest',
        replicas=3,
        ports=[{'containerPort': 8080}]
    )

# åˆ›å»ºç”¨æˆ·æœåŠ¡
    user_service = k8s.create_service_yaml(
        name='user-service',
        selector={'app': 'user-service'},
        ports=[{'port': 80, 'targetPort': 8080}]
    )

# ä¿å­˜YAMLæ–‡ä»¶
    k8s.save_yaml(user_deployment, 'user-service-deployment.yaml')

    print("Kuberneteséƒ¨ç½²æ–‡ä»¶å·²åˆ›å»º")

    return orchestrator, k8s
```

## 5. æœåŠ¡ç½‘æ ¼å®ç°

```python
import time
import random
from collections import defaultdict

class ServiceMesh:
    def __init__(self):
        self.services = {}
        self.routes = {}
        self.policies = {}
        self.metrics = defaultdict(list)

    def register_service(self, service_name, service_instance):
        """æ³¨å†ŒæœåŠ¡åˆ°ç½‘æ ¼"""
        if service_name not in self.services:
            self.services[service_name] = []
        self.services[service_name].append(service_instance)

    def add_route(self, source_service, target_service, route_config):
        """æ·»åŠ è·¯ç”±è§„åˆ™"""
        route_key = f"{source_service}->{target_service}"
        self.routes[route_key] = route_config

    def add_policy(self, service_name, policy_type, policy_config):
        """æ·»åŠ ç­–ç•¥"""
        if service_name not in self.policies:
            self.policies[service_name] = {}
        self.policies[service_name][policy_type] = policy_config

    def route_request(self, source_service, target_service, request_data):
        """è·¯ç”±è¯·æ±‚"""
        route_key = f"{source_service}->{target_service}"

# åº”ç”¨è·¯ç”±ç­–ç•¥
        if route_key in self.routes:
            route_config = self.routes[route_key]

# è´Ÿè½½å‡è¡¡
            if route_config.get('load_balancer') == 'round_robin':
                target_instances = self.services.get(target_service, [])
                if target_instances:
                    instance = target_instances[len(self.metrics[route_key]) % len(target_instances)]
                else:
                    return {'error': 'No available instances'}
            else:
# é»˜è®¤éšæœºé€‰æ‹©
                target_instances = self.services.get(target_service, [])
                if target_instances:
                    instance = random.choice(target_instances)
                else:
                    return {'error': 'No available instances'}
        else:
            return {'error': 'Route not found'}

# åº”ç”¨ç­–ç•¥
        if target_service in self.policies:
            policies = self.policies[target_service]

# é‡è¯•ç­–ç•¥
            if 'retry' in policies:
                retry_config = policies['retry']
                max_retries = retry_config.get('max_retries', 3)

                for attempt in range(max_retries):
                    try:
                        result = self.execute_request(instance, request_data)
                        self.record_metrics(route_key, 'success', time.time())
                        return result
                    except Exception as e:
                        if attempt == max_retries - 1:
                            self.record_metrics(route_key, 'error', time.time())
                            raise e
                        time.sleep(retry_config.get('delay', 1))

# ç†”æ–­å™¨ç­–ç•¥
            if 'circuit_breaker' in policies:
                circuit_config = policies['circuit_breaker']
                error_threshold = circuit_config.get('error_threshold', 0.5)

                recent_metrics = self.metrics[route_key][-10:]  # æœ€è¿‘10æ¬¡è¯·æ±‚
                if recent_metrics:
                    error_rate = sum(1 for m in recent_metrics if m['status'] == 'error') / len(recent_metrics)
                    if error_rate > error_threshold:
                        return {'error': 'Circuit breaker open'}

# æ‰§è¡Œè¯·æ±‚
        result = self.execute_request(instance, request_data)
        self.record_metrics(route_key, 'success', time.time())
        return result

    def execute_request(self, instance, request_data):
        """æ‰§è¡Œè¯·æ±‚"""
# æ¨¡æ‹Ÿè¯·æ±‚æ‰§è¡Œ
        if random.random() < 0.9:  # 90%æˆåŠŸç‡
            return {'result': 'success', 'instance': instance.id}
        else:
            raise Exception('Request failed')

    def record_metrics(self, route_key, status, timestamp):
        """è®°å½•æŒ‡æ ‡"""
        self.metrics[route_key].append({
            'status': status,
            'timestamp': timestamp
        })

    def get_metrics(self, route_key):
        """è·å–æŒ‡æ ‡"""
        return self.metrics[route_key]

# ä½¿ç”¨ç¤ºä¾‹
def service_mesh_example():
    """æœåŠ¡ç½‘æ ¼ç¤ºä¾‹"""
# åˆ›å»ºæœåŠ¡ç½‘æ ¼
    mesh = ServiceMesh()

# æ³¨å†ŒæœåŠ¡å®ä¾‹
    class ServiceInstance:
        def __init__(self, id):
            self.id = id

    user_service_1 = ServiceInstance('user-service-1')
    user_service_2 = ServiceInstance('user-service-2')
    order_service_1 = ServiceInstance('order-service-1')

    mesh.register_service('user-service', user_service_1)
    mesh.register_service('user-service', user_service_2)
    mesh.register_service('order-service', order_service_1)

# æ·»åŠ è·¯ç”±è§„åˆ™
    mesh.add_route('order-service', 'user-service', {
        'load_balancer': 'round_robin'
    })

# æ·»åŠ ç­–ç•¥
    mesh.add_policy('user-service', 'retry', {
        'max_retries': 3,
        'delay': 1
    })

    mesh.add_policy('user-service', 'circuit_breaker', {
        'error_threshold': 0.5
    })

# æµ‹è¯•è¯·æ±‚è·¯ç”±
    for i in range(5):
        try:
            result = mesh.route_request('order-service', 'user-service', {'user_id': i})
            print(f"è¯·æ±‚ {i+1}: {result}")
        except Exception as e:
            print(f"è¯·æ±‚ {i+1} å¤±è´¥: {e}")

# æŸ¥çœ‹æŒ‡æ ‡
    metrics = mesh.get_metrics('order-service->user-service')
    print(f"è·¯ç”±æŒ‡æ ‡: {metrics}")

    return mesh
```

## 6. DevOpså®è·µæ¡ˆä¾‹

### 6.1. æŒç»­é›†æˆæµæ°´çº¿

```python
import subprocess
import os
import json
import time

class CICDPipeline:
    def __init__(self):
        self.stages = []
        self.results = {}

    def add_stage(self, stage_name, stage_function):
        """æ·»åŠ æµæ°´çº¿é˜¶æ®µ"""
        self.stages.append({
            'name': stage_name,
            'function': stage_function
        })

    def run_pipeline(self):
        """è¿è¡Œæµæ°´çº¿"""
        print("å¼€å§‹è¿è¡ŒCI/CDæµæ°´çº¿...")

        for stage in self.stages:
            stage_name = stage['name']
            stage_function = stage['function']

            print(f"\næ‰§è¡Œé˜¶æ®µ: {stage_name}")
            start_time = time.time()

            try:
                result = stage_function()
                self.results[stage_name] = {
                    'status': 'success',
                    'result': result,
                    'duration': time.time() - start_time
                }
                print(f"âœ“ {stage_name} æˆåŠŸå®Œæˆ")
            except Exception as e:
                self.results[stage_name] = {
                    'status': 'failed',
                    'error': str(e),
                    'duration': time.time() - start_time
                }
                print(f"âœ— {stage_name} å¤±è´¥: {e}")
                break

        self.print_summary()
        return self.results

    def print_summary(self):
        """æ‰“å°æµæ°´çº¿æ‘˜è¦"""
        print("\n" + "="*50)
        print("æµæ°´çº¿æ‰§è¡Œæ‘˜è¦")
        print("="*50)

        for stage_name, result in self.results.items():
            status = "âœ“" if result['status'] == 'success' else "âœ—"
            duration = f"{result['duration']:.2f}s"
            print(f"{status} {stage_name}: {duration}")

            if result['status'] == 'failed':
                print(f"   é”™è¯¯: {result['error']}")

class CodeQualityChecker:
    def __init__(self):
        self.quality_metrics = {}

    def run_linting(self, code_path):
        """è¿è¡Œä»£ç æ£€æŸ¥"""
        print("è¿è¡Œä»£ç æ£€æŸ¥...")

# æ¨¡æ‹Ÿä»£ç æ£€æŸ¥
        issues = []

# æ£€æŸ¥Pythonæ–‡ä»¶
        for root, dirs, files in os.walk(code_path):
            for file in files:
                if file.endswith('.py'):
                    file_path = os.path.join(root, file)

# æ¨¡æ‹Ÿæ£€æŸ¥ç»“æœ
                    if 'TODO' in open(file_path, 'r').read():
                        issues.append(f"{file_path}: å‘ç°TODOæ³¨é‡Š")

        if issues:
            print(f"å‘ç° {len(issues)} ä¸ªé—®é¢˜:")
            for issue in issues:
                print(f"  - {issue}")
            return {'issues': issues, 'count': len(issues)}
        else:
            print("ä»£ç æ£€æŸ¥é€šè¿‡")
            return {'issues': [], 'count': 0}

    def run_tests(self, test_path):
        """è¿è¡Œæµ‹è¯•"""
        print("è¿è¡Œå•å…ƒæµ‹è¯•...")

# æ¨¡æ‹Ÿæµ‹è¯•æ‰§è¡Œ
        test_results = {
            'total': 10,
            'passed': 9,
            'failed': 1,
            'coverage': 85.5
        }

        print(f"æµ‹è¯•ç»“æœ: {test_results['passed']}/{test_results['total']} é€šè¿‡")
        print(f"ä»£ç è¦†ç›–ç‡: {test_results['coverage']}%")

        return test_results

    def run_security_scan(self, code_path):
        """è¿è¡Œå®‰å…¨æ‰«æ"""
        print("è¿è¡Œå®‰å…¨æ‰«æ...")

# æ¨¡æ‹Ÿå®‰å…¨æ‰«æ
        vulnerabilities = []

# æ£€æŸ¥å¸¸è§å®‰å…¨é—®é¢˜
        for root, dirs, files in os.walk(code_path):
            for file in files:
                if file.endswith('.py'):
                    file_path = os.path.join(root, file)
                    content = open(file_path, 'r').read()

                    if 'password' in content and '=' in content:
                        vulnerabilities.append(f"{file_path}: å‘ç°ç¡¬ç¼–ç å¯†ç ")
                    if 'eval(' in content:
                        vulnerabilities.append(f"{file_path}: å‘ç°evalå‡½æ•°ä½¿ç”¨")

        if vulnerabilities:
            print(f"å‘ç° {len(vulnerabilities)} ä¸ªå®‰å…¨æ¼æ´:")
            for vuln in vulnerabilities:
                print(f"  - {vuln}")
            return {'vulnerabilities': vulnerabilities, 'count': len(vulnerabilities)}
        else:
            print("å®‰å…¨æ‰«æé€šè¿‡")
            return {'vulnerabilities': [], 'count': 0}

class DockerBuilder:
    def __init__(self):
        self.images = {}

    def build_image(self, dockerfile_path, image_name, tag='latest'):
        """æ„å»ºDockeré•œåƒ"""
        print(f"æ„å»ºDockeré•œåƒ: {image_name}:{tag}")

# æ¨¡æ‹ŸDockeræ„å»º
        build_result = {
            'image_name': f"{image_name}:{tag}",
            'size': '156MB',
            'layers': 12,
            'status': 'success'
        }

        self.images[build_result['image_name']] = build_result
        print(f"é•œåƒæ„å»ºæˆåŠŸ: {build_result['image_name']}")

        return build_result

    def push_image(self, image_name, registry):
        """æ¨é€é•œåƒåˆ°ä»“åº“"""
        print(f"æ¨é€é•œåƒåˆ°ä»“åº“: {registry}/{image_name}")

# æ¨¡æ‹Ÿæ¨é€
        push_result = {
            'registry': registry,
            'image_name': image_name,
            'status': 'success'
        }

        print(f"é•œåƒæ¨é€æˆåŠŸ: {registry}/{image_name}")
        return push_result

# ä½¿ç”¨ç¤ºä¾‹
def cicd_pipeline_example():
    """CI/CDæµæ°´çº¿ç¤ºä¾‹"""
# åˆ›å»ºæµæ°´çº¿
    pipeline = CICDPipeline()
    quality_checker = CodeQualityChecker()
    docker_builder = DockerBuilder()

# æ·»åŠ æµæ°´çº¿é˜¶æ®µ
    def code_check_stage():
        return quality_checker.run_linting('./src')

    def test_stage():
        return quality_checker.run_tests('./tests')

    def security_stage():
        return quality_checker.run_security_scan('./src')

    def build_stage():
        return docker_builder.build_image('./Dockerfile', 'myapp')

    def deploy_stage():
        print("éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ...")
# æ¨¡æ‹Ÿéƒ¨ç½²
        time.sleep(2)
        return {'status': 'deployed', 'environment': 'production'}

# æ·»åŠ é˜¶æ®µåˆ°æµæ°´çº¿
    pipeline.add_stage('ä»£ç æ£€æŸ¥', code_check_stage)
    pipeline.add_stage('å•å…ƒæµ‹è¯•', test_stage)
    pipeline.add_stage('å®‰å…¨æ‰«æ', security_stage)
    pipeline.add_stage('æ„å»ºé•œåƒ', build_stage)
    pipeline.add_stage('éƒ¨ç½²', deploy_stage)

# è¿è¡Œæµæ°´çº¿
    results = pipeline.run_pipeline()

    return pipeline, results
```

## 7. æ€»ç»“

æœ¬æ–‡æ¡£æä¾›äº†è½¯ä»¶æ¶æ„åœ¨å®é™…é¡¹ç›®ä¸­çš„å…·ä½“åº”ç”¨æ¡ˆä¾‹ï¼ŒåŒ…æ‹¬ï¼š

1. **å¾®æœåŠ¡æ¶æ„å®è·µ**ï¼šç”µå•†å¾®æœåŠ¡æ¶æ„è®¾è®¡å’ŒæœåŠ¡å‘ç°ä¸è´Ÿè½½å‡è¡¡
2. **äº‘åŸç”Ÿæ¶æ„å®è·µ**ï¼šå®¹å™¨åŒ–åº”ç”¨éƒ¨ç½²å’ŒæœåŠ¡ç½‘æ ¼å®ç°
3. **DevOpså®è·µ**ï¼šæŒç»­é›†æˆæµæ°´çº¿

è¿™äº›æ¡ˆä¾‹å±•ç¤ºäº†è½¯ä»¶æ¶æ„åœ¨å„ä¸ªé¢†åŸŸçš„å®é™…åº”ç”¨ï¼Œä¸ºè½¯ä»¶æ¶æ„é¡¹ç›®æä¾›äº†å®ç”¨çš„å‚è€ƒå’ŒæŒ‡å¯¼ã€‚
