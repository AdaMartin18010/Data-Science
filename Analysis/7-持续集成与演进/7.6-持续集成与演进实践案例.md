# 7.6 æŒç»­é›†æˆä¸æ¼”è¿›å®è·µæ¡ˆä¾‹

## ğŸ“‘ ç›®å½•

- [7.6 æŒç»­é›†æˆä¸æ¼”è¿›å®è·µæ¡ˆä¾‹](#76-æŒç»­é›†æˆä¸æ¼”è¿›å®è·µæ¡ˆä¾‹)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [2. CI/CDæµæ°´çº¿å®è·µæ¡ˆä¾‹](#2-cicdæµæ°´çº¿å®è·µæ¡ˆä¾‹)
    - [2.1. å®Œæ•´çš„CI/CDæµæ°´çº¿å®ç°](#21-å®Œæ•´çš„cicdæµæ°´çº¿å®ç°)
  - [3. è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶](#3-è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶)
  - [4. ç›‘æ§ä¸å¯è§‚æµ‹æ€§å®è·µæ¡ˆä¾‹](#4-ç›‘æ§ä¸å¯è§‚æµ‹æ€§å®è·µæ¡ˆä¾‹)
    - [4.1. åº”ç”¨æ€§èƒ½ç›‘æ§](#41-åº”ç”¨æ€§èƒ½ç›‘æ§)
  - [5. æ€»ç»“](#5-æ€»ç»“)

---


## 1. æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›æŒç»­é›†æˆä¸æ¼”è¿›åœ¨å®é™…é¡¹ç›®ä¸­çš„å…·ä½“åº”ç”¨æ¡ˆä¾‹ï¼Œæ¶µç›–CI/CDæµæ°´çº¿ã€è‡ªåŠ¨åŒ–æµ‹è¯•ã€éƒ¨ç½²æµç¨‹ç­‰å„ä¸ªæ–¹é¢çš„å®é™…åº”ç”¨ã€‚

## 2. CI/CDæµæ°´çº¿å®è·µæ¡ˆä¾‹

### 2.1. å®Œæ•´çš„CI/CDæµæ°´çº¿å®ç°

```python
import subprocess
import os
import json
import time
import yaml
from datetime import datetime

class CICDPipeline:
    def __init__(self, project_name):
        self.project_name = project_name
        self.stages = []
        self.results = {}
        self.config = {}

    def load_config(self, config_file):
        """åŠ è½½CI/CDé…ç½®"""
        with open(config_file, 'r') as f:
            self.config = yaml.safe_load(f)

        print(f"åŠ è½½é…ç½®: {config_file}")
        return self.config

    def add_stage(self, stage_name, stage_function, dependencies=None):
        """æ·»åŠ æµæ°´çº¿é˜¶æ®µ"""
        self.stages.append({
            'name': stage_name,
            'function': stage_function,
            'dependencies': dependencies or [],
            'status': 'pending'
        })

    def run_pipeline(self):
        """è¿è¡Œå®Œæ•´æµæ°´çº¿"""
        print(f"å¼€å§‹è¿è¡Œ {self.project_name} CI/CDæµæ°´çº¿...")
        print(f"æ—¶é—´: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}")

        for stage in self.stages:
            stage_name = stage['name']
            stage_function = stage['function']

# æ£€æŸ¥ä¾èµ–
            if not self._check_dependencies(stage):
                print(f"âœ— {stage_name} ä¾èµ–æ£€æŸ¥å¤±è´¥")
                continue

            print(f"\næ‰§è¡Œé˜¶æ®µ: {stage_name}")
            start_time = time.time()

            try:
                result = stage_function()
                self.results[stage_name] = {
                    'status': 'success',
                    'result': result,
                    'duration': time.time() - start_time,
                    'timestamp': datetime.now()
                }
                stage['status'] = 'success'
                print(f"âœ“ {stage_name} æˆåŠŸå®Œæˆ ({self.results[stage_name]['duration']:.2f}s)")
            except Exception as e:
                self.results[stage_name] = {
                    'status': 'failed',
                    'error': str(e),
                    'duration': time.time() - start_time,
                    'timestamp': datetime.now()
                }
                stage['status'] = 'failed'
                print(f"âœ— {stage_name} å¤±è´¥: {e}")

# æ£€æŸ¥æ˜¯å¦åº”è¯¥ç»§ç»­
                if self.config.get('fail_fast', True):
                    break

        self.print_summary()
        return self.results

    def _check_dependencies(self, stage):
        """æ£€æŸ¥é˜¶æ®µä¾èµ–"""
        for dep in stage['dependencies']:
            if dep not in self.results or self.results[dep]['status'] != 'success':
                return False
        return True

    def print_summary(self):
        """æ‰“å°æµæ°´çº¿æ‘˜è¦"""
        print("\n" + "="*60)
        print(f"{self.project_name} CI/CDæµæ°´çº¿æ‰§è¡Œæ‘˜è¦")
        print("="*60)

        total_stages = len(self.stages)
        successful_stages = sum(1 for stage in self.stages if stage['status'] == 'success')
        failed_stages = total_stages - successful_stages

        print(f"æ€»é˜¶æ®µæ•°: {total_stages}")
        print(f"æˆåŠŸ: {successful_stages}")
        print(f"å¤±è´¥: {failed_stages}")
        print(f"æˆåŠŸç‡: {successful_stages/total_stages*100:.1f}%")

        print("\nè¯¦ç»†ç»“æœ:")
        for stage_name, result in self.results.items():
            status = "âœ“" if result['status'] == 'success' else "âœ—"
            duration = f"{result['duration']:.2f}s"
            print(f"{status} {stage_name}: {duration}")

            if result['status'] == 'failed':
                print(f"   é”™è¯¯: {result['error']}")

class CodeQualityChecker:
    def __init__(self):
        self.quality_metrics = {}

    def run_linting(self, code_path):
        """è¿è¡Œä»£ç æ£€æŸ¥"""
        print("è¿è¡Œä»£ç æ£€æŸ¥...")

        issues = []
        total_files = 0

# æ£€æŸ¥Pythonæ–‡ä»¶
        for root, dirs, files in os.walk(code_path):
            for file in files:
                if file.endswith('.py'):
                    total_files += 1
                    file_path = os.path.join(root, file)

# æ¨¡æ‹Ÿæ£€æŸ¥ç»“æœ
                    file_issues = []
                    content = open(file_path, 'r', encoding='utf-8').read()

                    if 'TODO' in content:
                        file_issues.append("å‘ç°TODOæ³¨é‡Š")
                    if len(content.split('\n')) > 100:
                        file_issues.append("æ–‡ä»¶è¿‡é•¿")
                    if 'print(' in content:
                        file_issues.append("å‘ç°printè¯­å¥")

                    if file_issues:
                        issues.append({
                            'file': file_path,
                            'issues': file_issues
                        })

        result = {
            'total_files': total_files,
            'issues': issues,
            'issue_count': len(issues),
            'quality_score': max(0, 100 - len(issues) * 5)
        }

        print(f"æ£€æŸ¥äº† {total_files} ä¸ªæ–‡ä»¶")
        print(f"å‘ç° {len(issues)} ä¸ªé—®é¢˜")
        print(f"è´¨é‡å¾—åˆ†: {result['quality_score']}/100")

        return result

    def run_security_scan(self, code_path):
        """è¿è¡Œå®‰å…¨æ‰«æ"""
        print("è¿è¡Œå®‰å…¨æ‰«æ...")

        vulnerabilities = []

        for root, dirs, files in os.walk(code_path):
            for file in files:
                if file.endswith('.py'):
                    file_path = os.path.join(root, file)
                    content = open(file_path, 'r', encoding='utf-8').read()

# æ£€æŸ¥å¸¸è§å®‰å…¨é—®é¢˜
                    if 'password' in content and '=' in content:
                        vulnerabilities.append({
                            'file': file_path,
                            'type': 'hardcoded_password',
                            'severity': 'high',
                            'description': 'å‘ç°ç¡¬ç¼–ç å¯†ç '
                        })

                    if 'eval(' in content:
                        vulnerabilities.append({
                            'file': file_path,
                            'type': 'eval_usage',
                            'severity': 'medium',
                            'description': 'å‘ç°evalå‡½æ•°ä½¿ç”¨'
                        })

                    if 'subprocess.call(' in content:
                        vulnerabilities.append({
                            'file': file_path,
                            'type': 'subprocess_usage',
                            'severity': 'low',
                            'description': 'å‘ç°subprocessè°ƒç”¨'
                        })

        result = {
            'vulnerabilities': vulnerabilities,
            'total_vulnerabilities': len(vulnerabilities),
            'high_severity': len([v for v in vulnerabilities if v['severity'] == 'high']),
            'medium_severity': len([v for v in vulnerabilities if v['severity'] == 'medium']),
            'low_severity': len([v for v in vulnerabilities if v['severity'] == 'low'])
        }

        print(f"å‘ç° {len(vulnerabilities)} ä¸ªå®‰å…¨æ¼æ´")
        print(f"é«˜å±: {result['high_severity']}, ä¸­å±: {result['medium_severity']}, ä½å±: {result['low_severity']}")

        return result

class TestRunner:
    def __init__(self):
        self.test_results = {}

    def run_unit_tests(self, test_path):
        """è¿è¡Œå•å…ƒæµ‹è¯•"""
        print("è¿è¡Œå•å…ƒæµ‹è¯•...")

# æ¨¡æ‹Ÿæµ‹è¯•æ‰§è¡Œ
        test_results = {
            'total': 25,
            'passed': 23,
            'failed': 2,
            'skipped': 0,
            'coverage': 87.5,
            'duration': 12.5
        }

        print(f"æµ‹è¯•ç»“æœ: {test_results['passed']}/{test_results['total']} é€šè¿‡")
        print(f"ä»£ç è¦†ç›–ç‡: {test_results['coverage']}%")
        print(f"æµ‹è¯•è€—æ—¶: {test_results['duration']}s")

        return test_results

    def run_integration_tests(self, test_path):
        """è¿è¡Œé›†æˆæµ‹è¯•"""
        print("è¿è¡Œé›†æˆæµ‹è¯•...")

# æ¨¡æ‹Ÿé›†æˆæµ‹è¯•
        test_results = {
            'total': 8,
            'passed': 7,
            'failed': 1,
            'skipped': 0,
            'duration': 45.2
        }

        print(f"é›†æˆæµ‹è¯•: {test_results['passed']}/{test_results['total']} é€šè¿‡")
        print(f"æµ‹è¯•è€—æ—¶: {test_results['duration']}s")

        return test_results

class DockerBuilder:
    def __init__(self):
        self.images = {}

    def build_image(self, dockerfile_path, image_name, tag='latest'):
        """æ„å»ºDockeré•œåƒ"""
        print(f"æ„å»ºDockeré•œåƒ: {image_name}:{tag}")

# æ¨¡æ‹ŸDockeræ„å»º
        build_result = {
            'image_name': f"{image_name}:{tag}",
            'size': '156MB',
            'layers': 12,
            'status': 'success',
            'build_time': 45.2
        }

        self.images[build_result['image_name']] = build_result
        print(f"é•œåƒæ„å»ºæˆåŠŸ: {build_result['image_name']}")
        print(f"é•œåƒå¤§å°: {build_result['size']}")
        print(f"æ„å»ºæ—¶é—´: {build_result['build_time']}s")

        return build_result

    def push_image(self, image_name, registry):
        """æ¨é€é•œåƒåˆ°ä»“åº“"""
        print(f"æ¨é€é•œåƒåˆ°ä»“åº“: {registry}/{image_name}")

# æ¨¡æ‹Ÿæ¨é€
        push_result = {
            'registry': registry,
            'image_name': image_name,
            'status': 'success',
            'push_time': 23.1
        }

        print(f"é•œåƒæ¨é€æˆåŠŸ: {registry}/{image_name}")
        print(f"æ¨é€æ—¶é—´: {push_result['push_time']}s")

        return push_result

class DeploymentManager:
    def __init__(self):
        self.deployments = {}

    def deploy_to_staging(self, image_name):
        """éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ"""
        print("éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ...")

# æ¨¡æ‹Ÿéƒ¨ç½²
        deployment_result = {
            'environment': 'staging',
            'image_name': image_name,
            'status': 'success',
            'deployment_time': 15.3,
            'url': 'https://staging.example.com'
        }

        print(f"æµ‹è¯•ç¯å¢ƒéƒ¨ç½²æˆåŠŸ: {deployment_result['url']}")
        print(f"éƒ¨ç½²æ—¶é—´: {deployment_result['deployment_time']}s")

        return deployment_result

    def deploy_to_production(self, image_name):
        """éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ"""
        print("éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ...")

# æ¨¡æ‹Ÿéƒ¨ç½²
        deployment_result = {
            'environment': 'production',
            'image_name': image_name,
            'status': 'success',
            'deployment_time': 28.7,
            'url': 'https://app.example.com'
        }

        print(f"ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æˆåŠŸ: {deployment_result['url']}")
        print(f"éƒ¨ç½²æ—¶é—´: {deployment_result['deployment_time']}s")

        return deployment_result

# ä½¿ç”¨ç¤ºä¾‹
def complete_cicd_pipeline_example():
    """å®Œæ•´CI/CDæµæ°´çº¿ç¤ºä¾‹"""
# åˆ›å»ºæµæ°´çº¿
    pipeline = CICDPipeline("my-web-app")

# åŠ è½½é…ç½®
    config = {
        'project_name': 'my-web-app',
        'fail_fast': True,
        'environments': {
            'staging': 'staging.example.com',
            'production': 'app.example.com'
        }
    }

# åˆ›å»ºå·¥å…·å®ä¾‹
    quality_checker = CodeQualityChecker()
    test_runner = TestRunner()
    docker_builder = DockerBuilder()
    deployment_manager = DeploymentManager()

# å®šä¹‰æµæ°´çº¿é˜¶æ®µ
    def code_check_stage():
        return quality_checker.run_linting('./src')

    def security_scan_stage():
        return quality_checker.run_security_scan('./src')

    def unit_test_stage():
        return test_runner.run_unit_tests('./tests')

    def integration_test_stage():
        return test_runner.run_integration_tests('./tests/integration')

    def build_stage():
        return docker_builder.build_image('./Dockerfile', 'my-web-app')

    def push_stage():
        return docker_builder.push_image('my-web-app:latest', 'registry.example.com')

    def deploy_staging_stage():
        return deployment_manager.deploy_to_staging('my-web-app:latest')

    def deploy_production_stage():
        return deployment_manager.deploy_to_production('my-web-app:latest')

# æ·»åŠ é˜¶æ®µåˆ°æµæ°´çº¿
    pipeline.add_stage('ä»£ç æ£€æŸ¥', code_check_stage)
    pipeline.add_stage('å®‰å…¨æ‰«æ', security_scan_stage)
    pipeline.add_stage('å•å…ƒæµ‹è¯•', unit_test_stage)
    pipeline.add_stage('é›†æˆæµ‹è¯•', integration_test_stage, dependencies=['å•å…ƒæµ‹è¯•'])
    pipeline.add_stage('æ„å»ºé•œåƒ', build_stage, dependencies=['ä»£ç æ£€æŸ¥', 'å®‰å…¨æ‰«æ', 'é›†æˆæµ‹è¯•'])
    pipeline.add_stage('æ¨é€é•œåƒ', push_stage, dependencies=['æ„å»ºé•œåƒ'])
    pipeline.add_stage('éƒ¨ç½²æµ‹è¯•ç¯å¢ƒ', deploy_staging_stage, dependencies=['æ¨é€é•œåƒ'])
    pipeline.add_stage('éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒ', deploy_production_stage, dependencies=['éƒ¨ç½²æµ‹è¯•ç¯å¢ƒ'])

# è¿è¡Œæµæ°´çº¿
    results = pipeline.run_pipeline()

    return pipeline, results
```

## 3. è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶

```python
import unittest
import time
import requests
import json
from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.ui import WebDriverWait
from selenium.webdriver.support import expected_conditions as EC

class AutomatedTestFramework:
    def __init__(self):
        self.test_results = []
        self.driver = None

    def setup_webdriver(self):
        """è®¾ç½®WebDriver"""
        options = webdriver.ChromeOptions()
        options.add_argument('--headless')  # æ— å¤´æ¨¡å¼
        options.add_argument('--no-sandbox')
        options.add_argument('--disable-dev-shm-usage')

        self.driver = webdriver.Chrome(options=options)
        return self.driver

    def teardown_webdriver(self):
        """æ¸…ç†WebDriver"""
        if self.driver:
            self.driver.quit()

    def run_api_tests(self, base_url):
        """è¿è¡ŒAPIæµ‹è¯•"""
        print("è¿è¡ŒAPIæµ‹è¯•...")

        test_cases = [
            {
                'name': 'å¥åº·æ£€æŸ¥',
                'method': 'GET',
                'endpoint': '/health',
                'expected_status': 200
            },
            {
                'name': 'è·å–ç”¨æˆ·åˆ—è¡¨',
                'method': 'GET',
                'endpoint': '/api/users',
                'expected_status': 200
            },
            {
                'name': 'åˆ›å»ºç”¨æˆ·',
                'method': 'POST',
                'endpoint': '/api/users',
                'data': {'name': 'Test User', 'email': 'test@example.com'},
                'expected_status': 201
            }
        ]

        results = []
        for test_case in test_cases:
            try:
                if test_case['method'] == 'GET':
                    response = requests.get(f"{base_url}{test_case['endpoint']}")
                elif test_case['method'] == 'POST':
                    response = requests.post(
                        f"{base_url}{test_case['endpoint']}",
                        json=test_case.get('data', {})
                    )

                success = response.status_code == test_case['expected_status']
                results.append({
                    'name': test_case['name'],
                    'status': 'passed' if success else 'failed',
                    'expected': test_case['expected_status'],
                    'actual': response.status_code,
                    'response_time': response.elapsed.total_seconds()
                })

                print(f"  {test_case['name']}: {'âœ“' if success else 'âœ—'}")

            except Exception as e:
                results.append({
                    'name': test_case['name'],
                    'status': 'error',
                    'error': str(e)
                })
                print(f"  {test_case['name']}: âœ— (é”™è¯¯: {e})")

        return results

    def run_ui_tests(self, base_url):
        """è¿è¡ŒUIæµ‹è¯•"""
        print("è¿è¡ŒUIæµ‹è¯•...")

        if not self.driver:
            self.setup_webdriver()

        test_cases = [
            {
                'name': 'é¦–é¡µåŠ è½½',
                'url': '/',
                'check_element': 'h1',
                'expected_text': 'Welcome'
            },
            {
                'name': 'ç”¨æˆ·ç™»å½•',
                'url': '/login',
                'actions': [
                    {'type': 'input', 'selector': '#username', 'value': 'testuser'},
                    {'type': 'input', 'selector': '#password', 'value': 'password'},
                    {'type': 'click', 'selector': '#login-btn'}
                ],
                'check_element': '.dashboard',
                'expected_text': 'Dashboard'
            }
        ]

        results = []
        for test_case in test_cases:
            try:
                self.driver.get(f"{base_url}{test_case['url']}")

# æ‰§è¡Œæ“ä½œ
                if 'actions' in test_case:
                    for action in test_case['actions']:
                        if action['type'] == 'input':
                            element = WebDriverWait(self.driver, 10).until(
                                EC.presence_of_element_located((By.CSS_SELECTOR, action['selector']))
                            )
                            element.clear()
                            element.send_keys(action['value'])
                        elif action['type'] == 'click':
                            element = WebDriverWait(self.driver, 10).until(
                                EC.element_to_be_clickable((By.CSS_SELECTOR, action['selector']))
                            )
                            element.click()

# æ£€æŸ¥ç»“æœ
                if 'check_element' in test_case:
                    element = WebDriverWait(self.driver, 10).until(
                        EC.presence_of_element_located((By.CSS_SELECTOR, test_case['check_element']))
                    )
                    success = test_case['expected_text'] in element.text
                else:
                    success = True

                results.append({
                    'name': test_case['name'],
                    'status': 'passed' if success else 'failed',
                    'url': test_case['url']
                })

                print(f"  {test_case['name']}: {'âœ“' if success else 'âœ—'}")

            except Exception as e:
                results.append({
                    'name': test_case['name'],
                    'status': 'error',
                    'error': str(e)
                })
                print(f"  {test_case['name']}: âœ— (é”™è¯¯: {e})")

        return results

    def run_performance_tests(self, base_url):
        """è¿è¡Œæ€§èƒ½æµ‹è¯•"""
        print("è¿è¡Œæ€§èƒ½æµ‹è¯•...")

        endpoints = ['/health', '/api/users', '/api/products']
        results = []

        for endpoint in endpoints:
            response_times = []

# è¿›è¡Œå¤šæ¬¡è¯·æ±‚æµ‹è¯•
            for i in range(10):
                start_time = time.time()
                try:
                    response = requests.get(f"{base_url}{endpoint}")
                    response_time = time.time() - start_time
                    response_times.append(response_time)
                except Exception as e:
                    response_times.append(None)

# è®¡ç®—ç»Ÿè®¡ä¿¡æ¯
            valid_times = [t for t in response_times if t is not None]
            if valid_times:
                avg_time = sum(valid_times) / len(valid_times)
                max_time = max(valid_times)
                min_time = min(valid_times)

                results.append({
                    'endpoint': endpoint,
                    'avg_response_time': avg_time,
                    'max_response_time': max_time,
                    'min_response_time': min_time,
                    'success_rate': len(valid_times) / len(response_times)
                })

                print(f"  {endpoint}: å¹³å‡ {avg_time:.3f}s, æœ€å¤§ {max_time:.3f}s")
            else:
                results.append({
                    'endpoint': endpoint,
                    'status': 'failed',
                    'error': 'æ‰€æœ‰è¯·æ±‚éƒ½å¤±è´¥'
                })
                print(f"  {endpoint}: âœ— æ‰€æœ‰è¯·æ±‚éƒ½å¤±è´¥")

        return results

    def generate_test_report(self, api_results, ui_results, performance_results):
        """ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š"""
        report = {
            'timestamp': time.strftime('%Y-%m-%d %H:%M:%S'),
            'summary': {
                'api_tests': {
                    'total': len(api_results),
                    'passed': len([r for r in api_results if r['status'] == 'passed']),
                    'failed': len([r for r in api_results if r['status'] == 'failed']),
                    'errors': len([r for r in api_results if r['status'] == 'error'])
                },
                'ui_tests': {
                    'total': len(ui_results),
                    'passed': len([r for r in ui_results if r['status'] == 'passed']),
                    'failed': len([r for r in ui_results if r['status'] == 'failed']),
                    'errors': len([r for r in ui_results if r['status'] == 'error'])
                },
                'performance_tests': {
                    'total': len(performance_results),
                    'successful': len([r for r in performance_results if 'avg_response_time' in r])
                }
            },
            'details': {
                'api_tests': api_results,
                'ui_tests': ui_results,
                'performance_tests': performance_results
            }
        }

# ä¿å­˜æŠ¥å‘Š
        with open('test_report.json', 'w') as f:
            json.dump(report, f, indent=2)

        print(f"\næµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ: test_report.json")
        print(f"APIæµ‹è¯•: {report['summary']['api_tests']['passed']}/{report['summary']['api_tests']['total']} é€šè¿‡")
        print(f"UIæµ‹è¯•: {report['summary']['ui_tests']['passed']}/{report['summary']['ui_tests']['total']} é€šè¿‡")
        print(f"æ€§èƒ½æµ‹è¯•: {report['summary']['performance_tests']['successful']}/{report['summary']['performance_tests']['total']} æˆåŠŸ")

        return report

# ä½¿ç”¨ç¤ºä¾‹
def automated_testing_example():
    """è‡ªåŠ¨åŒ–æµ‹è¯•ç¤ºä¾‹"""
# åˆ›å»ºæµ‹è¯•æ¡†æ¶
    test_framework = AutomatedTestFramework()

# è¿è¡Œæµ‹è¯•
    base_url = 'http://localhost:8000'

    print("å¼€å§‹è‡ªåŠ¨åŒ–æµ‹è¯•...")

# APIæµ‹è¯•
    api_results = test_framework.run_api_tests(base_url)

# UIæµ‹è¯•
    ui_results = test_framework.run_ui_tests(base_url)

# æ€§èƒ½æµ‹è¯•
    performance_results = test_framework.run_performance_tests(base_url)

# ç”ŸæˆæŠ¥å‘Š
    report = test_framework.generate_test_report(api_results, ui_results, performance_results)

# æ¸…ç†èµ„æº
    test_framework.teardown_webdriver()

    return test_framework, report
```

## 4. ç›‘æ§ä¸å¯è§‚æµ‹æ€§å®è·µæ¡ˆä¾‹

### 4.1. åº”ç”¨æ€§èƒ½ç›‘æ§

```python
import time
import psutil
import requests
import json
from datetime import datetime
import threading

class ApplicationMonitor:
    def __init__(self):
        self.metrics = []
        self.alerts = []
        self.monitoring = False

    def start_monitoring(self, interval=60):
        """å¼€å§‹ç›‘æ§"""
        self.monitoring = True
        self.monitor_thread = threading.Thread(target=self._monitor_loop, args=(interval,))
        self.monitor_thread.start()
        print(f"å¼€å§‹ç›‘æ§ï¼Œé—´éš”: {interval}ç§’")

    def stop_monitoring(self):
        """åœæ­¢ç›‘æ§"""
        self.monitoring = False
        if hasattr(self, 'monitor_thread'):
            self.monitor_thread.join()
        print("ç›‘æ§å·²åœæ­¢")

    def _monitor_loop(self, interval):
        """ç›‘æ§å¾ªç¯"""
        while self.monitoring:
            try:
                metrics = self.collect_metrics()
                self.metrics.append(metrics)

# æ£€æŸ¥å‘Šè­¦
                self.check_alerts(metrics)

                time.sleep(interval)
            except Exception as e:
                print(f"ç›‘æ§é”™è¯¯: {e}")

    def collect_metrics(self):
        """æ”¶é›†ç³»ç»ŸæŒ‡æ ‡"""
        timestamp = datetime.now()

# ç³»ç»ŸæŒ‡æ ‡
        cpu_percent = psutil.cpu_percent(interval=1)
        memory = psutil.virtual_memory()
        disk = psutil.disk_usage('/')

# ç½‘ç»œæŒ‡æ ‡
        network = psutil.net_io_counters()

# åº”ç”¨æŒ‡æ ‡ï¼ˆæ¨¡æ‹Ÿï¼‰
        app_metrics = self.collect_application_metrics()

        metrics = {
            'timestamp': timestamp.isoformat(),
            'system': {
                'cpu_percent': cpu_percent,
                'memory_percent': memory.percent,
                'memory_used': memory.used,
                'memory_total': memory.total,
                'disk_percent': disk.percent,
                'disk_used': disk.used,
                'disk_total': disk.total
            },
            'network': {
                'bytes_sent': network.bytes_sent,
                'bytes_recv': network.bytes_recv,
                'packets_sent': network.packets_sent,
                'packets_recv': network.packets_recv
            },
            'application': app_metrics
        }

        return metrics

    def collect_application_metrics(self):
        """æ”¶é›†åº”ç”¨æŒ‡æ ‡"""
# æ¨¡æ‹Ÿåº”ç”¨æŒ‡æ ‡æ”¶é›†
        return {
            'active_connections': 150,
            'requests_per_second': 25.5,
            'average_response_time': 0.125,
            'error_rate': 0.02,
            'memory_usage': 512 * 1024 * 1024,  # 512MB
            'uptime': 86400  # 24å°æ—¶
        }

    def check_alerts(self, metrics):
        """æ£€æŸ¥å‘Šè­¦æ¡ä»¶"""
        alerts = []

# CPUå‘Šè­¦
        if metrics['system']['cpu_percent'] > 80:
            alerts.append({
                'type': 'high_cpu',
                'severity': 'warning',
                'message': f"CPUä½¿ç”¨ç‡è¿‡é«˜: {metrics['system']['cpu_percent']}%",
                'timestamp': metrics['timestamp']
            })

# å†…å­˜å‘Šè­¦
        if metrics['system']['memory_percent'] > 85:
            alerts.append({
                'type': 'high_memory',
                'severity': 'critical',
                'message': f"å†…å­˜ä½¿ç”¨ç‡è¿‡é«˜: {metrics['system']['memory_percent']}%",
                'timestamp': metrics['timestamp']
            })

# ç£ç›˜å‘Šè­¦
        if metrics['system']['disk_percent'] > 90:
            alerts.append({
                'type': 'high_disk',
                'severity': 'critical',
                'message': f"ç£ç›˜ä½¿ç”¨ç‡è¿‡é«˜: {metrics['system']['disk_percent']}%",
                'timestamp': metrics['timestamp']
            })

# åº”ç”¨å‘Šè­¦
        if metrics['application']['error_rate'] > 0.05:
            alerts.append({
                'type': 'high_error_rate',
                'severity': 'warning',
                'message': f"é”™è¯¯ç‡è¿‡é«˜: {metrics['application']['error_rate']:.2%}",
                'timestamp': metrics['timestamp']
            })

        if metrics['application']['average_response_time'] > 1.0:
            alerts.append({
                'type': 'slow_response',
                'severity': 'warning',
                'message': f"å“åº”æ—¶é—´è¿‡é•¿: {metrics['application']['average_response_time']:.3f}s",
                'timestamp': metrics['timestamp']
            })

# æ·»åŠ å‘Šè­¦
        for alert in alerts:
            self.alerts.append(alert)
            print(f"å‘Šè­¦: {alert['message']}")

    def get_metrics_summary(self):
        """è·å–æŒ‡æ ‡æ‘˜è¦"""
        if not self.metrics:
            return None

        latest = self.metrics[-1]

        summary = {
            'current_status': {
                'cpu_percent': latest['system']['cpu_percent'],
                'memory_percent': latest['system']['memory_percent'],
                'disk_percent': latest['system']['disk_percent'],
                'error_rate': latest['application']['error_rate'],
                'response_time': latest['application']['average_response_time']
            },
            'alerts': {
                'total': len(self.alerts),
                'critical': len([a for a in self.alerts if a['severity'] == 'critical']),
                'warning': len([a for a in self.alerts if a['severity'] == 'warning'])
            },
            'uptime': latest['application']['uptime']
        }

        return summary

    def export_metrics(self, filename):
        """å¯¼å‡ºæŒ‡æ ‡æ•°æ®"""
        with open(filename, 'w') as f:
            json.dump(self.metrics, f, indent=2)
        print(f"æŒ‡æ ‡æ•°æ®å·²å¯¼å‡ºåˆ°: {filename}")

    def export_alerts(self, filename):
        """å¯¼å‡ºå‘Šè­¦æ•°æ®"""
        with open(filename, 'w') as f:
            json.dump(self.alerts, f, indent=2)
        print(f"å‘Šè­¦æ•°æ®å·²å¯¼å‡ºåˆ°: {filename}")

# ä½¿ç”¨ç¤ºä¾‹
def application_monitoring_example():
    """åº”ç”¨ç›‘æ§ç¤ºä¾‹"""
# åˆ›å»ºç›‘æ§å™¨
    monitor = ApplicationMonitor()

# å¼€å§‹ç›‘æ§
    monitor.start_monitoring(interval=30)  # æ¯30ç§’æ”¶é›†ä¸€æ¬¡æŒ‡æ ‡

# æ¨¡æ‹Ÿè¿è¡Œä¸€æ®µæ—¶é—´
    print("ç›‘æ§è¿è¡Œä¸­...")
    time.sleep(120)  # è¿è¡Œ2åˆ†é’Ÿ

# åœæ­¢ç›‘æ§
    monitor.stop_monitoring()

# è·å–æ‘˜è¦
    summary = monitor.get_metrics_summary()
    if summary:
        print("\nç›‘æ§æ‘˜è¦:")
        print(f"CPUä½¿ç”¨ç‡: {summary['current_status']['cpu_percent']}%")
        print(f"å†…å­˜ä½¿ç”¨ç‡: {summary['current_status']['memory_percent']}%")
        print(f"ç£ç›˜ä½¿ç”¨ç‡: {summary['current_status']['disk_percent']}%")
        print(f"é”™è¯¯ç‡: {summary['current_status']['error_rate']:.2%}")
        print(f"å“åº”æ—¶é—´: {summary['current_status']['response_time']:.3f}s")
        print(f"å‘Šè­¦æ€»æ•°: {summary['alerts']['total']}")
        print(f"ä¸¥é‡å‘Šè­¦: {summary['alerts']['critical']}")
        print(f"è­¦å‘Š: {summary['alerts']['warning']}")

# å¯¼å‡ºæ•°æ®
    monitor.export_metrics('metrics.json')
    monitor.export_alerts('alerts.json')

    return monitor, summary
```

## 5. æ€»ç»“

æœ¬æ–‡æ¡£æä¾›äº†æŒç»­é›†æˆä¸æ¼”è¿›åœ¨å®é™…é¡¹ç›®ä¸­çš„å…·ä½“åº”ç”¨æ¡ˆä¾‹ï¼ŒåŒ…æ‹¬ï¼š

1. **CI/CDæµæ°´çº¿å®è·µ**ï¼šå®Œæ•´çš„CI/CDæµæ°´çº¿å®ç°å’Œè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶
2. **ç›‘æ§ä¸å¯è§‚æµ‹æ€§å®è·µ**ï¼šåº”ç”¨æ€§èƒ½ç›‘æ§ç³»ç»Ÿ

è¿™äº›æ¡ˆä¾‹å±•ç¤ºäº†DevOpså’ŒæŒç»­é›†æˆåœ¨å„ä¸ªé¢†åŸŸçš„å®é™…åº”ç”¨ï¼Œä¸ºè½¯ä»¶å¼€å‘å’Œè¿ç»´é¡¹ç›®æä¾›äº†å®ç”¨çš„å‚è€ƒå’ŒæŒ‡å¯¼ã€‚
