# æ•°æ®åˆ†æåº”ç”¨æ•°æ®åº“è®¾è®¡å®è·µ

> **åˆ›å»ºæ—¥æœŸ**ï¼š2025-01-15
> **æœ€åæ›´æ–°**ï¼š2025-01-15
> **ç‰ˆæœ¬**ï¼šv1.0
> **çŠ¶æ€**ï¼šè¿›è¡Œä¸­

---

## ğŸ“‹ ç›®å½•

- [æ•°æ®åˆ†æåº”ç”¨æ•°æ®åº“è®¾è®¡å®è·µ](#æ•°æ®åˆ†æåº”ç”¨æ•°æ®åº“è®¾è®¡å®è·µ)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1. æ•°æ®åˆ†ææ•°æ®åº“è®¾è®¡æŒ‘æˆ˜](#11-æ•°æ®åˆ†ææ•°æ®åº“è®¾è®¡æŒ‘æˆ˜)
    - [1.2. æ•°æ®åˆ†ææ•°æ®åº“è®¾è®¡åŸåˆ™](#12-æ•°æ®åˆ†ææ•°æ®åº“è®¾è®¡åŸåˆ™)
  - [2. åˆ—å¼å­˜å‚¨è®¾è®¡](#2-åˆ—å¼å­˜å‚¨è®¾è®¡)
    - [2.1. cstore\_fdwè®¾è®¡](#21-cstore_fdwè®¾è®¡)
      - [2.1.1. cstore\_fdwå®‰è£…å’Œé…ç½®](#211-cstore_fdwå®‰è£…å’Œé…ç½®)
      - [2.1.2. åˆ—å¼è¡¨è®¾è®¡å†³ç­–æ ‘](#212-åˆ—å¼è¡¨è®¾è®¡å†³ç­–æ ‘)
    - [2.2. åˆ—å¼è¡¨è®¾è®¡](#22-åˆ—å¼è¡¨è®¾è®¡)
      - [2.2.1. åˆ—å¼è¡¨Schemaè®¾è®¡](#221-åˆ—å¼è¡¨schemaè®¾è®¡)
      - [2.2.2. åˆ—å¼è¡¨æŸ¥è¯¢ä¼˜åŒ–](#222-åˆ—å¼è¡¨æŸ¥è¯¢ä¼˜åŒ–)
    - [2.3. åˆ—å¼æŸ¥è¯¢ä¼˜åŒ–](#23-åˆ—å¼æŸ¥è¯¢ä¼˜åŒ–)
      - [2.3.1. åˆ—å¼æŸ¥è¯¢ä¼˜åŒ–åŸåˆ™](#231-åˆ—å¼æŸ¥è¯¢ä¼˜åŒ–åŸåˆ™)
  - [3. æ•°æ®ä»“åº“è®¾è®¡](#3-æ•°æ®ä»“åº“è®¾è®¡)
    - [3.1. æ˜Ÿå‹æ¨¡å‹è®¾è®¡](#31-æ˜Ÿå‹æ¨¡å‹è®¾è®¡)
      - [3.1.1. æ˜Ÿå‹æ¨¡å‹Schemaè®¾è®¡](#311-æ˜Ÿå‹æ¨¡å‹schemaè®¾è®¡)
    - [3.2. é›ªèŠ±æ¨¡å‹è®¾è®¡](#32-é›ªèŠ±æ¨¡å‹è®¾è®¡)
      - [3.2.1. é›ªèŠ±æ¨¡å‹Schemaè®¾è®¡](#321-é›ªèŠ±æ¨¡å‹schemaè®¾è®¡)
    - [3.3. äº‹å®è¡¨è®¾è®¡](#33-äº‹å®è¡¨è®¾è®¡)
      - [3.3.1. äº‹å®è¡¨è®¾è®¡åŸåˆ™](#331-äº‹å®è¡¨è®¾è®¡åŸåˆ™)
      - [3.3.2. äº‹å®è¡¨Schemaè®¾è®¡](#332-äº‹å®è¡¨schemaè®¾è®¡)
    - [3.4. ç»´åº¦è¡¨è®¾è®¡](#34-ç»´åº¦è¡¨è®¾è®¡)
      - [3.4.1. ç»´åº¦è¡¨è®¾è®¡åŸåˆ™](#341-ç»´åº¦è¡¨è®¾è®¡åŸåˆ™)
      - [3.4.2. ç»´åº¦è¡¨Schemaè®¾è®¡](#342-ç»´åº¦è¡¨schemaè®¾è®¡)
  - [4. ç‰©åŒ–è§†å›¾è®¾è®¡](#4-ç‰©åŒ–è§†å›¾è®¾è®¡)
    - [4.1. ç‰©åŒ–è§†å›¾åˆ›å»º](#41-ç‰©åŒ–è§†å›¾åˆ›å»º)
      - [4.1.1. ç‰©åŒ–è§†å›¾Schemaè®¾è®¡](#411-ç‰©åŒ–è§†å›¾schemaè®¾è®¡)
    - [4.2. ç‰©åŒ–è§†å›¾åˆ·æ–°](#42-ç‰©åŒ–è§†å›¾åˆ·æ–°)
      - [4.2.1. ç‰©åŒ–è§†å›¾åˆ·æ–°ç­–ç•¥](#421-ç‰©åŒ–è§†å›¾åˆ·æ–°ç­–ç•¥)
      - [4.2.2. ç‰©åŒ–è§†å›¾åˆ·æ–°å®ç°](#422-ç‰©åŒ–è§†å›¾åˆ·æ–°å®ç°)
    - [4.3. ç‰©åŒ–è§†å›¾ä¼˜åŒ–](#43-ç‰©åŒ–è§†å›¾ä¼˜åŒ–)
      - [4.3.1. ç‰©åŒ–è§†å›¾ä¼˜åŒ–åŸåˆ™](#431-ç‰©åŒ–è§†å›¾ä¼˜åŒ–åŸåˆ™)
  - [5. PostgreSQLæ•°æ®åˆ†æåº”ç”¨å®è·µ](#5-postgresqlæ•°æ®åˆ†æåº”ç”¨å®è·µ)
    - [5.1. åˆ—å¼å­˜å‚¨å®ç°](#51-åˆ—å¼å­˜å‚¨å®ç°)
      - [5.1.1. cstore\_fdwå®ç°](#511-cstore_fdwå®ç°)
    - [5.2. æ•°æ®ä»“åº“å®ç°](#52-æ•°æ®ä»“åº“å®ç°)
      - [5.2.1. æ˜Ÿå‹æ¨¡å‹å®ç°](#521-æ˜Ÿå‹æ¨¡å‹å®ç°)
    - [5.3. OLAPåˆ†æå®ç°](#53-olapåˆ†æå®ç°)
      - [5.3.1. OLAPæŸ¥è¯¢å®ç°](#531-olapæŸ¥è¯¢å®ç°)
  - [6. å®é™…åº”ç”¨æ¡ˆä¾‹](#6-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [6.1. å•†ä¸šæ™ºèƒ½ç³»ç»Ÿ](#61-å•†ä¸šæ™ºèƒ½ç³»ç»Ÿ)
      - [6.1.1. ç³»ç»Ÿæ¶æ„](#611-ç³»ç»Ÿæ¶æ„)
      - [6.1.2. æ•°æ®åº“è®¾è®¡](#612-æ•°æ®åº“è®¾è®¡)
    - [6.2. æ•°æ®ç§‘å­¦å¹³å°](#62-æ•°æ®ç§‘å­¦å¹³å°)
      - [6.2.1. ç³»ç»Ÿæ¶æ„](#621-ç³»ç»Ÿæ¶æ„)
  - [7. å‚è€ƒèµ„æ–™](#7-å‚è€ƒèµ„æ–™)
    - [7.1. ç»å…¸æ–‡çŒ®](#71-ç»å…¸æ–‡çŒ®)
    - [7.2. ç›¸å…³èµ„æº](#72-ç›¸å…³èµ„æº)

---

## 1. æ¦‚è¿°

### 1.1. æ•°æ®åˆ†ææ•°æ®åº“è®¾è®¡æŒ‘æˆ˜

æ•°æ®åˆ†ææ•°æ®åº“è®¾è®¡é¢ä¸´ä»¥ä¸‹æŒ‘æˆ˜ï¼š

1. **æ•°æ®è§„æ¨¡**ï¼šå¤§è§„æ¨¡æ•°æ®å­˜å‚¨å’Œåˆ†æ
2. **æŸ¥è¯¢æ€§èƒ½**ï¼šå¿«é€Ÿå“åº”OLAPæŸ¥è¯¢
3. **æ•°æ®ä¸€è‡´æ€§**ï¼šä¿è¯æ•°æ®ä¸€è‡´æ€§
4. **å®æ—¶æ€§**ï¼šæ”¯æŒå®æ—¶åˆ†æ

### 1.2. æ•°æ®åˆ†ææ•°æ®åº“è®¾è®¡åŸåˆ™

æ•°æ®åˆ†ææ•°æ®åº“è®¾è®¡éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

1. **åˆ—å¼å­˜å‚¨**ï¼šä½¿ç”¨åˆ—å¼å­˜å‚¨ä¼˜åŒ–OLAPæŸ¥è¯¢
2. **æ•°æ®ä»“åº“**ï¼šä½¿ç”¨æ•°æ®ä»“åº“æ¨¡å‹ç»„ç»‡æ•°æ®
3. **ç‰©åŒ–è§†å›¾**ï¼šä½¿ç”¨ç‰©åŒ–è§†å›¾åŠ é€ŸæŸ¥è¯¢
4. **åˆ†åŒºç­–ç•¥**ï¼šä½¿ç”¨åˆ†åŒºç­–ç•¥ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½

---

## 2. åˆ—å¼å­˜å‚¨è®¾è®¡

### 2.1. cstore_fdwè®¾è®¡

#### 2.1.1. cstore_fdwå®‰è£…å’Œé…ç½®

```sql
-- å®‰è£…cstore_fdwæ‰©å±•
CREATE EXTENSION cstore_fdw;

-- åˆ›å»ºå¤–éƒ¨æœåŠ¡å™¨
CREATE SERVER cstore_server
FOREIGN DATA WRAPPER cstore_fdw;
```

#### 2.1.2. åˆ—å¼è¡¨è®¾è®¡å†³ç­–æ ‘

```mermaid
flowchart TD
    A[åˆ—å¼å­˜å‚¨è®¾è®¡] --> B{æ•°æ®ç‰¹å¾}
    B -->|OLAPæŸ¥è¯¢| C[åˆ—å¼å­˜å‚¨ âœ…]
    B -->|OLTPæŸ¥è¯¢| D[è¡Œå¼å­˜å‚¨]

    C --> E{PostgreSQLé›†æˆ}
    E -->|éœ€è¦| F[cstore_fdw âœ…]
    E -->|ä¸éœ€è¦| G[ClickHouse]

    F --> H[åˆ—å¼è¡¨è®¾è®¡ âœ…]
    G --> I[ClickHouseè¡¨è®¾è®¡]

    D --> J[è¡Œå¼è¡¨è®¾è®¡]

    H --> K[éªŒè¯éœ€æ±‚]
    I --> K
    J --> K

    K --> L{éœ€æ±‚æ»¡è¶³?}
    L -->|æ˜¯| M[åˆ—å¼å­˜å‚¨è®¾è®¡å®Œæˆ âœ…]
    L -->|å¦| N[è°ƒæ•´è®¾è®¡]
    N --> B
```

### 2.2. åˆ—å¼è¡¨è®¾è®¡

#### 2.2.1. åˆ—å¼è¡¨Schemaè®¾è®¡

```sql
-- ============================================
-- åˆ—å¼å­˜å‚¨è¡¨è®¾è®¡
-- ============================================

-- åˆ›å»ºåˆ—å¼å­˜å‚¨è¡¨
CREATE FOREIGN TABLE sales_columnar (
    sale_id BIGINT,
    product_id BIGINT,
    customer_id BIGINT,
    sale_date DATE,
    amount DECIMAL(10,2),
    quantity INTEGER
)
SERVER cstore_server
OPTIONS (
    compression 'pglz',
    stripe_row_count '150000'
);

-- æ’å…¥æ•°æ®
INSERT INTO sales_columnar
SELECT
    sale_id,
    product_id,
    customer_id,
    sale_date,
    amount,
    quantity
FROM sales;
```

#### 2.2.2. åˆ—å¼è¡¨æŸ¥è¯¢ä¼˜åŒ–

```sql
-- åˆ—å¼æŸ¥è¯¢ä¼˜åŒ–ï¼šåªæŸ¥è¯¢éœ€è¦çš„åˆ—
SELECT
    product_id,
    SUM(amount) AS total_amount,
    COUNT(*) AS sale_count
FROM sales_columnar
WHERE sale_date >= '2024-01-01'
GROUP BY product_id;
```

### 2.3. åˆ—å¼æŸ¥è¯¢ä¼˜åŒ–

#### 2.3.1. åˆ—å¼æŸ¥è¯¢ä¼˜åŒ–åŸåˆ™

**ä¼˜åŒ–åŸåˆ™**ï¼š

1. **åªæŸ¥è¯¢éœ€è¦çš„åˆ—**ï¼šåˆ—å¼å­˜å‚¨åªè¯»å–éœ€è¦çš„åˆ—
2. **é¿å…å…¨è¡¨æ‰«æ**ï¼šä½¿ç”¨è¿‡æ»¤æ¡ä»¶å‡å°‘æ‰«ææ•°æ®
3. **åˆ©ç”¨èšåˆ**ï¼šåˆ—å¼å­˜å‚¨é€‚åˆèšåˆæ“ä½œ

---

## 3. æ•°æ®ä»“åº“è®¾è®¡

### 3.1. æ˜Ÿå‹æ¨¡å‹è®¾è®¡

#### 3.1.1. æ˜Ÿå‹æ¨¡å‹Schemaè®¾è®¡

```sql
-- ============================================
-- æ˜Ÿå‹æ¨¡å‹è®¾è®¡
-- ============================================

-- äº‹å®è¡¨ï¼šé”€å”®äº‹å®
CREATE TABLE fact_sales (
    sale_id BIGSERIAL PRIMARY KEY,
    product_id BIGINT NOT NULL REFERENCES dim_products(product_id),
    customer_id BIGINT NOT NULL REFERENCES dim_customers(customer_id),
    date_id BIGINT NOT NULL REFERENCES dim_dates(date_id),
    amount DECIMAL(10,2) NOT NULL,
    quantity INTEGER NOT NULL,
    discount DECIMAL(10,2) DEFAULT 0,
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_fact_sales_product ON fact_sales(product_id);
CREATE INDEX idx_fact_sales_customer ON fact_sales(customer_id);
CREATE INDEX idx_fact_sales_date ON fact_sales(date_id);

-- ç»´åº¦è¡¨ï¼šäº§å“ç»´åº¦
CREATE TABLE dim_products (
    product_id BIGSERIAL PRIMARY KEY,
    product_name VARCHAR(200) NOT NULL,
    category_id BIGINT NOT NULL REFERENCES dim_categories(category_id),
    brand_id BIGINT NOT NULL REFERENCES dim_brands(brand_id),
    price DECIMAL(10,2) NOT NULL,
    cost DECIMAL(10,2) NOT NULL,
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_dim_products_category ON dim_products(category_id);
CREATE INDEX idx_dim_products_brand ON dim_products(brand_id);

-- ç»´åº¦è¡¨ï¼šå®¢æˆ·ç»´åº¦
CREATE TABLE dim_customers (
    customer_id BIGSERIAL PRIMARY KEY,
    customer_name VARCHAR(200) NOT NULL,
    region_id BIGINT NOT NULL REFERENCES dim_regions(region_id),
    customer_type VARCHAR(50) NOT NULL,
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_dim_customers_region ON dim_customers(region_id);

-- ç»´åº¦è¡¨ï¼šæ—¥æœŸç»´åº¦
CREATE TABLE dim_dates (
    date_id BIGSERIAL PRIMARY KEY,
    date DATE NOT NULL UNIQUE,
    year INTEGER NOT NULL,
    quarter INTEGER NOT NULL CHECK (quarter BETWEEN 1 AND 4),
    month INTEGER NOT NULL CHECK (month BETWEEN 1 AND 12),
    day INTEGER NOT NULL CHECK (day BETWEEN 1 AND 31),
    day_of_week INTEGER NOT NULL CHECK (day_of_week BETWEEN 1 AND 7),
    is_weekend BOOLEAN NOT NULL,
    is_holiday BOOLEAN NOT NULL DEFAULT FALSE
);

CREATE INDEX idx_dim_dates_date ON dim_dates(date);
CREATE INDEX idx_dim_dates_year_month ON dim_dates(year, month);
```

### 3.2. é›ªèŠ±æ¨¡å‹è®¾è®¡

#### 3.2.1. é›ªèŠ±æ¨¡å‹Schemaè®¾è®¡

```sql
-- ============================================
-- é›ªèŠ±æ¨¡å‹è®¾è®¡
-- ============================================

-- äº‹å®è¡¨ï¼šé”€å”®äº‹å®
CREATE TABLE fact_sales (
    sale_id BIGSERIAL PRIMARY KEY,
    product_id BIGINT NOT NULL REFERENCES dim_products(product_id),
    customer_id BIGINT NOT NULL REFERENCES dim_customers(customer_id),
    date_id BIGINT NOT NULL REFERENCES dim_dates(date_id),
    amount DECIMAL(10,2) NOT NULL,
    quantity INTEGER NOT NULL
);

-- ç»´åº¦è¡¨ï¼šäº§å“ç»´åº¦ï¼ˆè§„èŒƒåŒ–ï¼‰
CREATE TABLE dim_products (
    product_id BIGSERIAL PRIMARY KEY,
    product_name VARCHAR(200) NOT NULL,
    category_id BIGINT NOT NULL REFERENCES dim_categories(category_id),
    brand_id BIGINT NOT NULL REFERENCES dim_brands(brand_id),
    price DECIMAL(10,2) NOT NULL
);

-- å­ç»´åº¦è¡¨ï¼šäº§å“ç±»åˆ«
CREATE TABLE dim_categories (
    category_id BIGSERIAL PRIMARY KEY,
    category_name VARCHAR(100) NOT NULL UNIQUE,
    parent_category_id BIGINT REFERENCES dim_categories(category_id)
);

-- å­ç»´åº¦è¡¨ï¼šå“ç‰Œ
CREATE TABLE dim_brands (
    brand_id BIGSERIAL PRIMARY KEY,
    brand_name VARCHAR(100) NOT NULL UNIQUE,
    manufacturer_id BIGINT NOT NULL REFERENCES dim_manufacturers(manufacturer_id)
);

-- å­ç»´åº¦è¡¨ï¼šåˆ¶é€ å•†
CREATE TABLE dim_manufacturers (
    manufacturer_id BIGSERIAL PRIMARY KEY,
    manufacturer_name VARCHAR(100) NOT NULL UNIQUE,
    country VARCHAR(50) NOT NULL
);
```

### 3.3. äº‹å®è¡¨è®¾è®¡

#### 3.3.1. äº‹å®è¡¨è®¾è®¡åŸåˆ™

**è®¾è®¡åŸåˆ™**ï¼š

1. **ç²’åº¦**ï¼šç¡®å®šäº‹å®è¡¨çš„ç²’åº¦
2. **åº¦é‡**ï¼šé€‰æ‹©åº¦é‡å­—æ®µ
3. **å¤–é”®**ï¼šå¤–é”®æŒ‡å‘ç»´åº¦è¡¨
4. **ç´¢å¼•**ï¼šä¸ºå¤–é”®åˆ›å»ºç´¢å¼•

#### 3.3.2. äº‹å®è¡¨Schemaè®¾è®¡

```sql
-- äº‹å®è¡¨ï¼šé”€å”®äº‹å®ï¼ˆè¯¦ç»†ç²’åº¦ï¼‰
CREATE TABLE fact_sales (
    sale_id BIGSERIAL PRIMARY KEY,
    product_id BIGINT NOT NULL REFERENCES dim_products(product_id),
    customer_id BIGINT NOT NULL REFERENCES dim_customers(customer_id),
    date_id BIGINT NOT NULL REFERENCES dim_dates(date_id),
    store_id BIGINT NOT NULL REFERENCES dim_stores(store_id),
    -- åº¦é‡å­—æ®µ
    amount DECIMAL(10,2) NOT NULL,
    quantity INTEGER NOT NULL,
    discount DECIMAL(10,2) DEFAULT 0,
    tax DECIMAL(10,2) DEFAULT 0,
    -- æ—¶é—´æˆ³
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_fact_sales_product ON fact_sales(product_id);
CREATE INDEX idx_fact_sales_customer ON fact_sales(customer_id);
CREATE INDEX idx_fact_sales_date ON fact_sales(date_id);
CREATE INDEX idx_fact_sales_store ON fact_sales(store_id);
CREATE INDEX idx_fact_sales_date_product ON fact_sales(date_id, product_id);
```

### 3.4. ç»´åº¦è¡¨è®¾è®¡

#### 3.4.1. ç»´åº¦è¡¨è®¾è®¡åŸåˆ™

**è®¾è®¡åŸåˆ™**ï¼š

1. **ç¼“æ…¢å˜åŒ–ç»´åº¦**ï¼šå¤„ç†ç»´åº¦æ•°æ®çš„å˜åŒ–
2. **ä»£ç†é”®**ï¼šä½¿ç”¨ä»£ç†é”®è€Œéè‡ªç„¶é”®
3. **å±‚æ¬¡ç»“æ„**ï¼šæ”¯æŒå±‚æ¬¡ç»“æ„æŸ¥è¯¢

#### 3.4.2. ç»´åº¦è¡¨Schemaè®¾è®¡

```sql
-- ç»´åº¦è¡¨ï¼šäº§å“ç»´åº¦ï¼ˆSCD Type 2ï¼‰
CREATE TABLE dim_products (
    product_id BIGSERIAL PRIMARY KEY,
    product_sk BIGINT NOT NULL UNIQUE,  -- ä»£ç†é”®
    product_code VARCHAR(50) NOT NULL,  -- è‡ªç„¶é”®
    product_name VARCHAR(200) NOT NULL,
    category_id BIGINT NOT NULL REFERENCES dim_categories(category_id),
    price DECIMAL(10,2) NOT NULL,
    -- SCDå­—æ®µ
    effective_date DATE NOT NULL,
    expiry_date DATE,
    is_current BOOLEAN NOT NULL DEFAULT TRUE,
    created_at TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_dim_products_sk ON dim_products(product_sk);
CREATE INDEX idx_dim_products_code ON dim_products(product_code);
CREATE INDEX idx_dim_products_current ON dim_products(is_current);
```

---

## 4. ç‰©åŒ–è§†å›¾è®¾è®¡

### 4.1. ç‰©åŒ–è§†å›¾åˆ›å»º

#### 4.1.1. ç‰©åŒ–è§†å›¾Schemaè®¾è®¡

```sql
-- ============================================
-- ç‰©åŒ–è§†å›¾è®¾è®¡
-- ============================================

-- åˆ›å»ºç‰©åŒ–è§†å›¾ï¼šé”€å”®æ±‡æ€»
CREATE MATERIALIZED VIEW mv_sales_summary AS
SELECT
    d.year,
    d.quarter,
    d.month,
    p.category_id,
    c.region_id,
    SUM(f.amount) AS total_amount,
    SUM(f.quantity) AS total_quantity,
    COUNT(*) AS sale_count,
    AVG(f.amount) AS avg_amount
FROM fact_sales f
JOIN dim_dates d ON f.date_id = d.date_id
JOIN dim_products p ON f.product_id = p.product_id
JOIN dim_customers c ON f.customer_id = c.customer_id
GROUP BY d.year, d.quarter, d.month, p.category_id, c.region_id;

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_mv_sales_summary_year_month
ON mv_sales_summary(year, month);

CREATE INDEX idx_mv_sales_summary_category
ON mv_sales_summary(category_id);

CREATE INDEX idx_mv_sales_summary_region
ON mv_sales_summary(region_id);
```

### 4.2. ç‰©åŒ–è§†å›¾åˆ·æ–°

#### 4.2.1. ç‰©åŒ–è§†å›¾åˆ·æ–°ç­–ç•¥

**åˆ·æ–°ç­–ç•¥**ï¼š

1. **æ‰‹åŠ¨åˆ·æ–°**ï¼šæ‰‹åŠ¨æ‰§è¡Œåˆ·æ–°
2. **å®šæ—¶åˆ·æ–°**ï¼šä½¿ç”¨å®šæ—¶ä»»åŠ¡åˆ·æ–°
3. **å¢é‡åˆ·æ–°**ï¼šåªåˆ·æ–°å˜åŒ–çš„æ•°æ®

#### 4.2.2. ç‰©åŒ–è§†å›¾åˆ·æ–°å®ç°

```sql
-- æ‰‹åŠ¨åˆ·æ–°ï¼ˆå…¨é‡åˆ·æ–°ï¼‰
REFRESH MATERIALIZED VIEW mv_sales_summary;

-- å¹¶å‘åˆ·æ–°ï¼ˆå¢é‡åˆ·æ–°ï¼‰
REFRESH MATERIALIZED VIEW CONCURRENTLY mv_sales_summary;

-- å®šæ—¶åˆ·æ–°ï¼ˆä½¿ç”¨pg_cronæ‰©å±•ï¼‰
SELECT cron.schedule(
    'refresh-sales-summary',
    '0 2 * * *',  -- æ¯å¤©å‡Œæ™¨2ç‚¹
    $$REFRESH MATERIALIZED VIEW CONCURRENTLY mv_sales_summary$$
);
```

### 4.3. ç‰©åŒ–è§†å›¾ä¼˜åŒ–

#### 4.3.1. ç‰©åŒ–è§†å›¾ä¼˜åŒ–åŸåˆ™

**ä¼˜åŒ–åŸåˆ™**ï¼š

1. **ç´¢å¼•ä¼˜åŒ–**ï¼šä¸ºç‰©åŒ–è§†å›¾åˆ›å»ºç´¢å¼•
2. **åˆ†åŒºä¼˜åŒ–**ï¼šå¯¹ç‰©åŒ–è§†å›¾è¿›è¡Œåˆ†åŒº
3. **æŸ¥è¯¢ä¼˜åŒ–**ï¼šä¼˜åŒ–ç‰©åŒ–è§†å›¾æŸ¥è¯¢

---

## 5. PostgreSQLæ•°æ®åˆ†æåº”ç”¨å®è·µ

### 5.1. åˆ—å¼å­˜å‚¨å®ç°

#### 5.1.1. cstore_fdwå®ç°

å‚è€ƒç¬¬2.1èŠ‚çš„cstore_fdwè®¾è®¡ã€‚

### 5.2. æ•°æ®ä»“åº“å®ç°

#### 5.2.1. æ˜Ÿå‹æ¨¡å‹å®ç°

å‚è€ƒç¬¬3.1èŠ‚çš„æ˜Ÿå‹æ¨¡å‹è®¾è®¡ã€‚

### 5.3. OLAPåˆ†æå®ç°

#### 5.3.1. OLAPæŸ¥è¯¢å®ç°

```sql
-- OLAPæŸ¥è¯¢ï¼šé”€å”®åˆ†æ
SELECT
    d.year,
    d.quarter,
    p.category_id,
    SUM(f.amount) AS total_amount,
    SUM(f.quantity) AS total_quantity,
    COUNT(*) AS sale_count
FROM fact_sales f
JOIN dim_dates d ON f.date_id = d.date_id
JOIN dim_products p ON f.product_id = p.product_id
WHERE d.year = 2024
GROUP BY
    ROLLUP(d.year, d.quarter),
    p.category_id
ORDER BY d.year, d.quarter, p.category_id;
```

---

## 6. å®é™…åº”ç”¨æ¡ˆä¾‹

### 6.1. å•†ä¸šæ™ºèƒ½ç³»ç»Ÿ

#### 6.1.1. ç³»ç»Ÿæ¶æ„

**ç³»ç»Ÿæ¶æ„**ï¼š

```text
æ•°æ®æº â†’ ETL â†’ æ•°æ®ä»“åº“ â†’ OLAP â†’ å•†ä¸šæ™ºèƒ½å·¥å…·
```

#### 6.1.2. æ•°æ®åº“è®¾è®¡

å‚è€ƒç¬¬3èŠ‚çš„æ•°æ®ä»“åº“è®¾è®¡ã€‚

### 6.2. æ•°æ®ç§‘å­¦å¹³å°

#### 6.2.1. ç³»ç»Ÿæ¶æ„

**ç³»ç»Ÿæ¶æ„**ï¼š

```text
æ•°æ®æº â†’ æ•°æ®æ¹– â†’ æ•°æ®ä»“åº“ â†’ æ•°æ®åˆ†æ â†’ æœºå™¨å­¦ä¹ 
```

---

## 7. å‚è€ƒèµ„æ–™

### 7.1. ç»å…¸æ–‡çŒ®

- "The Data Warehouse Toolkit" (Kimball, 2013)
- "Building the Data Warehouse" (Inmon, 2005)
- "Column-Stores vs. Row-Stores" (Abadi et al., 2008)

### 7.2. ç›¸å…³èµ„æº

- [PostgreSQL cstore_fdwæ–‡æ¡£](https://github.com/citusdata/cstore_fdw)
- [PostgreSQLç‰©åŒ–è§†å›¾æ–‡æ¡£](https://www.postgresql.org/docs/current/sql-creatematerializedview.html)
- [æ•°æ®ä»“åº“è®¾è®¡æŒ‡å—](https://www.kimballgroup.com/data-warehouse-business-intelligence-resources/)

---

**æœ€åæ›´æ–°**ï¼š2025-01-15
**ç»´æŠ¤è€…**ï¼šData-Science Team
**çŠ¶æ€**ï¼šè¿›è¡Œä¸­
