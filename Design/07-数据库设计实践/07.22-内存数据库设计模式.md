# å†…å­˜æ•°æ®åº“è®¾è®¡æ¨¡å¼ï¼šRedisç¼“å­˜ä¸æ•°æ®ç»“æ„è®¾è®¡

> **åˆ›å»ºæ—¥æœŸ**ï¼š2025-01-15
> **æœ€åæ›´æ–°**ï¼š2025-12-01
> **ç‰ˆæœ¬**ï¼šv2.0 (å¢å¼ºç‰ˆ)
> **çŠ¶æ€**ï¼šå·²å®Œæˆ âœ…

---

## ğŸ“‹ ç›®å½•

- [å†…å­˜æ•°æ®åº“è®¾è®¡æ¨¡å¼ï¼šRedisç¼“å­˜ä¸æ•°æ®ç»“æ„è®¾è®¡](#å†…å­˜æ•°æ®åº“è®¾è®¡æ¨¡å¼redisç¼“å­˜ä¸æ•°æ®ç»“æ„è®¾è®¡)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1. å†…å­˜æ•°æ®åº“åº”ç”¨åœºæ™¯](#11-å†…å­˜æ•°æ®åº“åº”ç”¨åœºæ™¯)
    - [1.2. Redisæ•°æ®ç»“æ„é€‰æ‹©å†³ç­–æ ‘](#12-redisæ•°æ®ç»“æ„é€‰æ‹©å†³ç­–æ ‘)
  - [2. Redisæ•°æ®ç»“æ„é€‰æ‹©](#2-redisæ•°æ®ç»“æ„é€‰æ‹©)
    - [2.1. æ•°æ®ç»“æ„å¯¹æ¯”çŸ©é˜µ](#21-æ•°æ®ç»“æ„å¯¹æ¯”çŸ©é˜µ)
    - [2.2. æ•°æ®ç»“æ„é€‰æ‹©åŸåˆ™](#22-æ•°æ®ç»“æ„é€‰æ‹©åŸåˆ™)
  - [3. ç¼“å­˜è®¾è®¡æ¨¡å¼](#3-ç¼“å­˜è®¾è®¡æ¨¡å¼)
    - [3.1. ç¼“å­˜æ¨¡å¼å¯¹æ¯”](#31-ç¼“å­˜æ¨¡å¼å¯¹æ¯”)
    - [3.2. Cache-Asideæ¨¡å¼å®ç°](#32-cache-asideæ¨¡å¼å®ç°)
    - [3.3. Write-Throughæ¨¡å¼å®ç°](#33-write-throughæ¨¡å¼å®ç°)
  - [4. Redis Schemaè®¾è®¡](#4-redis-schemaè®¾è®¡)
    - [4.1. ç”¨æˆ·ä¿¡æ¯å­˜å‚¨è®¾è®¡](#41-ç”¨æˆ·ä¿¡æ¯å­˜å‚¨è®¾è®¡)
    - [4.2. æ’è¡Œæ¦œè®¾è®¡](#42-æ’è¡Œæ¦œè®¾è®¡)
    - [4.3. è´­ç‰©è½¦è®¾è®¡](#43-è´­ç‰©è½¦è®¾è®¡)
    - [4.4. è®¡æ•°å™¨è®¾è®¡](#44-è®¡æ•°å™¨è®¾è®¡)
  - [5. RedisæŒä¹…åŒ–ä¸é«˜å¯ç”¨](#5-redisæŒä¹…åŒ–ä¸é«˜å¯ç”¨)
    - [5.1. æŒä¹…åŒ–ç­–ç•¥](#51-æŒä¹…åŒ–ç­–ç•¥)
    - [5.2. Redisé…ç½®ç¤ºä¾‹](#52-redisé…ç½®ç¤ºä¾‹)
    - [5.3. Redisé«˜å¯ç”¨è®¾è®¡](#53-redisé«˜å¯ç”¨è®¾è®¡)
  - [6. Redisæ€§èƒ½ä¼˜åŒ–](#6-redisæ€§èƒ½ä¼˜åŒ–)
    - [6.1. é”®å‘½åè§„èŒƒ](#61-é”®å‘½åè§„èŒƒ)
    - [6.2. æ‰¹é‡æ“ä½œä¼˜åŒ–](#62-æ‰¹é‡æ“ä½œä¼˜åŒ–)
    - [6.3. å†…å­˜ä¼˜åŒ–](#63-å†…å­˜ä¼˜åŒ–)
  - [7. å®é™…åº”ç”¨æ¡ˆä¾‹](#7-å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [7.1. åˆ†å¸ƒå¼é”è®¾è®¡](#71-åˆ†å¸ƒå¼é”è®¾è®¡)
    - [7.2. é™æµè®¾è®¡](#72-é™æµè®¾è®¡)
    - [7.3. æ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡](#73-æ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡)
  - [8. 2024-2025æœ€æ–°è¶‹åŠ¿](#8-2024-2025æœ€æ–°è¶‹åŠ¿)
    - [8.1. å†…å­˜æ•°æ®åº“æŠ€æœ¯æ¼”è¿›](#81-å†…å­˜æ•°æ®åº“æŠ€æœ¯æ¼”è¿›)
    - [8.2. å†…å­˜æ•°æ®åº“é€‰å‹çŸ©é˜µ](#82-å†…å­˜æ•°æ®åº“é€‰å‹çŸ©é˜µ)
    - [8.3. Rediså‘é‡æœç´¢](#83-rediså‘é‡æœç´¢)
    - [8.4. è¾¹ç¼˜ç¼“å­˜æ¶æ„](#84-è¾¹ç¼˜ç¼“å­˜æ¶æ„)
  - [9. å‚è€ƒèµ„æ–™](#9-å‚è€ƒèµ„æ–™)
    - [9.1. æƒå¨æ–‡çŒ®](#91-æƒå¨æ–‡çŒ®)
    - [9.2. åœ¨çº¿èµ„æº](#92-åœ¨çº¿èµ„æº)
    - [9.3. ç›¸å…³æ–‡æ¡£](#93-ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

å†…å­˜æ•°æ®åº“ä»¥å†…å­˜ä¸ºä¸»è¦å­˜å‚¨ä»‹è´¨ï¼Œæä¾›æé«˜çš„è¯»å†™æ€§èƒ½ï¼Œå¹¿æ³›åº”ç”¨äºç¼“å­˜ã€ä¼šè¯å­˜å‚¨ã€å®æ—¶è®¡ç®—ç­‰åœºæ™¯ã€‚

### 1.1. å†…å­˜æ•°æ®åº“åº”ç”¨åœºæ™¯

```mermaid
mindmap
  root((å†…å­˜æ•°æ®åº“åº”ç”¨))
    ç¼“å­˜ç³»ç»Ÿ
      æ•°æ®åº“ç¼“å­˜
      åº”ç”¨ç¼“å­˜
      CDNç¼“å­˜
    ä¼šè¯å­˜å‚¨
      ç”¨æˆ·ä¼šè¯
      è´­ç‰©è½¦
      ä¸´æ—¶æ•°æ®
    å®æ—¶è®¡ç®—
      è®¡æ•°å™¨
      æ’è¡Œæ¦œ
      å®æ—¶ç»Ÿè®¡
    æ¶ˆæ¯é˜Ÿåˆ—
      ä»»åŠ¡é˜Ÿåˆ—
      å‘å¸ƒè®¢é˜…
      äº‹ä»¶æµ
```

### 1.2. Redisæ•°æ®ç»“æ„é€‰æ‹©å†³ç­–æ ‘

```mermaid
flowchart TD
    A[é€‰æ‹©Redisæ•°æ®ç»“æ„] --> B{æ•°æ®ç‰¹ç‚¹}

    B -->|ç®€å•é”®å€¼| C[String]
    B -->|åˆ—è¡¨æ•°æ®| D[List]
    B -->|é›†åˆæ•°æ®| E{éœ€è¦å»é‡?}
    B -->|å“ˆå¸Œæ•°æ®| F[Hash]
    B -->|æœ‰åºé›†åˆ| G[Sorted Set]

    E -->|æ˜¯| H[Set]
    E -->|å¦| I[List]

    C --> J[è®¾è®¡å®Œæˆ]
    D --> J
    F --> J
    G --> J
    H --> J
    I --> J
```

---

## 2. Redisæ•°æ®ç»“æ„é€‰æ‹©

### 2.1. æ•°æ®ç»“æ„å¯¹æ¯”çŸ©é˜µ

**Redisæ•°æ®ç»“æ„å¯¹æ¯”**ï¼š

| æ•°æ®ç»“æ„ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ | æ—¶é—´å¤æ‚åº¦ |
|---------|------|---------|-----------|
| **String** | ç®€å•é”®å€¼å¯¹ | ç¼“å­˜ã€è®¡æ•°å™¨ | O(1) |
| **Hash** | å­—æ®µ-å€¼æ˜ å°„ | å¯¹è±¡å­˜å‚¨ã€ç”¨æˆ·ä¿¡æ¯ | O(1) |
| **List** | æœ‰åºåˆ—è¡¨ | é˜Ÿåˆ—ã€æ—¶é—´çº¿ | O(1) |
| **Set** | æ— åºé›†åˆ | æ ‡ç­¾ã€å…³æ³¨å…³ç³» | O(1) |
| **Sorted Set** | æœ‰åºé›†åˆ | æ’è¡Œæ¦œã€èŒƒå›´æŸ¥è¯¢ | O(log N) |
| **Stream** | æ¶ˆæ¯æµ | æ¶ˆæ¯é˜Ÿåˆ—ã€äº‹ä»¶æµ | O(1) |
| **Bitmap** | ä½å›¾ | å¸ƒéš†è¿‡æ»¤å™¨ã€ç­¾åˆ° | O(1) |
| **HyperLogLog** | åŸºæ•°ä¼°ç®— | å»é‡ç»Ÿè®¡ | O(1) |

### 2.2. æ•°æ®ç»“æ„é€‰æ‹©åŸåˆ™

**é€‰æ‹©åŸåˆ™**ï¼š

```text
1. ç®€å•æ•°æ® â†’ String
2. å¯¹è±¡æ•°æ® â†’ Hash
3. åˆ—è¡¨æ•°æ® â†’ List
4. é›†åˆæ•°æ® â†’ Set
5. æœ‰åºé›†åˆ â†’ Sorted Set
6. æ¶ˆæ¯æµ â†’ Stream
7. ä½æ“ä½œ â†’ Bitmap
8. åŸºæ•°ç»Ÿè®¡ â†’ HyperLogLog
```

---

## 3. ç¼“å­˜è®¾è®¡æ¨¡å¼

### 3.1. ç¼“å­˜æ¨¡å¼å¯¹æ¯”

**ç¼“å­˜æ¨¡å¼å¯¹æ¯”çŸ©é˜µ**ï¼š

| æ¨¡å¼ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ | ä¼˜ç¼ºç‚¹ |
|------|------|---------|--------|
| **Cache-Aside** | åº”ç”¨å±‚ç®¡ç†ç¼“å­˜ | è¯»å¤šå†™å°‘ | âœ… çµæ´» âŒ ä»£ç å¤æ‚ |
| **Write-Through** | å†™æ—¶åŒæ—¶æ›´æ–°ç¼“å­˜å’Œæ•°æ®åº“ | å†™å¤šè¯»å°‘ | âœ… ä¸€è‡´æ€§ âŒ å†™å…¥æ…¢ |
| **Write-Back** | å…ˆå†™ç¼“å­˜ï¼Œå¼‚æ­¥å†™æ•°æ®åº“ | é«˜å†™å…¥ | âœ… æ€§èƒ½é«˜ âŒ å¯èƒ½ä¸¢æ•°æ® |
| **Read-Through** | ç¼“å­˜è‡ªåŠ¨åŠ è½½æ•°æ® | è¯»å¤šå†™å°‘ | âœ… é€æ˜ âŒ ç¼“å­˜å¤±æ•ˆå¤æ‚ |

### 3.2. Cache-Asideæ¨¡å¼å®ç°

**Cache-Asideæ¨¡å¼Schema**ï¼š

```python
# Pythonç¤ºä¾‹ï¼šCache-Asideæ¨¡å¼
import redis
import json
from typing import Optional, Dict

class CacheAside:
    def __init__(self, redis_client: redis.Redis):
        self.redis = redis_client
        self.cache_ttl = 3600  # 1å°æ—¶

    def get_user(self, user_id: int) -> Optional[Dict]:
        # 1. å…ˆæŸ¥ç¼“å­˜
        cache_key = f"user:{user_id}"
        cached_data = self.redis.get(cache_key)

        if cached_data:
            return json.loads(cached_data)

        # 2. ç¼“å­˜æœªå‘½ä¸­ï¼ŒæŸ¥æ•°æ®åº“
        user_data = self._get_user_from_db(user_id)

        if user_data:
            # 3. å†™å…¥ç¼“å­˜
            self.redis.setex(
                cache_key,
                self.cache_ttl,
                json.dumps(user_data)
            )

        return user_data

    def update_user(self, user_id: int, user_data: Dict):
        # 1. æ›´æ–°æ•°æ®åº“
        self._update_user_in_db(user_id, user_data)

        # 2. åˆ é™¤ç¼“å­˜ï¼ˆæˆ–æ›´æ–°ç¼“å­˜ï¼‰
        cache_key = f"user:{user_id}"
        self.redis.delete(cache_key)
        # æˆ–è€…æ›´æ–°ç¼“å­˜
        # self.redis.setex(cache_key, self.cache_ttl, json.dumps(user_data))

    def _get_user_from_db(self, user_id: int) -> Optional[Dict]:
        # æ•°æ®åº“æŸ¥è¯¢é€»è¾‘
        pass

    def _update_user_in_db(self, user_id: int, user_data: Dict):
        # æ•°æ®åº“æ›´æ–°é€»è¾‘
        pass
```

### 3.3. Write-Throughæ¨¡å¼å®ç°

**Write-Throughæ¨¡å¼Schema**ï¼š

```python
class WriteThrough:
    def __init__(self, redis_client: redis.Redis):
        self.redis = redis_client
        self.cache_ttl = 3600

    def set_user(self, user_id: int, user_data: Dict):
        cache_key = f"user:{user_id}"

        # 1. åŒæ—¶æ›´æ–°ç¼“å­˜å’Œæ•°æ®åº“
        self.redis.setex(
            cache_key,
            self.cache_ttl,
            json.dumps(user_data)
        )
        self._update_user_in_db(user_id, user_data)

    def get_user(self, user_id: int) -> Optional[Dict]:
        cache_key = f"user:{user_id}"
        cached_data = self.redis.get(cache_key)

        if cached_data:
            return json.loads(cached_data)

        # ç¼“å­˜æœªå‘½ä¸­ï¼Œä»æ•°æ®åº“åŠ è½½
        user_data = self._get_user_from_db(user_id)

        if user_data:
            self.redis.setex(
                cache_key,
                self.cache_ttl,
                json.dumps(user_data)
            )

        return user_data
```

---

## 4. Redis Schemaè®¾è®¡

### 4.1. ç”¨æˆ·ä¿¡æ¯å­˜å‚¨è®¾è®¡

**Hashç»“æ„å­˜å‚¨ç”¨æˆ·ä¿¡æ¯**ï¼š

```redis
# ç”¨æˆ·ä¿¡æ¯å­˜å‚¨ï¼ˆHashï¼‰
HSET user:123 username "alice"
HSET user:123 email "alice@example.com"
HSET user:123 age 30
HSET user:123 city "New York"

# æ‰¹é‡è®¾ç½®
HMSET user:123 username "alice" email "alice@example.com" age 30 city "New York"

# è·å–æ‰€æœ‰å­—æ®µ
HGETALL user:123

# è·å–å•ä¸ªå­—æ®µ
HGET user:123 email

# è®¾ç½®è¿‡æœŸæ—¶é—´
EXPIRE user:123 3600
```

**Pythonå®ç°**ï¼š

```python
class UserCache:
    def __init__(self, redis_client: redis.Redis):
        self.redis = redis_client

    def set_user(self, user_id: int, user_data: Dict):
        cache_key = f"user:{user_id}"
        self.redis.hset(cache_key, mapping=user_data)
        self.redis.expire(cache_key, 3600)

    def get_user(self, user_id: int) -> Optional[Dict]:
        cache_key = f"user:{user_id}"
        return self.redis.hgetall(cache_key)

    def get_user_field(self, user_id: int, field: str) -> Optional[str]:
        cache_key = f"user:{user_id}"
        return self.redis.hget(cache_key, field)
```

### 4.2. æ’è¡Œæ¦œè®¾è®¡

**Sorted Setç»“æ„å­˜å‚¨æ’è¡Œæ¦œ**ï¼š

```redis
# æ’è¡Œæ¦œï¼ˆSorted Setï¼‰
ZADD leaderboard:2024-01 1000 "user:123"
ZADD leaderboard:2024-01 2000 "user:456"
ZADD leaderboard:2024-01 1500 "user:789"

# è·å–Top 10
ZREVRANGE leaderboard:2024-01 0 9 WITHSCORES

# è·å–ç”¨æˆ·æ’å
ZREVRANK leaderboard:2024-01 "user:123"

# è·å–ç”¨æˆ·åˆ†æ•°
ZSCORE leaderboard:2024-01 "user:123"

# èŒƒå›´æŸ¥è¯¢ï¼ˆ1000-2000åˆ†ï¼‰
ZRANGEBYSCORE leaderboard:2024-01 1000 2000 WITHSCORES

# å¢åŠ åˆ†æ•°
ZINCRBY leaderboard:2024-01 100 "user:123"
```

**Pythonå®ç°**ï¼š

```python
class Leaderboard:
    def __init__(self, redis_client: redis.Redis):
        self.redis = redis_client

    def add_score(self, leaderboard_key: str, user_id: str, score: float):
        self.redis.zadd(leaderboard_key, {user_id: score})

    def increment_score(self, leaderboard_key: str, user_id: str, increment: float):
        self.redis.zincrby(leaderboard_key, increment, user_id)

    def get_top_n(self, leaderboard_key: str, n: int = 10) -> List[Tuple[str, float]]:
        return self.redis.zrevrange(leaderboard_key, 0, n-1, withscores=True)

    def get_rank(self, leaderboard_key: str, user_id: str) -> Optional[int]:
        rank = self.redis.zrevrank(leaderboard_key, user_id)
        return rank + 1 if rank is not None else None

    def get_score(self, leaderboard_key: str, user_id: str) -> Optional[float]:
        return self.redis.zscore(leaderboard_key, user_id)
```

### 4.3. è´­ç‰©è½¦è®¾è®¡

**Hashç»“æ„å­˜å‚¨è´­ç‰©è½¦**ï¼š

```redis
# è´­ç‰©è½¦ï¼ˆHashï¼‰
HSET cart:user:123 product:456 quantity 2
HSET cart:user:123 product:789 quantity 1

# å¢åŠ å•†å“æ•°é‡
HINCRBY cart:user:123 product:456 quantity 1

# åˆ é™¤å•†å“
HDEL cart:user:123 product:789

# è·å–è´­ç‰©è½¦æ‰€æœ‰å•†å“
HGETALL cart:user:123

# è®¾ç½®è´­ç‰©è½¦è¿‡æœŸæ—¶é—´ï¼ˆ7å¤©ï¼‰
EXPIRE cart:user:123 604800
```

**Pythonå®ç°**ï¼š

```python
class ShoppingCart:
    def __init__(self, redis_client: redis.Redis):
        self.redis = redis_client
        self.cart_ttl = 604800  # 7å¤©

    def add_item(self, user_id: int, product_id: int, quantity: int = 1):
        cart_key = f"cart:user:{user_id}"
        self.redis.hincrby(cart_key, f"product:{product_id}", quantity)
        self.redis.expire(cart_key, self.cart_ttl)

    def remove_item(self, user_id: int, product_id: int):
        cart_key = f"cart:user:{user_id}"
        self.redis.hdel(cart_key, f"product:{product_id}")

    def get_cart(self, user_id: int) -> Dict[str, int]:
        cart_key = f"cart:user:{user_id}"
        cart_data = self.redis.hgetall(cart_key)
        return {k.decode(): int(v) for k, v in cart_data.items()}

    def clear_cart(self, user_id: int):
        cart_key = f"cart:user:{user_id}"
        self.redis.delete(cart_key)
```

### 4.4. è®¡æ•°å™¨è®¾è®¡

**Stringç»“æ„å­˜å‚¨è®¡æ•°å™¨**ï¼š

```redis
# è®¡æ•°å™¨ï¼ˆStringï¼‰
SET counter:page:views:123 0
INCR counter:page:views:123
INCRBY counter:page:views:123 10

# è·å–è®¡æ•°å™¨å€¼
GET counter:page:views:123

# è®¾ç½®è¿‡æœŸæ—¶é—´
EXPIRE counter:page:views:123 86400
```

**Pythonå®ç°**ï¼š

```python
class Counter:
    def __init__(self, redis_client: redis.Redis):
        self.redis = redis_client

    def increment(self, counter_key: str, amount: int = 1) -> int:
        return self.redis.incrby(counter_key, amount)

    def decrement(self, counter_key: str, amount: int = 1) -> int:
        return self.redis.decrby(counter_key, amount)

    def get_value(self, counter_key: str) -> int:
        value = self.redis.get(counter_key)
        return int(value) if value else 0

    def reset(self, counter_key: str):
        self.redis.delete(counter_key)
```

---

## 5. RedisæŒä¹…åŒ–ä¸é«˜å¯ç”¨

### 5.1. æŒä¹…åŒ–ç­–ç•¥

**æŒä¹…åŒ–ç­–ç•¥å¯¹æ¯”**ï¼š

| ç­–ç•¥ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ | ä¼˜ç¼ºç‚¹ |
|------|------|---------|--------|
| **RDB** | å¿«ç…§å¤‡ä»½ | æ•°æ®å¤‡ä»½ | âœ… æ–‡ä»¶å° âŒ å¯èƒ½ä¸¢æ•°æ® |
| **AOF** | è¿½åŠ æ—¥å¿— | æ•°æ®å®‰å…¨ | âœ… ä¸ä¸¢æ•°æ® âŒ æ–‡ä»¶å¤§ |
| **RDB+AOF** | æ··åˆæ¨¡å¼ | ç”Ÿäº§ç¯å¢ƒ | âœ… å…¼é¡¾æ€§èƒ½å’Œå®‰å…¨ |

### 5.2. Redisé…ç½®ç¤ºä¾‹

**Redisé…ç½®æ–‡ä»¶ï¼ˆredis.confï¼‰**ï¼š

```conf
# RDBæŒä¹…åŒ–é…ç½®
save 900 1      # 900ç§’å†…è‡³å°‘1ä¸ªkeyå˜åŒ–
save 300 10     # 300ç§’å†…è‡³å°‘10ä¸ªkeyå˜åŒ–
save 60 10000   # 60ç§’å†…è‡³å°‘10000ä¸ªkeyå˜åŒ–

# AOFæŒä¹…åŒ–é…ç½®
appendonly yes
appendfsync everysec  # æ¯ç§’åŒæ­¥ä¸€æ¬¡

# æ··åˆæŒä¹…åŒ–ï¼ˆRedis 4.0+ï¼‰
aof-use-rdb-preamble yes

# å†…å­˜é™åˆ¶
maxmemory 2gb
maxmemory-policy allkeys-lru  # LRUæ·˜æ±°ç­–ç•¥
```

### 5.3. Redisé«˜å¯ç”¨è®¾è®¡

**Redis Sentinelé…ç½®**ï¼š

```conf
# sentinel.conf
sentinel monitor mymaster 127.0.0.1 6379 2
sentinel down-after-milliseconds mymaster 5000
sentinel failover-timeout mymaster 10000
sentinel parallel-syncs mymaster 1
```

**Redis Clusteré…ç½®**ï¼š

```conf
# cluster.conf
cluster-enabled yes
cluster-config-file nodes.conf
cluster-node-timeout 15000
```

---

## 6. Redisæ€§èƒ½ä¼˜åŒ–

### 6.1. é”®å‘½åè§„èŒƒ

**é”®å‘½åè§„èŒƒ**ï¼š

```text
è§„èŒƒï¼š
1. ä½¿ç”¨å†’å·åˆ†éš”å±‚çº§ï¼šuser:123:profile
2. ä½¿ç”¨æœ‰æ„ä¹‰çš„å‘½åï¼šé¿å…éšæœºå­—ç¬¦ä¸²
3. æ§åˆ¶é”®é•¿åº¦ï¼šé¿å…è¿‡é•¿çš„é”®å
4. ä½¿ç”¨å‘½åç©ºé—´ï¼šapp:module:key

ç¤ºä¾‹ï¼š
âœ… user:123:profile
âœ… session:abc123
âœ… cart:user:123
âŒ u:123:p
âŒ key1234567890abcdef
```

### 6.2. æ‰¹é‡æ“ä½œä¼˜åŒ–

**æ‰¹é‡æ“ä½œç¤ºä¾‹**ï¼š

```python
# âŒ ä¸å¥½çš„åšæ³•ï¼šå¾ªç¯å•ä¸ªæ“ä½œ
for user_id in user_ids:
    redis.get(f"user:{user_id}")

# âœ… å¥½çš„åšæ³•ï¼šä½¿ç”¨Pipelineæ‰¹é‡æ“ä½œ
pipe = redis.pipeline()
for user_id in user_ids:
    pipe.get(f"user:{user_id}")
results = pipe.execute()

# âœ… ä½¿ç”¨MGETæ‰¹é‡è·å–
keys = [f"user:{user_id}" for user_id in user_ids]
results = redis.mget(keys)
```

### 6.3. å†…å­˜ä¼˜åŒ–

**å†…å­˜ä¼˜åŒ–æŠ€å·§**ï¼š

```python
# âœ… ä½¿ç”¨Hashå­˜å‚¨å¤šä¸ªå­—æ®µï¼ˆèŠ‚çœå†…å­˜ï¼‰
redis.hset("user:123", mapping={
    "username": "alice",
    "email": "alice@example.com",
    "age": "30"
})

# âŒ é¿å…ï¼šä½¿ç”¨å¤šä¸ªStringé”®
redis.set("user:123:username", "alice")
redis.set("user:123:email", "alice@example.com")
redis.set("user:123:age", "30")

# âœ… è®¾ç½®åˆç†çš„è¿‡æœŸæ—¶é—´
redis.setex("session:abc123", 3600, session_data)

# âœ… ä½¿ç”¨å‹ç¼©ï¼ˆå¦‚æœRedisæ”¯æŒï¼‰
# å¯¹äºå¤§valueï¼Œè€ƒè™‘å‹ç¼©åå­˜å‚¨
```

---

## 7. å®é™…åº”ç”¨æ¡ˆä¾‹

### 7.1. åˆ†å¸ƒå¼é”è®¾è®¡

**åˆ†å¸ƒå¼é”å®ç°**ï¼š

```python
import time
import uuid

class DistributedLock:
    def __init__(self, redis_client: redis.Redis):
        self.redis = redis_client

    def acquire_lock(self, lock_key: str, timeout: int = 10) -> Optional[str]:
        """
        è·å–åˆ†å¸ƒå¼é”
        è¿”å›ï¼šé”çš„æ ‡è¯†ç¬¦ï¼ˆç”¨äºé‡Šæ”¾é”ï¼‰
        """
        lock_id = str(uuid.uuid4())
        end_time = time.time() + timeout

        while time.time() < end_time:
            # å°è¯•è·å–é”
            if self.redis.set(
                lock_key,
                lock_id,
                nx=True,  # åªåœ¨keyä¸å­˜åœ¨æ—¶è®¾ç½®
                ex=timeout  # è®¾ç½®è¿‡æœŸæ—¶é—´
            ):
                return lock_id

            # ç­‰å¾…ä¸€å°æ®µæ—¶é—´åé‡è¯•
            time.sleep(0.001)

        return None

    def release_lock(self, lock_key: str, lock_id: str) -> bool:
        """
        é‡Šæ”¾åˆ†å¸ƒå¼é”ï¼ˆä½¿ç”¨Luaè„šæœ¬ä¿è¯åŸå­æ€§ï¼‰
        """
        lua_script = """
        if redis.call("get", KEYS[1]) == ARGV[1] then
            return redis.call("del", KEYS[1])
        else
            return 0
        end
        """

        result = self.redis.eval(lua_script, 1, lock_key, lock_id)
        return result == 1

    def __enter__(self):
        lock_id = self.acquire_lock(self.lock_key, self.timeout)
        if not lock_id:
            raise Exception("Failed to acquire lock")
        self.lock_id = lock_id
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        self.release_lock(self.lock_key, self.lock_id)
```

### 7.2. é™æµè®¾è®¡

**é™æµå®ç°ï¼ˆæ»‘åŠ¨çª—å£ï¼‰**ï¼š

```python
class RateLimiter:
    def __init__(self, redis_client: redis.Redis):
        self.redis = redis_client

    def is_allowed(self, key: str, limit: int, window: int) -> bool:
        """
        æ»‘åŠ¨çª—å£é™æµ
        limit: é™åˆ¶æ¬¡æ•°
        window: æ—¶é—´çª—å£ï¼ˆç§’ï¼‰
        """
        current_time = int(time.time())
        window_start = current_time - window + 1

        # ä½¿ç”¨Sorted Setå­˜å‚¨è¯·æ±‚æ—¶é—´æˆ³
        pipe = self.redis.pipeline()
        pipe.zremrangebyscore(key, 0, window_start - 1)  # åˆ é™¤è¿‡æœŸè®°å½•
        pipe.zcard(key)  # è·å–å½“å‰çª—å£å†…çš„è¯·æ±‚æ•°
        pipe.zadd(key, {str(current_time): current_time})  # æ·»åŠ å½“å‰è¯·æ±‚
        pipe.expire(key, window)  # è®¾ç½®è¿‡æœŸæ—¶é—´

        results = pipe.execute()
        current_count = results[1]

        return current_count < limit
```

### 7.3. æ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡

**ç®€å•æ¶ˆæ¯é˜Ÿåˆ—å®ç°**ï¼š

```python
class MessageQueue:
    def __init__(self, redis_client: redis.Redis):
        self.redis = redis_client

    def push(self, queue_name: str, message: str):
        """æ¨é€æ¶ˆæ¯åˆ°é˜Ÿåˆ—"""
        self.redis.lpush(queue_name, message)

    def pop(self, queue_name: str, timeout: int = 0) -> Optional[str]:
        """ä»é˜Ÿåˆ—å¼¹å‡ºæ¶ˆæ¯"""
        if timeout > 0:
            result = self.redis.brpop(queue_name, timeout=timeout)
            return result[1].decode() if result else None
        else:
            result = self.redis.rpop(queue_name)
            return result.decode() if result else None

    def get_length(self, queue_name: str) -> int:
        """è·å–é˜Ÿåˆ—é•¿åº¦"""
        return self.redis.llen(queue_name)
```

---

## 8. 2024-2025æœ€æ–°è¶‹åŠ¿

### 8.1. å†…å­˜æ•°æ®åº“æŠ€æœ¯æ¼”è¿›

```mermaid
timeline
    title å†…å­˜æ•°æ®åº“æ¼”è¿›
    2009 : Redis 1.0å‘å¸ƒ
         : é”®å€¼å­˜å‚¨
    2015 : Redis Cluster
         : åˆ†å¸ƒå¼æ”¯æŒ
    2019 : Redis Streams
         : æ¶ˆæ¯æµ
    2022 : Redis Stack
         : å¤šæ¨¡æ€æ‰©å±•
    2024 : Rediså‘é‡æœç´¢
         : AIåº”ç”¨æ”¯æŒ
    2025 : Serverless Redis
         : è¾¹ç¼˜ç¼“å­˜
```

### 8.2. å†…å­˜æ•°æ®åº“é€‰å‹çŸ©é˜µ

| æ•°æ®åº“ | ç±»å‹ | æŒä¹…åŒ– | å‘é‡æ”¯æŒ | é€‚ç”¨åœºæ™¯ |
|-------|------|--------|---------|---------|
| **Redis** | é”®å€¼+å¤šç»“æ„ | âœ… | Redis Stack | é€šç”¨ç¼“å­˜ |
| **Memcached** | çº¯é”®å€¼ | âŒ | âŒ | ç®€å•ç¼“å­˜ |
| **Dragonfly** | Rediså…¼å®¹ | âœ… | âœ… | é«˜æ€§èƒ½æ›¿ä»£ |
| **KeyDB** | Redisåˆ†æ”¯ | âœ… | âŒ | å¤šçº¿ç¨‹ |
| **Valkey** | Redisåˆ†æ”¯ | âœ… | âœ… | å¼€æºæ›¿ä»£ |

### 8.3. Rediså‘é‡æœç´¢

```python
# Redis Stackå‘é‡æœç´¢ç¤ºä¾‹
import redis
from redis.commands.search.field import VectorField, TextField
from redis.commands.search.indexDefinition import IndexDefinition, IndexType

# åˆ›å»ºå‘é‡ç´¢å¼•
schema = [
    TextField("content"),
    VectorField("embedding",
        "HNSW", {
            "TYPE": "FLOAT32",
            "DIM": 1536,
            "DISTANCE_METRIC": "COSINE"
        }
    )
]

r = redis.Redis()
r.ft("doc_idx").create_index(
    schema,
    definition=IndexDefinition(prefix=["doc:"], index_type=IndexType.HASH)
)

# å‘é‡æœç´¢
query_vector = [0.1, 0.2, ...]  # 1536ç»´
query = f"*=>[KNN 10 @embedding $vec AS score]"
results = r.ft("doc_idx").search(
    query,
    query_params={"vec": np.array(query_vector).tobytes()}
)
```

### 8.4. è¾¹ç¼˜ç¼“å­˜æ¶æ„

```mermaid
flowchart TB
    subgraph è¾¹ç¼˜å±‚
        E1[è¾¹ç¼˜Redis]
        E2[è¾¹ç¼˜Redis]
        E3[è¾¹ç¼˜Redis]
    end

    subgraph åŒºåŸŸå±‚
        R1[åŒºåŸŸRedis Cluster]
    end

    subgraph ä¸­å¿ƒå±‚
        C1[ä¸­å¤®Redis Cluster]
        C2[PostgreSQL]
    end

    E1 --> R1
    E2 --> R1
    E3 --> R1
    R1 --> C1
    C1 --> C2
```

---

## 9. å‚è€ƒèµ„æ–™

### 9.1. æƒå¨æ–‡çŒ®

**å†…å­˜æ•°æ®åº“**ï¼š

- Carlson, J. "Redis in Action"
- Redis Labs "Redis University"

### 9.2. åœ¨çº¿èµ„æº

| èµ„æº | URL | æè¿° |
|------|-----|------|
| **Redisæ–‡æ¡£** | <https://redis.io/docs/> | å®˜æ–¹æ–‡æ¡£ |
| **Redis Stack** | <https://redis.io/docs/stack/> | å¤šæ¨¡æ€æ‰©å±• |
| **Dragonfly** | <https://www.dragonflydb.io/> | é«˜æ€§èƒ½æ›¿ä»£ |

### 9.3. ç›¸å…³æ–‡æ¡£

- [07.08-æ•°æ®åº“æ€§èƒ½è°ƒä¼˜å®æˆ˜](./07.08-æ•°æ®åº“æ€§èƒ½è°ƒä¼˜å®æˆ˜.md)
- [07.17-åˆ†å¸ƒå¼æ•°æ®åº“è®¾è®¡æ¨¡å¼](./07.17-åˆ†å¸ƒå¼æ•°æ®åº“è®¾è®¡æ¨¡å¼.md)
- [07.10-å‘é‡æ•°æ®åº“è®¾è®¡](./07.10-å‘é‡æ•°æ®åº“è®¾è®¡.md)

---

**æœ€åæ›´æ–°**ï¼š2025-12-01
**ç»´æŠ¤è€…**ï¼šData-Science Team
**çŠ¶æ€**ï¼šå·²å®Œæˆ âœ…
**ç‰ˆæœ¬**ï¼šv2.0 (å¢å¼ºç‰ˆ)
