# å…ƒæ¨¡å‹ç†è®ºï¼šæ•°æ®åº“è®¾è®¡çš„å…ƒæ•°æ®å»ºæ¨¡æ¡†æ¶

> **åˆ›å»ºæ—¥æœŸ**ï¼š2025-01-15
> **æœ€åæ›´æ–°**ï¼š2025-12-01
> **ç‰ˆæœ¬**ï¼šv2.0 (å¢å¼ºç‰ˆ)
> **çŠ¶æ€**ï¼šå®æ–½ä¸­

---

## ğŸ“‹ ç›®å½•

- [å…ƒæ¨¡å‹ç†è®ºï¼šæ•°æ®åº“è®¾è®¡çš„å…ƒæ•°æ®å»ºæ¨¡æ¡†æ¶](#å…ƒæ¨¡å‹ç†è®ºæ•°æ®åº“è®¾è®¡çš„å…ƒæ•°æ®å»ºæ¨¡æ¡†æ¶)
  - [ğŸ“‹ ç›®å½•](#-ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1. å…ƒæ¨¡å‹çš„ä»·å€¼](#11-å…ƒæ¨¡å‹çš„ä»·å€¼)
    - [1.2. å…ƒæ¨¡å‹å±‚æ¬¡ç»“æ„](#12-å…ƒæ¨¡å‹å±‚æ¬¡ç»“æ„)
  - [2. å…ƒæ¨¡å‹åŸºç¡€](#2-å…ƒæ¨¡å‹åŸºç¡€)
    - [2.1. å…ƒæ¨¡å‹å®šä¹‰](#21-å…ƒæ¨¡å‹å®šä¹‰)
    - [2.2. å…ƒæ¨¡å‹æ ¸å¿ƒæ¦‚å¿µ](#22-å…ƒæ¨¡å‹æ ¸å¿ƒæ¦‚å¿µ)
    - [2.3. å…ƒæ¨¡å‹é€‰æ‹©å†³ç­–æ ‘](#23-å…ƒæ¨¡å‹é€‰æ‹©å†³ç­–æ ‘)
  - [3. æ•°æ®åº“å…ƒæ¨¡å‹](#3-æ•°æ®åº“å…ƒæ¨¡å‹)
    - [3.1. æ•°æ®åº“å…ƒæ¨¡å‹ç»“æ„](#31-æ•°æ®åº“å…ƒæ¨¡å‹ç»“æ„)
    - [3.2. å…ƒæ¨¡å‹å…³ç³»å›¾](#32-å…ƒæ¨¡å‹å…³ç³»å›¾)
    - [3.3. å…ƒæ¨¡å‹çº¦æŸè§„åˆ™](#33-å…ƒæ¨¡å‹çº¦æŸè§„åˆ™)
    - [3.4. å…ƒæ¨¡å‹éªŒè¯å†³ç­–æ ‘](#34-å…ƒæ¨¡å‹éªŒè¯å†³ç­–æ ‘)
  - [4. å…ƒæ¨¡å‹åº”ç”¨](#4-å…ƒæ¨¡å‹åº”ç”¨)
    - [4.1. Schemaè‡ªåŠ¨ç”Ÿæˆ](#41-schemaè‡ªåŠ¨ç”Ÿæˆ)
    - [4.2. æ¨¡å‹è½¬æ¢](#42-æ¨¡å‹è½¬æ¢)
    - [4.3. çº¦æŸéªŒè¯](#43-çº¦æŸéªŒè¯)
  - [5. å…ƒæ•°æ®ç®¡ç†](#5-å…ƒæ•°æ®ç®¡ç†)
    - [5.1. å…ƒæ•°æ®å­˜å‚¨](#51-å…ƒæ•°æ®å­˜å‚¨)
    - [5.2. å…ƒæ•°æ®æŸ¥è¯¢](#52-å…ƒæ•°æ®æŸ¥è¯¢)
    - [5.3. å…ƒæ•°æ®ç®¡ç†å†³ç­–æ ‘](#53-å…ƒæ•°æ®ç®¡ç†å†³ç­–æ ‘)
  - [6. MOFå½¢å¼åŒ–å®šä¹‰](#6-mofå½¢å¼åŒ–å®šä¹‰)
    - [6.1. MOFå››å±‚æ¶æ„å½¢å¼åŒ–](#61-mofå››å±‚æ¶æ„å½¢å¼åŒ–)
    - [6.2. èŒƒç•´è®ºè¡¨è¾¾](#62-èŒƒç•´è®ºè¡¨è¾¾)
  - [7. 2024-2025æœ€æ–°è¶‹åŠ¿](#7-2024-2025æœ€æ–°è¶‹åŠ¿)
    - [7.1. ç°ä»£å…ƒæ•°æ®ç®¡ç†å¹³å°](#71-ç°ä»£å…ƒæ•°æ®ç®¡ç†å¹³å°)
    - [7.2. å…ƒæ•°æ®è‡ªåŠ¨å‘ç°è¶‹åŠ¿](#72-å…ƒæ•°æ®è‡ªåŠ¨å‘ç°è¶‹åŠ¿)
  - [8. å‚è€ƒèµ„æ–™](#8-å‚è€ƒèµ„æ–™)
    - [8.1. æƒå¨æ–‡çŒ®](#81-æƒå¨æ–‡çŒ®)
    - [8.2. åœ¨çº¿èµ„æº](#82-åœ¨çº¿èµ„æº)
    - [8.3. ç›¸å…³æ–‡æ¡£](#83-ç›¸å…³æ–‡æ¡£)

---

## 1. æ¦‚è¿°

å…ƒæ¨¡å‹æ˜¯"æ¨¡å‹çš„æ¨¡å‹"ï¼Œç”¨äºæè¿°å’Œå®šä¹‰æ•°æ®åº“ç»“æ„ã€çº¦æŸå’Œè¡Œä¸ºçš„æŠ½è±¡æ¡†æ¶ã€‚

### 1.1. å…ƒæ¨¡å‹çš„ä»·å€¼

1. **ç»Ÿä¸€å»ºæ¨¡**ï¼šæä¾›ç»Ÿä¸€çš„å»ºæ¨¡è¯­è¨€å’Œæ¡†æ¶
2. **è‡ªåŠ¨ç”Ÿæˆ**ï¼šåŸºäºå…ƒæ¨¡å‹è‡ªåŠ¨ç”ŸæˆSchema
3. **æ¨¡å‹è½¬æ¢**ï¼šåœ¨ä¸åŒæ¨¡å‹é—´è½¬æ¢
4. **çº¦æŸéªŒè¯**ï¼šè‡ªåŠ¨éªŒè¯æ¨¡å‹çº¦æŸ
5. **æ–‡æ¡£ç”Ÿæˆ**ï¼šè‡ªåŠ¨ç”ŸæˆæŠ€æœ¯æ–‡æ¡£

### 1.2. å…ƒæ¨¡å‹å±‚æ¬¡ç»“æ„

```mermaid
mindmap
  root((å…ƒæ¨¡å‹å±‚æ¬¡))
    M0å±‚-å®ä¾‹æ•°æ®
      å®é™…æ•°æ®
      ä¸šåŠ¡è®°å½•
      è¿è¡Œæ—¶æ•°æ®
    M1å±‚-æ¨¡å‹
      æ•°æ®åº“Schema
      è¡¨å®šä¹‰
      çº¦æŸå®šä¹‰
    M2å±‚-å…ƒæ¨¡å‹
      å…ƒæ•°æ®Schema
      å»ºæ¨¡è¯­è¨€
      å»ºæ¨¡è§„åˆ™
    M3å±‚-å…ƒå…ƒæ¨¡å‹
      å…ƒæ¨¡å‹å®šä¹‰
      è¯­è¨€å®šä¹‰
      è§„åˆ™å®šä¹‰
```

---

## 2. å…ƒæ¨¡å‹åŸºç¡€

### 2.1. å…ƒæ¨¡å‹å®šä¹‰

**å…ƒæ¨¡å‹ï¼ˆMetamodelï¼‰**ï¼šç”¨äºæè¿°æ¨¡å‹çš„ç»“æ„ã€è¯­ä¹‰å’Œçº¦æŸçš„æ¨¡å‹ã€‚

**å››å±‚æ¶æ„ï¼ˆMOF - Meta Object Facilityï¼‰**ï¼š

```text
M3å±‚ï¼šå…ƒå…ƒæ¨¡å‹ï¼ˆMeta-metamodelï¼‰
  â””â”€ å®šä¹‰å…ƒæ¨¡å‹çš„è¯­è¨€

M2å±‚ï¼šå…ƒæ¨¡å‹ï¼ˆMetamodelï¼‰
  â””â”€ å®šä¹‰æ¨¡å‹çš„è¯­è¨€ï¼ˆå¦‚UMLã€ERæ¨¡å‹ï¼‰

M1å±‚ï¼šæ¨¡å‹ï¼ˆModelï¼‰
  â””â”€ å…·ä½“çš„æ•°æ®åº“Schema

M0å±‚ï¼šå®ä¾‹ï¼ˆInstanceï¼‰
  â””â”€ å®é™…çš„æ•°æ®è®°å½•
```

### 2.2. å…ƒæ¨¡å‹æ ¸å¿ƒæ¦‚å¿µ

**æ ¸å¿ƒå…ƒç´ **ï¼š

1. **å…ƒç±»ï¼ˆMetaclassï¼‰**ï¼šå®šä¹‰æ¨¡å‹å…ƒç´ çš„ç±»å‹
2. **å…ƒå±æ€§ï¼ˆMetaattributeï¼‰**ï¼šå®šä¹‰æ¨¡å‹å…ƒç´ çš„å±æ€§
3. **å…ƒå…³ç³»ï¼ˆMetarelationï¼‰**ï¼šå®šä¹‰æ¨¡å‹å…ƒç´ é—´çš„å…³ç³»
4. **å…ƒçº¦æŸï¼ˆMetaconstraintï¼‰**ï¼šå®šä¹‰æ¨¡å‹å…ƒç´ çš„çº¦æŸ

**å…ƒæ¨¡å‹ç¤ºä¾‹**ï¼š

```text
å…ƒæ¨¡å‹ï¼šæ•°æ®åº“Schemaå…ƒæ¨¡å‹

å…ƒç±»ï¼š
  - Tableï¼ˆè¡¨ï¼‰
  - Columnï¼ˆåˆ—ï¼‰
  - Keyï¼ˆé”®ï¼‰
  - Constraintï¼ˆçº¦æŸï¼‰
  - Indexï¼ˆç´¢å¼•ï¼‰

å…ƒå±æ€§ï¼š
  - Table: name, columns, constraints
  - Column: name, type, nullable, default
  - Key: name, columns, type

å…ƒå…³ç³»ï¼š
  - Table contains Column
  - Table has Key
  - Column belongs to Table
  - Key references Column

å…ƒçº¦æŸï¼š
  - Tableå¿…é¡»æœ‰è‡³å°‘ä¸€ä¸ªColumn
  - Primary Keyçš„Columnä¸èƒ½ä¸ºNULL
  - Foreign Keyå¿…é¡»å¼•ç”¨å­˜åœ¨çš„Table
```

### 2.3. å…ƒæ¨¡å‹é€‰æ‹©å†³ç­–æ ‘

```mermaid
flowchart TD
    A[é€‰æ‹©å…ƒæ¨¡å‹] --> B{åº”ç”¨åœºæ™¯}

    B -->|æ•°æ®åº“è®¾è®¡| C[æ•°æ®åº“å…ƒæ¨¡å‹]
    B -->|UMLå»ºæ¨¡| D[UMLå…ƒæ¨¡å‹]
    B -->|ERå»ºæ¨¡| E[ERå…ƒæ¨¡å‹]
    B -->|é€šç”¨å»ºæ¨¡| F[MOFå…ƒæ¨¡å‹]

    C --> G[å®šä¹‰æ•°æ®åº“ç»“æ„]
    D --> H[å®šä¹‰UMLå›¾]
    E --> I[å®šä¹‰ERå›¾]
    F --> J[å®šä¹‰é€šç”¨æ¨¡å‹]

    G --> K[ç”ŸæˆDDL]
    H --> L[ç”Ÿæˆä»£ç ]
    I --> M[ç”ŸæˆSchema]
    J --> N[æ¨¡å‹è½¬æ¢]
```

---

## 3. æ•°æ®åº“å…ƒæ¨¡å‹

### 3.1. æ•°æ®åº“å…ƒæ¨¡å‹ç»“æ„

**æ ¸å¿ƒå…ƒç±»å®šä¹‰**ï¼š

```text
DatabaseSchema {
    name: String
    tables: Table[]
    views: View[]
    procedures: Procedure[]
}

Table {
    name: String
    schema: DatabaseSchema
    columns: Column[]
    keys: Key[]
    constraints: Constraint[]
    indexes: Index[]
}

Column {
    name: String
    table: Table
    dataType: DataType
    nullable: Boolean
    defaultValue: Value
    constraints: Constraint[]
}

Key {
    name: String
    table: Table
    columns: Column[]
    type: KeyType  // PRIMARY, FOREIGN, UNIQUE
    referencedTable: Table?  // for FOREIGN KEY
}

Constraint {
    name: String
    table: Table
    type: ConstraintType  // CHECK, NOT NULL, UNIQUE
    expression: Expression
}

Index {
    name: String
    table: Table
    columns: Column[]
    unique: Boolean
    type: IndexType  // B-TREE, HASH, etc.
}
```

### 3.2. å…ƒæ¨¡å‹å…³ç³»å›¾

```mermaid
erDiagram
    DatabaseSchema ||--o{ Table : contains
    DatabaseSchema ||--o{ View : contains
    DatabaseSchema ||--o{ Procedure : contains

    Table ||--o{ Column : contains
    Table ||--o{ Key : has
    Table ||--o{ Constraint : has
    Table ||--o{ Index : has

    Key }o--o{ Column : references
    Index }o--o{ Column : indexes
    Constraint }o--o{ Column : constrains

    Key }o--o| Table : "references (FK)"
```

### 3.3. å…ƒæ¨¡å‹çº¦æŸè§„åˆ™

**çº¦æŸè§„åˆ™å®šä¹‰**ï¼š

```text
è§„åˆ™1ï¼šè¡¨å®Œæ•´æ€§
  âˆ€ t âˆˆ Table: |t.columns| > 0
  "æ¯ä¸ªè¡¨å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªåˆ—"

è§„åˆ™2ï¼šä¸»é”®å”¯ä¸€æ€§
  âˆ€ t âˆˆ Table: |{k âˆˆ t.keys | k.type = PRIMARY}| â‰¤ 1
  "æ¯ä¸ªè¡¨æœ€å¤šæœ‰ä¸€ä¸ªä¸»é”®"

è§„åˆ™3ï¼šå¤–é”®å¼•ç”¨å®Œæ•´æ€§
  âˆ€ k âˆˆ Key:
    k.type = FOREIGN âŸ¹
      k.referencedTable â‰  null âˆ§
      k.columns.length = k.referencedTable.primaryKey.columns.length
  "å¤–é”®å¿…é¡»å¼•ç”¨å­˜åœ¨çš„è¡¨ï¼Œä¸”åˆ—æ•°åŒ¹é…"

è§„åˆ™4ï¼šåˆ—ç±»å‹ä¸€è‡´æ€§
  âˆ€ c âˆˆ Column:
    c.defaultValue.type = c.dataType
  "é»˜è®¤å€¼ç±»å‹å¿…é¡»ä¸åˆ—ç±»å‹ä¸€è‡´"
```

### 3.4. å…ƒæ¨¡å‹éªŒè¯å†³ç­–æ ‘

```mermaid
flowchart TD
    A[å…ƒæ¨¡å‹éªŒè¯] --> B[éªŒè¯è¡¨å®Œæ•´æ€§]
    B --> C{æ‰€æœ‰è¡¨æœ‰åˆ—?}
    C -->|å¦| D[éªŒè¯å¤±è´¥]
    C -->|æ˜¯| E[éªŒè¯é”®å®Œæ•´æ€§]

    E --> F{ä¸»é”®å”¯ä¸€?}
    F -->|å¦| D
    F -->|æ˜¯| G[éªŒè¯å¤–é”®å¼•ç”¨]

    G --> H{å¤–é”®æœ‰æ•ˆ?}
    H -->|å¦| D
    H -->|æ˜¯| I[éªŒè¯çº¦æŸ]

    I --> J{çº¦æŸæœ‰æ•ˆ?}
    J -->|å¦| D
    J -->|æ˜¯| K[éªŒè¯å®Œæˆ]
```

---

## 4. å…ƒæ¨¡å‹åº”ç”¨

### 4.1. Schemaè‡ªåŠ¨ç”Ÿæˆ

**åŸºäºå…ƒæ¨¡å‹ç”ŸæˆDDL**ï¼š

```text
ç®—æ³•ï¼šå…ƒæ¨¡å‹åˆ°DDLè½¬æ¢
è¾“å…¥ï¼šDatabaseSchemaå…ƒæ¨¡å‹å®ä¾‹
è¾“å‡ºï¼šDDLè¯­å¥

æ­¥éª¤ï¼š
1. å¯¹äºæ¯ä¸ªTable tï¼š
   ç”Ÿæˆ CREATE TABLE t.name (

2. å¯¹äºæ¯ä¸ªColumn c âˆˆ t.columnsï¼š
   ç”Ÿæˆ c.name c.dataType [NOT NULL] [DEFAULT c.defaultValue]

3. å¯¹äºæ¯ä¸ªKey k âˆˆ t.keysï¼š
   å¦‚æœ k.type = PRIMARYï¼š
     ç”Ÿæˆ PRIMARY KEY (k.columns)
   å¦‚æœ k.type = FOREIGNï¼š
     ç”Ÿæˆ FOREIGN KEY (k.columns) REFERENCES k.referencedTable

4. ç”Ÿæˆ );
```

**Pythonå®ç°ç¤ºä¾‹**ï¼š

```python
class Column:
    def __init__(self, name, data_type, nullable=True, default=None):
        self.name = name
        self.data_type = data_type
        self.nullable = nullable
        self.default = default

    def to_ddl(self):
        ddl = f"{self.name} {self.data_type}"
        if not self.nullable:
            ddl += " NOT NULL"
        if self.default:
            ddl += f" DEFAULT {self.default}"
        return ddl

class Table:
    def __init__(self, name, columns, primary_key=None, foreign_keys=None):
        self.name = name
        self.columns = columns
        self.primary_key = primary_key
        self.foreign_keys = foreign_keys or []

    def to_ddl(self):
        ddl_parts = []

        # CREATE TABLE
        ddl_parts.append(f"CREATE TABLE {self.name} (")

        # Columns
        column_ddls = [col.to_ddl() for col in self.columns]
        ddl_parts.append("    " + ",\n    ".join(column_ddls))

        # Primary Key
        if self.primary_key:
            pk_cols = ", ".join(self.primary_key)
            ddl_parts.append(f",\n    PRIMARY KEY ({pk_cols})")

        # Foreign Keys
        for fk in self.foreign_keys:
            fk_cols = ", ".join(fk['columns'])
            ref_table = fk['references']
            ref_cols = ", ".join(fk.get('referenced_columns', fk['columns']))
            ddl_parts.append(f",\n    FOREIGN KEY ({fk_cols}) REFERENCES {ref_table}({ref_cols})")

        ddl_parts.append("\n);")

        return "\n".join(ddl_parts)

# ä½¿ç”¨ç¤ºä¾‹
users_table = Table(
    name="users",
    columns=[
        Column("id", "SERIAL", nullable=False),
        Column("username", "VARCHAR(50)", nullable=False),
        Column("email", "VARCHAR(100)", nullable=False),
        Column("created_at", "TIMESTAMP", default="CURRENT_TIMESTAMP")
    ],
    primary_key=["id"]
)

print(users_table.to_ddl())
# è¾“å‡ºï¼š
# CREATE TABLE users (
#     id SERIAL NOT NULL,
#     username VARCHAR(50) NOT NULL,
#     email VARCHAR(100) NOT NULL,
#     created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
#     PRIMARY KEY (id)
# );
```

**ç”Ÿæˆç¤ºä¾‹**ï¼š

```sql
-- å…ƒæ¨¡å‹å®šä¹‰
Table: Users {
    columns: [
        Column(name: "id", type: INTEGER, nullable: false),
        Column(name: "username", type: VARCHAR(50), nullable: false),
        Column(name: "email", type: VARCHAR(100), nullable: false)
    ],
    keys: [
        Key(name: "pk_users", type: PRIMARY, columns: ["id"])
    ]
}

-- ç”Ÿæˆçš„DDL
CREATE TABLE Users (
    id INTEGER NOT NULL,
    username VARCHAR(50) NOT NULL,
    email VARCHAR(100) NOT NULL,
    PRIMARY KEY (id)
);
```

### 4.2. æ¨¡å‹è½¬æ¢

**å…ƒæ¨¡å‹é—´è½¬æ¢**ï¼š

```mermaid
flowchart TD
    A[æºå…ƒæ¨¡å‹] --> B[å…ƒæ¨¡å‹æ˜ å°„]
    B --> C[ç›®æ ‡å…ƒæ¨¡å‹]

    C --> D{è½¬æ¢ç±»å‹}
    D -->|ERåˆ°å…³ç³»| E[è¡¨ç”Ÿæˆ]
    D -->|UMLåˆ°å…³ç³»| F[ç±»æ˜ å°„è¡¨]
    D -->|å…³ç³»åˆ°æ–‡æ¡£| G[åµŒå¥—ç»“æ„]

    E --> H[è½¬æ¢å®Œæˆ]
    F --> H
    G --> H
```

**è½¬æ¢è§„åˆ™ç¤ºä¾‹**ï¼š

```text
ERæ¨¡å‹ â†’ å…³ç³»æ¨¡å‹è½¬æ¢è§„åˆ™ï¼š

è§„åˆ™1ï¼šå®ä½“è½¬è¡¨
  Entity E â†’ Table T
  T.name = E.name
  T.columns = E.attributes

è§„åˆ™2ï¼šå…³ç³»è½¬è¡¨ï¼ˆM:Nï¼‰
  Relationship R (M:N) â†’ Table T
  T.name = R.name
  T.columns = [FK1, FK2, R.attributes]
  T.foreignKeys = [FK1 â†’ E1, FK2 â†’ E2]

è§„åˆ™3ï¼šå…³ç³»è½¬å¤–é”®ï¼ˆ1:Nï¼‰
  Relationship R (1:N) â†’ Foreign Key FK
  FK.table = R.manySide
  FK.references = R.oneSide
```

### 4.3. çº¦æŸéªŒè¯

**åŸºäºå…ƒæ¨¡å‹çš„çº¦æŸéªŒè¯**ï¼š

```text
ç®—æ³•ï¼šçº¦æŸéªŒè¯
è¾“å…¥ï¼šå…ƒæ¨¡å‹å®ä¾‹ Mï¼Œæ•°æ®å®ä¾‹ I
è¾“å‡ºï¼šéªŒè¯ç»“æœ

æ­¥éª¤ï¼š
1. å¯¹äºæ¯ä¸ªçº¦æŸè§„åˆ™ r âˆˆ M.constraintsï¼š
   éªŒè¯ r åœ¨ I ä¸Šæ˜¯å¦æ»¡è¶³

2. å¯¹äºæ¯ä¸ªè¡¨ t âˆˆ M.tablesï¼š
   éªŒè¯ t çš„å®Œæ•´æ€§çº¦æŸ

3. å¯¹äºæ¯ä¸ªå¤–é”® fk âˆˆ M.foreignKeysï¼š
   éªŒè¯ fk çš„å¼•ç”¨å®Œæ•´æ€§

4. è¿”å›éªŒè¯ç»“æœ
```

---

## 5. å…ƒæ•°æ®ç®¡ç†

### 5.1. å…ƒæ•°æ®å­˜å‚¨

**å…ƒæ•°æ®å­˜å‚¨ç­–ç•¥**ï¼š

| ç­–ç•¥ | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| **æ•°æ®åº“ç³»ç»Ÿè¡¨** | é›†æˆå¥½ï¼ŒæŸ¥è¯¢æ–¹ä¾¿ | ä¾èµ–æ•°æ®åº“ | å•ä¸€æ•°æ®åº“ |
| **ç‹¬ç«‹å…ƒæ•°æ®åº“** | ç‹¬ç«‹ç®¡ç†ï¼Œè·¨æ•°æ®åº“ | éœ€è¦åŒæ­¥ | å¤šæ•°æ®åº“ç¯å¢ƒ |
| **æ–‡ä»¶å­˜å‚¨** | ç®€å•ï¼Œç‰ˆæœ¬æ§åˆ¶ | æŸ¥è¯¢ä¸ä¾¿ | å°å‹é¡¹ç›® |
| **å…ƒæ•°æ®ä»“åº“** | ç»Ÿä¸€ç®¡ç†ï¼Œåˆ†ææ–¹ä¾¿ | å¤æ‚ | å¤§å‹ä¼ä¸š |

### 5.2. å…ƒæ•°æ®æŸ¥è¯¢

**å…ƒæ•°æ®æŸ¥è¯¢ç¤ºä¾‹**ï¼š

```sql
-- PostgreSQLç³»ç»Ÿè¡¨æŸ¥è¯¢
-- æŸ¥è¯¢æ‰€æœ‰è¡¨
SELECT table_name
FROM information_schema.tables
WHERE table_schema = 'public';

-- æŸ¥è¯¢è¡¨çš„æ‰€æœ‰åˆ—
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_name = 'users';

-- æŸ¥è¯¢å¤–é”®å…³ç³»
SELECT
    tc.table_name,
    kcu.column_name,
    ccu.table_name AS foreign_table_name,
    ccu.column_name AS foreign_column_name
FROM information_schema.table_constraints AS tc
JOIN information_schema.key_column_usage AS kcu
    ON tc.constraint_name = kcu.constraint_name
JOIN information_schema.constraint_column_usage AS ccu
    ON ccu.constraint_name = tc.constraint_name
WHERE tc.constraint_type = 'FOREIGN KEY';
```

**å®Œæ•´çš„Schemaå¯¼å‡ºå‡½æ•°**ï¼š

```sql
-- å¯¼å‡ºå®Œæ•´Schemaå…ƒæ•°æ®
CREATE OR REPLACE FUNCTION export_schema_metadata(p_schema_name TEXT DEFAULT 'public')
RETURNS TABLE (
    table_name TEXT,
    column_name TEXT,
    data_type TEXT,
    is_nullable TEXT,
    column_default TEXT,
    is_primary_key BOOLEAN,
    is_foreign_key BOOLEAN,
    foreign_table TEXT,
    foreign_column TEXT
) AS $$
BEGIN
    RETURN QUERY
    SELECT
        t.table_name::TEXT,
        c.column_name::TEXT,
        c.data_type::TEXT,
        c.is_nullable::TEXT,
        c.column_default::TEXT,
        COALESCE(pk.is_pk, FALSE) AS is_primary_key,
        COALESCE(fk.is_fk, FALSE) AS is_foreign_key,
        fk.ref_table::TEXT,
        fk.ref_column::TEXT
    FROM information_schema.tables t
    JOIN information_schema.columns c
        ON t.table_schema = c.table_schema
        AND t.table_name = c.table_name
    LEFT JOIN (
        SELECT
            kcu.table_name,
            kcu.column_name,
            TRUE AS is_pk
        FROM information_schema.table_constraints tc
        JOIN information_schema.key_column_usage kcu
            ON tc.constraint_name = kcu.constraint_name
        WHERE tc.constraint_type = 'PRIMARY KEY'
    ) pk ON t.table_name = pk.table_name AND c.column_name = pk.column_name
    LEFT JOIN (
        SELECT
            kcu.table_name,
            kcu.column_name,
            TRUE AS is_fk,
            ccu.table_name AS ref_table,
            ccu.column_name AS ref_column
        FROM information_schema.table_constraints tc
        JOIN information_schema.key_column_usage kcu
            ON tc.constraint_name = kcu.constraint_name
        JOIN information_schema.constraint_column_usage ccu
            ON ccu.constraint_name = tc.constraint_name
        WHERE tc.constraint_type = 'FOREIGN KEY'
    ) fk ON t.table_name = fk.table_name AND c.column_name = fk.column_name
    WHERE t.table_schema = p_schema_name
    ORDER BY t.table_name, c.ordinal_position;
END;
$$ LANGUAGE plpgsql;

-- ä½¿ç”¨ç¤ºä¾‹
SELECT * FROM export_schema_metadata('public');
```

**Pythonå…ƒæ•°æ®æå–å·¥å…·**ï¼š

```python
import psycopg2
from dataclasses import dataclass
from typing import List, Optional

@dataclass
class Column:
    name: str
    data_type: str
    nullable: bool
    default: Optional[str]
    is_primary_key: bool
    is_foreign_key: bool
    foreign_table: Optional[str] = None
    foreign_column: Optional[str] = None

@dataclass
class Table:
    name: str
    columns: List[Column]

class SchemaExtractor:
    def __init__(self, connection):
        self.conn = connection

    def extract_schema(self, schema_name='public'):
        """æå–å®Œæ•´Schemaå…ƒæ•°æ®"""
        with self.conn.cursor() as cur:
            cur.execute("""
                SELECT * FROM export_schema_metadata(%s)
            """, (schema_name,))

            tables = {}
            for row in cur.fetchall():
                table_name = row[0]
                if table_name not in tables:
                    tables[table_name] = Table(name=table_name, columns=[])

                column = Column(
                    name=row[1],
                    data_type=row[2],
                    nullable=row[3] == 'YES',
                    default=row[4],
                    is_primary_key=row[5],
                    is_foreign_key=row[6],
                    foreign_table=row[7],
                    foreign_column=row[8]
                )
                tables[table_name].columns.append(column)

            return list(tables.values())

    def generate_erd(self, schema_name='public'):
        """ç”ŸæˆERå›¾ï¼ˆMermaidæ ¼å¼ï¼‰"""
        tables = self.extract_schema(schema_name)

        erd = ["erDiagram"]

        for table in tables:
            erd.append(f"    {table.name} {{")
            for col in table.columns:
                col_type = col.data_type.upper()
                pk_marker = " PK" if col.is_primary_key else ""
                fk_marker = f" FK" if col.is_foreign_key else ""
                erd.append(f"        {col_type} {col.name}{pk_marker}{fk_marker}")
            erd.append("    }")

        # æ·»åŠ å…³ç³»
        for table in tables:
            for col in table.columns:
                if col.is_foreign_key and col.foreign_table:
                    erd.append(
                        f"    {col.foreign_table} ||--o{{ {table.name} : \"{col.name}\""
                    )

        return "\n".join(erd)

# ä½¿ç”¨ç¤ºä¾‹
conn = psycopg2.connect("dbname=mydb user=postgres")
extractor = SchemaExtractor(conn)
schema = extractor.extract_schema()
erd = extractor.generate_erd()
print(erd)
```

### 5.3. å…ƒæ•°æ®ç®¡ç†å†³ç­–æ ‘

```mermaid
flowchart TD
    A[å…ƒæ•°æ®ç®¡ç†] --> B{ç®¡ç†éœ€æ±‚}

    B -->|ç®€å•æŸ¥è¯¢| C[ä½¿ç”¨ç³»ç»Ÿè¡¨]
    B -->|å¤æ‚åˆ†æ| D[å…ƒæ•°æ®ä»“åº“]
    B -->|ç‰ˆæœ¬æ§åˆ¶| E[æ–‡ä»¶å­˜å‚¨]
    B -->|è·¨æ•°æ®åº“| F[ç‹¬ç«‹å…ƒæ•°æ®åº“]

    C --> G[ç›´æ¥æŸ¥è¯¢]
    D --> H[ETLåˆ°ä»“åº“]
    E --> I[Gitç®¡ç†]
    F --> J[åŒæ­¥æœºåˆ¶]

    G --> K[ç®¡ç†å®Œæˆ]
    H --> K
    I --> K
    J --> K
```

---

## 6. MOFå½¢å¼åŒ–å®šä¹‰

### 6.1. MOFå››å±‚æ¶æ„å½¢å¼åŒ–

**å®šä¹‰6.1.1ï¼ˆMOFæ¶æ„ï¼‰**ï¼š

MOF (Meta Object Facility) æ¶æ„æ˜¯ä¸€ä¸ªå››å±‚å…ƒå»ºæ¨¡ä½“ç³»ï¼š

```text
è®¾ MOF = (Mâ‚€, Mâ‚, Mâ‚‚, Mâ‚ƒ, Î¹) å…¶ä¸­ï¼š

Mâ‚ƒ: å…ƒå…ƒæ¨¡å‹å±‚ï¼ˆMeta-metamodelï¼‰
  Mâ‚ƒ = {Class, Attribute, Association, Package, ...}
  å®šä¹‰å…ƒæ¨¡å‹çš„è¯­è¨€

Mâ‚‚: å…ƒæ¨¡å‹å±‚ï¼ˆMetamodelï¼‰
  Mâ‚‚ âŠ† instance_of(Mâ‚ƒ)
  ä¾‹å¦‚ï¼šUMLã€ERæ¨¡å‹ã€æ•°æ®åº“Schemaå…ƒæ¨¡å‹

Mâ‚: æ¨¡å‹å±‚ï¼ˆModelï¼‰
  Mâ‚ âŠ† instance_of(Mâ‚‚)
  ä¾‹å¦‚ï¼šå…·ä½“çš„æ•°æ®åº“Schema

Mâ‚€: å®ä¾‹å±‚ï¼ˆInstanceï¼‰
  Mâ‚€ âŠ† instance_of(Mâ‚)
  ä¾‹å¦‚ï¼šå®é™…æ•°æ®è®°å½•

Î¹: Máµ¢ â†’ Máµ¢â‚Šâ‚ å®ä¾‹åŒ–å…³ç³»
```

### 6.2. èŒƒç•´è®ºè¡¨è¾¾

**å®šä¹‰6.2.1ï¼ˆSchemaèŒƒç•´ï¼‰**ï¼š

æ•°æ®åº“Schemaå¯ä»¥è¡¨ç¤ºä¸ºèŒƒç•´ ğ’®ï¼š

```text
èŒƒç•´ ğ’® = (Ob, Mor, âˆ˜, id) å…¶ä¸­ï¼š

Ob: å¯¹è±¡é›†åˆï¼ˆè¡¨/å®ä½“ï¼‰
  Ob = {Tableâ‚, Tableâ‚‚, ..., Tableâ‚™}

Mor: æ€å°„é›†åˆï¼ˆå¤–é”®å…³ç³»ï¼‰
  Mor(A, B) = {f: A â†’ B | f æ˜¯å¤–é”®å¼•ç”¨}

âˆ˜: æ€å°„å¤åˆï¼ˆä¼ é€’å…³ç³»ï¼‰
  g âˆ˜ f: A â†’ C å½“ f: A â†’ B, g: B â†’ C

id: æ’ç­‰æ€å°„
  idâ‚: A â†’ A å¯¹äºæ‰€æœ‰ A âˆˆ Ob
```

**ç¤ºä¾‹ï¼šç”µå•†SchemaèŒƒç•´**ï¼š

```mermaid
flowchart LR
    subgraph å¯¹è±¡
        U[Users]
        O[Orders]
        I[OrderItems]
        P[Products]
    end

    subgraph æ€å°„
        U -->|user_id| O
        O -->|order_id| I
        P -->|product_id| I
    end
```

---

## 7. 2024-2025æœ€æ–°è¶‹åŠ¿

### 7.1. ç°ä»£å…ƒæ•°æ®ç®¡ç†å¹³å°

| å¹³å° | ç±»å‹ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|------|---------|
| **DataHub** | å¼€æº | LinkedInå‡ºå“ã€å›¾è°± | å¤§å‹ä¼ä¸š |
| **OpenMetadata** | å¼€æº | ç°ä»£åŒ–ã€APIä¼˜å…ˆ | ä¸­å°å‹ |
| **Atlan** | å•†ä¸š | åä½œã€AIè¾…åŠ© | æ•°æ®å›¢é˜Ÿ |
| **Alation** | å•†ä¸š | æ•°æ®ç›®å½•é¢†å¯¼è€… | ä¼ä¸šçº§ |
| **Collibra** | å•†ä¸š | æ²»ç†å¯¼å‘ | åˆè§„è¦æ±‚é«˜ |

### 7.2. å…ƒæ•°æ®è‡ªåŠ¨å‘ç°è¶‹åŠ¿

```mermaid
flowchart TB
    subgraph ä¼ ç»Ÿæ–¹æ³•
        T1[æ‰‹åŠ¨å½•å…¥]
        T2[è„šæœ¬æ‰«æ]
    end

    subgraph ç°ä»£æ–¹æ³•
        M1[è‡ªåŠ¨å‘ç°]
        M2[è¡€ç¼˜è¿½è¸ª]
        M3[AIåˆ†ç±»]
        M4[å˜æ›´æ£€æµ‹]
    end

    subgraph 2025è¶‹åŠ¿
        N1[å®æ—¶å…ƒæ•°æ®]
        N2[è¯­ä¹‰ç†è§£]
        N3[è‡ªåŠ¨æ–‡æ¡£]
    end

    T1 --> M1
    T2 --> M1
    M1 --> N1
    M2 --> N1
    M3 --> N2
    M4 --> N3
```

---

## 8. å‚è€ƒèµ„æ–™

### 8.1. æƒå¨æ–‡çŒ®

**å…ƒå»ºæ¨¡ç†è®º**ï¼š

- OMG (2016). "Meta Object Facility (MOF) Core Specification"
- BÃ©zivin, J. (2005). "On the Unification Power of Models"
- KÃ¼hne, T. (2006). "Matters of (Meta-) Modeling"

### 8.2. åœ¨çº¿èµ„æº

| èµ„æº | URL | æè¿° |
|------|-----|------|
| **OMG MOF** | <https://www.omg.org/mof/> | MOFæ ‡å‡† |
| **DataHub** | <https://datahubproject.io> | å…ƒæ•°æ®å¹³å° |
| **OpenMetadata** | <https://open-metadata.org> | å¼€æºå…ƒæ•°æ® |

### 8.3. ç›¸å…³æ–‡æ¡£

- [07.01-Schemaè®¾è®¡æ–¹æ³•è®º](./07.01-Schemaè®¾è®¡æ–¹æ³•è®º.md)
- [07.15-æ•°æ®åº“è®¾è®¡å·¥å…·ä¸æ¨¡æ¿åº“](./07.15-æ•°æ®åº“è®¾è®¡å·¥å…·ä¸æ¨¡æ¿åº“.md)

---

**æœ€åæ›´æ–°**ï¼š2025-12-01
**ç»´æŠ¤è€…**ï¼šData-Science Team
**çŠ¶æ€**ï¼šå®æ–½ä¸­
**ç‰ˆæœ¬**ï¼šv2.0 (å¢å¼ºç‰ˆ)
