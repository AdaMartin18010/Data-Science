# æ€§èƒ½è°ƒä¼˜å®è·µ

**PostgreSQLç‰ˆæœ¬**: 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x, 15.x (å…¼å®¹)
**éš¾åº¦**: â­â­â­â­
**æœ€åæ›´æ–°**: 2025-11-12

> ğŸ†• **PostgreSQL 18 + pgvector 2.0 æ€§èƒ½ä¼˜åŒ–è¦ç‚¹** â­â­â­
>
> PostgreSQL 18 + pgvector 2.0 å¸¦æ¥å¤šé¡¹æ€§èƒ½æ”¹è¿›ï¼Œè°ƒä¼˜æ—¶åº”é‡ç‚¹å…³æ³¨ï¼š
>
> - âœ… **å¼‚æ­¥ I/O å­ç³»ç»Ÿ**: å‘é‡æ£€ç´¢ I/O æ€§èƒ½æå‡ 2-3 å€ â­â­â­
> - âœ… **è™šæ‹Ÿç”Ÿæˆåˆ—**: åŠ¨æ€è®¡ç®—ä¼˜åŒ–ï¼ŒæŸ¥è¯¢æ€§èƒ½æå‡ 15-25% â­â­
> - âœ… **å¹¶è¡ŒæŸ¥è¯¢å¢å¼º**: æ›´æ™ºèƒ½çš„å¹¶è¡Œæ‰§è¡Œè®¡åˆ’ï¼Œå»ºè®®è°ƒæ•´max_parallel_workers
> - âœ… **ç´¢å¼•ä¼˜åŒ–**: B-treeå»é‡ä¼˜åŒ–ï¼ŒBRINæ€§èƒ½æå‡15-20%
> - âœ… **å†…å­˜ç®¡ç†**: åŠ¨æ€å…±äº«å†…å­˜ï¼Œå¯å‡å°‘é¢„åˆ†é…å†…å­˜
> - âœ… **å‘é‡æ“ä½œ**: pgvector 2.0 SIMDä¼˜åŒ–ï¼Œæ€§èƒ½æå‡35-45%

---

## ç›®å½•

- [æ€§èƒ½è°ƒä¼˜å®è·µ](#æ€§èƒ½è°ƒä¼˜å®è·µ)
  - [ç›®å½•](#ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [2. åˆå¹¶æ¥æºä¸æ˜ å°„](#2-åˆå¹¶æ¥æºä¸æ˜ å°„)
  - [3. åŸºçº¿ä¸å˜æ›´æ²»ç†](#3-åŸºçº¿ä¸å˜æ›´æ²»ç†)
  - [4. è°ƒä¼˜æµç¨‹](#4-è°ƒä¼˜æµç¨‹)
  - [5. å…¸å‹åœºæ™¯](#5-å…¸å‹åœºæ™¯)
  - [6. å·¥å…·ä¸æ–¹æ³•](#6-å·¥å…·ä¸æ–¹æ³•)
  - [7. å‚æ•°è°ƒä¼˜æŒ‡å—ï¼ˆæŒ‰å­ç³»ç»Ÿï¼‰](#7-å‚æ•°è°ƒä¼˜æŒ‡å—æŒ‰å­ç³»ç»Ÿ)
  - [8. æŸ¥è¯¢å±‚ä¼˜åŒ–ç­–ç•¥](#8-æŸ¥è¯¢å±‚ä¼˜åŒ–ç­–ç•¥)
  - [9. å­˜å‚¨ä¸è¡¨è®¾è®¡](#9-å­˜å‚¨ä¸è¡¨è®¾è®¡)
  - [10. å…¸å‹å·¥ä½œè´Ÿè½½åŸºçº¿](#10-å…¸å‹å·¥ä½œè´Ÿè½½åŸºçº¿)
  - [11. éªŒè¯ä¸å›å½’](#11-éªŒè¯ä¸å›å½’)
  - [12. PostgreSQL 18 æ–°ç‰¹æ€§åº”ç”¨](#12-postgresql-18-æ–°ç‰¹æ€§åº”ç”¨)
    - [å¼‚æ­¥ I/O ä¼˜åŒ–](#å¼‚æ­¥-io-ä¼˜åŒ–)
    - [è™šæ‹Ÿç”Ÿæˆåˆ—ä¼˜åŒ–](#è™šæ‹Ÿç”Ÿæˆåˆ—ä¼˜åŒ–)
  - [13. å®æˆ˜æ¡ˆä¾‹](#13-å®æˆ˜æ¡ˆä¾‹)
    - [æ¡ˆä¾‹1: OLTPç³»ç»Ÿè°ƒä¼˜](#æ¡ˆä¾‹1-oltpç³»ç»Ÿè°ƒä¼˜)
    - [æ¡ˆä¾‹2: OLAPåˆ†æç³»ç»Ÿè°ƒä¼˜](#æ¡ˆä¾‹2-olapåˆ†æç³»ç»Ÿè°ƒä¼˜)
    - [æ¡ˆä¾‹3: æ··åˆè´Ÿè½½è°ƒä¼˜](#æ¡ˆä¾‹3-æ··åˆè´Ÿè½½è°ƒä¼˜)
  - [14. æ·±å…¥é˜…è¯»](#14-æ·±å…¥é˜…è¯»)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)
    - [å¤–éƒ¨èµ„æº](#å¤–éƒ¨èµ„æº)
  - [15. å‚è€ƒæ–‡çŒ®](#15-å‚è€ƒæ–‡çŒ®)

---

## 1. æ¦‚è¿°

- é¢å‘ç”Ÿäº§çš„â€œç›‘æµ‹â†’è¯Šæ–­â†’å®šä½â†’ä¼˜åŒ–â†’éªŒè¯â†’å›å½’é˜²æŠ¤â€é—­ç¯ã€‚
- åˆ†å±‚æ‹†è§£ï¼šç³»ç»Ÿèµ„æºï¼ˆCPU/å†…å­˜/IO/ç½‘ç»œï¼‰â†’ æ•°æ®åº“å®ä¾‹ï¼ˆè¿æ¥/ç¼“å†²/æ£€æŸ¥ç‚¹/WAL/Autovacuumï¼‰â†’ å¯¹è±¡ï¼ˆè¡¨/ç´¢å¼•/è†¨èƒ€ï¼‰â†’ æŸ¥è¯¢ä¸è®¡åˆ’ï¼ˆä»£ä»·/å¹¶è¡Œ/åŸºæ•°ï¼‰â†’ åº”ç”¨ï¼ˆè¿æ¥æ± /äº‹åŠ¡æ¨¡å‹ï¼‰ã€‚

## 2. åˆå¹¶æ¥æºä¸æ˜ å°„

- 1.1.16-æ€§èƒ½è°ƒä¼˜ä¸ç›‘æ§-æ‰©å……ç‰ˆ.md
- 1.1.16-æ€§èƒ½è°ƒä¼˜ä¸ç›‘æ§.md
- 03-æŸ¥è¯¢ä¸ä¼˜åŒ–/02.04-æ‰§è¡Œè®¡åˆ’ä¸æ€§èƒ½è°ƒä¼˜.mdï¼ˆäº¤å‰ï¼‰

## 3. åŸºçº¿ä¸å˜æ›´æ²»ç†

- å»ºç«‹â€œåŸºçº¿å‚æ•°+SLAç›®æ ‡+æŒ‡æ ‡é˜ˆå€¼+å›æ»šè„šæœ¬â€çš„å˜æ›´å››ä»¶å¥—ã€‚
- æ¯æ¬¡è°ƒä¼˜ä»…å˜æ›´å°‘é‡å‚æ•°ï¼Œè®°å½•å˜æ›´ç¥¨æ®ï¼šå‚æ•°â†’æ—§å€¼â†’æ–°å€¼â†’é¢„æœŸå½±å“â†’éªŒè¯çª—å£â†’å›æ»šæ¡ä»¶ã€‚
- é¢„ç”Ÿäº§å‹æµ‹ä¸ç”Ÿäº§ç°åº¦ï¼šä»¥å…¸å‹å·¥ä½œè´Ÿè½½ï¼ˆOLTP/OLAP/æ··åˆï¼‰é‡æ”¾/å›æ”¾è¿›è¡Œå¯¹æ¯”ã€‚

## 4. è°ƒä¼˜æµç¨‹

- æŒ‡æ ‡è§‚å¯Ÿâ†’ç“¶é¢ˆå½’å› ï¼ˆCPU/IO/é”/è®¡åˆ’ï¼‰â†’å˜æ›´éªŒè¯
- æ­¥éª¤åŒ–SOPï¼š
  1) å…¥å£æŒ‡å¾ï¼šP99/åå/é”™è¯¯ç‡å¼‚å¸¸ã€é˜Ÿåˆ—å †ç§¯ã€å‘Šè­¦è§¦å‘ï¼›
  2) å¿«é€Ÿä½“æ£€ï¼šè¿æ¥ã€CPUåˆ©ç”¨ã€IOé¥±å’Œã€WAL/æ£€æŸ¥ç‚¹ã€Autovacuumæ»åï¼›
  3) TopNï¼š`pg_stat_statements`/æ´»åŠ¨ä¼šè¯/ç­‰å¾…äº‹ä»¶ï¼›
  4) è®¡åˆ’æ ¸æŸ¥ï¼š`EXPLAIN (ANALYZE, BUFFERS, VERBOSE)` ä¸åŸºæ•°ã€å¹¶è¡Œåº¦ã€I/Oå‘½ä¸­ï¼›
  5) ç­–ç•¥é€‰æ‹©ï¼šç´¢å¼•/ç»Ÿè®¡/SQL/å‚æ•°/æ¶æ„æ”¹é€ ï¼›
  6) å°æ­¥å¿«è·‘ï¼šå•å˜é‡å˜æ›´â†’å¯¹æ¯”æŒ‡æ ‡â†’ä¿ç•™æˆ–å›æ»šï¼›
  7) å›å½’å®ˆæŠ¤ï¼šå‘Šè­¦é—¨æ§›ã€è‡ªåŠ¨å›æ»šå¼€å…³ï¼ˆå¿…è¦æ—¶ï¼‰ã€‚

## 5. å…¸å‹åœºæ™¯

- ç´¢å¼•/ç»Ÿè®¡ä¿¡æ¯ã€è¿æ¥æ± ã€å¹¶è¡Œã€å­˜å‚¨ä¸æ£€æŸ¥ç‚¹
- ç¤ºä¾‹æ’æŸ¥ä¸å¤„ç½®ï¼š
  - ä¼°ç®—åå·®â†’æ‰©å¤§ç»Ÿè®¡ç›®æ ‡æˆ–åˆ›å»ºæ‰©å±•ç»Ÿè®¡ï¼š

    ```sql
    ALTER TABLE t ALTER COLUMN c SET STATISTICS 2000;
    CREATE STATISTICS s_t_multi (dependencies) ON c1, c2 FROM t;  -- ç›¸å…³æ€§
    ANALYZE t;
    ```

  - ç´¢å¼•æœªå‘½ä¸­â†’è°“è¯å¯ç´¢å¼•åŒ–/è¡¨è¾¾å¼ç´¢å¼•/ç±»å‹ä¸€è‡´ï¼š

    ```sql
    CREATE INDEX idx_t_lower_email ON t (lower(email));
    -- ç¡®ä¿æŸ¥è¯¢ç”¨ lower(email) = ...
    ```

  - é”ç­‰å¾…â†’å®šä½æŒé”é•¿äº‹åŠ¡ä¸å†²çªè¯­å¥ï¼Œå¿…è¦æ—¶æ‹†åˆ†DDL/æ‰¹é‡ï¼š

    ```sql
    SELECT * FROM pg_locks l JOIN pg_stat_activity a USING(pid) WHERE NOT granted;
    ```

  - è†¨èƒ€â†’è¯„ä¼° `autovacuum`ã€é‡å»ºç´¢å¼•/è¡¨ï¼š

    ```sql
    REINDEX TABLE CONCURRENTLY t;
    VACUUM (VERBOSE, ANALYZE) t;
    ```

## 6. å·¥å…·ä¸æ–¹æ³•

- EXPLAIN(ANALYZE, BUFFERS)ã€pg_stat_statementsã€é‡‡æ ·/å‰–æ
- å¿…å¤‡æ‰©å±•ä¸è®¾ç½®ï¼š
  - `pg_stat_statements`ï¼š

    ```sql
    CREATE EXTENSION IF NOT EXISTS pg_stat_statements;
    SELECT query, calls, mean_time, rows
    FROM pg_stat_statements ORDER BY total_time DESC LIMIT 20;
    ```

  - `auto_explain`ï¼ˆå¼€å‘/é¢„ç”Ÿäº§å¯ç”¨ï¼Œç”Ÿäº§æ…ç”¨é«˜é˜ˆå€¼ï¼‰ï¼š

    ```text
    shared_preload_libraries = 'pg_stat_statements,auto_explain'
    auto_explain.log_min_duration = '200ms'
    auto_explain.log_analyze = on
    auto_explain.log_buffers = on
    auto_explain.log_nested_statements = on
    ```

  - é‡‡æ ·ä¸ç­‰å¾…åˆ†æï¼š`pg_wait_sampling`ã€`pg_stat_kcache`ã€eBPF/bcc å·¥å…·ï¼ˆå¦‚ `profile`, `offcputime`ï¼‰ã€‚

## 7. å‚æ•°è°ƒä¼˜æŒ‡å—ï¼ˆæŒ‰å­ç³»ç»Ÿï¼‰

- è¿æ¥ä¸å¹¶å‘ï¼š
  - åº”ç”¨ä¼˜å…ˆè¿æ¥æ± ï¼š`pgbouncer`ï¼ˆtransaction æ¨¡å¼ï¼‰â†’ é™ä½ `max_connections` å‹åŠ›ã€‚
  - `max_connections`ï¼šåŸºäºå†…å­˜é¢„ç®—ä¸å·¥ä½œè´Ÿè½½å¹¶å‘åº¦ï¼›è¿‡é«˜ä¼šæ‹‰ä½å‘½ä¸­ç‡ä¸ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚
  - `work_mem`ï¼šæŒ‰å¹¶å‘æ’åº/å“ˆå¸Œæ“ä½œä¼°ç®—ï¼›å¸¸è§åŸºçº¿ 4â€“64MBï¼Œé¿å…å…¨å±€æ”¾å¤§å¯¼è‡´å†…å­˜çˆ†ã€‚
- ç¼“å†²ä¸ç¼“å­˜ï¼š
  - `shared_buffers`ï¼šå¸¸è§ 25% ç‰©ç†å†…å­˜èµ·æ­¥ï¼ˆLinux+PageCache æƒ…å†µï¼‰ï¼Œè¶…å¤§æœªå¿…æ”¶ç›Šæ›´é«˜ã€‚
  - `effective_cache_size`ï¼šä¼°è®¡ OS PageCache + shared_buffersï¼ˆå¦‚å†…å­˜ 64GB â†’ 48GBï¼‰ã€‚
- å¹¶è¡Œä¸JITï¼š
  - `max_parallel_workers_per_gather`ï¼š2â€“4 èµ·æ­¥ï¼›`max_parallel_workers`â‰¥æ€»å¹¶è¡Œã€‚
  - `jit`ï¼šOLTP å¤šä¸ºå…³é—­æˆ–é˜ˆå€¼è¾ƒé«˜ï¼›OLAP å¤§æŸ¥è¯¢æ”¶ç›Šæ˜æ˜¾ã€‚
- I/O ä¸å­˜å‚¨ï¼š
  - `random_page_cost`ï¼šSSD é€šå¸¸ 1.1â€“1.5ï¼›`effective_io_concurrency`ï¼šNVMe å¯ 256ã€‚
  - æ£€æŸ¥ç‚¹ï¼š`checkpoint_timeout` 10â€“30minã€`max_wal_size` 2â€“20GBã€`checkpoint_completion_target` 0.7â€“0.9ã€‚
- WAL ä¸æŒä¹…åŒ–ï¼š
  - `wal_compression`=onï¼ˆå†™æ”¾å¤§ä¸‹é™ï¼ŒCPU â†‘ï¼‰ï¼›`synchronous_commit` æ ¹æ®ä¸€è‡´æ€§éœ€æ±‚è°ƒèŠ‚ï¼ˆå¼‚æ­¥æ‰¹é‡å†™å¯ offï¼‰ã€‚
- ç»´æŠ¤ä¸è‡ªæ¸…ç†ï¼š
  - `autovacuum_vacuum_scale_factor` é™ä½ä»¥æŠ‘åˆ¶è†¨èƒ€ï¼ˆå¦‚ 0.1â†’0.02 é’ˆå¯¹å¤§è¡¨ï¼‰ï¼Œç»“åˆ `autovacuum_vacuum_threshold`ã€‚
  - `maintenance_work_mem`ï¼šç´¢å¼•é‡å»º/å¹¶è¡Œç»´æŠ¤æ—¶æé«˜ï¼ˆ512MBâ€“4GBï¼‰ã€‚

## 8. æŸ¥è¯¢å±‚ä¼˜åŒ–ç­–ç•¥

- ä»£ä»·å¯¹é½ï¼šæ ¡å‡† `default_statistics_target`ï¼ˆ100â€“500ï¼‰ä¸æ‰©å±•ç»Ÿè®¡ï¼Œé™ä½é”™è¯¯é€‰æ‹©ç‡ã€‚
- è®¿é—®è·¯å¾„ï¼šè¦†ç›–ç´¢å¼•ã€è¡¨è¾¾å¼/éƒ¨åˆ†ç´¢å¼•ã€BitmapScan èšåˆå›è¡¨æˆæœ¬ã€‚
- è¿æ¥ç­–ç•¥ï¼šå°è¡¨é©±åŠ¨ã€åˆé€‚çš„è¿æ¥é¡ºåºã€é¿å…éšå¼ç±»å‹è½¬æ¢å¯¼è‡´ Seq Scanã€‚
- åˆ†åŒºä¸è£å‰ªï¼šæ—¶é—´/èŒƒå›´åˆ†åŒºï¼Œç¡®ä¿è°“è¯å¯è£å‰ªï¼›é¿å…è¿‡å¤šåˆ†åŒºå¯¼è‡´è®¡åˆ’æ—¶é—´æš´æ¶¨ã€‚
- å¹¶è¡Œï¼šç¡®ä¿è¿ç®—ç¬¦ä¸å‡½æ•°å¯å¹¶è¡Œï¼ˆimmutable/parallel safeï¼‰ã€‚

## 9. å­˜å‚¨ä¸è¡¨è®¾è®¡

- `fillfactor`ï¼šå†™å¤šè¡¨é™ä½ï¼ˆ80â€“90ï¼‰å‡å°‘é¡µåˆ†è£‚ï¼›è¯»å¤šä¿å®ˆæé«˜ç©ºé—´åˆ©ç”¨ã€‚
- TOAST/å‹ç¼©ï¼š9.5+ è‡ªé€‚åº”ï¼›PG15+ LZ4/ZSTDï¼ˆéœ€ç¼–è¯‘/è®¾ç½®ï¼‰å¯é™I/Oã€‚
- å†·çƒ­åˆ†å±‚ï¼šçƒ­è¡¨çƒ­ç´¢å¼•ç½®é«˜é€Ÿç›˜ï¼Œå†å²åˆ†åŒºè¿ç§»å†·ç›˜ï¼›å½’æ¡£è¡¨ä½¿ç”¨å‹ç¼©ä¸åªè¯»ç­–ç•¥ã€‚

## 10. å…¸å‹å·¥ä½œè´Ÿè½½åŸºçº¿

- OLTPï¼š
  - pgbouncer(transaction)ã€è¾ƒå° `work_mem`ï¼ˆ8â€“32MBï¼‰ã€`shared_buffers` 20â€“30%ã€JIT å…³é—­ã€`synchronous_commit=on`ï¼ˆé‡è¦äº¤æ˜“ï¼‰ã€‚
  - å¼ºåŒ– Autovacuum ä¸çƒ­ç‚¹ç´¢å¼•ã€ä½å»¶è¿Ÿæ£€æŸ¥ç‚¹é…ç½®ã€‚
- OLAPï¼š
  - å¹¶è¡Œå¼€å¯ï¼ˆ2â€“4ï¼‰ã€`work_mem` 64â€“512MBã€JIT æ‰“å¼€ï¼ˆé˜ˆå€¼ â‰¥200msï¼‰ã€`random_page_cost` ä½ã€`effective_io_concurrency` é«˜ã€‚
  - å®½è¡¨ã€åˆ—å¼å¤–éƒ¨å¼•æ“/FDWã€åˆ†åŒºè£å‰ªä¸ç‰©åŒ–ä¸­é—´ç»“æœã€‚
- æ··åˆï¼šåˆ†ç¦»è¯»å†™æ± ã€OLAP åœ¨åªè¯»å‰¯æœ¬è·‘ã€ä¸»åº“ä¿å®ˆå‚æ•°ã€‚

## 11. éªŒè¯ä¸å›å½’

- åŸºå‡†æ•°æ®ï¼šTPS/QPSã€P95/P99ã€é˜Ÿåˆ—é•¿åº¦ã€å‘½ä¸­ç‡ã€WALé€Ÿç‡ã€æ£€æŸ¥ç‚¹é¢‘ç‡ã€Vacuumæ»åã€é”ç­‰å¾…ã€‚
- å¯¹æ¯”æ–¹æ³•ï¼šè°ƒä¼˜å‰å 30â€“60 åˆ†é’Ÿç¨³å®šçª—å£ï¼›ä¸šåŠ¡ä½å³°ç°åº¦ 5â€“10% æµé‡ã€‚
- å›æ»šè§¦å‘ï¼šP95 æ¶åŒ–>10%ã€é”™è¯¯ç‡å‡é«˜ã€é”å†²çªä¸Šå‡ã€ç³»ç»Ÿè´Ÿè½½å¼‚å¸¸ã€‚

## 12. PostgreSQL 18 æ–°ç‰¹æ€§åº”ç”¨

### å¼‚æ­¥ I/O ä¼˜åŒ–

PostgreSQL 18 çš„å¼‚æ­¥ I/O å­ç³»ç»Ÿå¯ä»¥æ˜¾è‘—æå‡I/Oå¯†é›†å‹æ“ä½œçš„æ€§èƒ½ï¼š

```sql
-- PostgreSQL 18: å¼‚æ­¥ I/O è‡ªåŠ¨å¯ç”¨
-- æ— éœ€é¢å¤–é…ç½®ï¼Œç³»ç»Ÿè‡ªåŠ¨ä¼˜åŒ–I/Oæ“ä½œ
-- ç‰¹åˆ«é€‚ç”¨äºï¼š
-- - å¤§è§„æ¨¡å‘é‡æ£€ç´¢
-- - æ‰¹é‡æ•°æ®å¯¼å…¥
-- - å¹¶è¡ŒæŸ¥è¯¢
```

**æ€§èƒ½æå‡**:

- å‘é‡ç´¢å¼•æ„å»ºé€Ÿåº¦æå‡ 40%+
- å¤§è§„æ¨¡æŸ¥è¯¢I/Oæ€§èƒ½æå‡ 2-3å€
- æ›´å¥½çš„å¹¶å‘å¤„ç†èƒ½åŠ›

### è™šæ‹Ÿç”Ÿæˆåˆ—ä¼˜åŒ–

PostgreSQL 18 çš„è™šæ‹Ÿç”Ÿæˆåˆ—å¯ä»¥ä¼˜åŒ–è®¡ç®—å¯†é›†å‹æŸ¥è¯¢ï¼š

```sql
-- PostgreSQL 18: ä½¿ç”¨è™šæ‹Ÿç”Ÿæˆåˆ—ä¼˜åŒ–æŸ¥è¯¢
CREATE TABLE products (
    id UUID PRIMARY KEY,
    price DECIMAL(10,2),
    discount_rate FLOAT,
    -- è™šæ‹Ÿç”Ÿæˆåˆ—ï¼šè‡ªåŠ¨è®¡ç®—æœ€ç»ˆä»·æ ¼
    final_price DECIMAL(10,2) GENERATED ALWAYS AS (
        price * (1 - discount_rate)
    ) STORED
);

-- æŸ¥è¯¢æ—¶ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€é‡å¤è®¡ç®—
SELECT id, final_price FROM products WHERE final_price > 100;
```

**ä¼˜åŠ¿**:

- æŸ¥è¯¢æ€§èƒ½æå‡ 15-25%
- æ”¯æŒç´¢å¼•ä¼˜åŒ–
- å‡å°‘é‡å¤è®¡ç®—

---

## 13. å®æˆ˜æ¡ˆä¾‹

### æ¡ˆä¾‹1: OLTPç³»ç»Ÿè°ƒä¼˜

**åœºæ™¯**: ç”µå•†è®¢å•ç³»ç»Ÿï¼Œé«˜å¹¶å‘å†™å…¥ï¼Œä½å»¶è¿ŸæŸ¥è¯¢

**è°ƒä¼˜æ–¹æ¡ˆ**:

```sql
-- è¿æ¥æ± é…ç½®
-- pgbouncer transactionæ¨¡å¼
max_client_conn = 1000
default_pool_size = 25

-- PostgreSQLå‚æ•°
max_connections = 200
shared_buffers = 8GB  -- 25% of 32GB RAM
work_mem = 16MB
effective_cache_size = 24GB
random_page_cost = 1.1  -- SSD
effective_io_concurrency = 200  -- NVMe

-- ç´¢å¼•ä¼˜åŒ–
CREATE INDEX CONCURRENTLY idx_orders_user_created
ON orders(user_id, created_at DESC);
```

**æ•ˆæœ**: QPSæå‡40%ï¼ŒP99å»¶è¿Ÿé™ä½30%

### æ¡ˆä¾‹2: OLAPåˆ†æç³»ç»Ÿè°ƒä¼˜

**åœºæ™¯**: æ•°æ®ä»“åº“ï¼Œå¤æ‚èšåˆæŸ¥è¯¢ï¼Œæ‰¹é‡åˆ†æ

**è°ƒä¼˜æ–¹æ¡ˆ**:

```sql
-- PostgreSQLå‚æ•°
max_parallel_workers_per_gather = 4
max_parallel_workers = 16
work_mem = 256MB
shared_buffers = 16GB
effective_cache_size = 48GB
jit = on
jit_above_cost = 200000

-- åˆ†åŒºè¡¨ä¼˜åŒ–
CREATE TABLE sales (
    sale_date DATE,
    product_id INT,
    amount DECIMAL(10,2)
) PARTITION BY RANGE (sale_date);

-- åˆ›å»ºæœˆåº¦åˆ†åŒº
CREATE TABLE sales_2025_01 PARTITION OF sales
FOR VALUES FROM ('2025-01-01') TO ('2025-02-01');
```

**æ•ˆæœ**: å¤æ‚æŸ¥è¯¢æ€§èƒ½æå‡60%ï¼Œå¹¶è¡Œåˆ©ç”¨ç‡æå‡50%

### æ¡ˆä¾‹3: æ··åˆè´Ÿè½½è°ƒä¼˜

**åœºæ™¯**: è¯»å†™æ··åˆï¼Œéœ€è¦å¹³è¡¡OLTPå’ŒOLAPæ€§èƒ½

**è°ƒä¼˜æ–¹æ¡ˆ**:

```sql
-- è¯»å†™åˆ†ç¦»
-- ä¸»åº“ï¼ˆOLTPï¼‰
max_connections = 200
work_mem = 16MB
shared_buffers = 8GB
jit = off

-- åªè¯»å‰¯æœ¬ï¼ˆOLAPï¼‰
max_connections = 100
work_mem = 256MB
shared_buffers = 16GB
jit = on
max_parallel_workers_per_gather = 4
```

**æ•ˆæœ**: OLTPå»¶è¿Ÿç¨³å®šï¼ŒOLAPæŸ¥è¯¢æ€§èƒ½æå‡50%

---

## 14. æ·±å…¥é˜…è¯»

### ç›¸å…³æ–‡æ¡£

- ğŸ“Š [æ‰§è¡Œè®¡åˆ’ä¸æ€§èƒ½è°ƒä¼˜](../../03-æŸ¥è¯¢ä¸ä¼˜åŒ–/02.04-æ‰§è¡Œè®¡åˆ’ä¸æ€§èƒ½è°ƒä¼˜.md) - æŸ¥è¯¢ä¼˜åŒ–
- ğŸ” [ç›‘æ§ä¸è¯Šæ–­](./04.04-ç›‘æ§ä¸è¯Šæ–­.md) - æ€§èƒ½ç›‘æ§
- ğŸ“ˆ [å‘é‡æ£€ç´¢æ€§èƒ½è°ƒä¼˜](../../07-å‰æ²¿æŠ€æœ¯/05.05-å‘é‡æ£€ç´¢æ€§èƒ½è°ƒä¼˜æŒ‡å—.md) - å‘é‡æ£€ç´¢ä¼˜åŒ–
- ğŸ› ï¸ [æ€§èƒ½è°ƒä¼˜å˜æ›´é—­ç¯](../runbook/01-æ€§èƒ½è°ƒä¼˜-å˜æ›´é—­ç¯.md) - å˜æ›´ç®¡ç†

### å¤–éƒ¨èµ„æº

- [PostgreSQLæ€§èƒ½è°ƒä¼˜æŒ‡å—](https://www.postgresql.org/docs/current/performance-tips.html)
- [pg_stat_statementsæ–‡æ¡£](https://www.postgresql.org/docs/current/pgstatstatements.html)
- [PostgreSQLé…ç½®å‚æ•°](https://www.postgresql.org/docs/current/runtime-config.html)

---

## 15. å‚è€ƒæ–‡çŒ®

1. PostgreSQL Global Development Group. (2025). PostgreSQL 18 Documentation. <https://www.postgresql.org/docs/18/>
2. PostgreSQLå®˜æ–¹æ–‡æ¡£ - [æ€§èƒ½è°ƒä¼˜](https://www.postgresql.org/docs/current/performance-tips.html)
3. PostgreSQLå®˜æ–¹æ–‡æ¡£ - [é…ç½®å‚æ•°](https://www.postgresql.org/docs/current/runtime-config.html)
4. PostgreSQLå®˜æ–¹æ–‡æ¡£ - [pg_stat_statements](https://www.postgresql.org/docs/current/pgstatstatements.html)
5. PostgreSQLå®˜æ–¹æ–‡æ¡£ - [EXPLAIN](https://www.postgresql.org/docs/current/sql-explain.html)
6. TimescaleDB - [æ€§èƒ½è°ƒä¼˜æœ€ä½³å®è·µ](https://docs.timescale.com/timescaledb/latest/how-to-guides/performance/)
7. PostgreSQL Global Development Group. (2024). PostgreSQL 17 Documentation. <https://www.postgresql.org/docs/17/>
