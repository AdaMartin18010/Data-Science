# æ€§èƒ½è°ƒä¼˜å®è·µ

**PostgreSQLç‰ˆæœ¬**: 18.x (æ¨è) â­ | 17.x (æ¨è) | 16.x, 15.x (å…¼å®¹)
**éš¾åº¦**: â­â­â­â­
**æœ€åæ›´æ–°**: 2025-11-12

> ğŸ†• **PostgreSQL 18 + pgvector 2.0 æ€§èƒ½ä¼˜åŒ–è¦ç‚¹** â­â­â­
>
> PostgreSQL 18 + pgvector 2.0 å¸¦æ¥å¤šé¡¹æ€§èƒ½æ”¹è¿›ï¼Œè°ƒä¼˜æ—¶åº”é‡ç‚¹å…³æ³¨ï¼š
>
> - âœ… **å¼‚æ­¥ I/O å­ç³»ç»Ÿ**: å‘é‡æ£€ç´¢ I/O æ€§èƒ½æå‡ 2-3 å€ â­â­â­
> - âœ… **è™šæ‹Ÿç”Ÿæˆåˆ—**: åŠ¨æ€è®¡ç®—ä¼˜åŒ–ï¼ŒæŸ¥è¯¢æ€§èƒ½æå‡ 15-25% â­â­
> - âœ… **å¹¶è¡ŒæŸ¥è¯¢å¢å¼º**: æ›´æ™ºèƒ½çš„å¹¶è¡Œæ‰§è¡Œè®¡åˆ’ï¼Œå»ºè®®è°ƒæ•´max_parallel_workers
> - âœ… **ç´¢å¼•ä¼˜åŒ–**: B-treeå»é‡ä¼˜åŒ–ï¼ŒBRINæ€§èƒ½æå‡15-20%
> - âœ… **å†…å­˜ç®¡ç†**: åŠ¨æ€å…±äº«å†…å­˜ï¼Œå¯å‡å°‘é¢„åˆ†é…å†…å­˜
> - âœ… **å‘é‡æ“ä½œ**: pgvector 2.0 SIMDä¼˜åŒ–ï¼Œæ€§èƒ½æå‡35-45%

---

## ç›®å½•

- [æ€§èƒ½è°ƒä¼˜å®è·µ](#æ€§èƒ½è°ƒä¼˜å®è·µ)
  - [ç›®å½•](#ç›®å½•)
  - [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [2. åˆå¹¶æ¥æºä¸æ˜ å°„](#2-åˆå¹¶æ¥æºä¸æ˜ å°„)
  - [3. åŸºçº¿ä¸å˜æ›´æ²»ç†](#3-åŸºçº¿ä¸å˜æ›´æ²»ç†)
    - [3.1 åŸºçº¿å‚æ•°å»ºç«‹](#31-åŸºçº¿å‚æ•°å»ºç«‹)
    - [3.2 SLAç›®æ ‡å®šä¹‰](#32-slaç›®æ ‡å®šä¹‰)
    - [3.3 æŒ‡æ ‡é˜ˆå€¼è®¾ç½®](#33-æŒ‡æ ‡é˜ˆå€¼è®¾ç½®)
    - [3.4 å˜æ›´ç¥¨æ®æ¨¡æ¿](#34-å˜æ›´ç¥¨æ®æ¨¡æ¿)
    - [3.5 é¢„ç”Ÿäº§å‹æµ‹](#35-é¢„ç”Ÿäº§å‹æµ‹)
  - [4. è°ƒä¼˜æµç¨‹](#4-è°ƒä¼˜æµç¨‹)
    - [4.1 æ­¥éª¤1: å…¥å£æŒ‡å¾è¯†åˆ«](#41-æ­¥éª¤1-å…¥å£æŒ‡å¾è¯†åˆ«)
    - [4.2 æ­¥éª¤2: å¿«é€Ÿä½“æ£€](#42-æ­¥éª¤2-å¿«é€Ÿä½“æ£€)
    - [4.3 æ­¥éª¤3: TopNåˆ†æ](#43-æ­¥éª¤3-topnåˆ†æ)
    - [4.4 æ­¥éª¤4: è®¡åˆ’æ ¸æŸ¥](#44-æ­¥éª¤4-è®¡åˆ’æ ¸æŸ¥)
    - [4.5 æ­¥éª¤5: ç­–ç•¥é€‰æ‹©](#45-æ­¥éª¤5-ç­–ç•¥é€‰æ‹©)
    - [4.6 æ­¥éª¤6: å°æ­¥å¿«è·‘](#46-æ­¥éª¤6-å°æ­¥å¿«è·‘)
    - [4.7 æ­¥éª¤7: å›å½’å®ˆæŠ¤](#47-æ­¥éª¤7-å›å½’å®ˆæŠ¤)
  - [5. å…¸å‹åœºæ™¯](#5-å…¸å‹åœºæ™¯)
  - [6. å·¥å…·ä¸æ–¹æ³•](#6-å·¥å…·ä¸æ–¹æ³•)
  - [7. å‚æ•°è°ƒä¼˜æŒ‡å—ï¼ˆæŒ‰å­ç³»ç»Ÿï¼‰](#7-å‚æ•°è°ƒä¼˜æŒ‡å—æŒ‰å­ç³»ç»Ÿ)
    - [7.1 è¿æ¥ä¸å¹¶å‘å‚æ•°](#71-è¿æ¥ä¸å¹¶å‘å‚æ•°)
    - [7.2 ç¼“å†²ä¸ç¼“å­˜å‚æ•°](#72-ç¼“å†²ä¸ç¼“å­˜å‚æ•°)
    - [7.3 å¹¶è¡Œä¸JITå‚æ•°](#73-å¹¶è¡Œä¸jitå‚æ•°)
    - [7.4 I/Oä¸å­˜å‚¨å‚æ•°](#74-ioä¸å­˜å‚¨å‚æ•°)
    - [7.5 WALä¸æŒä¹…åŒ–å‚æ•°](#75-walä¸æŒä¹…åŒ–å‚æ•°)
    - [7.6 ç»´æŠ¤ä¸è‡ªæ¸…ç†å‚æ•°](#76-ç»´æŠ¤ä¸è‡ªæ¸…ç†å‚æ•°)
  - [8. æŸ¥è¯¢å±‚ä¼˜åŒ–ç­–ç•¥](#8-æŸ¥è¯¢å±‚ä¼˜åŒ–ç­–ç•¥)
    - [8.1 ä»£ä»·å¯¹é½ä¼˜åŒ–](#81-ä»£ä»·å¯¹é½ä¼˜åŒ–)
    - [8.2 è®¿é—®è·¯å¾„ä¼˜åŒ–](#82-è®¿é—®è·¯å¾„ä¼˜åŒ–)
    - [8.3 è¿æ¥ç­–ç•¥ä¼˜åŒ–](#83-è¿æ¥ç­–ç•¥ä¼˜åŒ–)
    - [8.4 æŸ¥è¯¢é‡å†™ä¼˜åŒ–](#84-æŸ¥è¯¢é‡å†™ä¼˜åŒ–)
  - [9. å­˜å‚¨ä¸è¡¨è®¾è®¡](#9-å­˜å‚¨ä¸è¡¨è®¾è®¡)
  - [10. å…¸å‹å·¥ä½œè´Ÿè½½åŸºçº¿](#10-å…¸å‹å·¥ä½œè´Ÿè½½åŸºçº¿)
  - [11. éªŒè¯ä¸å›å½’](#11-éªŒè¯ä¸å›å½’)
  - [12. PostgreSQL 18 æ–°ç‰¹æ€§åº”ç”¨](#12-postgresql-18-æ–°ç‰¹æ€§åº”ç”¨)
    - [å¼‚æ­¥ I/O ä¼˜åŒ–](#å¼‚æ­¥-io-ä¼˜åŒ–)
    - [è™šæ‹Ÿç”Ÿæˆåˆ—ä¼˜åŒ–](#è™šæ‹Ÿç”Ÿæˆåˆ—ä¼˜åŒ–)
  - [13. å®æˆ˜æ¡ˆä¾‹](#13-å®æˆ˜æ¡ˆä¾‹)
    - [æ¡ˆä¾‹1: OLTPç³»ç»Ÿè°ƒä¼˜](#æ¡ˆä¾‹1-oltpç³»ç»Ÿè°ƒä¼˜)
    - [æ¡ˆä¾‹2: OLAPåˆ†æç³»ç»Ÿè°ƒä¼˜](#æ¡ˆä¾‹2-olapåˆ†æç³»ç»Ÿè°ƒä¼˜)
    - [æ¡ˆä¾‹3: æ··åˆè´Ÿè½½è°ƒä¼˜](#æ¡ˆä¾‹3-æ··åˆè´Ÿè½½è°ƒä¼˜)
  - [14. æ·±å…¥é˜…è¯»](#14-æ·±å…¥é˜…è¯»)
    - [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)
      - [æŸ¥è¯¢ä¸ä¼˜åŒ–](#æŸ¥è¯¢ä¸ä¼˜åŒ–)
      - [æ ¸å¿ƒè¯¾ç¨‹](#æ ¸å¿ƒè¯¾ç¨‹)
      - [è¿ç»´å®è·µ](#è¿ç»´å®è·µ)
      - [å‰æ²¿æŠ€æœ¯](#å‰æ²¿æŠ€æœ¯)
      - [ç‰ˆæœ¬ç‰¹æ€§](#ç‰ˆæœ¬ç‰¹æ€§)
    - [å¤–éƒ¨èµ„æº](#å¤–éƒ¨èµ„æº)
  - [15. å‚è€ƒæ–‡çŒ®](#15-å‚è€ƒæ–‡çŒ®)

---

## 1. æ¦‚è¿°

- é¢å‘ç”Ÿäº§çš„â€œç›‘æµ‹â†’è¯Šæ–­â†’å®šä½â†’ä¼˜åŒ–â†’éªŒè¯â†’å›å½’é˜²æŠ¤â€é—­ç¯ã€‚
- åˆ†å±‚æ‹†è§£ï¼šç³»ç»Ÿèµ„æºï¼ˆCPU/å†…å­˜/IO/ç½‘ç»œï¼‰â†’ æ•°æ®åº“å®ä¾‹ï¼ˆè¿æ¥/ç¼“å†²/æ£€æŸ¥ç‚¹/WAL/Autovacuumï¼‰â†’ å¯¹è±¡ï¼ˆè¡¨/ç´¢å¼•/è†¨èƒ€ï¼‰â†’ æŸ¥è¯¢ä¸è®¡åˆ’ï¼ˆä»£ä»·/å¹¶è¡Œ/åŸºæ•°ï¼‰â†’ åº”ç”¨ï¼ˆè¿æ¥æ± /äº‹åŠ¡æ¨¡å‹ï¼‰ã€‚

## 2. åˆå¹¶æ¥æºä¸æ˜ å°„

- 1.1.16-æ€§èƒ½è°ƒä¼˜ä¸ç›‘æ§-æ‰©å……ç‰ˆ.md
- 1.1.16-æ€§èƒ½è°ƒä¼˜ä¸ç›‘æ§.md
- 03-æŸ¥è¯¢ä¸ä¼˜åŒ–/02.04-æ‰§è¡Œè®¡åˆ’ä¸æ€§èƒ½è°ƒä¼˜.mdï¼ˆäº¤å‰ï¼‰

## 3. åŸºçº¿ä¸å˜æ›´æ²»ç†

- å»ºç«‹"åŸºçº¿å‚æ•°+SLAç›®æ ‡+æŒ‡æ ‡é˜ˆå€¼+å›æ»šè„šæœ¬"çš„å˜æ›´å››ä»¶å¥—ã€‚
- æ¯æ¬¡è°ƒä¼˜ä»…å˜æ›´å°‘é‡å‚æ•°ï¼Œè®°å½•å˜æ›´ç¥¨æ®ï¼šå‚æ•°â†’æ—§å€¼â†’æ–°å€¼â†’é¢„æœŸå½±å“â†’éªŒè¯çª—å£â†’å›æ»šæ¡ä»¶ã€‚
- é¢„ç”Ÿäº§å‹æµ‹ä¸ç”Ÿäº§ç°åº¦ï¼šä»¥å…¸å‹å·¥ä½œè´Ÿè½½ï¼ˆOLTP/OLAP/æ··åˆï¼‰é‡æ”¾/å›æ”¾è¿›è¡Œå¯¹æ¯”ã€‚

### 3.1 åŸºçº¿å‚æ•°å»ºç«‹

```sql
-- 1. åˆ›å»ºå‚æ•°åŸºçº¿è¡¨
CREATE TABLE IF NOT EXISTS parameter_baseline (
    baseline_id SERIAL PRIMARY KEY,
    baseline_time TIMESTAMP DEFAULT NOW(),
    parameter_name TEXT,
    parameter_value TEXT,
    parameter_source TEXT,
    notes TEXT
);

-- 2. è®°å½•å½“å‰å‚æ•°åŸºçº¿
INSERT INTO parameter_baseline (parameter_name, parameter_value, parameter_source)
SELECT name, setting, source
FROM pg_settings
WHERE source IN ('configuration file', 'command line', 'environment variable')
AND name IN (
    'shared_buffers', 'work_mem', 'maintenance_work_mem',
    'max_connections', 'effective_cache_size',
    'random_page_cost', 'effective_io_concurrency',
    'checkpoint_timeout', 'max_wal_size',
    'autovacuum_vacuum_scale_factor', 'autovacuum_analyze_scale_factor'
);

-- 3. æŸ¥è¯¢å‚æ•°åŸºçº¿
SELECT * FROM parameter_baseline ORDER BY baseline_time DESC;
```

### 3.2 SLAç›®æ ‡å®šä¹‰

```sql
-- åˆ›å»ºSLAç›®æ ‡è¡¨
CREATE TABLE IF NOT EXISTS sla_targets (
    target_id SERIAL PRIMARY KEY,
    target_name TEXT,
    metric_name TEXT,
    target_value NUMERIC,
    unit TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);

-- å®šä¹‰SLAç›®æ ‡
INSERT INTO sla_targets (target_name, metric_name, target_value, unit) VALUES
('P95å»¶è¿Ÿ', 'p95_latency', 100, 'ms'),
('P99å»¶è¿Ÿ', 'p99_latency', 500, 'ms'),
('ååé‡', 'tps', 1000, 'transactions/sec'),
('ç¼“å­˜å‘½ä¸­ç‡', 'cache_hit_ratio', 95, 'percent'),
('é”™è¯¯ç‡', 'error_rate', 0.1, 'percent');
```

### 3.3 æŒ‡æ ‡é˜ˆå€¼è®¾ç½®

```sql
-- åˆ›å»ºæŒ‡æ ‡é˜ˆå€¼è¡¨
CREATE TABLE IF NOT EXISTS metric_thresholds (
    threshold_id SERIAL PRIMARY KEY,
    metric_name TEXT,
    warning_threshold NUMERIC,
    critical_threshold NUMERIC,
    unit TEXT
);

-- è®¾ç½®æŒ‡æ ‡é˜ˆå€¼
INSERT INTO metric_thresholds (metric_name, warning_threshold, critical_threshold, unit) VALUES
('active_connections', 80, 95, 'count'),
('cache_hit_ratio', 90, 85, 'percent'),
('replication_lag', 1048576, 10485760, 'bytes'),  -- 1MB, 10MB
('dead_tuples_ratio', 10, 20, 'percent'),
('checkpoint_frequency', 5, 10, 'minutes');
```

### 3.4 å˜æ›´ç¥¨æ®æ¨¡æ¿

```sql
-- åˆ›å»ºå˜æ›´è®°å½•è¡¨
CREATE TABLE IF NOT EXISTS change_tickets (
    ticket_id SERIAL PRIMARY KEY,
    change_time TIMESTAMP DEFAULT NOW(),
    parameter_name TEXT,
    old_value TEXT,
    new_value TEXT,
    expected_impact TEXT,
    verification_window TEXT,
    rollback_condition TEXT,
    change_status TEXT,  -- 'pending', 'in_progress', 'completed', 'rolled_back'
    actual_impact TEXT,
    changed_by TEXT
);

-- è®°å½•å˜æ›´
INSERT INTO change_tickets (
    parameter_name, old_value, new_value, expected_impact,
    verification_window, rollback_condition, changed_by
) VALUES (
    'shared_buffers', '256MB', '512MB',
    'æé«˜ç¼“å­˜å‘½ä¸­ç‡5-10%',
    '2025-11-22 02:00 - 06:00',
    'P95å»¶è¿Ÿå¢åŠ >10%æˆ–é”™è¯¯ç‡ä¸Šå‡',
    current_user
);
```

### 3.5 é¢„ç”Ÿäº§å‹æµ‹

```bash
# ä½¿ç”¨pgbenchè¿›è¡Œå‹æµ‹
# 1. åˆå§‹åŒ–æµ‹è¯•æ•°æ®
pgbench -i -s 100 mydb  # -s: ç¼©æ”¾å› å­ï¼Œ100è¡¨ç¤º1000ä¸‡è¡Œ

# 2. è¿è¡ŒåŸºå‡†æµ‹è¯•
pgbench -c 10 -j 2 -T 300 mydb
# -c: å®¢æˆ·ç«¯æ•°
# -j: çº¿ç¨‹æ•°
# -T: è¿è¡Œæ—¶é—´ï¼ˆç§’ï¼‰

# 3. è¿è¡Œè‡ªå®šä¹‰æµ‹è¯•
pgbench -f custom_script.sql -c 10 -j 2 -T 300 mydb

# 4. å¯¹æ¯”æµ‹è¯•ç»“æœ
# å˜æ›´å‰
pgbench -c 10 -j 2 -T 300 mydb > baseline.txt

# å˜æ›´å
pgbench -c 10 -j 2 -T 300 mydb > after_change.txt

# å¯¹æ¯”
diff baseline.txt after_change.txt
```

## 4. è°ƒä¼˜æµç¨‹

- æŒ‡æ ‡è§‚å¯Ÿâ†’ç“¶é¢ˆå½’å› ï¼ˆCPU/IO/é”/è®¡åˆ’ï¼‰â†’å˜æ›´éªŒè¯
- æ­¥éª¤åŒ–SOPï¼š
  1) å…¥å£æŒ‡å¾ï¼šP99/åå/é”™è¯¯ç‡å¼‚å¸¸ã€é˜Ÿåˆ—å †ç§¯ã€å‘Šè­¦è§¦å‘ï¼›
  2) å¿«é€Ÿä½“æ£€ï¼šè¿æ¥ã€CPUåˆ©ç”¨ã€IOé¥±å’Œã€WAL/æ£€æŸ¥ç‚¹ã€Autovacuumæ»åï¼›
  3) TopNï¼š`pg_stat_statements`/æ´»åŠ¨ä¼šè¯/ç­‰å¾…äº‹ä»¶ï¼›
  4) è®¡åˆ’æ ¸æŸ¥ï¼š`EXPLAIN (ANALYZE, BUFFERS, VERBOSE)` ä¸åŸºæ•°ã€å¹¶è¡Œåº¦ã€I/Oå‘½ä¸­ï¼›
  5) ç­–ç•¥é€‰æ‹©ï¼šç´¢å¼•/ç»Ÿè®¡/SQL/å‚æ•°/æ¶æ„æ”¹é€ ï¼›
  6) å°æ­¥å¿«è·‘ï¼šå•å˜é‡å˜æ›´â†’å¯¹æ¯”æŒ‡æ ‡â†’ä¿ç•™æˆ–å›æ»šï¼›
  7) å›å½’å®ˆæŠ¤ï¼šå‘Šè­¦é—¨æ§›ã€è‡ªåŠ¨å›æ»šå¼€å…³ï¼ˆå¿…è¦æ—¶ï¼‰ã€‚

### 4.1 æ­¥éª¤1: å…¥å£æŒ‡å¾è¯†åˆ«

```sql
-- 1. æ£€æŸ¥P99å»¶è¿Ÿï¼ˆéœ€è¦pg_stat_statementsï¼‰
SELECT
    queryid,
    LEFT(query, 100) as query_preview,
    calls,
    mean_exec_time,
    (SELECT percentile_cont(0.99) WITHIN GROUP (ORDER BY mean_exec_time)
     FROM pg_stat_statements) as p99_latency
FROM pg_stat_statements
WHERE mean_exec_time > (
    SELECT percentile_cont(0.99) WITHIN GROUP (ORDER BY mean_exec_time)
    FROM pg_stat_statements
)
ORDER BY mean_exec_time DESC
LIMIT 10;

-- 2. æ£€æŸ¥ååé‡
SELECT
    datname,
    xact_commit + xact_rollback as total_transactions,
    xact_commit,
    xact_rollback
FROM pg_stat_database
WHERE datname = current_database();

-- 3. æ£€æŸ¥é”™è¯¯ç‡
SELECT
    datname,
    xact_rollback::float / NULLIF(xact_commit + xact_rollback, 0) * 100 as error_rate
FROM pg_stat_database
WHERE datname = current_database();

-- 4. æ£€æŸ¥é˜Ÿåˆ—å †ç§¯
SELECT
    COUNT(*) FILTER (WHERE state = 'active') as active_queries,
    COUNT(*) FILTER (WHERE wait_event_type IS NOT NULL) as waiting_queries,
    COUNT(*) as total_connections
FROM pg_stat_activity
WHERE datname = current_database();
```

### 4.2 æ­¥éª¤2: å¿«é€Ÿä½“æ£€

```sql
-- 1. è¿æ¥æ•°æ£€æŸ¥
SELECT
    COUNT(*) as total_connections,
    COUNT(*) FILTER (WHERE state = 'active') as active_connections,
    COUNT(*) FILTER (WHERE state = 'idle') as idle_connections,
    COUNT(*) FILTER (WHERE state = 'idle in transaction') as idle_in_transaction
FROM pg_stat_activity
WHERE datname = current_database();

-- 2. CPUåˆ©ç”¨ç‡ï¼ˆé€šè¿‡ç­‰å¾…äº‹ä»¶æ¨æ–­ï¼‰
SELECT
    wait_event_type,
    COUNT(*) as count,
    ROUND(100.0 * COUNT(*) / SUM(COUNT(*)) OVER (), 2) as percentage
FROM pg_stat_activity
WHERE wait_event_type IS NOT NULL
GROUP BY wait_event_type
ORDER BY count DESC;

-- 3. I/Oé¥±å’Œæ£€æŸ¥
SELECT
    datname,
    blks_read,
    blks_hit,
    ROUND(100.0 * blks_hit / NULLIF(blks_hit + blks_read, 0), 2) as cache_hit_ratio
FROM pg_stat_database
WHERE datname = current_database();

-- 4. WAL/æ£€æŸ¥ç‚¹æ£€æŸ¥
SELECT
    checkpoints_timed,
    checkpoints_req,
    checkpoint_write_time,
    checkpoint_sync_time,
    buffers_checkpoint,
    buffers_clean,
    buffers_backend
FROM pg_stat_bgwriter;

-- 5. Autovacuumæ»åæ£€æŸ¥
SELECT
    schemaname,
    tablename,
    n_dead_tup,
    n_live_tup,
    last_autovacuum,
    CASE
        WHEN n_live_tup > 0 THEN ROUND(100.0 * n_dead_tup / n_live_tup, 2)
        ELSE 0
    END as dead_tuple_percent
FROM pg_stat_user_tables
WHERE n_dead_tup > 10000
ORDER BY n_dead_tup DESC
LIMIT 20;
```

### 4.3 æ­¥éª¤3: TopNåˆ†æ

```sql
-- 1. TopNæ…¢æŸ¥è¯¢
SELECT
    queryid,
    LEFT(query, 200) as query_preview,
    calls,
    total_exec_time,
    mean_exec_time,
    max_exec_time,
    rows,
    ROUND(100.0 * shared_blks_hit / NULLIF(shared_blks_hit + shared_blks_read, 0), 2) as hit_ratio
FROM pg_stat_statements
ORDER BY total_exec_time DESC
LIMIT 10;

-- 2. TopNæ´»åŠ¨ä¼šè¯
SELECT
    pid,
    usename,
    application_name,
    state,
    wait_event_type,
    wait_event,
    query_start,
    NOW() - query_start as query_duration,
    LEFT(query, 100) as query_preview
FROM pg_stat_activity
WHERE state = 'active'
ORDER BY query_start
LIMIT 10;

-- 3. TopNç­‰å¾…äº‹ä»¶
SELECT
    wait_event_type,
    wait_event,
    COUNT(*) as count
FROM pg_stat_activity
WHERE wait_event_type IS NOT NULL
GROUP BY wait_event_type, wait_event
ORDER BY count DESC
LIMIT 10;
```

### 4.4 æ­¥éª¤4: è®¡åˆ’æ ¸æŸ¥

```sql
-- 1. æ‰§è¡ŒEXPLAIN ANALYZE
EXPLAIN (ANALYZE, BUFFERS, VERBOSE, COSTS, TIMING)
SELECT * FROM users WHERE email = 'user@example.com';

-- 2. åˆ†æè®¡åˆ’å…³é”®æŒ‡æ ‡
-- - Planning Time: è®¡åˆ’æ—¶é—´
-- - Execution Time: æ‰§è¡Œæ—¶é—´
-- - Buffers: shared hit/read/dirtied/written
-- - I/O Time: è¯»å–æ—¶é—´
-- - Rows: å®é™…è¡Œæ•° vs ä¼°ç®—è¡Œæ•°

-- 3. æ£€æŸ¥åŸºæ•°ä¼°ç®—è¯¯å·®
-- å¦‚æœå®é™…è¡Œæ•°ä¸ä¼°ç®—è¡Œæ•°å·®å¼‚å¤§ï¼Œéœ€è¦æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
ANALYZE users;

-- 4. æ£€æŸ¥å¹¶è¡Œåº¦
-- æŸ¥çœ‹è®¡åˆ’ä¸­æ˜¯å¦ä½¿ç”¨äº†å¹¶è¡Œå·¥ä½œè¿›ç¨‹
-- å¦‚æœåº”è¯¥å¹¶è¡Œä½†æ²¡æœ‰ï¼Œæ£€æŸ¥max_parallel_workers_per_gather

-- 5. æ£€æŸ¥I/Oå‘½ä¸­ç‡
-- shared hitåº”è¯¥å°½å¯èƒ½é«˜ï¼ˆ>95%ï¼‰
```

### 4.5 æ­¥éª¤5: ç­–ç•¥é€‰æ‹©

```sql
-- ç­–ç•¥1: ç´¢å¼•ä¼˜åŒ–
-- æ£€æŸ¥ç¼ºå¤±çš„ç´¢å¼•
SELECT
    schemaname,
    tablename,
    seq_scan,
    idx_scan,
    CASE
        WHEN seq_scan + idx_scan > 0
        THEN ROUND(100.0 * seq_scan / (seq_scan + idx_scan), 2)
        ELSE 0
    END as seq_scan_percent
FROM pg_stat_user_tables
WHERE seq_scan > 1000
AND seq_scan > idx_scan
ORDER BY seq_scan DESC
LIMIT 10;

-- ç­–ç•¥2: ç»Ÿè®¡ä¿¡æ¯ä¼˜åŒ–
ALTER TABLE users ALTER COLUMN email SET STATISTICS 1000;
CREATE STATISTICS users_email_stats (dependencies) ON email, created_at FROM users;
ANALYZE users;

-- ç­–ç•¥3: SQLé‡å†™
-- ä¼˜åŒ–æŸ¥è¯¢é€»è¾‘ï¼Œå‡å°‘æ•°æ®æ‰«æ

-- ç­–ç•¥4: å‚æ•°è°ƒæ•´
ALTER SYSTEM SET work_mem = '64MB';
SELECT pg_reload_conf();

-- ç­–ç•¥5: æ¶æ„æ”¹é€ 
-- åˆ†åŒºè¡¨ã€è¯»å†™åˆ†ç¦»ã€ç¼“å­˜å±‚ç­‰
```

### 4.6 æ­¥éª¤6: å°æ­¥å¿«è·‘

```bash
# 1. è®°å½•å˜æ›´å‰æŒ‡æ ‡
psql -c "
SELECT
    'baseline' as stage,
    NOW() as timestamp,
    (SELECT SUM(total_exec_time) FROM pg_stat_statements) as total_exec_time,
    (SELECT SUM(blks_hit)::float / NULLIF(SUM(blks_hit) + SUM(blks_read), 0) * 100
     FROM pg_stat_database WHERE datname = current_database()) as cache_hit_ratio
" > /tmp/baseline_metrics.txt

# 2. æ‰§è¡Œå•å˜é‡å˜æ›´
psql -c "ALTER SYSTEM SET work_mem = '64MB';"
psql -c "SELECT pg_reload_conf();"

# 3. ç­‰å¾…ç¨³å®šæœŸï¼ˆ5-10åˆ†é’Ÿï¼‰
sleep 300

# 4. è®°å½•å˜æ›´åæŒ‡æ ‡
psql -c "
SELECT
    'after_change' as stage,
    NOW() as timestamp,
    (SELECT SUM(total_exec_time) FROM pg_stat_statements) as total_exec_time,
    (SELECT SUM(blks_hit)::float / NULLIF(SUM(blks_hit) + SUM(blks_read), 0) * 100
     FROM pg_stat_database WHERE datname = current_database()) as cache_hit_ratio
" > /tmp/after_change_metrics.txt

# 5. å¯¹æ¯”æŒ‡æ ‡
diff /tmp/baseline_metrics.txt /tmp/after_change_metrics.txt

# 6. å†³å®šä¿ç•™æˆ–å›æ»š
# å¦‚æœæ€§èƒ½æå‡ï¼Œä¿ç•™å˜æ›´
# å¦‚æœæ€§èƒ½ä¸‹é™ï¼Œå›æ»š
```

### 4.7 æ­¥éª¤7: å›å½’å®ˆæŠ¤

```sql
-- 1. åˆ›å»ºå‘Šè­¦é˜ˆå€¼è¡¨
CREATE TABLE IF NOT EXISTS alert_thresholds (
    threshold_id SERIAL PRIMARY KEY,
    metric_name TEXT,
    warning_value NUMERIC,
    critical_value NUMERIC,
    auto_rollback BOOLEAN DEFAULT false
);

-- 2. è®¾ç½®å‘Šè­¦é˜ˆå€¼
INSERT INTO alert_thresholds (metric_name, warning_value, critical_value, auto_rollback) VALUES
('p95_latency', 100, 200, false),  -- æ¯«ç§’
('error_rate', 0.1, 1.0, true),    -- ç™¾åˆ†æ¯”
('cache_hit_ratio', 90, 85, false); -- ç™¾åˆ†æ¯”

-- 3. ç›‘æ§æŸ¥è¯¢ï¼ˆå®šæœŸæ‰§è¡Œï¼‰
SELECT
    metric_name,
    current_value,
    warning_value,
    critical_value,
    CASE
        WHEN current_value >= critical_value THEN 'CRITICAL'
        WHEN current_value >= warning_value THEN 'WARNING'
        ELSE 'OK'
    END as status
FROM (
    SELECT
        'p95_latency' as metric_name,
        (SELECT percentile_cont(0.95) WITHIN GROUP (ORDER BY mean_exec_time)
         FROM pg_stat_statements) as current_value,
        (SELECT critical_value FROM alert_thresholds WHERE metric_name = 'p95_latency') as critical_value,
        (SELECT warning_value FROM alert_thresholds WHERE metric_name = 'p95_latency') as warning_value
) sub;
```

## 5. å…¸å‹åœºæ™¯

- ç´¢å¼•/ç»Ÿè®¡ä¿¡æ¯ã€è¿æ¥æ± ã€å¹¶è¡Œã€å­˜å‚¨ä¸æ£€æŸ¥ç‚¹
- ç¤ºä¾‹æ’æŸ¥ä¸å¤„ç½®ï¼š
  - ä¼°ç®—åå·®â†’æ‰©å¤§ç»Ÿè®¡ç›®æ ‡æˆ–åˆ›å»ºæ‰©å±•ç»Ÿè®¡ï¼š

    ```sql
    ALTER TABLE t ALTER COLUMN c SET STATISTICS 2000;
    CREATE STATISTICS s_t_multi (dependencies) ON c1, c2 FROM t;  -- ç›¸å…³æ€§
    ANALYZE t;
    ```

  - ç´¢å¼•æœªå‘½ä¸­â†’è°“è¯å¯ç´¢å¼•åŒ–/è¡¨è¾¾å¼ç´¢å¼•/ç±»å‹ä¸€è‡´ï¼š

    ```sql
    CREATE INDEX idx_t_lower_email ON t (lower(email));
    -- ç¡®ä¿æŸ¥è¯¢ç”¨ lower(email) = ...
    ```

  - é”ç­‰å¾…â†’å®šä½æŒé”é•¿äº‹åŠ¡ä¸å†²çªè¯­å¥ï¼Œå¿…è¦æ—¶æ‹†åˆ†DDL/æ‰¹é‡ï¼š

    ```sql
    SELECT * FROM pg_locks l JOIN pg_stat_activity a USING(pid) WHERE NOT granted;
    ```

  - è†¨èƒ€â†’è¯„ä¼° `autovacuum`ã€é‡å»ºç´¢å¼•/è¡¨ï¼š

    ```sql
    REINDEX TABLE CONCURRENTLY t;
    VACUUM (VERBOSE, ANALYZE) t;
    ```

## 6. å·¥å…·ä¸æ–¹æ³•

- EXPLAIN(ANALYZE, BUFFERS)ã€pg_stat_statementsã€é‡‡æ ·/å‰–æ
- å¿…å¤‡æ‰©å±•ä¸è®¾ç½®ï¼š
  - `pg_stat_statements`ï¼š

    ```sql
    CREATE EXTENSION IF NOT EXISTS pg_stat_statements;
    SELECT query, calls, mean_time, rows
    FROM pg_stat_statements ORDER BY total_time DESC LIMIT 20;
    ```

  - `auto_explain`ï¼ˆå¼€å‘/é¢„ç”Ÿäº§å¯ç”¨ï¼Œç”Ÿäº§æ…ç”¨é«˜é˜ˆå€¼ï¼‰ï¼š

    ```text
    shared_preload_libraries = 'pg_stat_statements,auto_explain'
    auto_explain.log_min_duration = '200ms'
    auto_explain.log_analyze = on
    auto_explain.log_buffers = on
    auto_explain.log_nested_statements = on
    ```

  - é‡‡æ ·ä¸ç­‰å¾…åˆ†æï¼š`pg_wait_sampling`ã€`pg_stat_kcache`ã€eBPF/bcc å·¥å…·ï¼ˆå¦‚ `profile`, `offcputime`ï¼‰ã€‚

## 7. å‚æ•°è°ƒä¼˜æŒ‡å—ï¼ˆæŒ‰å­ç³»ç»Ÿï¼‰

- è¿æ¥ä¸å¹¶å‘ï¼š
- åº”ç”¨ä¼˜å…ˆè¿æ¥æ± ï¼š`pgbouncer`ï¼ˆtransaction æ¨¡å¼ï¼‰â†’ é™ä½ `max_connections` å‹åŠ›ã€‚
- `max_connections`ï¼šåŸºäºå†…å­˜é¢„ç®—ä¸å·¥ä½œè´Ÿè½½å¹¶å‘åº¦ï¼›è¿‡é«˜ä¼šæ‹‰ä½å‘½ä¸­ç‡ä¸ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚
- `work_mem`ï¼šæŒ‰å¹¶å‘æ’åº/å“ˆå¸Œæ“ä½œä¼°ç®—ï¼›å¸¸è§åŸºçº¿ 4â€“64MBï¼Œé¿å…å…¨å±€æ”¾å¤§å¯¼è‡´å†…å­˜çˆ†ã€‚
- ç¼“å†²ä¸ç¼“å­˜ï¼š
- `shared_buffers`ï¼šå¸¸è§ 25% ç‰©ç†å†…å­˜èµ·æ­¥ï¼ˆLinux+PageCache æƒ…å†µï¼‰ï¼Œè¶…å¤§æœªå¿…æ”¶ç›Šæ›´é«˜ã€‚
- `effective_cache_size`ï¼šä¼°è®¡ OS PageCache + shared_buffersï¼ˆå¦‚å†…å­˜ 64GB â†’ 48GBï¼‰ã€‚
- å¹¶è¡Œä¸JITï¼š
- `max_parallel_workers_per_gather`ï¼š2â€“4 èµ·æ­¥ï¼›`max_parallel_workers`â‰¥æ€»å¹¶è¡Œã€‚
- `jit`ï¼šOLTP å¤šä¸ºå…³é—­æˆ–é˜ˆå€¼è¾ƒé«˜ï¼›OLAP å¤§æŸ¥è¯¢æ”¶ç›Šæ˜æ˜¾ã€‚
- I/O ä¸å­˜å‚¨ï¼š
- `random_page_cost`ï¼šSSD é€šå¸¸ 1.1â€“1.5ï¼›`effective_io_concurrency`ï¼šNVMe å¯ 256ã€‚
- æ£€æŸ¥ç‚¹ï¼š`checkpoint_timeout` 10â€“30minã€`max_wal_size` 2â€“20GBã€`checkpoint_completion_target` 0.7â€“0.9ã€‚
- WAL ä¸æŒä¹…åŒ–ï¼š
- `wal_compression`=onï¼ˆå†™æ”¾å¤§ä¸‹é™ï¼ŒCPU â†‘ï¼‰ï¼›`synchronous_commit` æ ¹æ®ä¸€è‡´æ€§éœ€æ±‚è°ƒèŠ‚ï¼ˆå¼‚æ­¥æ‰¹é‡å†™å¯ offï¼‰ã€‚
- ç»´æŠ¤ä¸è‡ªæ¸…ç†ï¼š
- `autovacuum_vacuum_scale_factor` é™ä½ä»¥æŠ‘åˆ¶è†¨èƒ€ï¼ˆå¦‚ 0.1â†’0.02 é’ˆå¯¹å¤§è¡¨ï¼‰ï¼Œç»“åˆ `autovacuum_vacuum_threshold`ã€‚
- `maintenance_work_mem`ï¼šç´¢å¼•é‡å»º/å¹¶è¡Œç»´æŠ¤æ—¶æé«˜ï¼ˆ512MBâ€“4GBï¼‰ã€‚

### 7.1 è¿æ¥ä¸å¹¶å‘å‚æ•°

```sql
-- 1. max_connections
-- è®¡ç®—ï¼šè€ƒè™‘åº”ç”¨è¿æ¥æ•° + ç®¡ç†è¿æ¥ + å¤åˆ¶è¿æ¥
-- å»ºè®®ï¼š100-300ï¼ˆä½¿ç”¨è¿æ¥æ± æ—¶ï¼‰
-- å†…å­˜å½±å“ï¼šæ¯ä¸ªè¿æ¥çº¦æ¶ˆè€— 10MBï¼ˆwork_memç­‰ï¼‰

-- æŸ¥çœ‹å½“å‰è¿æ¥æ•°
SELECT COUNT(*) FROM pg_stat_activity;

-- æŸ¥çœ‹è¿æ¥æ•°ä½¿ç”¨ç‡
SELECT
    COUNT(*) as current_connections,
    current_setting('max_connections')::int as max_connections,
    ROUND(100.0 * COUNT(*) / current_setting('max_connections')::int, 2) as usage_percent
FROM pg_stat_activity;

-- é…ç½®å»ºè®®
ALTER SYSTEM SET max_connections = 200;
-- å¦‚æœä½¿ç”¨pgbouncerï¼Œå¯ä»¥é™ä½åˆ°100-150

-- 2. work_mem
-- è®¡ç®—ï¼šwork_mem * max_connections < æ€»å†…å­˜çš„25%
-- å»ºè®®ï¼š4-64MBï¼Œæ ¹æ®æŸ¥è¯¢å¤æ‚åº¦è°ƒæ•´

-- æŸ¥çœ‹work_memä½¿ç”¨æƒ…å†µ
SELECT
    pid,
    usename,
    query,
    work_mem_used,
    work_mem_max
FROM pg_stat_activity
WHERE work_mem_used > 0
ORDER BY work_mem_used DESC;

-- é…ç½®å»ºè®®ï¼ˆæ ¹æ®å¹¶å‘æŸ¥è¯¢æ•°ï¼‰
-- 10ä¸ªå¹¶å‘ï¼šwork_mem = 64MB
-- 50ä¸ªå¹¶å‘ï¼šwork_mem = 16MB
-- 100ä¸ªå¹¶å‘ï¼šwork_mem = 8MB
ALTER SYSTEM SET work_mem = '16MB';

-- 3. superuser_reserved_connections
-- ä¸ºè¶…çº§ç”¨æˆ·ä¿ç•™çš„è¿æ¥æ•°
ALTER SYSTEM SET superuser_reserved_connections = 3;
```

### 7.2 ç¼“å†²ä¸ç¼“å­˜å‚æ•°

```sql
-- 1. shared_buffers
-- å»ºè®®ï¼šç³»ç»Ÿå†…å­˜çš„25%ï¼ˆLinuxï¼‰ï¼ŒWindowså¯ä»¥æ›´é«˜
-- 64GBå†…å­˜ï¼š16GB shared_buffers

-- æŸ¥çœ‹å½“å‰é…ç½®
SHOW shared_buffers;

-- æŸ¥çœ‹ç¼“å†²å‘½ä¸­ç‡
SELECT
    datname,
    ROUND(100.0 * blks_hit / NULLIF(blks_hit + blks_read, 0), 2) as hit_ratio
FROM pg_stat_database
WHERE datname = current_database();

-- é…ç½®å»ºè®®
ALTER SYSTEM SET shared_buffers = '16GB';  -- 64GBç³»ç»Ÿ

-- 2. effective_cache_size
-- å»ºè®®ï¼šç³»ç»Ÿå†…å­˜çš„50-75%
-- 64GBå†…å­˜ï¼š32-48GB

ALTER SYSTEM SET effective_cache_size = '32GB';

-- 3. éªŒè¯é…ç½®
SELECT
    name,
    setting,
    unit,
    source
FROM pg_settings
WHERE name IN ('shared_buffers', 'effective_cache_size', 'work_mem');
```

### 7.3 å¹¶è¡Œä¸JITå‚æ•°

```sql
-- 1. å¹¶è¡Œå‚æ•°
-- max_parallel_workers_per_gather: æ¯ä¸ªæŸ¥è¯¢çš„æœ€å¤§å¹¶è¡Œå·¥ä½œè¿›ç¨‹æ•°
-- max_parallel_workers: ç³»ç»Ÿæœ€å¤§å¹¶è¡Œå·¥ä½œè¿›ç¨‹æ€»æ•°
-- max_worker_processes: ç³»ç»Ÿæœ€å¤§å·¥ä½œè¿›ç¨‹æ•°

-- æŸ¥çœ‹å¹¶è¡Œä½¿ç”¨æƒ…å†µ
SELECT
    pid,
    usename,
    query,
    parallel_workers
FROM pg_stat_activity
WHERE parallel_workers > 0;

-- é…ç½®å»ºè®®
ALTER SYSTEM SET max_parallel_workers_per_gather = 4;
ALTER SYSTEM SET max_parallel_workers = 8;
ALTER SYSTEM SET max_worker_processes = 16;

-- 2. JITå‚æ•°
-- OLTP: å…³é—­æˆ–è®¾ç½®é«˜é˜ˆå€¼
-- OLAP: å¯ç”¨ï¼Œé˜ˆå€¼è¾ƒä½

-- æŸ¥çœ‹JITä½¿ç”¨æƒ…å†µ
SELECT
    jit_functions,
    jit_generation_time,
    jit_inlining_count,
    jit_optimization_count
FROM pg_stat_statements
WHERE jit_functions > 0
LIMIT 10;

-- OLTPé…ç½®ï¼ˆå…³é—­JITï¼‰
ALTER SYSTEM SET jit = off;

-- OLAPé…ç½®ï¼ˆå¯ç”¨JITï¼‰
ALTER SYSTEM SET jit = on;
ALTER SYSTEM SET jit_above_cost = 100000;
ALTER SYSTEM SET jit_optimize_above_cost = 500000;
ALTER SYSTEM SET jit_inline_above_cost = 500000;
```

### 7.4 I/Oä¸å­˜å‚¨å‚æ•°

```sql
-- 1. random_page_cost
-- SSD: 1.1-1.5
-- HDD: 4.0ï¼ˆé»˜è®¤ï¼‰
-- NVMe: 1.0-1.1

-- æŸ¥çœ‹I/Oç»Ÿè®¡
SELECT
    datname,
    blks_read,
    blks_hit,
    ROUND(100.0 * blks_hit / NULLIF(blks_hit + blks_read, 0), 2) as hit_ratio
FROM pg_stat_database
WHERE datname = current_database();

-- SSDé…ç½®
ALTER SYSTEM SET random_page_cost = 1.1;

-- 2. effective_io_concurrency
-- SSD: 200
-- NVMe: 256
-- HDD: 2

ALTER SYSTEM SET effective_io_concurrency = 200;

-- 3. æ£€æŸ¥ç‚¹å‚æ•°
-- checkpoint_timeout: æ£€æŸ¥ç‚¹é—´éš”ï¼ˆ10-30åˆ†é’Ÿï¼‰
-- max_wal_size: æœ€å¤§WALå¤§å°ï¼ˆ2-20GBï¼‰
-- checkpoint_completion_target: æ£€æŸ¥ç‚¹å®Œæˆç›®æ ‡ï¼ˆ0.7-0.9ï¼‰

-- æŸ¥çœ‹æ£€æŸ¥ç‚¹ç»Ÿè®¡
SELECT
    checkpoints_timed,
    checkpoints_req,
    checkpoint_write_time,
    checkpoint_sync_time
FROM pg_stat_bgwriter;

-- é…ç½®å»ºè®®
ALTER SYSTEM SET checkpoint_timeout = '15min';
ALTER SYSTEM SET max_wal_size = '4GB';
ALTER SYSTEM SET checkpoint_completion_target = 0.9;
```

### 7.5 WALä¸æŒä¹…åŒ–å‚æ•°

```sql
-- 1. wal_compression
-- å¯ç”¨å‹ç¼©å¯ä»¥å‡å°‘WALå¤§å°ï¼Œä½†å¢åŠ CPUä½¿ç”¨
ALTER SYSTEM SET wal_compression = on;

-- 2. synchronous_commit
-- local: æœ¬åœ°æäº¤å³å¯ï¼ˆæœ€å¿«ï¼Œå¯èƒ½ä¸¢æ•°æ®ï¼‰
-- remote_write: ç­‰å¾…å†™å…¥ä»åº“OSç¼“å­˜ï¼ˆæ¨èï¼‰
-- remote_apply: ç­‰å¾…ä»åº“åº”ç”¨ï¼ˆæœ€ä¸¥æ ¼ï¼Œæœ€æ…¢ï¼‰
-- off: ç­‰åŒäºlocalï¼ˆå·²åºŸå¼ƒï¼‰

-- æŸ¥çœ‹å½“å‰é…ç½®
SHOW synchronous_commit;

-- é…ç½®å»ºè®®ï¼ˆæ ¹æ®RPOéœ€æ±‚ï¼‰
ALTER SYSTEM SET synchronous_commit = 'remote_write';

-- 3. wal_buffers
-- å»ºè®®ï¼š16MBï¼ˆPostgreSQL 9.1+è‡ªåŠ¨è°ƒæ•´ï¼‰
ALTER SYSTEM SET wal_buffers = '16MB';

-- 4. min_wal_size / max_wal_size
ALTER SYSTEM SET min_wal_size = '1GB';
ALTER SYSTEM SET max_wal_size = '4GB';
```

### 7.6 ç»´æŠ¤ä¸è‡ªæ¸…ç†å‚æ•°

```sql
-- 1. autovacuumå‚æ•°
-- autovacuum_vacuum_scale_factor: è§¦å‘VACUUMçš„æ­»å…ƒç»„æ¯”ä¾‹
-- autovacuum_analyze_scale_factor: è§¦å‘ANALYZEçš„å˜æ›´æ¯”ä¾‹
-- autovacuum_vacuum_threshold: è§¦å‘VACUUMçš„æœ€å°æ­»å…ƒç»„æ•°

-- æŸ¥çœ‹autovacuumæ´»åŠ¨
SELECT
    schemaname,
    tablename,
    last_vacuum,
    last_autovacuum,
    last_analyze,
    last_autoanalyze,
    n_dead_tup,
    n_live_tup
FROM pg_stat_user_tables
WHERE n_dead_tup > 10000
ORDER BY n_dead_tup DESC
LIMIT 20;

-- å…¨å±€é…ç½®
ALTER SYSTEM SET autovacuum_vacuum_scale_factor = 0.1;
ALTER SYSTEM SET autovacuum_analyze_scale_factor = 0.05;
ALTER SYSTEM SET autovacuum_vacuum_threshold = 50;

-- è¡¨çº§é…ç½®ï¼ˆå¤§è¡¨ï¼‰
ALTER TABLE large_table SET (
    autovacuum_vacuum_scale_factor = 0.02,
    autovacuum_analyze_scale_factor = 0.01
);

-- 2. maintenance_work_mem
-- ç”¨äºVACUUMã€CREATE INDEXç­‰ç»´æŠ¤æ“ä½œ
-- å»ºè®®ï¼š512MB-4GB

ALTER SYSTEM SET maintenance_work_mem = '1GB';

-- 3. autovacuum_max_workers
-- åŒæ—¶è¿è¡Œçš„autovacuumå·¥ä½œè¿›ç¨‹æ•°
ALTER SYSTEM SET autovacuum_max_workers = 3;
```

## 8. æŸ¥è¯¢å±‚ä¼˜åŒ–ç­–ç•¥

- ä»£ä»·å¯¹é½ï¼šæ ¡å‡† `default_statistics_target`ï¼ˆ100â€“500ï¼‰ä¸æ‰©å±•ç»Ÿè®¡ï¼Œé™ä½é”™è¯¯é€‰æ‹©ç‡ã€‚
- è®¿é—®è·¯å¾„ï¼šè¦†ç›–ç´¢å¼•ã€è¡¨è¾¾å¼/éƒ¨åˆ†ç´¢å¼•ã€BitmapScan èšåˆå›è¡¨æˆæœ¬ã€‚
- è¿æ¥ç­–ç•¥ï¼šå°è¡¨é©±åŠ¨ã€åˆé€‚çš„è¿æ¥é¡ºåºã€é¿å…éšå¼ç±»å‹è½¬æ¢å¯¼è‡´ Seq Scanã€‚

### 8.1 ä»£ä»·å¯¹é½ä¼˜åŒ–

```sql
-- 1. è°ƒæ•´ç»Ÿè®¡ç›®æ ‡
-- default_statistics_target: é»˜è®¤100ï¼Œå¯ä»¥æé«˜åˆ°200-500

-- æŸ¥çœ‹å½“å‰ç»Ÿè®¡ç›®æ ‡
SHOW default_statistics_target;

-- å…¨å±€é…ç½®
ALTER SYSTEM SET default_statistics_target = 200;

-- åˆ—çº§é…ç½®ï¼ˆé‡è¦åˆ—ï¼‰
ALTER TABLE users ALTER COLUMN email SET STATISTICS 500;
ALTER TABLE orders ALTER COLUMN user_id SET STATISTICS 300;

-- æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
ANALYZE users;
ANALYZE orders;

-- 2. åˆ›å»ºæ‰©å±•ç»Ÿè®¡
-- ç›¸å…³æ€§ç»Ÿè®¡
CREATE STATISTICS users_email_created_stats (dependencies)
ON email, created_at FROM users;

-- å¤šåˆ—ç»Ÿè®¡
CREATE STATISTICS orders_user_date_stats (dependencies, ndistinct)
ON user_id, order_date FROM orders;

-- æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
ANALYZE users;
ANALYZE orders;

-- 3. éªŒè¯ç»Ÿè®¡ä¿¡æ¯è´¨é‡
SELECT
    schemaname,
    tablename,
    attname,
    n_distinct,
    correlation,
    most_common_vals,
    most_common_freqs
FROM pg_stats
WHERE schemaname = 'public'
AND tablename = 'users'
AND attname = 'email';
```

### 8.2 è®¿é—®è·¯å¾„ä¼˜åŒ–

```sql
-- 1. è¦†ç›–ç´¢å¼•ï¼ˆINCLUDEåˆ—ï¼‰
-- é¿å…å›è¡¨ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½
CREATE INDEX idx_users_email_covering ON users (email) INCLUDE (name, created_at);

-- æŸ¥è¯¢éªŒè¯
EXPLAIN (ANALYZE, BUFFERS)
SELECT name, created_at FROM users WHERE email = 'user@example.com';
-- åº”è¯¥æ˜¾ç¤ºIndex Only Scan

-- 2. è¡¨è¾¾å¼ç´¢å¼•
-- æ”¯æŒå‡½æ•°æŸ¥è¯¢
CREATE INDEX idx_users_lower_email ON users (lower(email));

-- æŸ¥è¯¢å¿…é¡»ä½¿ç”¨ç›¸åŒçš„è¡¨è¾¾å¼
EXPLAIN (ANALYZE, BUFFERS)
SELECT * FROM users WHERE lower(email) = 'user@example.com';
-- åº”è¯¥ä½¿ç”¨ç´¢å¼•

-- 3. éƒ¨åˆ†ç´¢å¼•
-- åªç´¢å¼•éƒ¨åˆ†æ•°æ®ï¼Œå‡å°‘ç´¢å¼•å¤§å°
CREATE INDEX idx_orders_active ON orders (user_id, order_date)
WHERE status = 'active';

-- æŸ¥è¯¢éªŒè¯
EXPLAIN (ANALYZE, BUFFERS)
SELECT * FROM orders WHERE user_id = 123 AND status = 'active';
-- åº”è¯¥ä½¿ç”¨éƒ¨åˆ†ç´¢å¼•

-- 4. å¤åˆç´¢å¼•ä¼˜åŒ–
-- è€ƒè™‘åˆ—çš„é€‰æ‹©æ€§å’ŒæŸ¥è¯¢æ¨¡å¼
CREATE INDEX idx_orders_user_date_status ON orders (user_id, order_date DESC, status);

-- æŸ¥è¯¢éªŒè¯
EXPLAIN (ANALYZE, BUFFERS)
SELECT * FROM orders
WHERE user_id = 123
AND order_date >= '2024-01-01'
AND status = 'active'
ORDER BY order_date DESC;
```

### 8.3 è¿æ¥ç­–ç•¥ä¼˜åŒ–

```sql
-- 1. å°è¡¨é©±åŠ¨å¤§è¡¨
-- ç¡®ä¿å°è¡¨åœ¨JOINçš„å³ä¾§ï¼ˆå¦‚æœå¯èƒ½ï¼‰

-- é”™è¯¯ç¤ºä¾‹ï¼šå¤§è¡¨é©±åŠ¨å°è¡¨
EXPLAIN (ANALYZE, BUFFERS)
SELECT u.name, o.total
FROM large_orders o
JOIN small_users u ON o.user_id = u.id;

-- ä¼˜åŒ–ï¼šè°ƒæ•´JOINé¡ºåºæˆ–ä½¿ç”¨å­æŸ¥è¯¢
EXPLAIN (ANALYZE, BUFFERS)
SELECT u.name, o.total
FROM small_users u
JOIN large_orders o ON u.id = o.user_id;

-- 2. é¿å…éšå¼ç±»å‹è½¬æ¢
-- ç¡®ä¿JOINé”®ç±»å‹ä¸€è‡´

-- é”™è¯¯ç¤ºä¾‹ï¼šç±»å‹ä¸åŒ¹é…
SELECT u.id, o.user_id
FROM users u
JOIN orders o ON u.id::text = o.user_id;  -- ç±»å‹è½¬æ¢å¯¼è‡´Seq Scan

-- æ­£ç¡®ç¤ºä¾‹ï¼šç±»å‹ä¸€è‡´
SELECT u.id, o.user_id
FROM users u
JOIN orders o ON u.id = o.user_id::int;  -- æˆ–ä¿®æ”¹è¡¨ç»“æ„ä½¿ç±»å‹ä¸€è‡´

-- 3. ä½¿ç”¨åˆé€‚çš„è¿æ¥ç®—æ³•
-- Hash Join: é€‚åˆå¤§è¡¨JOIN
-- Nested Loop: é€‚åˆå°è¡¨JOIN
-- Merge Join: é€‚åˆå·²æ’åºçš„æ•°æ®

-- å¼ºåˆ¶è¿æ¥ç®—æ³•ï¼ˆä»…ç”¨äºæµ‹è¯•ï¼‰
SET enable_hashjoin = on;
SET enable_nestloop = on;
SET enable_mergejoin = on;

-- 4. è¿æ¥é¡ºåºä¼˜åŒ–
-- ä½¿ç”¨JOIN_COLLAPSE_LIMITæ§åˆ¶è¿æ¥é¡ºåº
SET join_collapse_limit = 8;  -- é»˜è®¤8ï¼Œå¯ä»¥è°ƒæ•´
```

### 8.4 æŸ¥è¯¢é‡å†™ä¼˜åŒ–

```sql
-- 1. é¿å…SELECT *
-- åªé€‰æ‹©éœ€è¦çš„åˆ—
SELECT id, name, email FROM users WHERE id = 123;
-- è€Œä¸æ˜¯
SELECT * FROM users WHERE id = 123;

-- 2. ä½¿ç”¨LIMIT
-- é™åˆ¶è¿”å›è¡Œæ•°
SELECT * FROM orders WHERE user_id = 123 ORDER BY order_date DESC LIMIT 10;

-- 3. ä½¿ç”¨EXISTSä»£æ›¿COUNT
-- EXISTSåœ¨æ‰¾åˆ°ç¬¬ä¸€æ¡è®°å½•åç«‹å³è¿”å›
SELECT * FROM users u
WHERE EXISTS (SELECT 1 FROM orders o WHERE o.user_id = u.id);
-- è€Œä¸æ˜¯
SELECT * FROM users u
WHERE (SELECT COUNT(*) FROM orders o WHERE o.user_id = u.id) > 0;

-- 4. é¿å…åœ¨WHEREå­å¥ä¸­ä½¿ç”¨å‡½æ•°
-- é”™è¯¯ç¤ºä¾‹
SELECT * FROM users WHERE DATE(created_at) = '2024-01-01';

-- æ­£ç¡®ç¤ºä¾‹
SELECT * FROM users
WHERE created_at >= '2024-01-01' AND created_at < '2024-01-02';

-- 5. ä½¿ç”¨UNION ALLä»£æ›¿UNIONï¼ˆå¦‚æœä¸éœ€è¦å»é‡ï¼‰
SELECT id, name FROM users WHERE id < 100
UNION ALL
SELECT id, name FROM users WHERE id >= 100;
-- è€Œä¸æ˜¯
SELECT id, name FROM users WHERE id < 100
UNION
SELECT id, name FROM users WHERE id >= 100;
```

- åˆ†åŒºä¸è£å‰ªï¼šæ—¶é—´/èŒƒå›´åˆ†åŒºï¼Œç¡®ä¿è°“è¯å¯è£å‰ªï¼›é¿å…è¿‡å¤šåˆ†åŒºå¯¼è‡´è®¡åˆ’æ—¶é—´æš´æ¶¨ã€‚
- å¹¶è¡Œï¼šç¡®ä¿è¿ç®—ç¬¦ä¸å‡½æ•°å¯å¹¶è¡Œï¼ˆimmutable/parallel safeï¼‰ã€‚

## 9. å­˜å‚¨ä¸è¡¨è®¾è®¡

- `fillfactor`ï¼šå†™å¤šè¡¨é™ä½ï¼ˆ80â€“90ï¼‰å‡å°‘é¡µåˆ†è£‚ï¼›è¯»å¤šä¿å®ˆæé«˜ç©ºé—´åˆ©ç”¨ã€‚
- TOAST/å‹ç¼©ï¼š9.5+ è‡ªé€‚åº”ï¼›PG15+ LZ4/ZSTDï¼ˆéœ€ç¼–è¯‘/è®¾ç½®ï¼‰å¯é™I/Oã€‚
- å†·çƒ­åˆ†å±‚ï¼šçƒ­è¡¨çƒ­ç´¢å¼•ç½®é«˜é€Ÿç›˜ï¼Œå†å²åˆ†åŒºè¿ç§»å†·ç›˜ï¼›å½’æ¡£è¡¨ä½¿ç”¨å‹ç¼©ä¸åªè¯»ç­–ç•¥ã€‚

## 10. å…¸å‹å·¥ä½œè´Ÿè½½åŸºçº¿

- OLTPï¼š
  - pgbouncer(transaction)ã€è¾ƒå° `work_mem`ï¼ˆ8â€“32MBï¼‰ã€`shared_buffers` 20â€“30%ã€JIT å…³é—­ã€`synchronous_commit=on`ï¼ˆé‡è¦äº¤æ˜“ï¼‰ã€‚
  - å¼ºåŒ– Autovacuum ä¸çƒ­ç‚¹ç´¢å¼•ã€ä½å»¶è¿Ÿæ£€æŸ¥ç‚¹é…ç½®ã€‚
- OLAPï¼š
  - å¹¶è¡Œå¼€å¯ï¼ˆ2â€“4ï¼‰ã€`work_mem` 64â€“512MBã€JIT æ‰“å¼€ï¼ˆé˜ˆå€¼ â‰¥200msï¼‰ã€`random_page_cost` ä½ã€`effective_io_concurrency` é«˜ã€‚
  - å®½è¡¨ã€åˆ—å¼å¤–éƒ¨å¼•æ“/FDWã€åˆ†åŒºè£å‰ªä¸ç‰©åŒ–ä¸­é—´ç»“æœã€‚
- æ··åˆï¼šåˆ†ç¦»è¯»å†™æ± ã€OLAP åœ¨åªè¯»å‰¯æœ¬è·‘ã€ä¸»åº“ä¿å®ˆå‚æ•°ã€‚

## 11. éªŒè¯ä¸å›å½’

- åŸºå‡†æ•°æ®ï¼šTPS/QPSã€P95/P99ã€é˜Ÿåˆ—é•¿åº¦ã€å‘½ä¸­ç‡ã€WALé€Ÿç‡ã€æ£€æŸ¥ç‚¹é¢‘ç‡ã€Vacuumæ»åã€é”ç­‰å¾…ã€‚
- å¯¹æ¯”æ–¹æ³•ï¼šè°ƒä¼˜å‰å 30â€“60 åˆ†é’Ÿç¨³å®šçª—å£ï¼›ä¸šåŠ¡ä½å³°ç°åº¦ 5â€“10% æµé‡ã€‚
- å›æ»šè§¦å‘ï¼šP95 æ¶åŒ–>10%ã€é”™è¯¯ç‡å‡é«˜ã€é”å†²çªä¸Šå‡ã€ç³»ç»Ÿè´Ÿè½½å¼‚å¸¸ã€‚

## 12. PostgreSQL 18 æ–°ç‰¹æ€§åº”ç”¨

### å¼‚æ­¥ I/O ä¼˜åŒ–

PostgreSQL 18 çš„å¼‚æ­¥ I/O å­ç³»ç»Ÿå¯ä»¥æ˜¾è‘—æå‡I/Oå¯†é›†å‹æ“ä½œçš„æ€§èƒ½ï¼š

```sql
-- PostgreSQL 18: å¼‚æ­¥ I/O è‡ªåŠ¨å¯ç”¨
-- æ— éœ€é¢å¤–é…ç½®ï¼Œç³»ç»Ÿè‡ªåŠ¨ä¼˜åŒ–I/Oæ“ä½œ
-- ç‰¹åˆ«é€‚ç”¨äºï¼š
-- - å¤§è§„æ¨¡å‘é‡æ£€ç´¢
-- - æ‰¹é‡æ•°æ®å¯¼å…¥
-- - å¹¶è¡ŒæŸ¥è¯¢
```

**æ€§èƒ½æå‡**:

- å‘é‡ç´¢å¼•æ„å»ºé€Ÿåº¦æå‡ 40%+
- å¤§è§„æ¨¡æŸ¥è¯¢I/Oæ€§èƒ½æå‡ 2-3å€
- æ›´å¥½çš„å¹¶å‘å¤„ç†èƒ½åŠ›

### è™šæ‹Ÿç”Ÿæˆåˆ—ä¼˜åŒ–

PostgreSQL 18 çš„è™šæ‹Ÿç”Ÿæˆåˆ—å¯ä»¥ä¼˜åŒ–è®¡ç®—å¯†é›†å‹æŸ¥è¯¢ï¼š

```sql
-- PostgreSQL 18: ä½¿ç”¨è™šæ‹Ÿç”Ÿæˆåˆ—ä¼˜åŒ–æŸ¥è¯¢
CREATE TABLE products (
    id UUID PRIMARY KEY,
    price DECIMAL(10,2),
    discount_rate FLOAT,
    -- è™šæ‹Ÿç”Ÿæˆåˆ—ï¼šè‡ªåŠ¨è®¡ç®—æœ€ç»ˆä»·æ ¼
    final_price DECIMAL(10,2) GENERATED ALWAYS AS (
        price * (1 - discount_rate)
    ) STORED
);

-- æŸ¥è¯¢æ—¶ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€é‡å¤è®¡ç®—
SELECT id, final_price FROM products WHERE final_price > 100;
```

**ä¼˜åŠ¿**:

- æŸ¥è¯¢æ€§èƒ½æå‡ 15-25%
- æ”¯æŒç´¢å¼•ä¼˜åŒ–
- å‡å°‘é‡å¤è®¡ç®—

---

## 13. å®æˆ˜æ¡ˆä¾‹

### æ¡ˆä¾‹1: OLTPç³»ç»Ÿè°ƒä¼˜

**åœºæ™¯**: ç”µå•†è®¢å•ç³»ç»Ÿï¼Œé«˜å¹¶å‘å†™å…¥ï¼Œä½å»¶è¿ŸæŸ¥è¯¢

**è°ƒä¼˜æ–¹æ¡ˆ**:

```sql
-- è¿æ¥æ± é…ç½®
-- pgbouncer transactionæ¨¡å¼
max_client_conn = 1000
default_pool_size = 25

-- PostgreSQLå‚æ•°
max_connections = 200
shared_buffers = 8GB  -- 25% of 32GB RAM
work_mem = 16MB
effective_cache_size = 24GB
random_page_cost = 1.1  -- SSD
effective_io_concurrency = 200  -- NVMe

-- ç´¢å¼•ä¼˜åŒ–
CREATE INDEX CONCURRENTLY idx_orders_user_created
ON orders(user_id, created_at DESC);
```

**æ•ˆæœ**: QPSæå‡40%ï¼ŒP99å»¶è¿Ÿé™ä½30%

### æ¡ˆä¾‹2: OLAPåˆ†æç³»ç»Ÿè°ƒä¼˜

**åœºæ™¯**: æ•°æ®ä»“åº“ï¼Œå¤æ‚èšåˆæŸ¥è¯¢ï¼Œæ‰¹é‡åˆ†æ

**è°ƒä¼˜æ–¹æ¡ˆ**:

```sql
-- PostgreSQLå‚æ•°
max_parallel_workers_per_gather = 4
max_parallel_workers = 16
work_mem = 256MB
shared_buffers = 16GB
effective_cache_size = 48GB
jit = on
jit_above_cost = 200000

-- åˆ†åŒºè¡¨ä¼˜åŒ–
CREATE TABLE sales (
    sale_date DATE,
    product_id INT,
    amount DECIMAL(10,2)
) PARTITION BY RANGE (sale_date);

-- åˆ›å»ºæœˆåº¦åˆ†åŒº
CREATE TABLE sales_2025_01 PARTITION OF sales
FOR VALUES FROM ('2025-01-01') TO ('2025-02-01');
```

**æ•ˆæœ**: å¤æ‚æŸ¥è¯¢æ€§èƒ½æå‡60%ï¼Œå¹¶è¡Œåˆ©ç”¨ç‡æå‡50%

### æ¡ˆä¾‹3: æ··åˆè´Ÿè½½è°ƒä¼˜

**åœºæ™¯**: è¯»å†™æ··åˆï¼Œéœ€è¦å¹³è¡¡OLTPå’ŒOLAPæ€§èƒ½

**è°ƒä¼˜æ–¹æ¡ˆ**:

```sql
-- è¯»å†™åˆ†ç¦»
-- ä¸»åº“ï¼ˆOLTPï¼‰
max_connections = 200
work_mem = 16MB
shared_buffers = 8GB
jit = off

-- åªè¯»å‰¯æœ¬ï¼ˆOLAPï¼‰
max_connections = 100
work_mem = 256MB
shared_buffers = 16GB
jit = on
max_parallel_workers_per_gather = 4
```

**æ•ˆæœ**: OLTPå»¶è¿Ÿç¨³å®šï¼ŒOLAPæŸ¥è¯¢æ€§èƒ½æå‡50%

---

## 14. æ·±å…¥é˜…è¯»

### ç›¸å…³æ–‡æ¡£

#### æŸ¥è¯¢ä¸ä¼˜åŒ–

- â­â­â­ [æ‰§è¡Œè®¡åˆ’ä¸æ€§èƒ½è°ƒä¼˜](../../03-æŸ¥è¯¢ä¸ä¼˜åŒ–/02.04-æ‰§è¡Œè®¡åˆ’ä¸æ€§èƒ½è°ƒä¼˜.md) - æŸ¥è¯¢ä¼˜åŒ–
- â­â­ [æŸ¥è¯¢ä¼˜åŒ–å™¨åŸç†](../../03-æŸ¥è¯¢ä¸ä¼˜åŒ–/02.01-æŸ¥è¯¢ä¼˜åŒ–å™¨åŸç†.md) - æŸ¥è¯¢ä¼˜åŒ–åŸºç¡€
- â­â­ [ç´¢å¼•ç»“æ„ä¸ä¼˜åŒ–](../../03-æŸ¥è¯¢ä¸ä¼˜åŒ–/02.02-ç´¢å¼•ç»“æ„ä¸ä¼˜åŒ–.md) - ç´¢å¼•ä¼˜åŒ–
- â­â­ [ç»Ÿè®¡ä¿¡æ¯ä¸ä»£ä»·æ¨¡å‹](../../03-æŸ¥è¯¢ä¸ä¼˜åŒ–/02.03-ç»Ÿè®¡ä¿¡æ¯ä¸ä»£ä»·æ¨¡å‹.md) - ç»Ÿè®¡ä¿¡æ¯ç®¡ç†

#### æ ¸å¿ƒè¯¾ç¨‹

- â­â­ [ç³»ç»Ÿæ¶æ„ä¸è®¾è®¡åŸç†](../../01-æ ¸å¿ƒè¯¾ç¨‹/01.01-ç³»ç»Ÿæ¶æ„ä¸è®¾è®¡åŸç†.md) - ç³»ç»Ÿæ¶æ„åŸºç¡€
- â­â­ [å­˜å‚¨ç®¡ç†ä¸æ•°æ®æŒä¹…åŒ–](../../01-æ ¸å¿ƒè¯¾ç¨‹/01.06-å­˜å‚¨ç®¡ç†ä¸æ•°æ®æŒä¹…åŒ–.md) - å­˜å‚¨ä¼˜åŒ–

#### è¿ç»´å®è·µ

- â­â­â­ [ç›‘æ§ä¸è¯Šæ–­](../../06-è¿ç»´å®è·µ/ç›‘æ§ä¸è¯Šæ–­/06.01-ç›‘æ§ä¸è¯Šæ–­.md) - æ€§èƒ½ç›‘æ§
- â­â­ [æ€§èƒ½è°ƒä¼˜å˜æ›´é—­ç¯](../../06-è¿ç»´å®è·µ/ç›‘æ§ä¸è¯Šæ–­/06.03-æ€§èƒ½è°ƒä¼˜å˜æ›´é—­ç¯.md) - å˜æ›´ç®¡ç†
- â­â­ [æ€§èƒ½é—®é¢˜-æ¡ˆä¾‹åº“](../../09-åº”ç”¨è®¾è®¡/è¡Œä¸šæ¡ˆä¾‹/æ€§èƒ½é—®é¢˜-æ¡ˆä¾‹åº“.md) - æ€§èƒ½é—®é¢˜æ¡ˆä¾‹

#### å‰æ²¿æŠ€æœ¯

- â­â­ [å‘é‡æ£€ç´¢æ€§èƒ½è°ƒä¼˜](../../07-å‰æ²¿æŠ€æœ¯/05.05-å‘é‡æ£€ç´¢æ€§èƒ½è°ƒä¼˜æŒ‡å—.md) - å‘é‡æ£€ç´¢ä¼˜åŒ–

#### ç‰ˆæœ¬ç‰¹æ€§

- â­â­ [PostgreSQL 18æ–°ç‰¹æ€§](../../02-ç‰ˆæœ¬ç‰¹æ€§/02.01-PostgreSQL-18-æ–°ç‰¹æ€§.md) - PostgreSQL 18æ€§èƒ½ä¼˜åŒ–

### å¤–éƒ¨èµ„æº

- [PostgreSQLæ€§èƒ½è°ƒä¼˜æŒ‡å—](https://www.postgresql.org/docs/current/performance-tips.html)
- [pg_stat_statementsæ–‡æ¡£](https://www.postgresql.org/docs/current/pgstatstatements.html)
- [PostgreSQLé…ç½®å‚æ•°](https://www.postgresql.org/docs/current/runtime-config.html)

---

## 15. å‚è€ƒæ–‡çŒ®

1. PostgreSQL Global Development Group. (2025). PostgreSQL 18 Documentation. <https://www.postgresql.org/docs/18/>
2. PostgreSQLå®˜æ–¹æ–‡æ¡£ - [æ€§èƒ½è°ƒä¼˜](https://www.postgresql.org/docs/current/performance-tips.html)
3. PostgreSQLå®˜æ–¹æ–‡æ¡£ - [é…ç½®å‚æ•°](https://www.postgresql.org/docs/current/runtime-config.html)
4. PostgreSQLå®˜æ–¹æ–‡æ¡£ - [pg_stat_statements](https://www.postgresql.org/docs/current/pgstatstatements.html)
5. PostgreSQLå®˜æ–¹æ–‡æ¡£ - [EXPLAIN](https://www.postgresql.org/docs/current/sql-explain.html)
6. TimescaleDB - [æ€§èƒ½è°ƒä¼˜æœ€ä½³å®è·µ](https://docs.timescale.com/timescaledb/latest/how-to-guides/performance/)
7. PostgreSQL Global Development Group. (2024). PostgreSQL 17 Documentation. <https://www.postgresql.org/docs/17/>
