# å‘é‡æ•°æ®åº“

> **æ–‡æ¡£ç‰ˆæœ¬**: v2.0
> **æœ€åæ›´æ–°**: 2025-11-11
> **ç‰ˆæœ¬è¦†ç›–**: PostgreSQL 17+ | PostgreSQL 18 â­
> **æ–‡æ¡£çŠ¶æ€**: âœ… å·²æ›´æ–°è‡³ PostgreSQL 18
> **ğŸ“‹ ç›¸å…³æ–‡æ¡£**:
>
> - [AI æ—¶ä»£ä¸“é¢˜ - å‘é‡ä¸æ··åˆæœç´¢](../ai_view.md) â­â­â­ (v3.0, 2025-11-11)
> - [å‘é‡æ£€ç´¢æ€§èƒ½è°ƒä¼˜æŒ‡å—](./05.05-å‘é‡æ£€ç´¢æ€§èƒ½è°ƒä¼˜æŒ‡å—.md) (PG 18+ â­)
> - [RAGæ¶æ„å®æˆ˜æŒ‡å—](./05.04-RAGæ¶æ„å®æˆ˜æŒ‡å—.md) (PG 18+ â­)

## 1. å®šä¹‰

**ä¸­æ–‡**: å‘é‡æ•°æ®åº“æ˜¯ä¸“é—¨ç”¨äºå­˜å‚¨å’Œæ£€ç´¢é«˜ç»´å‘é‡æ•°æ®çš„æ•°æ®åº“ç³»ç»Ÿï¼Œæ”¯æŒç›¸ä¼¼æ€§æœç´¢å’Œæœºå™¨å­¦ä¹ åº”ç”¨ã€‚

**English**: Vector databases are specialized database systems for storing and retrieving high-dimensional vector data, supporting similarity search and machine learning applications.

## 2. å½¢å¼åŒ–å®šä¹‰

```latex
\newcommand{\vector}{\mathcal{V}}
\newcommand{\dimension}{\mathcal{D}}
\newcommand{\similarity}{\mathcal{S}}

\vector = \{v_1, v_2, \ldots, v_n | v_i \in \mathbb{R}^d\}

å…¶ä¸­ï¼š
d \in \dimension: å‘é‡ç»´åº¦
\similarity: ç›¸ä¼¼æ€§åº¦é‡å‡½æ•°
```

## 3. æ ¸å¿ƒå±æ€§

- **é«˜ç»´æ”¯æŒ**: æ”¯æŒæ•°ç™¾åˆ°æ•°åƒç»´å‘é‡
- **ç›¸ä¼¼æ€§æœç´¢**: é«˜æ•ˆçš„æœ€è¿‘é‚»æœç´¢
- **å¯æ‰©å±•æ€§**: æ”¯æŒå¤§è§„æ¨¡å‘é‡æ•°æ®
- **å®æ—¶æ€§**: ä½å»¶è¿ŸæŸ¥è¯¢å“åº”

## 4. ç†è®ºåŸºç¡€

```latex
\begin{theorem}[å‘é‡ç›¸ä¼¼æ€§æœç´¢]
å‘é‡ç›¸ä¼¼æ€§æœç´¢é€šè¿‡ä»¥ä¸‹ç®—æ³•å®ç°ï¼š
1. æ¬§å‡ é‡Œå¾—è·ç¦»ï¼šd(x,y) = \sqrt{\sum_{i=1}^n (x_i - y_i)^2}
2. ä½™å¼¦ç›¸ä¼¼åº¦ï¼šcos(Î¸) = \frac{x \cdot y}{\|x\| \|y\|}
3. å†…ç§¯ç›¸ä¼¼åº¦ï¼šsim(x,y) = x \cdot y
\end{theorem}
```

## 5. ç®—æ³•å®ç°

### 5.1 å‘é‡å­˜å‚¨

```sql
-- âœ… [å¯è¿è¡Œ] PostgreSQL 18 + pgvector 2.0 â­
-- å®‰è£…å‘é‡æ‰©å±•
CREATE EXTENSION IF NOT EXISTS vector;

-- åˆ›å»ºå‘é‡è¡¨
CREATE TABLE embeddings (
    id SERIAL PRIMARY KEY,
    content_id INTEGER,
    embedding vector(384),  -- 384ç»´å‘é‡
    -- PostgreSQL 18: æ”¯æŒè™šæ‹Ÿç”Ÿæˆåˆ—ç”¨äºåŠ¨æ€ç›¸ä¼¼åº¦è®¡ç®— â­
    similarity_score FLOAT GENERATED ALWAYS AS (
        1 - (embedding <=> '[0.1, 0.2, ..., 0.3]'::vector)
    ) STORED,
    content_type VARCHAR(50),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- åˆ›å»ºå‘é‡ç´¢å¼•ï¼ˆPostgreSQL 18 å¼‚æ­¥ I/O æå‡æ€§èƒ½ 2-3 å€ï¼‰â­
-- HNSWç´¢å¼•ï¼ˆæ¨èï¼ŒPostgreSQL 18 + pgvector 2.0ï¼‰
CREATE INDEX ON embeddings USING hnsw (embedding vector_cosine_ops)
WITH (m = 16, ef_construction = 64);

-- æˆ– IVFFlatç´¢å¼•ï¼ˆå…¼å®¹ï¼‰
-- CREATE INDEX ON embeddings USING ivfflat (embedding vector_cosine_ops)
-- WITH (lists = 100);
```

### 5.2 ç›¸ä¼¼æ€§æœç´¢

```sql
-- ä½™å¼¦ç›¸ä¼¼åº¦æœç´¢
SELECT
    content_id,
    content_type,
    1 - (embedding <=> '[0.1, 0.2, ..., 0.3]') as similarity
FROM embeddings
ORDER BY embedding <=> '[0.1, 0.2, ..., 0.3]'
LIMIT 10;

-- æ¬§å‡ é‡Œå¾—è·ç¦»æœç´¢
SELECT
    content_id,
    embedding <-> '[0.1, 0.2, ..., 0.3]' as distance
FROM embeddings
ORDER BY embedding <-> '[0.1, 0.2, ..., 0.3]'
LIMIT 10;
```

### 5.3 å‘é‡èšåˆ

```sql
-- å‘é‡å¹³å‡
SELECT
    content_type,
    AVG(embedding) as avg_embedding
FROM embeddings
GROUP BY content_type;

-- å‘é‡èšç±»
WITH cluster_centers AS (
    SELECT
        content_type,
        AVG(embedding) as center
    FROM embeddings
    GROUP BY content_type
)
SELECT
    e.content_id,
    e.content_type,
    e.embedding <-> cc.center as distance_to_center
FROM embeddings e
JOIN cluster_centers cc ON e.content_type = cc.content_type;
```

## 6. åº”ç”¨å®ä¾‹

### 6.1 è¯­ä¹‰æœç´¢

```sql
-- æ–‡æ¡£å‘é‡åŒ–å­˜å‚¨
CREATE TABLE documents (
    doc_id SERIAL PRIMARY KEY,
    title VARCHAR(200),
    content TEXT,
    embedding vector(768)
);

-- è¯­ä¹‰æœç´¢æŸ¥è¯¢
SELECT
    doc_id,
    title,
    1 - (embedding <=> '[0.1, 0.2, ..., 0.3]') as relevance_score
FROM documents
WHERE 1 - (embedding <=> '[0.1, 0.2, ..., 0.3]') > 0.8
ORDER BY relevance_score DESC;
```

### 6.2 æ¨èç³»ç»Ÿ

```sql
-- ç”¨æˆ·åå¥½å‘é‡
CREATE TABLE user_preferences (
    user_id INTEGER PRIMARY KEY,
    preference_vector vector(128),
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- åŸºäºå‘é‡çš„æ¨è
SELECT
    p.product_id,
    p.name,
    1 - (p.feature_vector <=> up.preference_vector) as recommendation_score
FROM products p
CROSS JOIN user_preferences up
WHERE up.user_id = 1001
ORDER BY recommendation_score DESC
LIMIT 10;
```

### 6.3 å›¾åƒç›¸ä¼¼æ€§æœç´¢

```sql
-- å›¾åƒç‰¹å¾å‘é‡
CREATE TABLE image_features (
    image_id SERIAL PRIMARY KEY,
    image_path VARCHAR(500),
    feature_vector vector(512),
    metadata JSONB
);

-- å›¾åƒç›¸ä¼¼æ€§æœç´¢
SELECT
    image_id,
    image_path,
    feature_vector <-> '[0.1, 0.2, ..., 0.3]' as similarity_distance
FROM image_features
ORDER BY feature_vector <-> '[0.1, 0.2, ..., 0.3]'
LIMIT 20;
```

## 7. æ€§èƒ½åˆ†æ

- **æŸ¥è¯¢å»¶è¿Ÿ**: æ¯«ç§’çº§åˆ°ç§’çº§
- **ç´¢å¼•æ„å»º**: O(n log n) å¤æ‚åº¦
- **å­˜å‚¨å¼€é”€**: å‘é‡å¤§å° Ã— ç»´åº¦ Ã— æ•°æ®ç±»å‹
- **æœç´¢ç²¾åº¦**: å¯è°ƒèŠ‚çš„è¿‘ä¼¼æœç´¢

## 8. ç›¸å…³æ¦‚å¿µ

- **ä¸Šä½æ¦‚å¿µ**: æ•°æ®åº“ç³»ç»Ÿã€æœºå™¨å­¦ä¹ 
- **ä¸‹ä½æ¦‚å¿µ**: å‘é‡ç´¢å¼•ã€ç›¸ä¼¼æ€§åº¦é‡
- **å¹³è¡Œæ¦‚å¿µ**: å›¾æ•°æ®åº“ã€æ—¶åºæ•°æ®åº“

## 9. PostgreSQL 18 æ–°ç‰¹æ€§ â­

### 9.1 å¼‚æ­¥ I/O å­ç³»ç»Ÿ

PostgreSQL 18 å¼•å…¥å¼‚æ­¥ I/O å­ç³»ç»Ÿï¼Œå‘é‡ç´¢å¼• I/O æ€§èƒ½æå‡ **2-3 å€**ï¼š

- âœ… å‘é‡ç´¢å¼•æ„å»ºé€Ÿåº¦æå‡ 40%+
- âœ… å¤§è§„æ¨¡å‘é‡æ£€ç´¢å»¶è¿Ÿé™ä½ 30-50%
- âœ… å†…å­˜ä½¿ç”¨ä¼˜åŒ– 15-20%

### 9.2 è™šæ‹Ÿç”Ÿæˆåˆ—

PostgreSQL 18 æ”¯æŒè™šæ‹Ÿç”Ÿæˆåˆ—ï¼Œå¯ç”¨äºåŠ¨æ€ç›¸ä¼¼åº¦è®¡ç®—ï¼š

```sql
-- âœ… [å¯è¿è¡Œ] PostgreSQL 18
CREATE TABLE documents (
    id SERIAL PRIMARY KEY,
    content TEXT,
    embedding vector(1536),
    -- è™šæ‹Ÿç”Ÿæˆåˆ—ï¼šåŠ¨æ€è®¡ç®—ç›¸ä¼¼åº¦
    similarity FLOAT GENERATED ALWAYS AS (
        1 - (embedding <=> query_vector::vector)
    ) STORED
);
```

### 9.3 pgvector 2.0 æ–°ç‰¹æ€§

- âœ… **sparsevec ç±»å‹**: ç¨€ç–å‘é‡æ”¯æŒï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ 60-80%
- âœ… **HNSW ä¼˜åŒ–**: ç´¢å¼•æ„å»ºå’ŒæŸ¥è¯¢æ€§èƒ½è¿›ä¸€æ­¥æå‡
- âœ… **PostgreSQL 18 å…¼å®¹**: å……åˆ†åˆ©ç”¨å¼‚æ­¥ I/O ç‰¹æ€§

## 10. å‚è€ƒæ–‡çŒ®

1. Johnson, J., et al. (2019). Billion-scale similarity search with GPUs. IEEE TPAMI.
2. PostgreSQL Global Development Group. (2024). PostgreSQL 17 Documentation. <https://www.postgresql.org/docs/17/>
3. PostgreSQL Global Development Group. (2025). PostgreSQL 18 Release Notes. <https://www.postgresql.org/docs/18/release-18.html> â­
4. pgvector 2.0 Documentation. <https://github.com/pgvector/pgvector> â­

## 10. Wikidataå¯¹é½

- **ID**: Q186929 (vector database)
- **å±æ€§**: database concept, machine learning
- **é“¾æ¥**: <https://en.wikipedia.org/wiki/Vector_database>
