# å­˜å‚¨å¼•æ“ï¼šé¡µç»“æ„ä¸B-Treeæ·±åº¦å‰–æ

> **åˆ›å»ºæ—¥æœŸ**ï¼š2025-11-13
> **æœ€åæ›´æ–°**ï¼š2025-01-15
> **ç‰ˆæœ¬**ï¼šSQLite 3.31+ è‡³ 3.47.x

---

## 1. ğŸ“‹ æ¦‚è¿°

SQLiteçš„å­˜å‚¨å¼•æ“åŸºäºé¡µï¼ˆPageï¼‰å’ŒB-Treeç»“æ„ï¼Œæœ¬æ–‡æ¡£æ·±å…¥è§£æé¡µç»“æ„ã€B-Treeå®ç°å’ŒåŸå­æ€§ä¿è¯æœºåˆ¶ã€‚

---

## 2. ğŸ“‘ ç›®å½•

- [å­˜å‚¨å¼•æ“ï¼šé¡µç»“æ„ä¸B-Treeæ·±åº¦å‰–æ](#å­˜å‚¨å¼•æ“é¡µç»“æ„ä¸b-treeæ·±åº¦å‰–æ)
  - [1. ğŸ“‹ æ¦‚è¿°](#1--æ¦‚è¿°)
  - [2. ğŸ“‘ ç›®å½•](#2--ç›®å½•)
  - [3. ğŸ“Š æ€ç»´å¯¼å›¾](#3--æ€ç»´å¯¼å›¾)
  - [4. ğŸ“Š å¤šç»´æ¦‚å¿µçŸ©é˜µå¯¹æ¯”](#4--å¤šç»´æ¦‚å¿µçŸ©é˜µå¯¹æ¯”)
    - [4.1. é¡µç±»å‹å¯¹æ¯”çŸ©é˜µ](#41-é¡µç±»å‹å¯¹æ¯”çŸ©é˜µ)
    - [4.2. B-Treeæ“ä½œå¯¹æ¯”çŸ©é˜µ](#42-b-treeæ“ä½œå¯¹æ¯”çŸ©é˜µ)
    - [4.3. å­˜å‚¨ä¼˜åŒ–ç­–ç•¥å¯¹æ¯”çŸ©é˜µ](#43-å­˜å‚¨ä¼˜åŒ–ç­–ç•¥å¯¹æ¯”çŸ©é˜µ)
  - [5. ğŸŒ Wikipediaå¯¹é½](#5--wikipediaå¯¹é½)
    - [5.1. B-Treeæ¦‚å¿µå¯¹é½](#51-b-treeæ¦‚å¿µå¯¹é½)
    - [5.2. å­˜å‚¨å¼•æ“æ¦‚å¿µå¯¹é½](#52-å­˜å‚¨å¼•æ“æ¦‚å¿µå¯¹é½)
    - [5.3. åŸå­æ€§æ¦‚å¿µå¯¹é½](#53-åŸå­æ€§æ¦‚å¿µå¯¹é½)
  - [5.5. å½¢å¼åŒ–å®šä¹‰](#55-å½¢å¼åŒ–å®šä¹‰)
    - [5.5.1. B-Treeç»“æ„å½¢å¼åŒ–å®šä¹‰](#551-b-treeç»“æ„å½¢å¼åŒ–å®šä¹‰)
    - [5.5.2. B-Treeæ“ä½œå½¢å¼åŒ–å®šä¹‰](#552-b-treeæ“ä½œå½¢å¼åŒ–å®šä¹‰)
    - [5.5.3. B-Treeæ’å…¥å½¢å¼åŒ–å®šä¹‰](#553-b-treeæ’å…¥å½¢å¼åŒ–å®šä¹‰)
    - [5.5.4. B-Treeåˆ é™¤å½¢å¼åŒ–å®šä¹‰](#554-b-treeåˆ é™¤å½¢å¼åŒ–å®šä¹‰)
    - [5.5.5. B-Treeé«˜åº¦å½¢å¼åŒ–å®šä¹‰](#555-b-treeé«˜åº¦å½¢å¼åŒ–å®šä¹‰)
    - [5.5.6. å½¢å¼åŒ–å®šç†](#556-å½¢å¼åŒ–å®šç†)
    - [5.5.7. å½¢å¼åŒ–éªŒè¯](#557-å½¢å¼åŒ–éªŒè¯)
  - [6. é¡µï¼ˆPageï¼‰â€”â€”å­˜å‚¨çš„åŸºæœ¬åŸå­](#6-é¡µpageå­˜å‚¨çš„åŸºæœ¬åŸå­)
    - [6.1. é¡µçš„åŸºæœ¬æ¦‚å¿µ](#61-é¡µçš„åŸºæœ¬æ¦‚å¿µ)
    - [6.2. é¡µç±»å‹](#62-é¡µç±»å‹)
    - [6.3. é¡µå¤´éƒ¨ç»“æ„](#63-é¡µå¤´éƒ¨ç»“æ„)
    - [6.4. å•å…ƒï¼ˆCellï¼‰ç»“æ„](#64-å•å…ƒcellç»“æ„)
  - [7. B-Treeå®ç°](#7-b-treeå®ç°)
    - [7.1. B-Treeå˜ä½“](#71-b-treeå˜ä½“)
    - [7.2. B-Treeæ“ä½œè¯¦è§£ä¸ä»£ç ç¤ºä¾‹](#72-b-treeæ“ä½œè¯¦è§£ä¸ä»£ç ç¤ºä¾‹)
      - [7.2.1. æ’å…¥æ“ä½œæµç¨‹](#721-æ’å…¥æ“ä½œæµç¨‹)
      - [7.2.2. æŸ¥æ‰¾æ“ä½œè¯¦è§£](#722-æŸ¥æ‰¾æ“ä½œè¯¦è§£)
      - [7.2.3. åˆ é™¤æ“ä½œæµç¨‹](#723-åˆ é™¤æ“ä½œæµç¨‹)
  - [7.3. B-Treeæ“ä½œå†³ç­–æ ‘](#73-b-treeæ“ä½œå†³ç­–æ ‘)
  - [7.4. B-Treeç†è®ºæ¨å¯¼](#74-b-treeç†è®ºæ¨å¯¼)
    - [7.4.1. B-TreeæŸ¥æ‰¾æ€§èƒ½æ¨å¯¼](#741-b-treeæŸ¥æ‰¾æ€§èƒ½æ¨å¯¼)
    - [7.4.2. B-Treeæ’å…¥æ€§èƒ½æ¨å¯¼](#742-b-treeæ’å…¥æ€§èƒ½æ¨å¯¼)
    - [7.4.3. B-Treeç©ºé—´æ•ˆç‡æ¨å¯¼](#743-b-treeç©ºé—´æ•ˆç‡æ¨å¯¼)
  - [8. æ¸¸æ ‡æœºåˆ¶](#8-æ¸¸æ ‡æœºåˆ¶)
  - [9. åŸå­æ€§ä¿è¯æœºåˆ¶](#9-åŸå­æ€§ä¿è¯æœºåˆ¶)
    - [9.1. é¡µé¢çº§æ—¥å¿—](#91-é¡µé¢çº§æ—¥å¿—)
    - [9.2. å´©æºƒæ¢å¤](#92-å´©æºƒæ¢å¤)
    - [9.3. åŸå­æ€§è¯æ˜](#93-åŸå­æ€§è¯æ˜)
  - [10. å­˜å‚¨ä¼˜åŒ–](#10-å­˜å‚¨ä¼˜åŒ–)
    - [10.1. é¡µå¤§å°é€‰æ‹©ä¸æ€§èƒ½ä¼˜åŒ–](#101-é¡µå¤§å°é€‰æ‹©ä¸æ€§èƒ½ä¼˜åŒ–)
  - [11. ç¢ç‰‡ç®¡ç†ä¸ä¼˜åŒ–](#11-ç¢ç‰‡ç®¡ç†ä¸ä¼˜åŒ–)
  - [12. å‹ç¼©å­˜å‚¨](#12-å‹ç¼©å­˜å‚¨)
  - [13. åˆ—å­˜å‚¨æ¶æ„åˆ†æ](#13-åˆ—å­˜å‚¨æ¶æ„åˆ†æ)
    - [13.1. åˆ—å­˜å‚¨æ¦‚è¿°](#131-åˆ—å­˜å‚¨æ¦‚è¿°)
    - [13.2. SQLiteçš„è¡Œå­˜å‚¨æ¶æ„](#132-sqliteçš„è¡Œå­˜å‚¨æ¶æ„)
    - [13.3. åˆ—å­˜å‚¨æ¶æ„ç†è®º](#133-åˆ—å­˜å‚¨æ¶æ„ç†è®º)
    - [13.4. è¡Œå­˜å‚¨ vs åˆ—å­˜å‚¨å¯¹æ¯”](#134-è¡Œå­˜å‚¨-vs-åˆ—å­˜å‚¨å¯¹æ¯”)
      - [ğŸ“Š å­˜å‚¨æ¶æ„é€‰æ‹©å†³ç­–æ ‘](#-å­˜å‚¨æ¶æ„é€‰æ‹©å†³ç­–æ ‘)
      - [ğŸ“Š è¡Œå­˜å‚¨ vs åˆ—å­˜å‚¨ vs æ··åˆå­˜å‚¨å¯¹æ¯”çŸ©é˜µ](#-è¡Œå­˜å‚¨-vs-åˆ—å­˜å‚¨-vs-æ··åˆå­˜å‚¨å¯¹æ¯”çŸ©é˜µ)
      - [ğŸ“Š SQLiteåˆ—å­˜å‚¨æ¨¡æ‹Ÿæ¶æ„å›¾](#-sqliteåˆ—å­˜å‚¨æ¨¡æ‹Ÿæ¶æ„å›¾)
      - [ğŸ“Š åˆ—å­˜å‚¨æ¨¡æ‹ŸæŸ¥è¯¢æ‰§è¡Œæ—¶åºå›¾](#-åˆ—å­˜å‚¨æ¨¡æ‹ŸæŸ¥è¯¢æ‰§è¡Œæ—¶åºå›¾)
    - [13.5. SQLiteä¸­çš„åˆ—å­˜å‚¨æ¨¡æ‹Ÿ](#135-sqliteä¸­çš„åˆ—å­˜å‚¨æ¨¡æ‹Ÿ)
      - [ğŸ“Š SQLiteåˆ—å­˜å‚¨æ¨¡æ‹Ÿæ–¹æ¡ˆå¯¹æ¯”çŸ©é˜µ](#-sqliteåˆ—å­˜å‚¨æ¨¡æ‹Ÿæ–¹æ¡ˆå¯¹æ¯”çŸ©é˜µ)
    - [13.6. åˆ—å­˜å‚¨å®ç°åŸç†](#136-åˆ—å­˜å‚¨å®ç°åŸç†)
      - [ğŸ“Š SQLiteåˆ—å­˜å‚¨æŠ€æœ¯æ ˆå¯¹æ¯”](#-sqliteåˆ—å­˜å‚¨æŠ€æœ¯æ ˆå¯¹æ¯”)
  - [14. åˆ—å‹ç¼©æŠ€æœ¯è¯¦è§£](#14-åˆ—å‹ç¼©æŠ€æœ¯è¯¦è§£)
    - [14.1. åˆ—å‹ç¼©æ¦‚è¿°](#141-åˆ—å‹ç¼©æ¦‚è¿°)
    - [14.2. åˆ—å‹ç¼©ç®—æ³•](#142-åˆ—å‹ç¼©ç®—æ³•)
      - [14.2.1. å­—å…¸ç¼–ç ï¼ˆDictionary Encodingï¼‰](#1421-å­—å…¸ç¼–ç dictionary-encoding)
      - [14.2.2. æ¸¸ç¨‹ç¼–ç ï¼ˆRun-Length Encoding, RLEï¼‰](#1422-æ¸¸ç¨‹ç¼–ç run-length-encoding-rle)
      - [14.2.3. å¢é‡ç¼–ç ï¼ˆDelta Encodingï¼‰](#1423-å¢é‡ç¼–ç delta-encoding)
      - [14.2.4. ä½å›¾å‹ç¼©ï¼ˆBitmap Compressionï¼‰](#1424-ä½å›¾å‹ç¼©bitmap-compression)
      - [14.2.5. é€šç”¨å‹ç¼©ç®—æ³•](#1425-é€šç”¨å‹ç¼©ç®—æ³•)
    - [14.3. åˆ—å‹ç¼©æ€§èƒ½åˆ†æ](#143-åˆ—å‹ç¼©æ€§èƒ½åˆ†æ)
    - [14.4. SQLiteä¸­çš„å‹ç¼©å®è·µ](#144-sqliteä¸­çš„å‹ç¼©å®è·µ)
    - [14.5. åˆ—å‹ç¼©ç†è®ºåˆ†æ](#145-åˆ—å‹ç¼©ç†è®ºåˆ†æ)
  - [14.6. å­˜å‚¨å¼•æ“è®ºè¯è„‰ç»œ](#146-å­˜å‚¨å¼•æ“è®ºè¯è„‰ç»œ)
    - [14.6.1. è®ºè¯ç›®æ ‡](#1461-è®ºè¯ç›®æ ‡)
    - [14.6.2. è®ºè¯é“¾æ¡](#1462-è®ºè¯é“¾æ¡)
    - [14.6.3. å…³é”®è®ºè¯æ­¥éª¤](#1463-å…³é”®è®ºè¯æ­¥éª¤)
    - [14.6.4. æ­£åä¾‹è¯æ˜](#1464-æ­£åä¾‹è¯æ˜)
  - [15. å­˜å‚¨å¼•æ“æ€§èƒ½ç‰¹å¾](#15-å­˜å‚¨å¼•æ“æ€§èƒ½ç‰¹å¾)
    - [15.1. è¯»å–æ€§èƒ½](#151-è¯»å–æ€§èƒ½)
    - [15.2. å†™å…¥æ€§èƒ½](#152-å†™å…¥æ€§èƒ½)
    - [15.3. ç©ºé—´æ•ˆç‡](#153-ç©ºé—´æ•ˆç‡)
  - [19. å­˜å‚¨å¼•æ“æ¦‚å¿µå±‚æ¬¡å…³ç³»å›¾](#19-å­˜å‚¨å¼•æ“æ¦‚å¿µå±‚æ¬¡å…³ç³»å›¾)
    - [19.1. B-Treeå­˜å‚¨å¼•æ“æ¦‚å¿µå±‚æ¬¡å›¾](#191-b-treeå­˜å‚¨å¼•æ“æ¦‚å¿µå±‚æ¬¡å›¾)
    - [19.2. å­˜å‚¨ä¼˜åŒ–æ¦‚å¿µå…³ç³»å›¾](#192-å­˜å‚¨ä¼˜åŒ–æ¦‚å¿µå…³ç³»å›¾)
  - [16. ğŸ”— ç›¸å…³èµ„æº](#16--ç›¸å…³èµ„æº)
  - [17. ğŸ“š å‚è€ƒèµ„æ–™](#17--å‚è€ƒèµ„æ–™)
  - [18. ğŸ”— äº¤å‰å¼•ç”¨](#18--äº¤å‰å¼•ç”¨)
    - [18.1. ç›¸å…³æ–‡æ¡£](#181-ç›¸å…³æ–‡æ¡£)
      - [16.1.1. æ ¸å¿ƒæ¶æ„](#1611-æ ¸å¿ƒæ¶æ„)
      - [16.1.2. æ•°æ®æ¨¡å‹](#1612-æ•°æ®æ¨¡å‹)
      - [18.1.3. æ€§èƒ½ä¼˜åŒ–](#1813-æ€§èƒ½ä¼˜åŒ–)
      - [18.1.4. å½¢å¼åŒ–ç†è®º](#1814-å½¢å¼åŒ–ç†è®º)
      - [18.1.5. ç†è®ºæ¨¡å‹ ğŸ†•](#1815-ç†è®ºæ¨¡å‹-)
      - [18.1.6. è®¾è®¡æ¨¡å‹ ğŸ†•](#1816-è®¾è®¡æ¨¡å‹-)
      - [18.1.7. å¯¼èˆªä¸ç´¢å¼• ğŸ†•](#1817-å¯¼èˆªä¸ç´¢å¼•-)
    - [18.2. ç›¸å…³æ¦‚å¿µé“¾æ¥ ğŸ†•](#182-ç›¸å…³æ¦‚å¿µé“¾æ¥-)
      - [18.2.1. æ ¸å¿ƒæ¦‚å¿µ](#1821-æ ¸å¿ƒæ¦‚å¿µ)
      - [18.2.2. å®šç†ä¾èµ–é“¾](#1822-å®šç†ä¾èµ–é“¾)

---

## 3. ğŸ“Š æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((å­˜å‚¨å¼•æ“))
    é¡µç»“æ„
      é¡µç±»å‹
        é”å®šé¡µ
        è‡ªç”±åˆ—è¡¨é¡µ
        B-Treeé¡µ
        æŒ‡é’ˆæ˜ å°„é¡µ
      é¡µå¤´éƒ¨
        é¡µç±»å‹æ ‡å¿—
        å•å…ƒæ•°é‡
        å•å…ƒå†…å®¹åŒºåŸŸ
        å³å­é¡µæŒ‡é’ˆ
      å•å…ƒç»“æ„
        å•å…ƒæŒ‡é’ˆ
        å•å…ƒå†…å®¹
        é”®å€¼å¯¹
    B-Treeå®ç°
      B-Treeå˜ä½“
        è¡¨B-Tree
        ç´¢å¼•B-Tree
       B-Treeæ“ä½œ
        æ’å…¥æ“ä½œ
        åˆ é™¤æ“ä½œ
        æŸ¥æ‰¾æ“ä½œ
        åˆ†è£‚æ“ä½œ
      æ¸¸æ ‡æœºåˆ¶
        æ¸¸æ ‡å®šä½
        æ¸¸æ ‡éå†
        æ¸¸æ ‡æ›´æ–°
    åŸå­æ€§ä¿è¯
      é¡µé¢çº§æ—¥å¿—
        æ—¥å¿—è®°å½•
        æ—¥å¿—å›æ»š
      å´©æºƒæ¢å¤
        æ—¥å¿—é‡æ”¾
        ä¸€è‡´æ€§æ£€æŸ¥
      åŸå­æ€§è¯æ˜
        äº‹åŠ¡åŸå­æ€§
        æ“ä½œåŸå­æ€§
    å­˜å‚¨ä¼˜åŒ–
      é¡µå¤§å°é€‰æ‹©
        é»˜è®¤4KB
        å¯é…ç½®èŒƒå›´
        æ€§èƒ½å½±å“
      ç¢ç‰‡ç®¡ç†
        è‡ªç”±å—é“¾è¡¨
        ç¢ç‰‡æ•´ç†
      å‹ç¼©å­˜å‚¨
        æ•°æ®å‹ç¼©
        ç©ºé—´ä¼˜åŒ–
        åˆ—å‹ç¼©æŠ€æœ¯
    åˆ—å­˜å‚¨æ¶æ„
      è¡Œå­˜å‚¨æ¨¡å‹
        SQLiteè¡Œå­˜å‚¨
        B-Treeé¡µç»“æ„
        OLTPä¼˜åŠ¿
      åˆ—å­˜å‚¨æ¨¡å‹
        åˆ—æ–‡ä»¶ç»„ç»‡
        åˆ—æ‰«ææ•ˆç‡
        OLAPä¼˜åŠ¿
      å­˜å‚¨å¯¹æ¯”
        æ€§èƒ½å¯¹æ¯”çŸ©é˜µ
        é€‚ç”¨åœºæ™¯åˆ†æ
      æ¨¡æ‹Ÿå®ç°
        å‚ç›´åˆ†åŒº
        è¦†ç›–ç´¢å¼•
        ç‰©åŒ–è§†å›¾
    åˆ—å‹ç¼©æŠ€æœ¯
      å‹ç¼©ç®—æ³•
        å­—å…¸ç¼–ç 
        æ¸¸ç¨‹ç¼–ç 
        å¢é‡ç¼–ç 
        ä½å›¾å‹ç¼©
        é€šç”¨å‹ç¼©
      å‹ç¼©æ€§èƒ½
        å‹ç¼©ç‡åˆ†æ
        å‹ç¼©æˆæœ¬
        å‹ç¼©å†³ç­–
      å®è·µæ–¹æ¡ˆ
        åº”ç”¨å±‚å‹ç¼©
        JSONå‹ç¼©
        å¤–éƒ¨åˆ—å­˜å‚¨
    æ€§èƒ½ç‰¹å¾
      è¯»å–æ€§èƒ½
        é¡ºåºè¯»å–
        éšæœºè¯»å–
        ç¼“å­˜å‘½ä¸­
      å†™å…¥æ€§èƒ½
        é¡ºåºå†™å…¥
        éšæœºå†™å…¥
        WALä¼˜åŒ–
      ç©ºé—´æ•ˆç‡
        å­˜å‚¨å¯†åº¦
        ç©ºé—´åˆ©ç”¨ç‡
```

---

## 4. ğŸ“Š å¤šç»´æ¦‚å¿µçŸ©é˜µå¯¹æ¯”

### 4.1. é¡µç±»å‹å¯¹æ¯”çŸ©é˜µ

| é¡µç±»å‹ | ç”¨é€” | ä½ç½® | å¤§å° | ç”Ÿå‘½å‘¨æœŸ | è®¿é—®é¢‘ç‡ | SQLiteæ”¯æŒ |
|--------|------|------|------|---------|---------|-----------|
| **é”å®šé¡µ** | æ–‡ä»¶é” | é¡µ0 | å›ºå®š | æ°¸ä¹… | ä½ | âœ… åŸç”Ÿæ”¯æŒ |
| **è‡ªç”±åˆ—è¡¨é¡µ** | ç©ºé—²ç©ºé—´ç®¡ç† | åˆ†æ•£ | å¯å˜ | åŠ¨æ€ | ä¸­ | âœ… åŸç”Ÿæ”¯æŒ |
| **B-Treeé¡µ** | æ•°æ®å­˜å‚¨ | å¤§éƒ¨åˆ† | å¯å˜ | åŠ¨æ€ | é«˜ | âœ… åŸç”Ÿæ”¯æŒ |
| **æŒ‡é’ˆæ˜ å°„é¡µ** | WALé¡µå¼•ç”¨ | WALæ¨¡å¼ | å›ºå®š | åŠ¨æ€ | ä¸­ | âœ… WALæ¨¡å¼ |

### 4.2. B-Treeæ“ä½œå¯¹æ¯”çŸ©é˜µ

| B-Treeæ“ä½œ | æ—¶é—´å¤æ‚åº¦ | ç©ºé—´å¤æ‚åº¦ | ç£ç›˜I/O | é”éœ€æ±‚ | é€‚ç”¨åœºæ™¯ | SQLiteå®ç° |
|-----------|-----------|-----------|---------|--------|---------|-----------|
| **æŸ¥æ‰¾æ“ä½œ** | O(log n) | O(1) | O(log n) | è¯»é” | æŸ¥è¯¢ | âœ… ä¼˜åŒ–å®ç° |
| **æ’å…¥æ“ä½œ** | O(log n) | O(1) | O(log n) | å†™é” | æ’å…¥ | âœ… æ”¯æŒåˆ†è£‚ |
| **åˆ é™¤æ“ä½œ** | O(log n) | O(1) | O(log n) | å†™é” | åˆ é™¤ | âœ… æ”¯æŒåˆå¹¶ |
| **æ›´æ–°æ“ä½œ** | O(log n) | O(1) | O(log n) | å†™é” | æ›´æ–° | âœ… å°±åœ°æ›´æ–° |

### 4.3. å­˜å‚¨ä¼˜åŒ–ç­–ç•¥å¯¹æ¯”çŸ©é˜µ

| ä¼˜åŒ–ç­–ç•¥ | æ€§èƒ½æå‡ | ç©ºé—´èŠ‚çœ | å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ | SQLiteæ”¯æŒ |
|---------|---------|---------|--------|---------|-----------|
| **é¡µå¤§å°ä¼˜åŒ–** | ä¸­ | ä½ | ä½ | ç‰¹å®šè´Ÿè½½ | âœ… PRAGMAé…ç½® |
| **ç¢ç‰‡æ•´ç†** | ä¸­ | é«˜ | ä¸­ | é¢‘ç¹æ›´æ–° | âœ… VACUUM |
| **å‹ç¼©å­˜å‚¨** | ä½ | é«˜ | é«˜ | å­˜å‚¨å—é™ | âš ï¸ æœ‰é™æ”¯æŒ |
| **WALæ¨¡å¼** | é«˜ | ä½ | ä¸­ | é«˜å¹¶å‘ | âœ… åŸç”Ÿæ”¯æŒ |

---

## 5. ğŸŒ Wikipediaå¯¹é½

### 5.1. B-Treeæ¦‚å¿µå¯¹é½

**Wikipediaå®šä¹‰**: [B-tree](https://en.wikipedia.org/wiki/B-tree)

> A B-tree is a self-balancing tree data structure that maintains sorted data and allows searches, sequential access, insertions, and deletions in logarithmic time.

**å¯¹é½è¯´æ˜**:

- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒB-Treeæ˜¯è‡ªå¹³è¡¡æ ‘ç»“æ„
- âœ… **æ ¸å¿ƒç‰¹æ€§**: éƒ½æåˆ°æœ‰åºæ•°æ®ã€å¯¹æ•°æ—¶é—´æ“ä½œç­‰æ ¸å¿ƒç‰¹æ€§
- âœ… **åº”ç”¨åœºæ™¯**: éƒ½æåˆ°æ•°æ®åº“ç´¢å¼•ã€æ–‡ä»¶ç³»ç»Ÿç­‰åº”ç”¨åœºæ™¯

### 5.2. å­˜å‚¨å¼•æ“æ¦‚å¿µå¯¹é½

**Wikipediaå®šä¹‰**: [Storage engine](https://en.wikipedia.org/wiki/Storage_engine)

> A storage engine is a software component that a database management system uses to create, read, update and delete data from a database.

**å¯¹é½è¯´æ˜**:

- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒå­˜å‚¨å¼•æ“æ˜¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿçš„è½¯ä»¶ç»„ä»¶
- âœ… **æ ¸å¿ƒåŠŸèƒ½**: éƒ½æåˆ°CRUDæ“ä½œã€æ•°æ®æŒä¹…åŒ–ç­‰æ ¸å¿ƒåŠŸèƒ½
- âœ… **å®ç°æ–¹å¼**: SQLiteçš„B-Treeå­˜å‚¨å¼•æ“ç¬¦åˆWikipediaçš„æè¿°

### 5.3. åŸå­æ€§æ¦‚å¿µå¯¹é½

**Wikipediaå®šä¹‰**: [Atomicity (database systems)](https://en.wikipedia.org/wiki/Atomicity_(database_systems))

> Atomicity is a property of database transactions stating that a series of database operations either all occur, or nothing occurs.

**å¯¹é½è¯´æ˜**:

- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒåŸå­æ€§æ˜¯äº‹åŠ¡è¦ä¹ˆå…¨éƒ¨å‘ç”Ÿè¦ä¹ˆå…¨éƒ¨ä¸å‘ç”Ÿçš„å±æ€§
- âœ… **å®ç°æœºåˆ¶**: éƒ½æåˆ°æ—¥å¿—ã€å›æ»šç­‰å®ç°æœºåˆ¶
- âœ… **ä¿è¯æ–¹å¼**: SQLiteé€šè¿‡é¡µé¢çº§æ—¥å¿—å’Œå´©æºƒæ¢å¤ä¿è¯åŸå­æ€§

---

## 5.5. å½¢å¼åŒ–å®šä¹‰

### 5.5.1. B-Treeç»“æ„å½¢å¼åŒ–å®šä¹‰

```text
å®šä¹‰5.5.1 B-Treeï¼ˆB-Tree Structureï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

B-Tree T = (Nodes, Root, Order)
  å…¶ä¸­:
  â€¢ Nodes: èŠ‚ç‚¹é›†åˆ
  â€¢ Root: æ ¹èŠ‚ç‚¹
  â€¢ Order: B-Treeé˜¶æ•°ï¼ˆæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šOrder-1ä¸ªé”®ï¼‰

èŠ‚ç‚¹å®šä¹‰:
  Node N = (Keys, Children, Values, Type)
  å…¶ä¸­:
    â€¢ Keys: é”®é›†åˆ {kâ‚, kâ‚‚, ..., kâ‚˜}ï¼Œm â‰¤ Order-1
    â€¢ Children: å­èŠ‚ç‚¹æŒ‡é’ˆé›†åˆ {câ‚, câ‚‚, ..., câ‚˜â‚Šâ‚}
    â€¢ Values: å€¼é›†åˆ {vâ‚, vâ‚‚, ..., vâ‚˜}ï¼ˆå¶å­èŠ‚ç‚¹ï¼‰
    â€¢ Type: èŠ‚ç‚¹ç±»å‹ âˆˆ {INTERIOR, LEAF}

B-Treeæ€§è´¨:
  1. æ‰€æœ‰å¶å­èŠ‚ç‚¹åœ¨åŒä¸€å±‚
  2. æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰Order-1ä¸ªé”®
  3. æ ¹èŠ‚ç‚¹è‡³å°‘æœ‰1ä¸ªé”®ï¼ˆé™¤éæ ‘ä¸ºç©ºï¼‰
  4. éæ ¹èŠ‚ç‚¹è‡³å°‘æœ‰âŒˆOrder/2âŒ‰-1ä¸ªé”®
  5. é”®æŒ‰å‡åºæ’åˆ—: âˆ€i: káµ¢ < káµ¢â‚Šâ‚

å½¢å¼åŒ–è¡¨ç¤º:
  IsValidBTree(T) âŸº
    (AllLeavesSameLevel(T) âˆ§
     NodeKeyCountValid(T) âˆ§
     KeysOrdered(T) âˆ§
     RootExists(T))
```

### 5.5.2. B-Treeæ“ä½œå½¢å¼åŒ–å®šä¹‰

```text
å®šä¹‰5.5.2 B-Treeæœç´¢ï¼ˆB-Tree Searchï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Search(T, k): Tree Ã— Key â†’ Value
  Search(T, k) =
    if T.Root.Type = LEAF:
      return Value where Key = k in T.Root
    else:
      let child = FindChild(T.Root, k)
      return Search(child, k)

FindChild(node, k):
  if k < node.Keys[0]:
    return node.Children[0]
  else if k â‰¥ node.Keys[m-1]:
    return node.Children[m]
  else:
    return node.Children[i] where node.Keys[i-1] â‰¤ k < node.Keys[i]

æœç´¢æ­£ç¡®æ€§:
  âˆ€T, âˆ€k: Search(T, k) = v âŸº (k, v) âˆˆ T

æ—¶é—´å¤æ‚åº¦:
  O(log_{Order}(n))ï¼Œå…¶ä¸­næ˜¯é”®çš„æ•°é‡
```

### 5.5.3. B-Treeæ’å…¥å½¢å¼åŒ–å®šä¹‰

```text
å®šä¹‰5.5.3 B-Treeæ’å…¥ï¼ˆB-Tree Insertï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Insert(T, k, v): Tree Ã— Key Ã— Value â†’ Tree
  Insert(T, k, v) =
    if T.Root is full:
      SplitRoot(T)
    InsertIntoNode(T.Root, k, v)

InsertIntoNode(node, k, v):
  if node.Type = LEAF:
    InsertKeyValue(node, k, v)
    if node is full:
      SplitNode(node)
  else:
    let child = FindChild(node, k)
    InsertIntoNode(child, k, v)
    if child was split:
      InsertKeyIntoParent(node, child.middle_key)

SplitNode(node):
  middle = âŒŠOrder/2âŒ‹
  new_node = CreateNode()
  new_node.Keys = node.Keys[middle+1:]
  new_node.Values = node.Values[middle+1:]
  node.Keys = node.Keys[:middle]
  node.Values = node.Values[:middle]
  return (node.Keys[middle], new_node)

æ’å…¥æ­£ç¡®æ€§:
  Insert(T, k, v) = T' â‡’ (k, v) âˆˆ T' âˆ§ IsValidBTree(T')
```

### 5.5.4. B-Treeåˆ é™¤å½¢å¼åŒ–å®šä¹‰

```text
å®šä¹‰5.5.4 B-Treeåˆ é™¤ï¼ˆB-Tree Deleteï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Delete(T, k): Tree Ã— Key â†’ Tree
  Delete(T, k) =
    DeleteFromNode(T.Root, k)
    if T.Root has 0 keys and T.Root.Type = INTERIOR:
      T.Root = T.Root.Children[0]

DeleteFromNode(node, k):
  if node.Type = LEAF:
    RemoveKey(node, k)
    if node has < âŒˆOrder/2âŒ‰-1 keys:
      MergeOrBorrow(node)
  else:
    let child = FindChild(node, k)
    DeleteFromNode(child, k)
    if child has < âŒˆOrder/2âŒ‰-1 keys:
      MergeOrBorrow(child)

åˆ é™¤æ­£ç¡®æ€§:
  Delete(T, k) = T' â‡’ (k, v) âˆ‰ T' âˆ§ IsValidBTree(T')
```

### 5.5.5. B-Treeé«˜åº¦å½¢å¼åŒ–å®šä¹‰

```text
å®šä¹‰5.5.5 B-Treeé«˜åº¦ï¼ˆB-Tree Heightï¼‰
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

é«˜åº¦å®šä¹‰:
  Height(T) = ä»æ ¹åˆ°å¶å­çš„æœ€é•¿è·¯å¾„é•¿åº¦

é«˜åº¦å®šç†:
  å¯¹äºåŒ…å«nä¸ªé”®çš„B-Treeï¼Œå…¶é«˜åº¦hæ»¡è¶³:
    h â‰¤ log_{âŒˆOrder/2âŒ‰}((n+1)/2) + 1

è¯æ˜:
  è®¾æ¯ä¸ªèŠ‚ç‚¹è‡³å°‘æœ‰âŒˆOrder/2âŒ‰-1ä¸ªé”®ï¼Œåˆ™:
  â€¢ ç¬¬0å±‚ï¼ˆæ ¹ï¼‰: è‡³å°‘æœ‰1ä¸ªé”®
  â€¢ ç¬¬1å±‚: è‡³å°‘æœ‰âŒˆOrder/2âŒ‰ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªè‡³å°‘âŒˆOrder/2âŒ‰-1ä¸ªé”®
  â€¢ ç¬¬hå±‚: è‡³å°‘æœ‰âŒˆOrder/2âŒ‰^hä¸ªé”®

  å› æ­¤: n â‰¥ âŒˆOrder/2âŒ‰^h - 1
  å³: h â‰¤ log_{âŒˆOrder/2âŒ‰}(n+1) + 1
  âˆ
```

### 5.5.6. å½¢å¼åŒ–å®šç†

```text
å®šç†5.5.1 B-Treeæœç´¢æ­£ç¡®æ€§
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âˆ€T, âˆ€k: Search(T, k) = v âŸº (k, v) âˆˆ T

è¯æ˜ï¼ˆå½’çº³æ³•ï¼‰:
  åŸºç¡€: å¶å­èŠ‚ç‚¹ï¼Œç›´æ¥æŸ¥æ‰¾
  å½’çº³: å†…éƒ¨èŠ‚ç‚¹ï¼Œæ ¹æ®é”®å€¼é€‰æ‹©å­æ ‘
  ç”±B-Treeæ€§è´¨ï¼Œé”®æŒ‰é¡ºåºæ’åˆ—
  å› æ­¤æœç´¢æ­£ç¡®
  âˆ

å®šç†5.5.2 B-Treeæ’å…¥ä¿æŒç»“æ„
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Insert(T, k, v) = T' â‡’ IsValidBTree(T')

è¯æ˜:
  1. æ’å…¥åˆ°å¶å­èŠ‚ç‚¹
  2. å¦‚æœèŠ‚ç‚¹æœªæ»¡ï¼Œç›´æ¥æ’å…¥ï¼Œä¿æŒç»“æ„
  3. å¦‚æœèŠ‚ç‚¹æ»¡ï¼Œåˆ†è£‚åä»æ»¡è¶³é”®æ•°çº¦æŸ
  4. åˆ†è£‚å¯èƒ½å‘ä¸Šä¼ æ’­ï¼Œä½†æœ€ç»ˆä¿æŒç»“æ„
  âˆ

å®šç†5.5.3 B-Treeå¹³è¡¡æ€§
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âˆ€T: IsValidBTree(T) â‡’ Balanced(T)

è¯æ˜:
  1. ç”±é«˜åº¦å®šç†ï¼Œé«˜åº¦æœ‰ç•Œ
  2. ç”±æ’å…¥åˆ é™¤æ“ä½œï¼Œä¿æŒç»“æ„
  3. å› æ­¤B-Treeå¹³è¡¡
  âˆ
```

### 5.5.7. å½¢å¼åŒ–éªŒè¯

```text
ä¸å˜å¼5.5.1 B-Treeç»“æ„ä¸å˜å¼
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âˆ€T: IsValidBTree(T) â‡’
  (AllLeavesSameLevel(T) âˆ§
   NodeKeyCountValid(T) âˆ§
   KeysOrdered(T))

éªŒè¯:
  1. åˆå§‹çŠ¶æ€: ç©ºæ ‘æ»¡è¶³ä¸å˜å¼
  2. æ’å…¥æ“ä½œ: ä¿æŒç»“æ„ï¼ˆç”±å®šç†5.5.2ï¼‰
  3. åˆ é™¤æ“ä½œ: ä¿æŒç»“æ„
  4. å› æ­¤æ‰€æœ‰çŠ¶æ€æ»¡è¶³ä¸å˜å¼
  âˆ

ä¸å˜å¼5.5.2 é”®é¡ºåºä¸å˜å¼
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âˆ€node: âˆ€i: node.Keys[i] < node.Keys[i+1]

éªŒè¯:
  1. æ’å…¥æ—¶ä¿æŒé”®é¡ºåº
  2. åˆ é™¤æ—¶ä¿æŒé”®é¡ºåº
  3. åˆ†è£‚åˆå¹¶æ—¶ä¿æŒé”®é¡ºåº
  4. å› æ­¤é”®é¡ºåºä¸å˜å¼æˆç«‹
  âˆ
```

---

## 6. é¡µï¼ˆPageï¼‰â€”â€”å­˜å‚¨çš„åŸºæœ¬åŸå­

### 6.1. é¡µçš„åŸºæœ¬æ¦‚å¿µ

**é¡µå¤§å°**ï¼š

- **é»˜è®¤å¤§å°**ï¼š4096å­—èŠ‚ï¼ˆ4KBï¼‰
- **å¯é…ç½®èŒƒå›´**ï¼š512å­—èŠ‚åˆ°65536å­—èŠ‚
- **é…ç½®æ–¹æ³•**ï¼š`PRAGMA page_size`ï¼ˆä»…åœ¨å»ºåº“æ—¶æœ‰æ•ˆï¼‰

**é¡µçš„ä½œç”¨**ï¼š

- æ•°æ®åº“æ–‡ä»¶çš„åŸºæœ¬å­˜å‚¨å•å…ƒ
- B-TreeèŠ‚ç‚¹çš„å­˜å‚¨å®¹å™¨
- ç¼“å­˜ç®¡ç†çš„åŸºæœ¬å•ä½

### 6.2. é¡µç±»å‹

SQLiteæ•°æ®åº“æ–‡ä»¶åŒ…å«å¤šç§ç±»å‹çš„é¡µï¼š

| é¡µç±»å‹ | è¯´æ˜ | ä½ç½® |
|--------|------|------|
| **é”å®šé¡µ**ï¼ˆLock-byte pageï¼‰ | ç”¨äºæ–‡ä»¶é” | ç¬¬ä¸€é¡µï¼ˆé¡µ0ï¼‰ |
| **è‡ªç”±åˆ—è¡¨é¡µ**ï¼ˆFreelist pagesï¼‰ | ç®¡ç†ç©ºé—²ç©ºé—´ | åˆ†æ•£åœ¨æ–‡ä»¶ä¸­ |
| **B-Treeé¡µ** | å­˜å‚¨è¡¨æ•°æ®æˆ–ç´¢å¼• | å¤§éƒ¨åˆ†é¡µé¢ |
| **æŒ‡é’ˆæ˜ å°„é¡µ**ï¼ˆPointer Map pagesï¼‰ | WALæ¨¡å¼ä¸‹è¿½è¸ªé¡µå¼•ç”¨ | WALæ¨¡å¼ç‰¹æœ‰ |

### 6.3. é¡µå¤´éƒ¨ç»“æ„

**B-Treeé¡µå¤´éƒ¨**ï¼ˆ8-12å­—èŠ‚ï¼‰ï¼š

```text
åç§»  å¤§å°  è¯´æ˜
0     1     é¡µç±»å‹æ ‡å¿—ï¼ˆ0x02=å†…éƒ¨é¡µï¼Œ0x05=å¶å­é¡µï¼Œ0x0A=å†…éƒ¨é¡µ+å³æŒ‡é’ˆï¼Œ0x0D=å¶å­é¡µ+å³æŒ‡é’ˆï¼‰
1     2     ç¬¬ä¸€ä¸ªè‡ªç”±å—åç§»ï¼ˆ0è¡¨ç¤ºæ— è‡ªç”±å—ï¼‰
3     2     å•å…ƒæ•°é‡
5     2     å•å…ƒå†…å®¹åŒºåŸŸèµ·ç‚¹
7     2     ç¢ç‰‡å­—èŠ‚æ•°ï¼ˆä»…å¶å­é¡µï¼‰
9     4     å³å­é¡µæŒ‡é’ˆï¼ˆä»…å†…éƒ¨é¡µï¼‰
```

**é¡µç»“æ„å¸ƒå±€**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¡µå¤´éƒ¨ï¼ˆ8-12å­—èŠ‚ï¼‰                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å•å…ƒæŒ‡é’ˆæ•°ç»„ï¼ˆæ¯ä¸ª2å­—èŠ‚ï¼‰              â”‚
â”‚ [ptr1][ptr2][ptr3]...[ptrN]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è‡ªç”±å—é“¾è¡¨ï¼ˆå¦‚æœæœ‰ï¼‰                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å•å…ƒå†…å®¹åŒºåŸŸ                          â”‚
â”‚ [cell1][cell2][cell3]...[cellN]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.4. å•å…ƒï¼ˆCellï¼‰ç»“æ„

**è¡¨B-Treeå•å…ƒ**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Payloadé•¿åº¦ â”‚ RowID    â”‚ æ•°æ®åˆ—    â”‚
â”‚ (varint)    â”‚ (varint) â”‚ (æ•°æ®)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç´¢å¼•B-Treeå•å…ƒ**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Payloadé•¿åº¦ â”‚ é”®å€¼     â”‚
â”‚ (varint)    â”‚ (æ•°æ®)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. B-Treeå®ç°

### 7.1. B-Treeå˜ä½“

SQLiteé‡‡ç”¨å˜ä½“B-Treeï¼Œæ”¯æŒB+Treeç‰¹æ€§ï¼š

**è¡¨B-Tree**ï¼š

- **é”®**ï¼šrowidï¼ˆINTEGER PRIMARY KEYï¼‰æˆ–ä¸»é”®
- **å€¼**ï¼šå®Œæ•´çš„è¡Œæ•°æ®
- **ç‰¹æ€§**ï¼šå¶å­èŠ‚ç‚¹å­˜å‚¨æ•°æ®ï¼Œå†…éƒ¨èŠ‚ç‚¹å­˜å‚¨é”®å’ŒæŒ‡é’ˆ

**ç´¢å¼•B-Tree**ï¼š

- **é”®**ï¼šç´¢å¼•åˆ—çš„å€¼
- **å€¼**ï¼šrowidï¼ˆç”¨äºå›è¡¨ï¼‰
- **ç‰¹æ€§**ï¼šæ‰€æœ‰èŠ‚ç‚¹éƒ½å­˜å‚¨é”®å€¼å¯¹

### 7.2. B-Treeæ“ä½œè¯¦è§£ä¸ä»£ç ç¤ºä¾‹

#### 7.2.1. æ’å…¥æ“ä½œæµç¨‹

**æ’å…¥æ“ä½œæµç¨‹**ï¼š

```text
1. å¯»é¡µï¼šB-Treeæ¨¡å—è¯·æ±‚Pagerè·å–ç›®æ ‡é¡µ
2. ä¿®æ”¹ï¼šåœ¨å†…å­˜ä¸­çš„é¡µå‰¯æœ¬æ‰§è¡Œæ’å…¥ï¼ˆå¯èƒ½å¼•å‘åˆ†è£‚ï¼‰
3. æ—¥å¿—ï¼šPagerå°†æ—§é¡µå†…å®¹å†™å…¥å›æ»šæ—¥å¿—ï¼ˆæˆ–WALï¼‰
4. è½ç›˜ï¼šä¿®æ”¹åçš„é¡µæ ‡è®°ä¸ºè„é¡µï¼Œæ‹©æœºåˆ·ç›˜
5. æäº¤ï¼šæ—¥å¿—æ¸…ç†ï¼Œå®ŒæˆåŸå­æäº¤
```

**å®é™…ä»£ç ç¤ºä¾‹ï¼ˆCè¯­è¨€é£æ ¼ä¼ªä»£ç ï¼‰**ï¼š

```c
// B-Treeæ’å…¥æ“ä½œï¼ˆç®€åŒ–ç‰ˆï¼‰
int sqlite3BtreeInsert(
    BtCursor *pCur,        // æ¸¸æ ‡
    const void *pKey,      // é”®
    int nKey,              // é”®é•¿åº¦
    const void *pData,     // æ•°æ®
    int nData,             // æ•°æ®é•¿åº¦
    int nZero,             // é›¶å¡«å……é•¿åº¦
    int appendFlag,        // è¿½åŠ æ ‡å¿—
    int seekResult         // æŸ¥æ‰¾ç»“æœ
) {
    MemPage *pPage = pCur->apPage[pCur->iPage];  // å½“å‰é¡µ
    int nCell = pPage->nCell;                     // å½“å‰å•å…ƒæ•°

    // 1. æ£€æŸ¥é¡µç©ºé—´æ˜¯å¦è¶³å¤Ÿ
    int cellSize = computeCellSize(pKey, nKey, pData, nData);
    if (pPage->nFree < cellSize + 2) {  // éœ€è¦é¢å¤–2å­—èŠ‚ç”¨äºæŒ‡é’ˆ
        // é¡µç©ºé—´ä¸è¶³ï¼Œéœ€è¦åˆ†è£‚
        return splitPage(pCur, pKey, nKey, pData, nData);
    }

    // 2. æ‰¾åˆ°æ’å…¥ä½ç½®
    int idx = findInsertPosition(pPage, pKey, nKey);

    // 3. åˆ†é…ç©ºé—´
    int cellOffset = allocateCell(pPage, cellSize);

    // 4. å†™å…¥å•å…ƒ
    writeCell(pPage, cellOffset, pKey, nKey, pData, nData);

    // 5. æ›´æ–°æŒ‡é’ˆæ•°ç»„
    insertCellPointer(pPage, idx, cellOffset);
    pPage->nCell++;

    // 6. æ ‡è®°é¡µä¸ºè„é¡µ
    sqlite3PagerWrite(pPage->pDbPage);

    return SQLITE_OK;
}

// é¡µåˆ†è£‚æ“ä½œ
int splitPage(BtCursor *pCur, const void *pKey, int nKey,
              const void *pData, int nData) {
    MemPage *pOld = pCur->apPage[pCur->iPage];
    MemPage *pNew;
    Pgno newPgno;

    // 1. åˆ†é…æ–°é¡µ
    sqlite3PagerAcquire(pCur->pBt->pPager, &newPgno, &pNew->pDbPage);
    initializePage(pNew);

    // 2. å°†ä¸€åŠæ•°æ®ç§»åŠ¨åˆ°æ–°é¡µ
    int moveCount = pOld->nCell / 2;
    for (int i = moveCount; i < pOld->nCell; i++) {
        CellInfo cell;
        getCellInfo(pOld, i, &cell);
        insertCell(pNew, cell.pKey, cell.nKey, cell.pData, cell.nData);
        deleteCell(pOld, i);
    }

    // 3. æ›´æ–°çˆ¶èŠ‚ç‚¹
    if (pCur->iPage == 0) {
        // æ ¹èŠ‚ç‚¹åˆ†è£‚ï¼Œåˆ›å»ºæ–°æ ¹
        createNewRoot(pCur->pBt, pOld, pNew, pKey, nKey);
    } else {
        // æ›´æ–°çˆ¶èŠ‚ç‚¹æŒ‡é’ˆ
        MemPage *pParent = pCur->apPage[pCur->iPage - 1];
        insertCell(pParent, pKey, nKey, &newPgno, sizeof(Pgno));
    }

    // 4. ç¡®å®šæ’å…¥ä½ç½®
    if (compareKey(pKey, nKey, getFirstKey(pNew)) < 0) {
        insertCell(pOld, pKey, nKey, pData, nData);
    } else {
        insertCell(pNew, pKey, nKey, pData, nData);
    }

    return SQLITE_OK;
}
```

#### 7.2.2. æŸ¥æ‰¾æ“ä½œè¯¦è§£

**æŸ¥æ‰¾æ“ä½œä»£ç ç¤ºä¾‹**ï¼š

```c
// B-TreeæŸ¥æ‰¾æ“ä½œ
int sqlite3BtreeMovetoUnpacked(
    BtCursor *pCur,
    UnpackedRecord *pIdxKey,
    int *pRes
) {
    MemPage *pPage;
    int idx;
    int rc;

    // 1. ä»æ ¹èŠ‚ç‚¹å¼€å§‹
    pPage = pCur->apPage[0] = getRootPage(pCur->pBt);
    pCur->iPage = 0;

    // 2. å‘ä¸‹éå†åˆ°å¶å­èŠ‚ç‚¹
    while (!isLeafPage(pPage)) {
        // åœ¨å†…éƒ¨èŠ‚ç‚¹ä¸­æŸ¥æ‰¾
        idx = binarySearch(pPage, pIdxKey);

        // è·å–å­é¡µæŒ‡é’ˆ
        Pgno childPgno = getChildPgno(pPage, idx);

        // ç§»åŠ¨åˆ°å­é¡µ
        pCur->iPage++;
        pPage = pCur->apPage[pCur->iPage] = getPage(childPgno);
    }

    // 3. åœ¨å¶å­èŠ‚ç‚¹ä¸­æŸ¥æ‰¾
    idx = binarySearch(pPage, pIdxKey);
    pCur->aiIdx[pCur->iPage] = idx;

    // 4. è®¾ç½®æŸ¥æ‰¾ç»“æœ
    if (idx < pPage->nCell) {
        int cmp = compareKey(pPage, idx, pIdxKey);
        *pRes = cmp;
    } else {
        *pRes = -1;  // æœªæ‰¾åˆ°
    }

    return SQLITE_OK;
}

// äºŒåˆ†æŸ¥æ‰¾ï¼ˆåœ¨é¡µå†…æŸ¥æ‰¾é”®ï¼‰
int binarySearch(MemPage *pPage, UnpackedRecord *pIdxKey) {
    int left = 0;
    int right = pPage->nCell;

    while (left < right) {
        int mid = (left + right) / 2;
        int cmp = compareKey(pPage, mid, pIdxKey);

        if (cmp < 0) {
            left = mid + 1;
        } else {
            right = mid;
        }
    }

    return left;
}
```

#### 7.2.3. åˆ é™¤æ“ä½œæµç¨‹

**åˆ é™¤æ“ä½œä»£ç ç¤ºä¾‹**ï¼š

```c
// B-Treeåˆ é™¤æ“ä½œ
int sqlite3BtreeDelete(BtCursor *pCur) {
    MemPage *pPage = pCur->apPage[pCur->iPage];
    int idx = pCur->aiIdx[pCur->iPage];

    // 1. åˆ é™¤å•å…ƒ
    deleteCell(pPage, idx);
    pPage->nCell--;

    // 2. æ£€æŸ¥é¡µåˆ©ç”¨ç‡
    int utilization = (pPage->nCell * avgCellSize) / pageSize;
    if (utilization < 0.5 && pPage->nCell > 0) {
        // é¡µåˆ©ç”¨ç‡è¿‡ä½ï¼Œè€ƒè™‘åˆå¹¶
        return tryMergePage(pCur);
    }

    // 3. æ ‡è®°é¡µä¸ºè„é¡µ
    sqlite3PagerWrite(pPage->pDbPage);

    return SQLITE_OK;
}

// é¡µåˆå¹¶æ“ä½œ
int tryMergePage(BtCursor *pCur) {
    MemPage *pPage = pCur->apPage[pCur->iPage];
    MemPage *pSibling;

    // å°è¯•ä¸å…„å¼Ÿé¡µåˆå¹¶
    if (getLeftSibling(pPage, &pSibling)) {
        if (pSibling->nCell + pPage->nCell < maxCellsPerPage) {
            // å¯ä»¥åˆå¹¶
            mergePages(pSibling, pPage);
            deletePage(pPage);
            return SQLITE_OK;
        }
    }

    return SQLITE_OK;  // æ— æ³•åˆå¹¶ï¼Œä¿æŒç°çŠ¶
}
```

**å®é™…ä½¿ç”¨ç¤ºä¾‹ï¼ˆPythonï¼‰**ï¼š

```python
import sqlite3

# åˆ›å»ºæ•°æ®åº“å¹¶è§‚å¯ŸB-Treeç»“æ„
conn = sqlite3.connect('btree_demo.db')
conn.execute('PRAGMA page_size=4096')  # è®¾ç½®é¡µå¤§å°

# åˆ›å»ºè¡¨
conn.execute('''
    CREATE TABLE users (
        id INTEGER PRIMARY KEY,
        name TEXT,
        email TEXT
    )
''')

# æ’å…¥æ•°æ®ï¼ˆè§‚å¯ŸB-Treeå¢é•¿ï¼‰
for i in range(1000):
    conn.execute(
        'INSERT INTO users (name, email) VALUES (?, ?)',
        (f'user_{i}', f'user_{i}@example.com')
    )

# åˆ†æB-Treeç»“æ„
cursor = conn.execute('PRAGMA page_count')  # æŸ¥çœ‹é¡µæ•°
page_count = cursor.fetchone()[0]
print(f'æ•°æ®åº“é¡µæ•°: {page_count}')

cursor = conn.execute('PRAGMA page_size')
page_size = cursor.fetchone()[0]
print(f'é¡µå¤§å°: {page_size} bytes')

# ä½¿ç”¨EXPLAIN QUERY PLANæŸ¥çœ‹B-Treeä½¿ç”¨
cursor = conn.execute('EXPLAIN QUERY PLAN SELECT * FROM users WHERE id = 500')
for row in cursor:
    print(f'æŸ¥è¯¢è®¡åˆ’: {row}')

conn.close()
```

## 7.3. B-Treeæ“ä½œå†³ç­–æ ‘

```text
SQLite B-Treeæ“ä½œå†³ç­–æ ‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

é—®é¢˜ï¼šå¦‚ä½•é€‰æ‹©B-Treeæ“ä½œç­–ç•¥ï¼Ÿ
    â”‚
    â”œâ”€ æ“ä½œç±»å‹ï¼Ÿ
    â”‚   â”œâ”€ æŸ¥æ‰¾æ“ä½œ â†’ è¿›å…¥æŸ¥æ‰¾ä¼˜åŒ–è·¯å¾„
    â”‚   â”œâ”€ æ’å…¥æ“ä½œ â†’ è¿›å…¥æ’å…¥ä¼˜åŒ–è·¯å¾„
    â”‚   â”œâ”€ åˆ é™¤æ“ä½œ â†’ è¿›å…¥åˆ é™¤ä¼˜åŒ–è·¯å¾„
    â”‚   â””â”€ æ›´æ–°æ“ä½œ â†’ è¿›å…¥æ›´æ–°ä¼˜åŒ–è·¯å¾„
    â”‚
    â”œâ”€ æŸ¥æ‰¾ä¼˜åŒ–è·¯å¾„
    â”‚   â”œâ”€ æ˜¯å¦æœ‰ç´¢å¼•ï¼Ÿ
    â”‚   â”‚   â”œâ”€ å¦ â†’ åˆ›å»ºç´¢å¼•ï¼ˆCREATE INDEXï¼‰
    â”‚   â”‚   â””â”€ æ˜¯ â†’ æ£€æŸ¥ç´¢å¼•é€‰æ‹©æ€§
    â”‚   â”‚
    â”‚   â”œâ”€ ç´¢å¼•é€‰æ‹©æ€§æ˜¯å¦é«˜ï¼Ÿ
    â”‚   â”‚   â”œâ”€ å¦ â†’ è€ƒè™‘éƒ¨åˆ†ç´¢å¼•æˆ–è¦†ç›–ç´¢å¼•
    â”‚   â”‚   â””â”€ æ˜¯ â†’ æ£€æŸ¥æŸ¥è¯¢è®¡åˆ’
    â”‚   â”‚
    â”‚   â”œâ”€ æŸ¥è¯¢è®¡åˆ’æ˜¯å¦æœ€ä¼˜ï¼Ÿ
    â”‚   â”‚   â”œâ”€ å¦ â†’ ä½¿ç”¨ANALYZEæ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    â”‚   â”‚   â””â”€ æ˜¯ â†’ æ£€æŸ¥ç¼“å­˜å‘½ä¸­ç‡
    â”‚   â”‚
    â”‚   â””â”€ ç¼“å­˜å‘½ä¸­ç‡æ˜¯å¦é«˜ï¼Ÿ
    â”‚       â”œâ”€ å¦ â†’ è°ƒæ•´PRAGMA cache_size
    â”‚       â””â”€ æ˜¯ â†’ æŸ¥æ‰¾æ€§èƒ½æ­£å¸¸
    â”‚
    â”œâ”€ æ’å…¥ä¼˜åŒ–è·¯å¾„
    â”‚   â”œâ”€ æ˜¯å¦æ‰¹é‡æ’å…¥ï¼Ÿ
    â”‚   â”‚   â”œâ”€ æ˜¯ â†’ ä½¿ç”¨äº‹åŠ¡æ‰¹é‡æ’å…¥
    â”‚   â”‚   â””â”€ å¦ â†’ æ£€æŸ¥ç´¢å¼•æ•°é‡
    â”‚   â”‚
    â”‚   â”œâ”€ ç´¢å¼•æ•°é‡æ˜¯å¦è¿‡å¤šï¼Ÿ
    â”‚   â”‚   â”œâ”€ æ˜¯ â†’ è¯„ä¼°ç´¢å¼•å¿…è¦æ€§ï¼Œåˆ é™¤å†—ä½™ç´¢å¼•
    â”‚   â”‚   â””â”€ å¦ â†’ æ£€æŸ¥é¡µå¤§å°
    â”‚   â”‚
    â”‚   â”œâ”€ é¡µå¤§å°æ˜¯å¦åˆé€‚ï¼Ÿ
    â”‚   â”‚   â”œâ”€ å¦ â†’ è°ƒæ•´PRAGMA page_sizeï¼ˆéœ€é‡å»ºæ•°æ®åº“ï¼‰
    â”‚   â”‚   â””â”€ æ˜¯ â†’ æ£€æŸ¥WALæ¨¡å¼
    â”‚   â”‚
    â”‚   â””â”€ æ˜¯å¦ä½¿ç”¨WALæ¨¡å¼ï¼Ÿ
    â”‚       â”œâ”€ å¦ â†’ å¯ç”¨WALæ¨¡å¼ï¼ˆPRAGMA journal_mode=WALï¼‰
    â”‚       â””â”€ æ˜¯ â†’ æ’å…¥æ€§èƒ½æ­£å¸¸
    â”‚
    â”œâ”€ åˆ é™¤ä¼˜åŒ–è·¯å¾„
    â”‚   â”œâ”€ æ˜¯å¦æ‰¹é‡åˆ é™¤ï¼Ÿ
    â”‚   â”‚   â”œâ”€ æ˜¯ â†’ ä½¿ç”¨äº‹åŠ¡æ‰¹é‡åˆ é™¤
    â”‚   â”‚   â””â”€ å¦ â†’ æ£€æŸ¥ç¢ç‰‡ç‡
    â”‚   â”‚
    â”‚   â”œâ”€ ç¢ç‰‡ç‡æ˜¯å¦è¿‡é«˜ï¼Ÿ
    â”‚   â”‚   â”œâ”€ æ˜¯ â†’ è¿è¡ŒVACUUMæ•´ç†ç¢ç‰‡
    â”‚   â”‚   â””â”€ å¦ â†’ æ£€æŸ¥é¡µåˆ©ç”¨ç‡
    â”‚   â”‚
    â”‚   â””â”€ é¡µåˆ©ç”¨ç‡æ˜¯å¦è¿‡ä½ï¼Ÿ
    â”‚       â”œâ”€ æ˜¯ â†’ è€ƒè™‘åˆå¹¶æ“ä½œæˆ–é‡å»ºæ•°æ®åº“
    â”‚       â””â”€ å¦ â†’ åˆ é™¤æ€§èƒ½æ­£å¸¸
    â”‚
    â””â”€ æ›´æ–°ä¼˜åŒ–è·¯å¾„
        â”œâ”€ æ˜¯å¦æ›´æ–°ç´¢å¼•åˆ—ï¼Ÿ
        â”‚   â”œâ”€ æ˜¯ â†’ æ£€æŸ¥ç´¢å¼•æ›´æ–°æˆæœ¬
        â”‚   â””â”€ å¦ â†’ ç›´æ¥æ›´æ–°æ•°æ®é¡µ
        â”‚
        â”œâ”€ ç´¢å¼•æ›´æ–°æˆæœ¬æ˜¯å¦é«˜ï¼Ÿ
        â”‚   â”œâ”€ æ˜¯ â†’ è€ƒè™‘å»¶è¿Ÿç´¢å¼•æ›´æ–°æˆ–åˆ é™¤ç´¢å¼•
        â”‚   â””â”€ å¦ â†’ æ£€æŸ¥WALæ¨¡å¼
        â”‚
        â””â”€ æ˜¯å¦ä½¿ç”¨WALæ¨¡å¼ï¼Ÿ
            â”œâ”€ å¦ â†’ å¯ç”¨WALæ¨¡å¼
            â””â”€ æ˜¯ â†’ æ›´æ–°æ€§èƒ½æ­£å¸¸

æ€§èƒ½ä¼˜åŒ–ä¼˜å…ˆçº§:
1. åˆ›å»ºå¿…è¦ç´¢å¼•ï¼ˆæŸ¥æ‰¾æ€§èƒ½æœ€å¤§æ”¶ç›Šï¼‰
2. å¯ç”¨WALæ¨¡å¼ï¼ˆå†™å…¥æ€§èƒ½2-3å€æå‡ï¼‰
3. æ‰¹é‡äº‹åŠ¡ï¼ˆå‡å°‘I/Oå¼€é”€ï¼‰
4. è°ƒæ•´é¡µå¤§å°ï¼ˆé€‚åˆæ•°æ®ç‰¹å¾ï¼‰
5. å®šæœŸVACUUMï¼ˆå‡å°‘ç¢ç‰‡ï¼‰
```

---

## 7.4. B-Treeç†è®ºæ¨å¯¼

### 7.4.1. B-TreeæŸ¥æ‰¾æ€§èƒ½æ¨å¯¼

**å®šç†7.4.1 B-TreeæŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦**:

```text
å¯¹äºB-TreeæŸ¥æ‰¾æ“ä½œï¼š
  æ—¶é—´å¤æ‚åº¦: O(log_B(N))
  å…¶ä¸­: Bæ˜¯åˆ†æ”¯å› å­ï¼ŒNæ˜¯é”®æ•°é‡

æ¨å¯¼è¿‡ç¨‹:
1. B-Treeé«˜åº¦å®šç†:
   h â‰¤ log_B((N+1)/2) + 1
   å…¶ä¸­hæ˜¯æ ‘é«˜åº¦ï¼ŒBæ˜¯æœ€å°åˆ†æ”¯å› å­

2. æŸ¥æ‰¾è·¯å¾„é•¿åº¦:
   - ä»æ ¹åˆ°å¶å­éœ€è¦éå†hå±‚
   - æ¯å±‚éœ€è¦O(log B)æ—¶é—´è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾
   - æ€»æ—¶é—´: O(h Ã— log B) = O(log_B(N))

3. å®é™…æ€§èƒ½:
   - å¯¹äºB=100çš„B-Treeï¼Œ100ä¸‡æ¡è®°å½•åªéœ€3-4æ¬¡ç£ç›˜I/O
   - å¯¹äºB=1000çš„B-Treeï¼Œ10äº¿æ¡è®°å½•åªéœ€4-5æ¬¡ç£ç›˜I/O
   âˆ
```

### 7.4.2. B-Treeæ’å…¥æ€§èƒ½æ¨å¯¼

**å®šç†7.4.2 B-Treeæ’å…¥æ—¶é—´å¤æ‚åº¦**:

```text
å¯¹äºB-Treeæ’å…¥æ“ä½œï¼š
  å¹³å‡æ—¶é—´å¤æ‚åº¦: O(log_B(N))
  æœ€åæ—¶é—´å¤æ‚åº¦: O(log_B(N))ï¼ˆåˆ†è£‚ä¼ æ’­ï¼‰

æ¨å¯¼è¿‡ç¨‹:
1. æŸ¥æ‰¾æ’å…¥ä½ç½®:
   - æ—¶é—´å¤æ‚åº¦: O(log_B(N))ï¼ˆç”±å®šç†7.4.1ï¼‰

2. æ’å…¥åˆ°å¶å­èŠ‚ç‚¹:
   - å¦‚æœèŠ‚ç‚¹æœªæ»¡: O(1)
   - å¦‚æœèŠ‚ç‚¹æ»¡: éœ€è¦åˆ†è£‚ï¼ŒO(B)

3. åˆ†è£‚ä¼ æ’­:
   - æœ€åæƒ…å†µ: åˆ†è£‚ä¼ æ’­åˆ°æ ¹èŠ‚ç‚¹
   - ä¼ æ’­å±‚æ•°: O(log_B(N))
   - æ€»æ—¶é—´: O(log_B(N))

4. å®é™…æ€§èƒ½:
   - å¹³å‡æƒ…å†µ: å¾ˆå°‘åˆ†è£‚ï¼Œæ¥è¿‘O(log_B(N))
   - æœ€åæƒ…å†µ: åˆ†è£‚ä¼ æ’­ï¼ŒO(log_B(N))
   âˆ
```

### 7.4.3. B-Treeç©ºé—´æ•ˆç‡æ¨å¯¼

**å®šç†7.4.3 B-Treeç©ºé—´åˆ©ç”¨ç‡**:

```text
å¯¹äºB-Treeå­˜å‚¨ï¼š
  æœ€å°ç©ºé—´åˆ©ç”¨ç‡: 50%ï¼ˆèŠ‚ç‚¹è‡³å°‘åŠæ»¡ï¼‰
  å¹³å‡ç©ºé—´åˆ©ç”¨ç‡: çº¦69%ï¼ˆéšæœºæ’å…¥ï¼‰

æ¨å¯¼è¿‡ç¨‹:
1. B-TreeèŠ‚ç‚¹çº¦æŸ:
   - å†…éƒ¨èŠ‚ç‚¹: è‡³å°‘âŒˆB/2âŒ‰ä¸ªå­èŠ‚ç‚¹
   - å¶å­èŠ‚ç‚¹: è‡³å°‘âŒˆ(B-1)/2âŒ‰ä¸ªé”®
   - å› æ­¤æœ€å°åˆ©ç”¨ç‡: 50%

2. éšæœºæ’å…¥åˆ†æ:
   - èŠ‚ç‚¹æ»¡æ—¶åˆ†è£‚ä¸ºä¸¤ä¸ªåŠæ»¡èŠ‚ç‚¹
   - åç»­æ’å…¥å¡«å……èŠ‚ç‚¹
   - å¹³å‡åˆ©ç”¨ç‡: çº¦69%ï¼ˆç†è®ºåˆ†æï¼‰

3. å®é™…ç©ºé—´æ•ˆç‡:
   - SQLiteé»˜è®¤é¡µå¤§å°4KB
   - å®é™…åˆ©ç”¨ç‡: 60-80%ï¼ˆå–å†³äºæ•°æ®ç‰¹å¾ï¼‰
   âˆ
```

---

## 8. æ¸¸æ ‡æœºåˆ¶

**BtCursorç»“æ„**ï¼š

```c
// ç®€åŒ–çš„æ¸¸æ ‡ç»“æ„
struct BtCursor {
    Btree* pBtree;      // æ‰€å±B-Tree
    BtShared* pBt;      // å…±äº«B-Treeä¿¡æ¯
    int pgnoRoot;       // æ ¹é¡µå·
    int iPage;          // å½“å‰é¡µåœ¨è·¯å¾„ä¸­çš„ç´¢å¼•
    MemPage* aPage[20]; // é¡µè·¯å¾„ï¼ˆæœ€å¤š20å±‚ï¼‰
    int aiIdx[20];      // æ¯é¡µä¸­çš„å•å…ƒç´¢å¼•
    // ...
};
```

**æ¸¸æ ‡æ“ä½œ**ï¼š

```c
sqlite3BtreeCursor();      // åˆ›å»ºæ¸¸æ ‡
sqlite3BtreeMoveto();     // å®šä½åˆ°æŒ‡å®šé”®
sqlite3BtreeNext();        // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ª
sqlite3BtreePrev();        // ç§»åŠ¨åˆ°ä¸Šä¸€ä¸ª
sqlite3BtreeInsert();      // æ’å…¥è®°å½•
sqlite3BtreeDelete();      // åˆ é™¤è®°å½•
```

---

## 9. åŸå­æ€§ä¿è¯æœºåˆ¶

### 9.1. é¡µé¢çº§æ—¥å¿—

SQLiteé€šè¿‡**é¡µé¢çº§æ—¥å¿—**ä¿è¯B-Treeæ“ä½œçš„åŸå­æ€§ï¼š

**DELETEæ¨¡å¼æ—¥å¿—**ï¼š

```text
1. ä¿®æ”¹å‰ï¼šå°†æ—§é¡µå†…å®¹å†™å…¥å›æ»šæ—¥å¿—
2. ä¿®æ”¹ï¼šåœ¨å†…å­˜ä¸­ä¿®æ”¹é¡µ
3. æäº¤ï¼šå°†ä¿®æ”¹å†™å…¥æ•°æ®åº“æ–‡ä»¶
4. æ¸…ç†ï¼šåˆ é™¤å›æ»šæ—¥å¿—
```

**WALæ¨¡å¼æ—¥å¿—**ï¼š

```text
1. ä¿®æ”¹ï¼šç›´æ¥å†™å…¥WALæ–‡ä»¶ï¼ˆè¿½åŠ ï¼‰
2. æäº¤ï¼šåœ¨WALæ–‡ä»¶ä¸­æ ‡è®°æäº¤
3. Checkpointï¼šå®šæœŸå°†WALå†…å®¹åˆå¹¶åˆ°æ•°æ®åº“æ–‡ä»¶
```

### 9.2. å´©æºƒæ¢å¤

**DELETEæ¨¡å¼æ¢å¤**ï¼š

```text
å¯åŠ¨æ—¶æ£€æŸ¥ï¼š
1. å¦‚æœå›æ»šæ—¥å¿—å­˜åœ¨ â†’ æœ‰æœªå®Œæˆäº‹åŠ¡
2. ä½¿ç”¨æ—¥å¿—å›æ»šåˆ°ä¸€è‡´çŠ¶æ€
3. åˆ é™¤æ—¥å¿—æ–‡ä»¶
```

**WALæ¨¡å¼æ¢å¤**ï¼š

```text
å¯åŠ¨æ—¶æ£€æŸ¥ï¼š
1. å¦‚æœ-walæ–‡ä»¶å­˜åœ¨ â†’ æ£€æŸ¥æœªå®Œæˆäº‹åŠ¡
2. å›æ»šæœªå®Œæˆäº‹åŠ¡
3. åº”ç”¨å·²æäº¤äº‹åŠ¡åˆ°dbæ–‡ä»¶
```

### 9.3. åŸå­æ€§è¯æ˜

**å½¢å¼åŒ–æè¿°**ï¼š

```text
å®šä¹‰ï¼šäº‹åŠ¡TåŒ…å«æ“ä½œåºåˆ—{oâ‚, oâ‚‚, ..., oâ‚™}

æäº¤è¿‡ç¨‹ï¼š
1. æ—¥å¿—å†™å…¥ï¼šâˆ€iâˆˆ[1,n], å°†old_pageå†™å…¥æ—¥å¿—
2. é¡µä¿®æ”¹ï¼šåœ¨å†…å­˜ä¸­ä¿®æ”¹é¡µ
3. æäº¤æ ‡è®°ï¼šå†™å…¥commitè®°å½•
4. æ•°æ®è½ç›˜ï¼šå°†ä¿®æ”¹å†™å…¥æ•°æ®åº“æ–‡ä»¶
5. æ—¥å¿—æ¸…ç†ï¼šåˆ é™¤æ—¥å¿—æ–‡ä»¶

å´©æºƒæ¢å¤ä¸å˜å¼ï¼š
- å¦‚æœæ—¥å¿—å­˜åœ¨ä¸”æ— commitæ ‡è®° â†’ å›æ»š
- å¦‚æœæ—¥å¿—å­˜åœ¨ä¸”æœ‰commitæ ‡è®° â†’ é‡æ”¾
- å¦‚æœæ—¥å¿—ä¸å­˜åœ¨ â†’ äº‹åŠ¡å·²æäº¤
```

---

## 10. å­˜å‚¨ä¼˜åŒ–

### 10.1. é¡µå¤§å°é€‰æ‹©ä¸æ€§èƒ½ä¼˜åŒ–

**é¡µå¤§å°å½±å“**ï¼š

| é¡µå¤§å° | ä¼˜ç‚¹ | ç¼ºç‚¹ | é€‚ç”¨åœºæ™¯ |
|--------|------|------|----------|
| 512B | å°æ•°æ®é‡é«˜æ•ˆ | B-Treeé«˜åº¦å¢åŠ  | å°æ•°æ®é‡ |
| 4KBï¼ˆé»˜è®¤ï¼‰ | å¹³è¡¡ | - | å¤§å¤šæ•°åœºæ™¯ |
| 64KB | å¤§æ•°æ®é‡é«˜æ•ˆ | å°æ•°æ®é‡æµªè´¹ | å¤§æ•°æ®é‡ |

**é…ç½®å»ºè®®**ï¼š

```sql
-- å»ºåº“æ—¶è®¾ç½®é¡µå¤§å°ï¼ˆä»…åœ¨å»ºåº“æ—¶æœ‰æ•ˆï¼‰
PRAGMA page_size=4096;

-- æŸ¥çœ‹å½“å‰é¡µå¤§å°
PRAGMA page_size;
```

**é¡µå¤§å°æ€§èƒ½æµ‹è¯•ä»£ç **ï¼š

```python
import sqlite3
import time
import os

def test_page_size_performance(page_size, num_records=100000):
    """æµ‹è¯•ä¸åŒé¡µå¤§å°çš„æ€§èƒ½"""
    db_name = f'test_{page_size}.db'

# åˆ é™¤æ—§æ•°æ®åº“
    if os.path.exists(db_name):
        os.remove(db_name)

    conn = sqlite3.connect(db_name)

# è®¾ç½®é¡µå¤§å°ï¼ˆå¿…é¡»åœ¨å»ºåº“æ—¶è®¾ç½®ï¼‰
    conn.execute(f'PRAGMA page_size={page_size}')

# åˆ›å»ºè¡¨
    conn.execute('''
        CREATE TABLE test (
            id INTEGER PRIMARY KEY,
            data TEXT,
            value REAL
        )
    ''')

# æ’å…¥æ•°æ®
    start = time.time()
    conn.executemany(
        'INSERT INTO test (data, value) VALUES (?, ?)',
        [(f'data_{i}', i * 1.5) for i in range(num_records)]
    )
    conn.commit()
    insert_time = time.time() - start

# æŸ¥è¯¢æ€§èƒ½
    start = time.time()
    for i in range(0, num_records, 1000):
        conn.execute('SELECT * FROM test WHERE id = ?', (i,)).fetchone()
    query_time = time.time() - start

# è·å–ç»Ÿè®¡ä¿¡æ¯
    cursor = conn.execute('PRAGMA page_count')
    page_count = cursor.fetchone()[0]

    cursor = conn.execute('PRAGMA page_size')
    actual_page_size = cursor.fetchone()[0]

    file_size = os.path.getsize(db_name)

    conn.close()

    return {
        'page_size': actual_page_size,
        'page_count': page_count,
        'file_size': file_size,
        'insert_time': insert_time,
        'query_time': query_time
    }

# æµ‹è¯•ä¸åŒé¡µå¤§å°
page_sizes = [512, 1024, 4096, 8192, 16384, 32768, 65536]
results = []

for ps in page_sizes:
    result = test_page_size_performance(ps)
    results.append(result)
    print(f"é¡µå¤§å°: {result['page_size']:5d} bytes | "
          f"é¡µæ•°: {result['page_count']:5d} | "
          f"æ–‡ä»¶å¤§å°: {result['file_size']/1024/1024:.2f} MB | "
          f"æ’å…¥æ—¶é—´: {result['insert_time']:.2f}s | "
          f"æŸ¥è¯¢æ—¶é—´: {result['query_time']:.2f}s")

# æ€§èƒ½åˆ†æ
print("\næ€§èƒ½åˆ†æï¼š")
print("é¡µå¤§å°è¶Šå¤§ï¼ŒB-Treeé«˜åº¦è¶Šä½ï¼Œä½†å°æ•°æ®é‡æ—¶æµªè´¹ç©ºé—´")
print("æ¨èï¼šå¤§å¤šæ•°åœºæ™¯ä½¿ç”¨4KBï¼ˆé»˜è®¤ï¼‰ï¼Œå¤§æ•°æ®é‡ä½¿ç”¨64KB")
```

**å®é™…æ¡ˆä¾‹ï¼šæ ¹æ®æ•°æ®ç‰¹å¾é€‰æ‹©é¡µå¤§å°**ï¼š

```python
import sqlite3
import os

def create_optimized_database(data_type='mixed'):
    """æ ¹æ®æ•°æ®ç±»å‹åˆ›å»ºä¼˜åŒ–çš„æ•°æ®åº“"""

    if data_type == 'small':
# å°æ•°æ®é‡ï¼šä½¿ç”¨å°é¡µ
        page_size = 1024
        db_name = 'small_data.db'
    elif data_type == 'large':
# å¤§æ•°æ®é‡ï¼šä½¿ç”¨å¤§é¡µ
        page_size = 65536
        db_name = 'large_data.db'
    else:
# æ··åˆæ•°æ®ï¼šä½¿ç”¨é»˜è®¤é¡µ
        page_size = 4096
        db_name = 'mixed_data.db'

    if os.path.exists(db_name):
        os.remove(db_name)

    conn = sqlite3.connect(db_name)
    conn.execute(f'PRAGMA page_size={page_size}')

# å…¶ä»–ä¼˜åŒ–è®¾ç½®
    conn.execute('PRAGMA journal_mode=WAL')
    conn.execute('PRAGMA synchronous=NORMAL')
    conn.execute('PRAGMA cache_size=-64000')  # 64MBç¼“å­˜

    return conn

# ä½¿ç”¨ç¤ºä¾‹
conn = create_optimized_database('large')
conn.execute('''
    CREATE TABLE large_table (
        id INTEGER PRIMARY KEY,
        data BLOB  -- å¤§æ•°æ®å­—æ®µ
    )
''')
conn.close()
```

## 11. ç¢ç‰‡ç®¡ç†ä¸ä¼˜åŒ–

**è‡ªç”±å—é“¾è¡¨**ï¼š

- ç®¡ç†é¡µå†…ç©ºé—²ç©ºé—´
- æ”¯æŒç©ºé—´å¤ç”¨
- å‡å°‘é¡µåˆ†è£‚

**VACUUMæ“ä½œ**ï¼š

```sql
-- é‡å»ºæ•°æ®åº“ï¼Œæ¶ˆé™¤ç¢ç‰‡
VACUUM;

-- æ•ˆæœï¼š
-- 1. é‡å»ºæ‰€æœ‰è¡¨
-- 2. æ¶ˆé™¤ç¢ç‰‡
-- 3. ä¼˜åŒ–é¡µå¸ƒå±€
```

**ç¢ç‰‡æ£€æµ‹ä¸ä¼˜åŒ–ä»£ç ç¤ºä¾‹**ï¼š

```python
import sqlite3
import os

def analyze_fragmentation(db_path):
    """åˆ†ææ•°æ®åº“ç¢ç‰‡æƒ…å†µ"""
    conn = sqlite3.connect(db_path)

# è·å–æ•°æ®åº“ç»Ÿè®¡ä¿¡æ¯
    cursor = conn.execute('PRAGMA page_count')
    page_count = cursor.fetchone()[0]

    cursor = conn.execute('PRAGMA page_size')
    page_size = cursor.fetchone()[0]

    cursor = conn.execute('PRAGMA freelist_count')
    freelist_count = cursor.fetchone()[0]

# è®¡ç®—æ–‡ä»¶å¤§å°
    file_size = os.path.getsize(db_path)
    theoretical_size = page_count * page_size
    free_pages = freelist_count

# ç¢ç‰‡ç‡
    fragmentation = (free_pages / page_count * 100) if page_count > 0 else 0

    print(f"æ•°æ®åº“æ–‡ä»¶: {db_path}")
    print(f"é¡µå¤§å°: {page_size} bytes")
    print(f"æ€»é¡µæ•°: {page_count}")
    print(f"ç©ºé—²é¡µæ•°: {free_pages}")
    print(f"ç¢ç‰‡ç‡: {fragmentation:.2f}%")
    print(f"æ–‡ä»¶å¤§å°: {file_size / 1024 / 1024:.2f} MB")
    print(f"ç†è®ºå¤§å°: {theoretical_size / 1024 / 1024:.2f} MB")

    conn.close()

    return {
        'fragmentation': fragmentation,
        'free_pages': free_pages,
        'page_count': page_count
    }

def optimize_database(db_path):
    """ä¼˜åŒ–æ•°æ®åº“ï¼ˆæ¶ˆé™¤ç¢ç‰‡ï¼‰"""
    conn = sqlite3.connect(db_path)

# è·å–ä¼˜åŒ–å‰ä¿¡æ¯
    before = analyze_fragmentation(db_path)

# æ‰§è¡ŒVACUUM
    print("\næ‰§è¡ŒVACUUMä¼˜åŒ–...")
    conn.execute('VACUUM')
    conn.close()

# è·å–ä¼˜åŒ–åä¿¡æ¯
    print("\nä¼˜åŒ–åï¼š")
    after = analyze_fragmentation(db_path)

# è®¡ç®—ä¼˜åŒ–æ•ˆæœ
    improvement = before['fragmentation'] - after['fragmentation']
    print(f"\nç¢ç‰‡ç‡é™ä½: {improvement:.2f}%")

    return improvement

# ä½¿ç”¨ç¤ºä¾‹
# analyze_fragmentation('example.db')
# optimize_database('example.db')
```

**è‡ªåŠ¨ç¢ç‰‡ç®¡ç†ç­–ç•¥**ï¼š

```python
import sqlite3
import time

class AutoVacuumManager:
    """è‡ªåŠ¨ç¢ç‰‡ç®¡ç†"""

    def __init__(self, db_path, threshold=20.0):
        """
        threshold: ç¢ç‰‡ç‡é˜ˆå€¼ï¼ˆ%ï¼‰ï¼Œè¶…è¿‡æ­¤å€¼è‡ªåŠ¨æ‰§è¡ŒVACUUM
        """
        self.db_path = db_path
        self.threshold = threshold
        self.last_vacuum = time.time()
        self.vacuum_interval = 86400  # 24å°æ—¶

    def check_and_vacuum(self):
        """æ£€æŸ¥å¹¶æ‰§è¡ŒVACUUMï¼ˆå¦‚æœéœ€è¦ï¼‰"""
        conn = sqlite3.connect(self.db_path)

# æ£€æŸ¥ç¢ç‰‡ç‡
        cursor = conn.execute('PRAGMA page_count')
        page_count = cursor.fetchone()[0]

        cursor = conn.execute('PRAGMA freelist_count')
        freelist_count = cursor.fetchone()[0]

        fragmentation = (freelist_count / page_count * 100) if page_count > 0 else 0

        conn.close()

# æ£€æŸ¥æ˜¯å¦éœ€è¦VACUUM
        need_vacuum = (
            fragmentation > self.threshold or
            (time.time() - self.last_vacuum) > self.vacuum_interval
        )

        if need_vacuum:
            print(f"ç¢ç‰‡ç‡: {fragmentation:.2f}%ï¼Œæ‰§è¡ŒVACUUM...")
            self.vacuum()
            return True

        return False

    def vacuum(self):
        """æ‰§è¡ŒVACUUM"""
        conn = sqlite3.connect(self.db_path)
        conn.execute('VACUUM')
        conn.close()
        self.last_vacuum = time.time()
        print("VACUUMå®Œæˆ")

# ä½¿ç”¨ç¤ºä¾‹
# manager = AutoVacuumManager('app.db', threshold=15.0)
# manager.check_and_vacuum()  # å®šæœŸè°ƒç”¨
```

## 12. å‹ç¼©å­˜å‚¨

**Varintç¼–ç **ï¼š

- æ•´æ•°ä½¿ç”¨å˜é•¿ç¼–ç 
- å°æ•´æ•°å ç”¨æ›´å°‘ç©ºé—´
- å‡å°‘å­˜å‚¨å¼€é”€

**ç¤ºä¾‹**ï¼š

```text
0-127:     1å­—èŠ‚
128-16383: 2å­—èŠ‚
16384-...: 3å­—èŠ‚æˆ–æ›´å¤š
```

---

## 13. åˆ—å­˜å‚¨æ¶æ„åˆ†æ

### 13.1. åˆ—å­˜å‚¨æ¦‚è¿°

**åˆ—å­˜å‚¨ï¼ˆColumnar Storageï¼‰**æ˜¯ä¸€ç§æ•°æ®å­˜å‚¨æ–¹å¼ï¼Œå°†æ•°æ®æŒ‰åˆ—è€ŒéæŒ‰è¡Œç»„ç»‡å­˜å‚¨ã€‚ä¸SQLiteä½¿ç”¨çš„è¡Œå­˜å‚¨ï¼ˆRow-Oriented Storageï¼‰å½¢æˆå¯¹æ¯”ã€‚

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š

```text
è¡Œå­˜å‚¨ï¼ˆRow-Orientedï¼‰ï¼š
  Rowâ‚: [colâ‚, colâ‚‚, colâ‚ƒ, ..., colâ‚™]
  Rowâ‚‚: [colâ‚, colâ‚‚, colâ‚ƒ, ..., colâ‚™]
  Rowâ‚ƒ: [colâ‚, colâ‚‚, colâ‚ƒ, ..., colâ‚™]

åˆ—å­˜å‚¨ï¼ˆColumn-Orientedï¼‰ï¼š
  Colâ‚: [valâ‚, valâ‚‚, valâ‚ƒ, ..., valâ‚™]
  Colâ‚‚: [valâ‚, valâ‚‚, valâ‚ƒ, ..., valâ‚™]
  Colâ‚ƒ: [valâ‚, valâ‚‚, valâ‚ƒ, ..., valâ‚™]
```

### 13.2. SQLiteçš„è¡Œå­˜å‚¨æ¶æ„

**SQLiteå­˜å‚¨æ¨¡å‹**ï¼š

SQLiteé‡‡ç”¨**è¡Œå­˜å‚¨æ¶æ„**ï¼Œæ¯æ¡è®°å½•ï¼ˆè¡Œï¼‰çš„æ‰€æœ‰åˆ—å€¼è¿ç»­å­˜å‚¨åœ¨B-Treeé¡µä¸­ï¼š

```text
B-Treeé¡µç»“æ„ï¼ˆè¡Œå­˜å‚¨ï¼‰ï¼š
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ é¡µå¤´éƒ¨ (Header)                 â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ å•å…ƒæŒ‡é’ˆæ•°ç»„ (Cell Pointers)    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ å•å…ƒ1: [id, name, age, email]   â”‚ â† å®Œæ•´è¡Œ
  â”‚ å•å…ƒ2: [id, name, age, email]   â”‚ â† å®Œæ•´è¡Œ
  â”‚ å•å…ƒ3: [id, name, age, email]   â”‚ â† å®Œæ•´è¡Œ
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¡Œå­˜å‚¨ä¼˜åŠ¿**ï¼š

1. **äº‹åŠ¡æ€§èƒ½**ï¼šå•è¡Œæ›´æ–°åªéœ€ä¿®æ”¹ä¸€ä¸ªå•å…ƒ
2. **ç‚¹æŸ¥è¯¢**ï¼šé€šè¿‡ä¸»é”®å¿«é€Ÿå®šä½æ•´è¡Œæ•°æ®
3. **æ’å…¥æ€§èƒ½**ï¼šæ’å…¥æ–°è¡Œåªéœ€è¿½åŠ ä¸€ä¸ªå•å…ƒ
4. **OLTPåœºæ™¯**ï¼šé€‚åˆäº‹åŠ¡å¤„ç†ï¼Œè¯»å†™æ··åˆè´Ÿè½½

**è¡Œå­˜å‚¨åŠ£åŠ¿**ï¼š

1. **åˆ—æ‰«æ**ï¼šæŸ¥è¯¢å•åˆ—éœ€è¦è¯»å–æ•´è¡Œæ•°æ®
2. **å‹ç¼©æ•ˆç‡**ï¼šä¸åŒæ•°æ®ç±»å‹æ··åˆå­˜å‚¨ï¼Œå‹ç¼©ç‡ä½
3. **èšåˆæŸ¥è¯¢**ï¼šéœ€è¦æ‰«æå¤§é‡ä¸ç›¸å…³åˆ—æ•°æ®

### 13.3. åˆ—å­˜å‚¨æ¶æ„ç†è®º

**åˆ—å­˜å‚¨å¸ƒå±€**ï¼š

```text
åˆ—å­˜å‚¨æ–‡ä»¶ç»“æ„ï¼š
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ åˆ—1æ•°æ®å—: [valâ‚, valâ‚‚, ..., valâ‚™] â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ åˆ—2æ•°æ®å—: [valâ‚, valâ‚‚, ..., valâ‚™] â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚ åˆ—3æ•°æ®å—: [valâ‚, valâ‚‚, ..., valâ‚™] â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åˆ—å­˜å‚¨ä¼˜åŠ¿**ï¼š

1. **åˆ—æ‰«ææ•ˆç‡**ï¼šåªè¯»å–éœ€è¦çš„åˆ—ï¼ŒI/Oå‡å°‘
2. **å‹ç¼©æ•ˆç‡**ï¼šåŒåˆ—æ•°æ®ç±»å‹ç›¸åŒï¼Œå‹ç¼©ç‡é«˜
3. **èšåˆæŸ¥è¯¢**ï¼šé€‚åˆSUMã€AVGã€COUNTç­‰èšåˆæ“ä½œ
4. **å‘é‡åŒ–å¤„ç†**ï¼šåˆ—æ•°æ®å¯æ‰¹é‡å¤„ç†ï¼ŒSIMDä¼˜åŒ–

**åˆ—å­˜å‚¨åŠ£åŠ¿**ï¼š

1. **ç‚¹æŸ¥è¯¢**ï¼šéœ€è¦è®¿é—®å¤šåˆ—ï¼Œæ€§èƒ½è¾ƒå·®
2. **æ›´æ–°æ€§èƒ½**ï¼šæ›´æ–°ä¸€è¡Œéœ€è¦ä¿®æ”¹å¤šä¸ªåˆ—æ–‡ä»¶
3. **æ’å…¥æ€§èƒ½**ï¼šæ’å…¥æ–°è¡Œéœ€è¦è¿½åŠ åˆ°æ‰€æœ‰åˆ—
4. **äº‹åŠ¡å¼€é”€**ï¼šå¤šåˆ—æ›´æ–°éœ€è¦æ›´å¤šI/O

### 13.4. è¡Œå­˜å‚¨ vs åˆ—å­˜å‚¨å¯¹æ¯”

#### ğŸ“Š å­˜å‚¨æ¶æ„é€‰æ‹©å†³ç­–æ ‘

```mermaid
flowchart TD
    A[é€‰æ‹©å­˜å‚¨æ¶æ„] --> B{æŸ¥è¯¢æ¨¡å¼}

    B -->|ç‚¹æŸ¥è¯¢ä¸ºä¸»<br/>SELECT * WHERE id = ?| C[SQLiteè¡Œå­˜å‚¨ âœ…]
    B -->|åˆ†ææŸ¥è¯¢ä¸ºä¸»<br/>SELECT col1, SUM col2 GROUP BY| D{æ•°æ®é‡}
    B -->|æ··åˆåœºæ™¯<br/>ç‚¹æŸ¥è¯¢+åˆ†ææŸ¥è¯¢| J[æ··åˆå­˜å‚¨æ¶æ„ âœ…]

    D -->|< 100MB| E[SQLiteè¡Œå­˜å‚¨ âœ…<br/>+ ç´¢å¼•ä¼˜åŒ–]
    D -->|100MB - 1GB| F{æ›´æ–°é¢‘ç‡}
    D -->|> 1GB| I[è€ƒè™‘åˆ—å­˜å‚¨æ¨¡æ‹Ÿ<br/>æˆ–è¿ç§»åˆ°PostgreSQL/DuckDB]

    F -->|é¢‘ç¹æ›´æ–°| G[SQLiteè¡Œå­˜å‚¨ âœ…<br/>+ åˆ†åŒºä¼˜åŒ–]
    F -->|åªè¯»/å¾ˆå°‘æ›´æ–°| H[åˆ—å­˜å‚¨æ¨¡æ‹Ÿæ–¹æ¡ˆ âœ…<br/>å‚ç›´åˆ†åŒº/ç‰©åŒ–è§†å›¾]

    J --> J1[çƒ­æ•°æ®: SQLiteè¡Œå­˜å‚¨<br/>æœ€è¿‘æ•°æ®]
    J --> J2[å†·æ•°æ®: åˆ—å­˜å‚¨æ¨¡æ‹Ÿ<br/>æˆ–å¤–éƒ¨åˆ—å­˜å‚¨]

    style C fill:#90EE90
    style E fill:#90EE90
    style G fill:#90EE90
    style H fill:#87CEEB
    style I fill:#FFA500
    style J fill:#FFD700
    style J1 fill:#90EE90
    style J2 fill:#87CEEB
```

#### ğŸ“Š è¡Œå­˜å‚¨ vs åˆ—å­˜å‚¨ vs æ··åˆå­˜å‚¨å¯¹æ¯”çŸ©é˜µ

| ç»´åº¦ | è¡Œå­˜å‚¨ï¼ˆSQLiteï¼‰ | åˆ—å­˜å‚¨ | æ··åˆå­˜å‚¨ | æœ€ä½³é€‰æ‹© |
|------|----------------|--------|---------|---------|
| **ç‚¹æŸ¥è¯¢ï¼ˆå•è¡Œï¼‰** | â­â­â­â­â­ | â­â­ | â­â­â­â­ | è¡Œå­˜å‚¨ |
| **åˆ—æ‰«æï¼ˆå•åˆ—ï¼‰** | â­â­ | â­â­â­â­â­ | â­â­â­â­ | åˆ—å­˜å‚¨ |
| **èšåˆæŸ¥è¯¢** | â­â­ | â­â­â­â­â­ | â­â­â­â­ | åˆ—å­˜å‚¨ |
| **æ’å…¥å•è¡Œ** | â­â­â­â­â­ | â­â­ | â­â­â­ | è¡Œå­˜å‚¨ |
| **æ›´æ–°å•è¡Œ** | â­â­â­â­â­ | â­â­ | â­â­â­ | è¡Œå­˜å‚¨ |
| **æ‰¹é‡æ’å…¥** | â­â­â­â­ | â­â­â­ | â­â­â­ | è¡Œå­˜å‚¨ç•¥ä¼˜ |
| **å‹ç¼©ç‡** | â­â­ (10-30%) | â­â­â­â­â­ (70-90%) | â­â­â­â­ (50-70%) | åˆ—å­˜å‚¨ |
| **OLTPè´Ÿè½½** | â­â­â­â­â­ | â­â­ | â­â­â­â­ | è¡Œå­˜å‚¨ |
| **OLAPè´Ÿè½½** | â­â­ | â­â­â­â­â­ | â­â­â­â­ | åˆ—å­˜å‚¨ |
| **å­˜å‚¨æˆæœ¬** | â­â­ | â­â­â­â­â­ | â­â­â­â­ | åˆ—å­˜å‚¨ |
| **æŸ¥è¯¢å»¶è¿Ÿ** | â­â­â­â­ (ä½) | â­â­â­ (ä¸­) | â­â­â­â­ (ä½-ä¸­) | è¡Œå­˜å‚¨ |
| **ååé‡** | â­â­â­ (ä¸­) | â­â­â­â­â­ (é«˜) | â­â­â­â­ (ä¸­-é«˜) | åˆ—å­˜å‚¨ |
| **ç»´æŠ¤å¤æ‚åº¦** | â­â­â­â­â­ (ä½) | â­â­â­ (ä¸­) | â­â­ (é«˜) | è¡Œå­˜å‚¨ |
| **SQLiteæ”¯æŒ** | âœ… åŸç”Ÿæ”¯æŒ | âš ï¸ éœ€æ¨¡æ‹Ÿ | âš ï¸ éœ€è®¾è®¡ | è¡Œå­˜å‚¨ |
| **é€‚ç”¨åœºæ™¯** | OLTPã€ç‚¹æŸ¥è¯¢ã€åµŒå…¥å¼ | OLAPã€åˆ†ææŸ¥è¯¢ã€æ•°æ®ä»“åº“ | æ··åˆè´Ÿè½½ | - |

**é€‚ç”¨åœºæ™¯åˆ†æ**ï¼š

```text
è¡Œå­˜å‚¨ï¼ˆSQLiteï¼‰é€‚åˆï¼š
  - OLTPäº‹åŠ¡å¤„ç†
  - ç‚¹æŸ¥è¯¢å’ŒèŒƒå›´æŸ¥è¯¢
  - é¢‘ç¹çš„æ’å…¥å’Œæ›´æ–°
  - å°åˆ°ä¸­ç­‰è§„æ¨¡æ•°æ®
  - åµŒå…¥å¼åº”ç”¨

åˆ—å­˜å‚¨é€‚åˆï¼š
  - OLAPåˆ†ææŸ¥è¯¢
  - å¤§è§„æ¨¡æ•°æ®ä»“åº“
  - èšåˆå’Œç»Ÿè®¡æŸ¥è¯¢
  - åªè¯»æˆ–è¯»å¤šå†™å°‘åœºæ™¯
  - å¤§æ•°æ®åˆ†æ
```

#### ğŸ“Š SQLiteåˆ—å­˜å‚¨æ¨¡æ‹Ÿæ¶æ„å›¾

```mermaid
graph TB
    subgraph "SQLiteåˆ—å­˜å‚¨æ¨¡æ‹Ÿæ¶æ„"
        A[åº”ç”¨å±‚] --> B[SQLiteæŸ¥è¯¢å¼•æ“]
        B --> C{å­˜å‚¨ç±»å‹}

        C -->|è¡Œå­˜å‚¨| D[SQLite B-Tree<br/>åŸç”Ÿè¡Œå­˜å‚¨]
        C -->|åˆ—å­˜å‚¨æ¨¡æ‹Ÿ| E[åˆ—å­˜å‚¨æ¨¡æ‹Ÿå±‚]

        D --> D1[è¡¨1: å®Œæ•´è¡Œæ•°æ®]
        D --> D2[è¡¨2: å®Œæ•´è¡Œæ•°æ®]

        E --> E1[æ–¹æ¡ˆ1: å‚ç›´åˆ†åŒº]
        E --> E2[æ–¹æ¡ˆ2: åˆ—å¼ç‰©åŒ–è§†å›¾]
        E --> E3[æ–¹æ¡ˆ3: åˆ—å‹ç¼©å­˜å‚¨]

        E1 --> F1[è¡¨_col1<br/>è¡¨_col2<br/>è¡¨_col3]
        E2 --> F2[ç‰©åŒ–è§†å›¾<br/>æŒ‰åˆ—ç»„ç»‡]
        E3 --> F3[JSONå‹ç¼©<br/>åº”ç”¨å±‚å‹ç¼©]
    end

    style D fill:#90EE90
    style E fill:#87CEEB
    style E1 fill:#87CEEB
    style E2 fill:#87CEEB
    style E3 fill:#87CEEB
```

#### ğŸ“Š åˆ—å­˜å‚¨æ¨¡æ‹ŸæŸ¥è¯¢æ‰§è¡Œæ—¶åºå›¾

```mermaid
sequenceDiagram
    participant Client
    participant SQLite
    participant ColumnarView
    participant ColumnTables
    participant Compression

    Client->>SQLite: SELECT col1, SUM(col2) GROUP BY col1
    SQLite->>SQLite: è¯†åˆ«åˆ—å­˜å‚¨æ¨¡æ‹Ÿè¡¨
    SQLite->>ColumnarView: æŸ¥è¯¢åˆ—å­˜å‚¨è§†å›¾

    ColumnarView->>ColumnTables: è¯»å–col1åˆ—è¡¨
    ColumnTables->>Compression: è§£å‹ç¼©col1æ•°æ®
    Compression-->>ColumnTables: è¿”å›col1æ•°æ®

    ColumnarView->>ColumnTables: è¯»å–col2åˆ—è¡¨
    ColumnTables->>Compression: è§£å‹ç¼©col2æ•°æ®
    Compression-->>ColumnTables: è¿”å›col2æ•°æ®

    ColumnarView->>ColumnarView: æ‰§è¡ŒGROUP BYå’ŒSUMèšåˆ
    ColumnarView-->>SQLite: è¿”å›èšåˆç»“æœ
    SQLite-->>Client: è¿”å›æœ€ç»ˆç»“æœ

    Note over ColumnarView,ColumnTables: åªè¯»å–éœ€è¦çš„åˆ—ï¼ŒI/Oå‡å°‘
    Note over Compression: åˆ—å‹ç¼©ç‡50-70%
```

### 13.5. SQLiteä¸­çš„åˆ—å­˜å‚¨æ¨¡æ‹Ÿ

**è™½ç„¶SQLiteåŸç”Ÿä¸æ”¯æŒåˆ—å­˜å‚¨ï¼Œä½†å¯ä»¥é€šè¿‡è®¾è®¡æ¨¡å¼æ¨¡æ‹Ÿ**ï¼š

**æ–¹æ¡ˆ1ï¼šå‚ç›´åˆ†åŒºï¼ˆåˆ—åˆ†ç¦»ï¼‰**ï¼š

```sql
-- å°†å®½è¡¨æ‹†åˆ†ä¸ºå¤šä¸ªçª„è¡¨
-- åŸå§‹è¡¨
CREATE TABLE users (
    id INTEGER PRIMARY KEY,
    name TEXT,
    email TEXT,
    age INTEGER,
    profile TEXT,  -- å¤§å­—æ®µ
    metadata TEXT  -- å¤§å­—æ®µ
);

-- æ‹†åˆ†ä¸ºæ ¸å¿ƒè¡¨å’Œæ‰©å±•è¡¨
CREATE TABLE users_core (
    id INTEGER PRIMARY KEY,
    name TEXT,
    email TEXT,
    age INTEGER
);

CREATE TABLE users_extended (
    id INTEGER PRIMARY KEY,
    profile TEXT,
    metadata TEXT,
    FOREIGN KEY (id) REFERENCES users_core(id)
);

-- æŸ¥è¯¢æ—¶åªè®¿é—®éœ€è¦çš„è¡¨
SELECT id, name, email FROM users_core;  -- åªæ‰«ææ ¸å¿ƒåˆ—
```

**æ–¹æ¡ˆ2ï¼šè¦†ç›–ç´¢å¼•ï¼ˆCovering Indexï¼‰**ï¼š

```sql
-- åˆ›å»ºè¦†ç›–ç´¢å¼•ï¼ŒåŒ…å«æŸ¥è¯¢æ‰€éœ€çš„æ‰€æœ‰åˆ—
CREATE INDEX idx_user_analytics ON users(id, name, email, age);

-- æŸ¥è¯¢æ—¶ä½¿ç”¨è¦†ç›–ç´¢å¼•ï¼Œé¿å…å›è¡¨
SELECT name, email, age
FROM users
WHERE id BETWEEN 1000 AND 2000;
-- ç´¢å¼•åŒ…å«æ‰€æœ‰åˆ—ï¼Œæ— éœ€è®¿é—®ä¸»è¡¨
```

**æ–¹æ¡ˆ3ï¼šç‰©åŒ–è§†å›¾ï¼ˆMaterialized Viewï¼‰**ï¼š

```sql
-- ä¸ºåˆ†ææŸ¥è¯¢åˆ›å»ºç‰©åŒ–è§†å›¾
CREATE TABLE user_stats AS
SELECT
    age,
    COUNT(*) as count,
    AVG(score) as avg_score
FROM users
GROUP BY age;

-- åˆ†ææŸ¥è¯¢ç›´æ¥ä½¿ç”¨ç‰©åŒ–è§†å›¾
SELECT * FROM user_stats WHERE age > 30;
```

#### ğŸ“Š SQLiteåˆ—å­˜å‚¨æ¨¡æ‹Ÿæ–¹æ¡ˆå¯¹æ¯”çŸ©é˜µ

| æ–¹æ¡ˆ | å®ç°å¤æ‚åº¦ | æŸ¥è¯¢æ€§èƒ½ | å­˜å‚¨æ•ˆç‡ | ç»´æŠ¤æˆæœ¬ | é€‚ç”¨åœºæ™¯ | æ¨èåº¦ |
|------|-----------|---------|---------|---------|---------|--------|
| **å‚ç›´åˆ†åŒº** | â­â­â­ | â­â­â­ | â­â­â­ | â­â­â­ | å®½è¡¨ã€åˆ—åˆ†ç¦» | â­â­â­â­ |
| **åˆ—å¼ç‰©åŒ–è§†å›¾** | â­â­â­â­ | â­â­â­â­ | â­â­â­â­ | â­â­ | åˆ†ææŸ¥è¯¢ã€å®šæœŸåˆ·æ–° | â­â­â­â­â­ |
| **åˆ—å‹ç¼©å­˜å‚¨** | â­â­â­â­ | â­â­â­ | â­â­â­â­â­ | â­â­â­ | å¤§å­—æ®µã€JSONæ•°æ® | â­â­â­â­ |
| **å¤–éƒ¨åˆ—å­˜å‚¨** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­ | å¤§è§„æ¨¡æ•°æ®ã€PostgreSQLé›†æˆ | â­â­â­â­â­ |

**æ–¹æ¡ˆé€‰æ‹©å†³ç­–æ ‘**ï¼š

```mermaid
flowchart TD
    A[é€‰æ‹©åˆ—å­˜å‚¨æ¨¡æ‹Ÿæ–¹æ¡ˆ] --> B{æ•°æ®è§„æ¨¡}

    B -->|< 1GB| C{æŸ¥è¯¢æ¨¡å¼}
    B -->|1GB - 10GB| D{æ›´æ–°é¢‘ç‡}
    B -->|> 10GB| E[è€ƒè™‘å¤–éƒ¨åˆ—å­˜å‚¨<br/>PostgreSQL/DuckDB]

    C -->|åˆ†ææŸ¥è¯¢ä¸ºä¸»| F[åˆ—å¼ç‰©åŒ–è§†å›¾ âœ…]
    C -->|å®½è¡¨åˆ†ç¦»| G[å‚ç›´åˆ†åŒº âœ…]

    D -->|åªè¯»/å¾ˆå°‘æ›´æ–°| H[åˆ—å¼ç‰©åŒ–è§†å›¾ âœ…]
    D -->|é¢‘ç¹æ›´æ–°| I[å‚ç›´åˆ†åŒº âœ…]

    F --> F1[ä¼˜åŠ¿: æŸ¥è¯¢æ€§èƒ½å¥½<br/>åŠ£åŠ¿: éœ€è¦å®šæœŸåˆ·æ–°]
    G --> G1[ä¼˜åŠ¿: å®ç°ç®€å•<br/>åŠ£åŠ¿: JOINå¼€é”€]
    H --> H1[ä¼˜åŠ¿: æ€§èƒ½+å­˜å‚¨ä¼˜åŒ–<br/>åŠ£åŠ¿: ç»´æŠ¤å¤æ‚]
    I --> I1[ä¼˜åŠ¿: æ›´æ–°çµæ´»<br/>åŠ£åŠ¿: æŸ¥è¯¢éœ€è¦JOIN]
    E --> E1[ä¼˜åŠ¿: åŸç”Ÿåˆ—å­˜å‚¨<br/>åŠ£åŠ¿: éœ€è¦æ•°æ®è¿ç§»]

    style F fill:#90EE90
    style G fill:#90EE90
    style H fill:#90EE90
    style I fill:#90EE90
    style E fill:#FFA500
```

### 13.6. åˆ—å­˜å‚¨å®ç°åŸç†

**åˆ—å­˜å‚¨æ–‡ä»¶ç»„ç»‡**ï¼š

```text
åˆ—å­˜å‚¨æ–‡ä»¶ç»“æ„ï¼š
  ColumnFile = {
    Header: {
      ColumnName: string
      DataType: type
      RowCount: integer
      CompressionType: enum
    }
    DataBlocks: [
      Blockâ‚: [compressed_data]
      Blockâ‚‚: [compressed_data]
      ...
    ]
    Index: {
      BlockOffsets: [offsetâ‚, offsetâ‚‚, ...]
      MinMaxValues: [(minâ‚, maxâ‚), (minâ‚‚, maxâ‚‚), ...]
    }
  }
```

**åˆ—å­˜å‚¨æŸ¥è¯¢æµç¨‹**ï¼š

```text
åˆ—å­˜å‚¨æŸ¥è¯¢æ‰§è¡Œï¼š
  1. è§£ææŸ¥è¯¢ï¼Œç¡®å®šéœ€è¦çš„åˆ—
  2. è¯»å–ç›¸å…³åˆ—æ–‡ä»¶
  3. è§£å‹åˆ—æ•°æ®å—
  4. åº”ç”¨è¿‡æ»¤æ¡ä»¶ï¼ˆåˆ—çº§è¿‡æ»¤ï¼‰
  5. åˆå¹¶å¤šåˆ—æ•°æ®ï¼ˆå¦‚æœéœ€è¦ï¼‰
  6. è¿”å›ç»“æœé›†
```

#### ğŸ“Š SQLiteåˆ—å­˜å‚¨æŠ€æœ¯æ ˆå¯¹æ¯”

**SQLiteåˆ—å­˜å‚¨æ¨¡æ‹Ÿ vs å…¶ä»–åˆ—å­˜å‚¨æ•°æ®åº“**ï¼š

| ç»´åº¦ | SQLiteåˆ—å­˜å‚¨æ¨¡æ‹Ÿ | PostgreSQL + cstore_fdw | DuckDB | ClickHouse | æ¨èåœºæ™¯ |
|------|----------------|------------------------|--------|------------|---------|
| **ç±»å‹** | æ¨¡æ‹Ÿæ–¹æ¡ˆ | æ‰©å±• | åµŒå…¥å¼ | ä¸“ç”¨åˆ—å­˜å‚¨ | - |
| **æ€§èƒ½** | â­â­â­ | â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | - |
| **å‹ç¼©ç‡** | â­â­â­ (50-70%) | â­â­â­ (50-70%) | â­â­â­â­ (60-80%) | â­â­â­â­â­ (70-90%) | - |
| **SQLiteå…¼å®¹** | âœ… å®Œå…¨å…¼å®¹ | âŒ éœ€è¿ç§» | âŒ éœ€è¿ç§» | âŒ éœ€è¿ç§» | SQLiteåœºæ™¯ |
| **å®ç°å¤æ‚åº¦** | â­â­â­ (ä¸­) | â­â­â­â­ (ä¸­é«˜) | â­â­â­ (ä¸­) | â­â­â­â­ (ä¸­é«˜) | - |
| **ç»´æŠ¤æˆæœ¬** | â­â­â­ (ä¸­) | â­â­â­ (ä¸­) | â­â­â­â­ (ä½) | â­â­â­ (ä¸­) | - |
| **é€‚ç”¨åœºæ™¯** | å°è§„æ¨¡åˆ†æã€SQLiteç”Ÿæ€ | æ··åˆè´Ÿè½½ã€å·²æœ‰PostgreSQL | æ•°æ®åˆ†æã€BIå·¥å…· | OLAPã€å®æ—¶åˆ†æ | - |
| **æ•°æ®è§„æ¨¡** | < 10GB | 10GB - 1TB | < 100GB | > 1TB | - |

**æŠ€æœ¯é€‰å‹å»ºè®®**ï¼š

- **å·²æœ‰SQLiteç³»ç»Ÿï¼Œå°è§„æ¨¡åˆ†æ**ï¼šä½¿ç”¨SQLiteåˆ—å­˜å‚¨æ¨¡æ‹Ÿæ–¹æ¡ˆ
- **éœ€è¦åŸç”Ÿåˆ—å­˜å‚¨ï¼Œä¸­ç­‰è§„æ¨¡**ï¼šè€ƒè™‘DuckDBï¼ˆåµŒå…¥å¼ï¼Œæ˜“é›†æˆï¼‰
- **å¤§è§„æ¨¡æ•°æ®ä»“åº“**ï¼šè€ƒè™‘ClickHouseæˆ–PostgreSQL + cstore_fdw
- **æ··åˆè´Ÿè½½ï¼Œå·²æœ‰PostgreSQL**ï¼šä½¿ç”¨PostgreSQL + cstore_fdw

---

## 14. åˆ—å‹ç¼©æŠ€æœ¯è¯¦è§£

### 14.1. åˆ—å‹ç¼©æ¦‚è¿°

**åˆ—å‹ç¼©ï¼ˆColumn Compressionï¼‰**æ˜¯åˆ—å­˜å‚¨çš„æ ¸å¿ƒä¼˜åŠ¿ä¹‹ä¸€ã€‚ç”±äºåˆ—å­˜å‚¨ä¸­åŒä¸€åˆ—çš„æ•°æ®ç±»å‹ç›¸åŒï¼Œæ•°æ®åˆ†å¸ƒç›¸ä¼¼ï¼Œå‹ç¼©æ•ˆç‡è¿œé«˜äºè¡Œå­˜å‚¨ã€‚

**å‹ç¼©åŸç†**ï¼š

```text
åˆ—å‹ç¼©ä¼˜åŠ¿ï¼š
  1. æ•°æ®ç±»å‹ä¸€è‡´ï¼šåŒä¸€åˆ—æ•°æ®ç±»å‹ç›¸åŒï¼Œå‹ç¼©ç®—æ³•é’ˆå¯¹æ€§å¼º
  2. æ•°æ®ç›¸ä¼¼æ€§ï¼šç›¸é‚»å€¼å¾€å¾€ç›¸ä¼¼ï¼Œå‹ç¼©ç‡é«˜
  3. æ‰¹é‡å¤„ç†ï¼šæ•´åˆ—æ•°æ®å¯æ‰¹é‡å‹ç¼©ï¼Œæ•ˆç‡é«˜
  4. å‘é‡åŒ–ï¼šå‹ç¼©åçš„åˆ—æ•°æ®å¯å‘é‡åŒ–å¤„ç†
```

### 14.2. åˆ—å‹ç¼©ç®—æ³•

#### 14.2.1. å­—å…¸ç¼–ç ï¼ˆDictionary Encodingï¼‰

**åŸç†**ï¼šå°†é‡å¤å€¼æ˜ å°„åˆ°å­—å…¸ç´¢å¼•ï¼Œç”¨çŸ­æ•´æ•°ä»£æ›¿é•¿å­—ç¬¦ä¸²ã€‚

```text
åŸå§‹æ•°æ®ï¼š
  ['Apple', 'Banana', 'Apple', 'Cherry', 'Apple', 'Banana']

å­—å…¸ç¼–ç ï¼š
  Dictionary: {0: 'Apple', 1: 'Banana', 2: 'Cherry'}
  Encoded: [0, 1, 0, 2, 0, 1]

å‹ç¼©ç‡ï¼šå‡è®¾åŸå§‹å­—ç¬¦ä¸²å¹³å‡10å­—èŠ‚ï¼Œç¼–ç å1å­—èŠ‚
  åŸå§‹å¤§å°ï¼š6 Ã— 10 = 60å­—èŠ‚
  ç¼–ç å¤§å°ï¼š6 Ã— 1 + å­—å…¸(30) = 36å­—èŠ‚
  å‹ç¼©ç‡ï¼š40% (èŠ‚çœ24å­—èŠ‚)
```

**é€‚ç”¨åœºæ™¯**ï¼š

- ä½åŸºæ•°ï¼ˆCardinalityï¼‰åˆ—ï¼šé‡å¤å€¼å¤š
- å­—ç¬¦ä¸²åˆ—ï¼šæ–‡æœ¬æ•°æ®
- æšä¸¾ç±»å‹ï¼šå›ºå®šå€¼é›†åˆ

**å½¢å¼åŒ–å®šä¹‰**ï¼š

```text
å­—å…¸ç¼–ç å®šä¹‰ï¼š
  DictionaryEncoding(Column) = (Dict, Encoded)

å…¶ä¸­ï¼š
  Dict: å€¼åˆ°ç´¢å¼•çš„æ˜ å°„ {value â†’ index}
  Encoded: ç¼–ç åçš„ç´¢å¼•åºåˆ— [indexâ‚, indexâ‚‚, ..., indexâ‚™]

å‹ç¼©ç‡ï¼š
  CompressionRatio = (OriginalSize - EncodedSize) / OriginalSize
```

#### 14.2.2. æ¸¸ç¨‹ç¼–ç ï¼ˆRun-Length Encoding, RLEï¼‰

**åŸç†**ï¼šå°†è¿ç»­ç›¸åŒå€¼å‹ç¼©ä¸ºï¼ˆå€¼ï¼Œé•¿åº¦ï¼‰å¯¹ã€‚

```text
åŸå§‹æ•°æ®ï¼š
  [1, 1, 1, 2, 2, 3, 3, 3, 3, 3]

æ¸¸ç¨‹ç¼–ç ï¼š
  [(1, 3), (2, 2), (3, 5)]

å‹ç¼©ç‡ï¼š
  åŸå§‹å¤§å°ï¼š10 Ã— 4å­—èŠ‚ = 40å­—èŠ‚
  ç¼–ç å¤§å°ï¼š3 Ã— 8å­—èŠ‚ = 24å­—èŠ‚
  å‹ç¼©ç‡ï¼š40% (èŠ‚çœ16å­—èŠ‚)
```

**é€‚ç”¨åœºæ™¯**ï¼š

- æ’åºåçš„åˆ—ï¼šè¿ç»­å€¼ç›¸åŒ
- ç¨€ç–æ•°æ®ï¼šå¤§é‡é‡å¤å€¼
- æ—¶é—´åºåˆ—ï¼šç›¸åŒå€¼è¿ç»­å‡ºç°

**å½¢å¼åŒ–å®šä¹‰**ï¼š

```text
æ¸¸ç¨‹ç¼–ç å®šä¹‰ï¼š
  RLE(Column) = [(valueâ‚, lengthâ‚), (valueâ‚‚, lengthâ‚‚), ...]

å…¶ä¸­ï¼š
  valueáµ¢: é‡å¤çš„å€¼
  lengtháµ¢: é‡å¤æ¬¡æ•°

å‹ç¼©æ¡ä»¶ï¼š
  CompressionEffective âŸº Î£ lengtháµ¢ < n
  (æ€»æ¸¸ç¨‹æ•°å°äºåŸå§‹æ•°æ®é‡)
```

#### 14.2.3. å¢é‡ç¼–ç ï¼ˆDelta Encodingï¼‰

**åŸç†**ï¼šå­˜å‚¨ç›¸é‚»å€¼çš„å·®å€¼è€Œéç»å¯¹å€¼ã€‚

```text
åŸå§‹æ•°æ®ï¼ˆæ’åºåï¼‰ï¼š
  [100, 105, 107, 110, 115, 120]

å¢é‡ç¼–ç ï¼š
  [100, +5, +2, +3, +5, +5]
  Base: 100
  Deltas: [5, 2, 3, 5, 5]

å‹ç¼©ç‡ï¼š
  åŸå§‹å¤§å°ï¼š6 Ã— 4å­—èŠ‚ = 24å­—èŠ‚
  ç¼–ç å¤§å°ï¼š4 + 5 Ã— 1å­—èŠ‚ = 9å­—èŠ‚ï¼ˆå‡è®¾å·®å€¼<128ï¼‰
  å‹ç¼©ç‡ï¼š62.5% (èŠ‚çœ15å­—èŠ‚)
```

**é€‚ç”¨åœºæ™¯**ï¼š

- æœ‰åºæ•°å€¼åˆ—ï¼šæ—¶é—´æˆ³ã€IDåºåˆ—
- å•è°ƒé€’å¢/é€’å‡æ•°æ®
- æ•°å€¼èŒƒå›´å¤§ä½†å·®å€¼å°

**å½¢å¼åŒ–å®šä¹‰**ï¼š

```text
å¢é‡ç¼–ç å®šä¹‰ï¼š
  DeltaEncoding(Column) = (base, [Î´â‚, Î´â‚‚, ..., Î´â‚™â‚‹â‚])

å…¶ä¸­ï¼š
  base = Column[0]
  Î´áµ¢ = Column[i+1] - Column[i]

å‹ç¼©ä¼˜åŠ¿ï¼š
  VarInt(Î´áµ¢) â‰¤ VarInt(Column[i+1])
  (å·®å€¼é€šå¸¸å°äºç»å¯¹å€¼)
```

#### 14.2.4. ä½å›¾å‹ç¼©ï¼ˆBitmap Compressionï¼‰

**åŸç†**ï¼šå¯¹äºä½åŸºæ•°å¸ƒå°”æˆ–æšä¸¾å€¼ï¼Œä½¿ç”¨ä½å›¾è¡¨ç¤ºã€‚

```text
åŸå§‹æ•°æ®ï¼ˆå¸ƒå°”åˆ—ï¼‰ï¼š
  [true, false, true, true, false, true]

ä½å›¾ç¼–ç ï¼š
  Bitmap: 101101 (äºŒè¿›åˆ¶)
  å­˜å‚¨ï¼š1å­—èŠ‚ï¼ˆ6ä½ + 2ä½å¡«å……ï¼‰

å‹ç¼©ç‡ï¼š
  åŸå§‹å¤§å°ï¼š6 Ã— 1å­—èŠ‚ = 6å­—èŠ‚ï¼ˆå¸ƒå°”å€¼ï¼‰
  ç¼–ç å¤§å°ï¼š1å­—èŠ‚
  å‹ç¼©ç‡ï¼š83.3% (èŠ‚çœ5å­—èŠ‚)
```

**é€‚ç”¨åœºæ™¯**ï¼š

- å¸ƒå°”åˆ—ï¼štrue/false
- ä½åŸºæ•°æšä¸¾ï¼š2-8ä¸ªå€¼
- ç¨€ç–ä½å›¾ï¼šå¤§é‡0ï¼Œå°‘é‡1

#### 14.2.5. é€šç”¨å‹ç¼©ç®—æ³•

**åœ¨åˆ—çº§å‹ç¼©åŸºç¡€ä¸Šï¼Œå¯è¿›ä¸€æ­¥åº”ç”¨é€šç”¨å‹ç¼©**ï¼š

```text
å‹ç¼©å±‚æ¬¡ï¼š
  1. åˆ—çº§å‹ç¼©ï¼ˆå­—å…¸ã€RLEã€å¢é‡ç­‰ï¼‰
  2. é€šç”¨å‹ç¼©ï¼ˆLZ4ã€Zstdã€Snappyç­‰ï¼‰

å‹ç¼©æµç¨‹ï¼š
  Original â†’ ColumnCompress â†’ GeneralCompress â†’ Storage
```

**å‹ç¼©ç®—æ³•å¯¹æ¯”**ï¼š

| å‹ç¼©ç®—æ³• | å‹ç¼©ç‡ | å‹ç¼©é€Ÿåº¦ | è§£å‹é€Ÿåº¦ | é€‚ç”¨åœºæ™¯ |
|---------|--------|---------|---------|---------|
| **LZ4** | â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | å®æ—¶æŸ¥è¯¢ |
| **Zstd** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | å¹³è¡¡åœºæ™¯ |
| **Snappy** | â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | å¿«é€Ÿå‹ç¼© |
| **Gzip** | â­â­â­â­ | â­â­ | â­â­â­ | å­˜å‚¨ä¼˜åŒ– |
| **Brotli** | â­â­â­â­â­ | â­â­ | â­â­â­ | æœ€é«˜å‹ç¼©ç‡ |

### 14.3. åˆ—å‹ç¼©æ€§èƒ½åˆ†æ

**å‹ç¼©æ”¶ç›Š**ï¼š

```text
å‹ç¼©æ”¶ç›Šè®¡ç®—ï¼š
  CompressionBenefit = {
    StorageSavings: OriginalSize - CompressedSize
    IOReduction: (1 - CompressedSize/OriginalSize) Ã— ReadIO
    CacheEfficiency: MoreDataInCache
  }

æ€»æ”¶ç›Šï¼š
  TotalBenefit = StorageSavings + IOReduction + CacheEfficiency
```

**å‹ç¼©æˆæœ¬**ï¼š

```text
å‹ç¼©æˆæœ¬ï¼š
  CompressionCost = {
    CPU: CompressTime + DecompressTime
    Memory: CompressBuffer + DecompressBuffer
    Latency: DecompressOverhead
  }
```

**å‹ç¼©å†³ç­–**ï¼š

```text
å‹ç¼©ç­–ç•¥é€‰æ‹©ï¼š
  if ColumnCardinality < Threshold:
    Use DictionaryEncoding()
  elif ColumnIsSorted:
    Use RLE() or DeltaEncoding()
  elif ColumnIsBoolean:
    Use BitmapCompression()
  else:
    Use GeneralCompression(LZ4 or Zstd)
```

### 14.4. SQLiteä¸­çš„å‹ç¼©å®è·µ

**è™½ç„¶SQLiteä¸æ”¯æŒåŸç”Ÿåˆ—å‹ç¼©ï¼Œä½†å¯é€šè¿‡åº”ç”¨å±‚å®ç°**ï¼š

**æ–¹æ¡ˆ1ï¼šåº”ç”¨å±‚å‹ç¼©**ï¼š

```python
import sqlite3
import zlib
import json

def compress_column_data(data):
    """å‹ç¼©åˆ—æ•°æ®"""
    json_str = json.dumps(data)
    compressed = zlib.compress(json_str.encode('utf-8'))
    return compressed

def decompress_column_data(compressed):
    """è§£å‹åˆ—æ•°æ®"""
    decompressed = zlib.decompress(compressed)
    return json.loads(decompressed.decode('utf-8'))

# å­˜å‚¨å‹ç¼©æ•°æ®
conn = sqlite3.connect('example.db')
cursor = conn.cursor()

# å°†å¤šè¡Œæ•°æ®å‹ç¼©å­˜å‚¨
data = [{'id': i, 'value': f'value_{i}'} for i in range(1000)]
compressed = compress_column_data(data)

cursor.execute('''
    CREATE TABLE IF NOT EXISTS compressed_data (
        id INTEGER PRIMARY KEY,
        compressed_column BLOB
    )
''')

cursor.execute('INSERT INTO compressed_data (compressed_column) VALUES (?)',
               (compressed,))
conn.commit()
```

**æ–¹æ¡ˆ2ï¼šä½¿ç”¨JSONå­˜å‚¨å’Œå‹ç¼©**ï¼š

```sql
-- ä½¿ç”¨JSONå­˜å‚¨åˆ—æ•°æ®ï¼Œåº”ç”¨å‹ç¼©
CREATE TABLE analytics_data (
    id INTEGER PRIMARY KEY,
    date TEXT,
    metrics TEXT,  -- JSONæ ¼å¼ï¼Œå¯å‹ç¼©
    compressed_metrics BLOB  -- å‹ç¼©åçš„JSON
);

-- æŸ¥è¯¢æ—¶è§£å‹
-- æ³¨æ„ï¼šéœ€è¦åœ¨åº”ç”¨å±‚å¤„ç†å‹ç¼©/è§£å‹
```

**æ–¹æ¡ˆ3ï¼šå¤–éƒ¨åˆ—å­˜å‚¨ç³»ç»Ÿ**ï¼š

```text
æ··åˆæ¶æ„ï¼š
  SQLite (è¡Œå­˜å‚¨) â† â†’ åˆ—å­˜å‚¨ç³»ç»Ÿ (Parquet/ORC)

  1. çƒ­æ•°æ®å­˜å‚¨åœ¨SQLiteï¼ˆOLTPï¼‰
  2. å†·æ•°æ®å¯¼å‡ºåˆ°åˆ—å­˜å‚¨ï¼ˆOLAPï¼‰
  3. åˆ†ææŸ¥è¯¢ä½¿ç”¨åˆ—å­˜å‚¨
  4. äº‹åŠ¡æŸ¥è¯¢ä½¿ç”¨SQLite
```

### 14.5. åˆ—å‹ç¼©ç†è®ºåˆ†æ

**å‹ç¼©ç‡ç†è®º**ï¼š

```text
å‹ç¼©ç‡å®šä¹‰ï¼š
  CompressionRatio = CompressedSize / OriginalSize

ä¿¡æ¯ç†µï¼š
  H(X) = -Î£ P(x) Ã— logâ‚‚(P(x))

ç†è®ºå‹ç¼©ä¸‹é™ï¼š
  CompressedSize â‰¥ n Ã— H(X)
  (é¦™å†œç†µå®šç†)

å®é™…å‹ç¼©ç‡ï¼š
  ActualRatio = CompressedSize / OriginalSize
  Efficiency = H(X) / ActualRatio
```

**åˆ—å‹ç¼©ä¼˜åŠ¿è¯æ˜**ï¼š

```text
åˆ—å‹ç¼©ä¼˜åŠ¿ï¼š
  è®¾åˆ—Cæœ‰nä¸ªå€¼ï¼Œæ¯ä¸ªå€¼váµ¢å‡ºç°é¢‘ç‡fáµ¢

  è¡Œå­˜å‚¨ç†µï¼š
    H_row = -Î£ P(row) Ã— logâ‚‚(P(row))
    (è¡Œæ•°æ®æ··åˆï¼Œç†µé«˜)

  åˆ—å­˜å‚¨ç†µï¼š
    H_column = -Î£ (fáµ¢/n) Ã— logâ‚‚(fáµ¢/n)
    (åˆ—æ•°æ®åŒè´¨ï¼Œç†µä½)

  å‹ç¼©ç‡å…³ç³»ï¼š
    CompressionRatio_column < CompressionRatio_row
    (åˆ—å­˜å‚¨å‹ç¼©ç‡æ›´é«˜)
```

---

## 14.6. å­˜å‚¨å¼•æ“è®ºè¯è„‰ç»œ

### 14.6.1. è®ºè¯ç›®æ ‡

**ç›®æ ‡é™ˆè¿°**ï¼š

- è¯æ˜B-Treeç»“æ„çš„æ­£ç¡®æ€§å’Œæ€§èƒ½ä¿è¯
- è¯æ˜é¡µé¢ç®¡ç†çš„åŸå­æ€§
- è¯æ˜å­˜å‚¨å¼•æ“çš„å¯é æ€§

**è®ºè¯èŒƒå›´**ï¼š

- B-Treeç»“æ„æ­£ç¡®æ€§ï¼ˆé«˜åº¦ã€æœç´¢ã€æ’å…¥ã€åˆ é™¤ï¼‰
- é¡µé¢æ“ä½œçš„åŸå­æ€§
- å­˜å‚¨å¼•æ“çš„æ€§èƒ½ç‰¹å¾

### 14.6.2. è®ºè¯é“¾æ¡

**B-Treeæ­£ç¡®æ€§è®ºè¯é“¾**ï¼š

```text
å…¬ç†å±‚ (A2: B-Treeç»“æ„å…¬ç†)
  â†“
åŸºç¡€å®šç†å±‚ (B1: B-Treeé«˜åº¦å®šç†, B2: B-Treeæœç´¢æ­£ç¡®æ€§, B3: B-Treeæ’å…¥æ­£ç¡®æ€§)
  â†“
æ ¸å¿ƒå®šç†å±‚ (C16: B-Treeæ“ä½œæ­£ç¡®æ€§)
  â†“
åº”ç”¨å±‚ (ç´¢å¼•åŠ é€ŸæŸ¥è¯¢ï¼Œæ•°æ®å®Œæ•´æ€§)
```

**é¡µé¢åŸå­æ€§è®ºè¯é“¾**ï¼š

```text
å…¬ç†å±‚ (A3: äº‹åŠ¡åŸå­æ€§å…¬ç†)
  â†“
åŸºç¡€å®šç†å±‚ (B9: WALå¸§åŸå­æ€§)
  â†“
æ ¸å¿ƒå®šç†å±‚ (C1: ACIDåŸå­æ€§)
  â†“
åº”ç”¨å±‚ (é¡µé¢æ“ä½œåŸå­æ€§ä¿è¯)
```

### 14.6.3. å…³é”®è®ºè¯æ­¥éª¤

**æ­¥éª¤1: B-Treeé«˜åº¦è®ºè¯**:

- **å‰æ**: B-TreeèŠ‚ç‚¹æœ€å°åº¦æ•°tï¼ŒèŠ‚ç‚¹æœ€å¤š2t-1ä¸ªé”®
- **æ¨ç†**: å¯¹äºnä¸ªé”®çš„B-Treeï¼Œé«˜åº¦hæ»¡è¶³ h â‰¤ log_t((n+1)/2)
- **ç»“è®º**: B-Treeé«˜åº¦å¯¹æ•°çº§ï¼Œæœç´¢æ•ˆç‡O(log n) âœ…

**æ­¥éª¤2: B-Treeæœç´¢æ­£ç¡®æ€§è®ºè¯**:

- **å‰æ**: B-Treeä¿æŒæœ‰åºæ€§ï¼ˆå·¦å­æ ‘ < æ ¹ < å³å­æ ‘ï¼‰
- **æ¨ç†**: æœç´¢ç®—æ³•æ²¿è·¯å¾„ä¸‹é™ï¼Œæ¯æ¬¡æ¯”è¾ƒç¡®å®šå­æ ‘æ–¹å‘
- **ç»“è®º**: æœç´¢ç®—æ³•æ­£ç¡®æ‰¾åˆ°ç›®æ ‡é”®æˆ–ç¡®å®šä¸å­˜åœ¨ âœ…

**æ­¥éª¤3: B-Treeæ’å…¥æ­£ç¡®æ€§è®ºè¯**:

- **å‰æ**: æ’å…¥å‰B-Treeæ»¡è¶³B-Treeæ€§è´¨
- **æ¨ç†**: æ’å…¥æ“ä½œç»´æŠ¤B-Treeæ€§è´¨ï¼ˆåˆ†è£‚èŠ‚ç‚¹ï¼Œæå‡é”®ï¼‰
- **ç»“è®º**: æ’å…¥åB-Treeä»æ»¡è¶³B-Treeæ€§è´¨ âœ…

**æ­¥éª¤4: é¡µé¢åŸå­æ€§è®ºè¯**:

- **å‰æ**: WALæœºåˆ¶ä¿è¯æ‰€æœ‰é¡µé¢ä¿®æ”¹å…ˆå†™å…¥æ—¥å¿—
- **æ¨ç†**: é¡µé¢ä¿®æ”¹åœ¨äº‹åŠ¡æäº¤æ—¶åŸå­æ€§ç”Ÿæ•ˆ
- **ç»“è®º**: é¡µé¢æ“ä½œæ»¡è¶³åŸå­æ€§ âœ…

### 14.6.4. æ­£åä¾‹è¯æ˜

**æ­£ä¾‹ï¼šB-Treeæœç´¢é«˜æ•ˆ**:

- **åœºæ™¯**: 100ä¸‡æ¡è®°å½•çš„ç´¢å¼•
- **æ“ä½œ**: æœç´¢ç‰¹å®šé”®å€¼
- **ç»“æœ**: O(log n)æ—¶é—´å¤æ‚åº¦ï¼Œçº¦20æ¬¡æ¯”è¾ƒå³å¯æ‰¾åˆ°
- **éªŒè¯**: âœ… B-Treeæœç´¢é«˜æ•ˆ

**åä¾‹ï¼šæ— åºå­˜å‚¨çš„æœç´¢ä½æ•ˆ**:

- **åœºæ™¯**: 100ä¸‡æ¡è®°å½•æ— åºå­˜å‚¨
- **æ“ä½œ**: çº¿æ€§æœç´¢ç‰¹å®šé”®å€¼
- **ç»“æœ**: O(n)æ—¶é—´å¤æ‚åº¦ï¼Œå¹³å‡50ä¸‡æ¬¡æ¯”è¾ƒ
- **é—®é¢˜**: æœç´¢æ€§èƒ½å·®ï¼Œæ— æ³•æ¥å—
- **ç»“è®º**: âŒ è¯´æ˜B-Treeç´¢å¼•çš„å¿…è¦æ€§

**æ­£ä¾‹ï¼šé¡µé¢åŸå­æ€§ä¿è¯**:

- **åœºæ™¯**: äº‹åŠ¡ä¿®æ”¹å¤šä¸ªé¡µé¢
- **æ“ä½œ**: BEGIN â†’ ä¿®æ”¹Page1, Page2, Page3 â†’ COMMIT
- **ç»“æœ**: æ‰€æœ‰é¡µé¢ä¿®æ”¹åŸå­æ€§ç”Ÿæ•ˆï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»š
- **éªŒè¯**: âœ… é¡µé¢åŸå­æ€§æˆç«‹

**åä¾‹ï¼šæ— åŸå­æ€§ä¿è¯çš„é—®é¢˜**:

- **åœºæ™¯**: æ— äº‹åŠ¡ä¿æŠ¤çš„å¤šé¡µé¢ä¿®æ”¹
- **æ“ä½œ**: ä¿®æ”¹Page1æˆåŠŸ â†’ ä¿®æ”¹Page2å¤±è´¥ â†’ Page1å·²ä¿®æ”¹
- **ç»“æœ**: æ•°æ®ä¸ä¸€è‡´ï¼Œéƒ¨åˆ†ä¿®æ”¹ç”Ÿæ•ˆ
- **é—®é¢˜**: æ•°æ®å®Œæ•´æ€§ç ´å
- **ç»“è®º**: âŒ è¯´æ˜åŸå­æ€§ä¿è¯çš„å¿…è¦æ€§

---

## 15. å­˜å‚¨å¼•æ“æ€§èƒ½ç‰¹å¾

### 15.1. è¯»å–æ€§èƒ½

**ç´¢å¼•æŸ¥æ‰¾**ï¼š

- **æ—¶é—´å¤æ‚åº¦**ï¼šO(log n)
- **å®é™…æ€§èƒ½**ï¼šB-Treeé«˜åº¦é€šå¸¸â‰¤4ï¼ŒæŸ¥æ‰¾å¾ˆå¿«

**å…¨è¡¨æ‰«æ**ï¼š

- **æ—¶é—´å¤æ‚åº¦**ï¼šO(n)
- **ä¼˜åŒ–**ï¼šä½¿ç”¨ç´¢å¼•é¿å…å…¨è¡¨æ‰«æ

### 15.2. å†™å…¥æ€§èƒ½

**æ’å…¥æ€§èƒ½**ï¼š

- **å•æ¬¡æ’å…¥**ï¼šéœ€è¦æ—¥å¿—å†™å…¥ + æ•°æ®å†™å…¥
- **æ‰¹é‡æ’å…¥**ï¼šä½¿ç”¨äº‹åŠ¡å¯æå‡10å€+æ€§èƒ½

**æ›´æ–°æ€§èƒ½**ï¼š

- **åŸåœ°æ›´æ–°**ï¼šå¦‚æœæ•°æ®å¤§å°ä¸å˜ï¼Œå¯åŸåœ°æ›´æ–°
- **éåŸåœ°æ›´æ–°**ï¼šéœ€è¦åˆ é™¤æ—§è®°å½• + æ’å…¥æ–°è®°å½•

### 15.3. ç©ºé—´æ•ˆç‡

**å­˜å‚¨å¼€é”€**ï¼š

- **é¡µå¤´éƒ¨**ï¼š8-12å­—èŠ‚
- **å•å…ƒæŒ‡é’ˆ**ï¼šæ¯ä¸ª2å­—èŠ‚
- **å•å…ƒå†…å®¹**ï¼šå˜é•¿ï¼Œä½¿ç”¨varintç¼–ç 

**ç©ºé—´åˆ©ç”¨ç‡**ï¼š

- **ç†è®ºæœ€å¤§**ï¼šçº¦95%ï¼ˆè€ƒè™‘é¡µå¤´éƒ¨å’ŒæŒ‡é’ˆï¼‰
- **å®é™…å¹³å‡**ï¼šçº¦70-80%ï¼ˆè€ƒè™‘ç¢ç‰‡ï¼‰

---

## 19. å­˜å‚¨å¼•æ“æ¦‚å¿µå±‚æ¬¡å…³ç³»å›¾

### 19.1. B-Treeå­˜å‚¨å¼•æ“æ¦‚å¿µå±‚æ¬¡å›¾

```mermaid
graph TB
    subgraph "å­˜å‚¨å¼•æ“æ ¸å¿ƒæ¦‚å¿µ"
        A[å­˜å‚¨å¼•æ“] --> B[é¡µç»“æ„Page]
        A --> C[B-Treeç»“æ„]
        A --> D[åŸå­æ€§ä¿è¯]

        B --> B1[é¡µç±»å‹]
        B --> B2[é¡µå¤´éƒ¨]
        B --> B3[å•å…ƒCell]

        B1 --> B11[é”å®šé¡µ]
        B1 --> B12[è‡ªç”±åˆ—è¡¨é¡µ]
        B1 --> B13[B-Treeé¡µ]
        B1 --> B14[æŒ‡é’ˆæ˜ å°„é¡µ]

        C --> C1[è¡¨B-Tree]
        C --> C2[ç´¢å¼•B-Tree]
        C --> C3[B-Treeæ“ä½œ]

        C3 --> C31[æ’å…¥æ“ä½œ]
        C3 --> C32[åˆ é™¤æ“ä½œ]
        C3 --> C33[æŸ¥æ‰¾æ“ä½œ]
        C3 --> C34[åˆ†è£‚æ“ä½œ]

        D --> D1[é¡µé¢çº§æ—¥å¿—]
        D --> D2[å´©æºƒæ¢å¤]
        D --> D3[åŸå­æ€§è¯æ˜]
    end

    subgraph "å­˜å‚¨ä¼˜åŒ–"
        E[å­˜å‚¨ä¼˜åŒ–] --> E1[é¡µå¤§å°é€‰æ‹©]
        E --> E2[ç¢ç‰‡ç®¡ç†]
        E --> E3[å‹ç¼©å­˜å‚¨]
        E --> E4[åˆ—å­˜å‚¨æ¶æ„]

        E1 --> E11[é»˜è®¤4KB]
        E1 --> E12[å¯é…ç½®èŒƒå›´]
        E1 --> E13[æ€§èƒ½å½±å“]

        E2 --> E21[è‡ªç”±å—é“¾è¡¨]
        E2 --> E22[ç¢ç‰‡æ•´ç†]
        E2 --> E23[VACUUMæ“ä½œ]

        E3 --> E31[æ•°æ®å‹ç¼©]
        E3 --> E32[ç©ºé—´ä¼˜åŒ–]
        E3 --> E33[åˆ—å‹ç¼©æŠ€æœ¯]
    end

    subgraph "æ€§èƒ½ç‰¹å¾"
        F[æ€§èƒ½ç‰¹å¾] --> F1[è¯»å–æ€§èƒ½]
        F --> F2[å†™å…¥æ€§èƒ½]
        F --> F3[ç©ºé—´æ•ˆç‡]

        F1 --> F11[é¡ºåºè¯»å–]
        F1 --> F12[éšæœºè¯»å–]
        F1 --> F13[ç¼“å­˜å‘½ä¸­]

        F2 --> F21[é¡ºåºå†™å…¥]
        F2 --> F22[éšæœºå†™å…¥]
        F2 --> F23[æ‰¹é‡å†™å…¥]
    end

    A --> E
    C --> F
    D --> F
```

### 19.2. å­˜å‚¨ä¼˜åŒ–æ¦‚å¿µå…³ç³»å›¾

```text
å­˜å‚¨ä¼˜åŒ–æ¦‚å¿µå…³ç³»å›¾
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ä¼˜åŒ–ç­–ç•¥å±‚æ¬¡:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¡µå¤§å°ä¼˜åŒ–                                                  â”‚
â”‚  â”œâ”€ é»˜è®¤4KBï¼ˆé€‚åˆå¤§å¤šæ•°åœºæ™¯ï¼‰                                 â”‚
â”‚  â”œâ”€ å¤§é¡µï¼ˆ8KB-64KBï¼‰é€‚åˆå¤§è®°å½•                               â”‚
â”‚  â””â”€ å°é¡µï¼ˆ1KB-2KBï¼‰é€‚åˆå°è®°å½•                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¢ç‰‡ç®¡ç†ä¼˜åŒ–                                                â”‚
â”‚  â”œâ”€ è‡ªç”±å—é“¾è¡¨ï¼ˆç®¡ç†ç©ºé—²ç©ºé—´ï¼‰                                â”‚
â”‚  â”œâ”€ ç¢ç‰‡æ•´ç†ï¼ˆVACUUMæ“ä½œï¼‰                                   â”‚
â”‚  â””â”€ å®šæœŸç»´æŠ¤ï¼ˆå‡å°‘ç¢ç‰‡ç§¯ç´¯ï¼‰                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‹ç¼©å­˜å‚¨ä¼˜åŒ–                                                â”‚
â”‚  â”œâ”€ å­—å…¸ç¼–ç ï¼ˆé‡å¤å€¼å‹ç¼©ï¼‰                                    â”‚
â”‚  â”œâ”€ æ¸¸ç¨‹ç¼–ç ï¼ˆè¿ç»­å€¼å‹ç¼©ï¼‰                                    â”‚
â”‚  â”œâ”€ å¢é‡ç¼–ç ï¼ˆæœ‰åºå€¼å‹ç¼©ï¼‰                                    â”‚
â”‚  â””â”€ é€šç”¨å‹ç¼©ï¼ˆLZ4/Zstdï¼‰                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ—å­˜å‚¨æ¶æ„ä¼˜åŒ–                                              â”‚
â”‚  â”œâ”€ å‚ç›´åˆ†åŒºï¼ˆæ¨¡æ‹Ÿåˆ—å­˜å‚¨ï¼‰                                    â”‚
â”‚  â”œâ”€ è¦†ç›–ç´¢å¼•ï¼ˆå‡å°‘I/Oï¼‰                                      â”‚
â”‚  â”œâ”€ ç‰©åŒ–è§†å›¾ï¼ˆé¢„èšåˆï¼‰                                       â”‚
â”‚  â””â”€ æ··åˆå­˜å‚¨ï¼ˆçƒ­æ•°æ®è¡Œå­˜å‚¨ï¼Œå†·æ•°æ®åˆ—å­˜å‚¨ï¼‰                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ€§èƒ½ä¼˜åŒ–ä¼˜å…ˆçº§:
1. é¡µå¤§å°é€‰æ‹©ï¼ˆåŸºç¡€ä¼˜åŒ–ï¼Œå½±å“æ‰€æœ‰æ“ä½œï¼‰
2. ç¢ç‰‡ç®¡ç†ï¼ˆå®šæœŸç»´æŠ¤ï¼Œä¿æŒæ€§èƒ½ï¼‰
3. å‹ç¼©å­˜å‚¨ï¼ˆç©ºé—´ä¼˜åŒ–ï¼Œé€‚åˆå½’æ¡£æ•°æ®ï¼‰
4. åˆ—å­˜å‚¨æ¶æ„ï¼ˆåˆ†ææŸ¥è¯¢ä¼˜åŒ–ï¼‰
```

---

## 16. ğŸ”— ç›¸å…³èµ„æº

- [SQLiteå®˜æ–¹æ–‡æ¡£ - æ–‡ä»¶æ ¼å¼](https://www.sqlite.org/fileformat.html)
- [SQLiteå®˜æ–¹æ–‡æ¡£ - B-Tree](https://www.sqlite.org/btree.html)
- [01.01 ç¼–è¯‘æ‰§è¡Œæ¨¡å‹](./01.01-ç¼–è¯‘æ‰§è¡Œæ¨¡å‹.md)
- [01.02 äº‹åŠ¡ä¸å¹¶å‘æ§åˆ¶](./01.02-äº‹åŠ¡ä¸å¹¶å‘æ§åˆ¶.md)

---

## 17. ğŸ“š å‚è€ƒèµ„æ–™

- [SQLiteæ–‡ä»¶æ ¼å¼è§„èŒƒ](https://www.sqlite.org/fileformat.html)
- [B-Treeæ•°æ®ç»“æ„](https://en.wikipedia.org/wiki/B-tree)
- [æ•°æ®åº“ç³»ç»Ÿå®ç°](https://www.sqlite.org/arch.html)
- [åˆ—å­˜å‚¨æ•°æ®åº“ç³»ç»Ÿ](https://en.wikipedia.org/wiki/Column-oriented_DBMS)
- [æ•°æ®å‹ç¼©ç†è®º](https://en.wikipedia.org/wiki/Data_compression)

---

## 18. ğŸ”— äº¤å‰å¼•ç”¨

### 18.1. ç›¸å…³æ–‡æ¡£

#### 16.1.1. æ ¸å¿ƒæ¶æ„

- â­â­â­ [ç¼–è¯‘æ‰§è¡Œæ¨¡å‹](./01.01-ç¼–è¯‘æ‰§è¡Œæ¨¡å‹.md) - æ‰§è¡Œæ¨¡å‹åŸºç¡€
- â­â­â­ [äº‹åŠ¡ä¸å¹¶å‘æ§åˆ¶](./01.02-äº‹åŠ¡ä¸å¹¶å‘æ§åˆ¶.md) - äº‹åŠ¡éš”ç¦»å’Œå¹¶å‘æ§åˆ¶

#### 16.1.2. æ•°æ®æ¨¡å‹

- â­â­ [è¡¨ç»“æ„è®¾è®¡](../02-æ•°æ®æ¨¡å‹/02.02-è¡¨ç»“æ„è®¾è®¡.md) - ç´¢å¼•è®¾è®¡å®è·µ
- â­ [æ•°æ®ç±»å‹ç³»ç»Ÿ](../02-æ•°æ®æ¨¡å‹/02.01-æ•°æ®ç±»å‹ç³»ç»Ÿ.md) - æ•°æ®ç±»å‹åŸºç¡€

#### 18.1.3. æ€§èƒ½ä¼˜åŒ–

- â­â­ [ä¼˜åŒ–ç­–ç•¥](../03-æ€§èƒ½ä¼˜åŒ–/03.02-ä¼˜åŒ–ç­–ç•¥.md) - å­˜å‚¨ä¼˜åŒ–ç­–ç•¥ã€åˆ—å­˜å‚¨æ¨¡æ‹Ÿä¼˜åŒ– ğŸ†•
- â­ [æ€§èƒ½ç‰¹å¾åˆ†æ](../03-æ€§èƒ½ä¼˜åŒ–/03.01-æ€§èƒ½ç‰¹å¾åˆ†æ.md) - å­˜å‚¨æ€§èƒ½åˆ†æ
- â­â­ [å­˜å‚¨ç©ºé—´ä¼˜åŒ–æ¡ˆä¾‹](../cases/08-å­˜å‚¨ç©ºé—´ä¼˜åŒ–æ¡ˆä¾‹.md) - åˆ—å­˜å‚¨æ¨¡æ‹Ÿæ–¹æ¡ˆå®è·µ ğŸ†•

#### 18.1.4. å½¢å¼åŒ–ç†è®º

- â­â­â­ [B-Treeæ­£ç¡®æ€§è¯æ˜](../06-å½¢å¼åŒ–ç†è®º/06.02-B-Treeæ­£ç¡®æ€§è¯æ˜.md) - B-Treeç†è®ºè¯æ˜
- â­â­â­ [ACIDåŸå­æ€§è¯æ˜](../06-å½¢å¼åŒ–ç†è®º/06.01-ACIDåŸå­æ€§è¯æ˜.md) - åŸå­æ€§ç†è®ºè¯æ˜
- â­ [çŸ¥è¯†å›¾è°±](../06-å½¢å¼åŒ–ç†è®º/06.03-çŸ¥è¯†å›¾è°±.md) - æ¶æ„å¯è§†åŒ–

#### 18.1.5. ç†è®ºæ¨¡å‹ ğŸ†•

- â­â­â­ [å­˜å‚¨ç†è®º](../11-ç†è®ºæ¨¡å‹/11.05-å­˜å‚¨ç†è®º.md) - å­˜å‚¨æ¨¡å‹ç†è®ºã€ç´¢å¼•ç†è®ºã€ç¼“å­˜ç†è®ºã€æŒä¹…åŒ–ç†è®ºã€åˆ—å­˜å‚¨ç†è®ºã€åˆ—å‹ç¼©ç†è®º ğŸ†•
- â­â­ [ç®—æ³•å¤æ‚åº¦ç†è®º](../11-ç†è®ºæ¨¡å‹/11.03-ç®—æ³•å¤æ‚åº¦ç†è®º.md) - B-Treeæ“ä½œå¤æ‚åº¦ã€å­˜å‚¨æ“ä½œå¤æ‚åº¦
- â­â­ [å¹¶å‘æ§åˆ¶ç†è®º](../11-ç†è®ºæ¨¡å‹/11.04-å¹¶å‘æ§åˆ¶ç†è®º.md) - äº‹åŠ¡ç†è®ºã€éš”ç¦»æ€§ç†è®ºã€é”ç†è®º

#### 18.1.6. è®¾è®¡æ¨¡å‹ ğŸ†•

- â­â­â­ [æ¶æ„è®¾è®¡æ¨¡å‹](../12-è®¾è®¡æ¨¡å‹/12.01-æ¶æ„è®¾è®¡æ¨¡å‹.md) - åˆ†å±‚æ¶æ„è®¾è®¡ã€æ¨¡å—åŒ–è®¾è®¡
- â­â­ [è®¾è®¡å†³ç­–](../12-è®¾è®¡æ¨¡å‹/12.04-è®¾è®¡å†³ç­–.md) - å­˜å‚¨è®¾è®¡å†³ç­–ã€B-Treeå­˜å‚¨å†³ç­–

#### 18.1.7. å¯¼èˆªä¸ç´¢å¼• ğŸ†•

- â­â­â­ [æ ¸å¿ƒæœºåˆ¶å…¨æ™¯å›¾](./01.05-SQLiteæ ¸å¿ƒæœºåˆ¶å…¨æ™¯å›¾-å¤šç»´åº¦æ•´åˆåˆ†æ.md) - æ ¸å¿ƒæœºåˆ¶æ•´åˆåˆ†æï¼ˆå«å­˜å‚¨å¼•æ“è®ºè¯ï¼‰
- â­â­â­ [çŸ¥è¯†å›¾è°±ä¸æ¦‚å¿µå…³ç³»ç½‘ç»œ](../09-æœ€æ–°ç‰¹æ€§/09.03-SQLiteçŸ¥è¯†å›¾è°±ä¸æ¦‚å¿µå…³ç³»ç½‘ç»œ.md) - B-Treeå­˜å‚¨æœ¬ä½“
- â­â­ [æ–‡æ¡£ä¾èµ–å…³ç³»å›¾](../00-é¡¹ç›®å¯¼èˆª/06-æ–‡æ¡£ä¾èµ–å…³ç³»å›¾.md) - å­˜å‚¨å¼•æ“æ–‡æ¡£ä¾èµ–
- â­â­ [æœ¯è¯­æ ‡å‡†åŒ–è¯å…¸](../00-é¡¹ç›®å¯¼èˆª/03-æœ¯è¯­è¯å…¸/SQLiteæœ¯è¯­æ ‡å‡†åŒ–è¯å…¸.md) - å­˜å‚¨æ¦‚å¿µç´¢å¼•

### 18.2. ç›¸å…³æ¦‚å¿µé“¾æ¥ ğŸ†•

#### 18.2.1. æ ¸å¿ƒæ¦‚å¿µ

- **B-Tree** â†’ [çŸ¥è¯†å›¾è°±ï¼šB-Treeå­˜å‚¨æœ¬ä½“](../09-æœ€æ–°ç‰¹æ€§/09.03-SQLiteçŸ¥è¯†å›¾è°±ä¸æ¦‚å¿µå…³ç³»ç½‘ç»œ.md#æ ¸å¿ƒæœ¬ä½“b-treeå­˜å‚¨)
- **é¡µé¢ç®¡ç†** â†’ [çŸ¥è¯†å›¾è°±ï¼šé¡µé¢æ¦‚å¿µ](../09-æœ€æ–°ç‰¹æ€§/09.03-SQLiteçŸ¥è¯†å›¾è°±ä¸æ¦‚å¿µå…³ç³»ç½‘ç»œ.md#æ ¸å¿ƒæœ¬ä½“b-treeå­˜å‚¨)
- **B-Treeæ­£ç¡®æ€§** â†’ [å®šç†ï¼šC16-B-Treeæ“ä½œæ­£ç¡®æ€§](../06-å½¢å¼åŒ–ç†è®º/06.06-SQLiteå®šç†ä¾èµ–å…³ç³»å›¾è°±.md#c16-b-treeæ“ä½œæ­£ç¡®æ€§)
- **B-Treeé«˜åº¦** â†’ [å®šç†ï¼šB1-B-Treeé«˜åº¦å®šç†](../06-å½¢å¼åŒ–ç†è®º/06.06-SQLiteå®šç†ä¾èµ–å…³ç³»å›¾è°±.md#b1-b-treeé«˜åº¦å®šç†)

#### 18.2.2. å®šç†ä¾èµ–é“¾

- **B-Treeæ­£ç¡®æ€§é“¾**: A2 â†’ B1 â†’ B2 â†’ B3 â†’ C16 â†’ [è¯æ˜æ ‘](../06-å½¢å¼åŒ–ç†è®º/06.07-SQLiteæ ¸å¿ƒå®šç†å®Œæ•´è¯æ˜æ ‘.md#b-treeæ­£ç¡®æ€§è¯æ˜æ ‘)
- **é¡µé¢åŸå­æ€§é“¾**: A3 â†’ B9 â†’ C1 â†’ [è¯æ˜æ ‘](../06-å½¢å¼åŒ–ç†è®º/06.07-SQLiteæ ¸å¿ƒå®šç†å®Œæ•´è¯æ˜æ ‘.md#acidåŸå­æ€§è¯æ˜æ ‘)

---

**æœ€åæ›´æ–°**ï¼š2025-01-15
**ç»´æŠ¤è€…**ï¼šData-Science Team
