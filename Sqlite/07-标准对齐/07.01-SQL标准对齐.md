# SQL标准对齐：SQL-92, SQL:2016, SQL:2023

> **创建日期**：2025-11-13
> **最后更新**：2025-11-13
> **版本**：SQLite 3.31+ 至 3.47+

---

## 📋 概述

本文档详细说明SQLite与SQL标准的对齐情况，包括SQL-92、SQL:2016和SQL:2023标准的支持情况。

---

## 一、SQL-92标准支持情况

SQLite实现了**SQL-92标准的核心子集**，包括：

### 1.1 数据定义语言（DDL）

| SQL-92特性 | SQLite支持 | 说明 |
|-----------|----------|------|
| CREATE TABLE | ✅ 完全支持 | 支持列约束、主键、外键、CHECK约束 |
| ALTER TABLE | ⚠️ 部分支持 | 仅支持ADD COLUMN、RENAME TABLE，不支持DROP COLUMN |
| CREATE INDEX | ✅ 完全支持 | 支持唯一索引、复合索引、部分索引 |
| CREATE VIEW | ✅ 完全支持 | 支持可更新视图（WITH CHECK OPTION） |
| DROP TABLE/INDEX/VIEW | ✅ 完全支持 | |

### 1.2 数据操作语言（DML）

| SQL-92特性 | SQLite支持 | 说明 |
|-----------|----------|------|
| SELECT | ✅ 完全支持 | 支持子查询、UNION、EXCEPT、INTERSECT |
| INSERT | ✅ 完全支持 | 支持INSERT OR REPLACE、INSERT OR IGNORE |
| UPDATE | ✅ 完全支持 | 支持多表UPDATE（3.33+） |
| DELETE | ✅ 完全支持 | 支持多表DELETE（3.33+） |

### 1.3 事务控制

| SQL-92特性 | SQLite支持 | 说明 |
|-----------|----------|------|
| BEGIN TRANSACTION | ✅ 完全支持 | 支持DEFERRED/IMMEDIATE/EXCLUSIVE |
| COMMIT | ✅ 完全支持 | |
| ROLLBACK | ✅ 完全支持 | |
| SAVEPOINT | ✅ 完全支持 | SQLite 3.6.8+ |

### 1.4 约束与完整性

| SQL-92特性 | SQLite支持 | 说明 |
|-----------|----------|------|
| PRIMARY KEY | ✅ 完全支持 | INTEGER PRIMARY KEY = rowid别名 |
| FOREIGN KEY | ✅ 完全支持 | 需PRAGMA foreign_keys=ON |
| UNIQUE | ✅ 完全支持 | |
| CHECK | ✅ 完全支持 | |
| NOT NULL | ✅ 完全支持 | |

### 1.5 SQL-92偏差说明

#### 偏差1：动态类型系统

SQL-92要求严格的静态类型，SQLite采用动态类型（存储类系统）

**SQL-92标准（严格类型）**：

```sql
CREATE TABLE t(id INTEGER, name VARCHAR(50));
INSERT INTO t VALUES ('123', 456); -- 错误：类型不匹配
```

**SQLite（动态类型）**：

```sql
CREATE TABLE t(id INTEGER, name TEXT);
INSERT INTO t VALUES ('123', 456); -- 允许：'123'存储为TEXT，456存储为INTEGER
```

#### 偏差2：ALTER TABLE限制

SQL-92支持完整的ALTER TABLE，SQLite仅支持有限操作

**SQL-92标准**：

```sql
ALTER TABLE t DROP COLUMN name; -- SQLite不支持
ALTER TABLE t MODIFY COLUMN id BIGINT; -- SQLite不支持
```

**SQLite支持**：

```sql
ALTER TABLE t ADD COLUMN email TEXT; -- ✅ 支持
ALTER TABLE t RENAME TO t_new; -- ✅ 支持
```

---

## 二、SQL:2016标准对齐

SQL:2016引入了JSON支持、窗口函数等特性，SQLite的兼容情况：

| SQL:2016特性 | SQLite支持 | 版本要求 | 说明 |
|------------|----------|---------|------|
| **JSON函数** | ✅ 完全支持 | 3.9.0+ | JSON1扩展，RFC 7159兼容 |
| **窗口函数** | ✅ 完全支持 | 3.25.0+ | ROW_NUMBER, RANK, DENSE_RANK, LAG, LEAD等 |
| **CTE（WITH子句）** | ✅ 完全支持 | 3.8.3+ | 支持递归CTE（WITH RECURSIVE） |
| **UPSERT** | ✅ 完全支持 | 3.24.0+ | INSERT ... ON CONFLICT |
| **生成列** | ✅ 完全支持 | 3.31.0+ | GENERATED ALWAYS AS ... STORED/VIRTUAL |
| **布尔类型** | ⚠️ 部分支持 | 3.23.0+ | 存储为INTEGER (0/1)，无原生BOOLEAN类型 |

### 2.1 SQL:2016 JSON支持对比

**SQL:2016标准JSON函数**：

```sql
SELECT
    JSON_EXTRACT(data, '$.name') as name,  -- SQLite: json_extract()
    JSON_ARRAY_LENGTH(data, '$.items') as count,  -- SQLite: json_array_length()
    JSON_TYPE(data, '$.status') as type  -- SQLite: json_type()
FROM documents;
```

**SQLite JSON1扩展（完全兼容SQL:2016）**：

```sql
SELECT
    json_extract(config, '$.network.ip') as ip,
    json_array_length(config, '$.sensors') as sensor_count
FROM device_configs
WHERE json_type(config, '$.network') = 'object';
```

### 2.2 窗口函数示例（SQL:2016标准）

**SQL:2016窗口函数（SQLite 3.25.0+完全支持）**：

```sql
SELECT
    employee_id,
    department_id,
    salary,
    ROW_NUMBER() OVER (PARTITION BY department_id ORDER BY salary DESC) as rank,
    AVG(salary) OVER (PARTITION BY department_id) as dept_avg,
    LAG(salary, 1) OVER (ORDER BY employee_id) as prev_salary
FROM employees;
```

---

## 三、SQL:2023标准前瞻

SQL:2023标准的新特性与SQLite的兼容性：

| SQL:2023特性 | SQLite状态 | 说明 |
|------------|----------|------|
| **JSON5支持** | 🔄 规划中 | 当前仅支持RFC 7159 JSON |
| **多表UPDATE/DELETE增强** | ✅ 已支持 | SQLite 3.33.0+ |
| **STRICT表模式** | ✅ 已支持 | SQLite 3.37.0+，符合SQL:2023类型严格性要求 |
| **分区表** | ❌ 不支持 | SQLite无原生分区表，需应用层实现 |
| **并行查询** | 🔄 实验性 | SQLite 3.38.0+实验性支持 |

### 3.1 SQL:2023 STRICT表模式对齐

**SQL:2023要求：严格类型检查**

```sql
CREATE TABLE users STRICT (
    id INTEGER PRIMARY KEY,
    age INTEGER NOT NULL,
    email TEXT UNIQUE
);
```

**SQL:2023标准行为（SQLite 3.37+）**：

```sql
INSERT INTO users VALUES (1, 'twenty', 'test@example.com');
-- 错误：age必须是INTEGER类型，不能是TEXT

-- 正确用法
INSERT INTO users VALUES (1, 20, 'test@example.com'); -- ✅
```

---

## 📊 标准支持总结

### 支持程度

- **SQL-92核心子集**：✅ 90%+支持
- **SQL:2016关键特性**：✅ 80%+支持
- **SQL:2023前瞻特性**：🔄 部分支持

### 主要偏差

1. **动态类型系统**：与SQL-92静态类型要求不同
2. **ALTER TABLE限制**：不支持DROP COLUMN、MODIFY COLUMN
3. **分区表**：无原生支持
4. **并行查询**：仅实验性支持

### 优势特性

1. **JSON1扩展**：完全兼容SQL:2016 JSON标准
2. **窗口函数**：完整支持SQL:2016窗口函数
3. **STRICT表模式**：符合SQL:2023类型严格性要求
4. **UPSERT**：支持INSERT ... ON CONFLICT

---

## 🔗 相关资源

- [SQLite官方文档 - SQL标准](https://www.sqlite.org/lang.html)
- [ISO/IEC 9075 SQL标准](https://www.iso.org/standard/76583.html)
- [SQL:2016标准文档](https://www.iso.org/standard/76583.html)
- [SQL:2023标准文档](https://www.iso.org/standard/76583.html)

---

## 📚 参考资料

- [SQLite官方文档](https://www.sqlite.org/docs.html)
- [SQL标准对比表](https://www.sqlite.org/lang.html)
- [SQL:2016特性列表](https://en.wikipedia.org/wiki/SQL:2016)

---

**最后更新**：2025-11-13
**维护者**：Data-Science Team
