# æ•°æ®æ¨¡å‹ç†è®ºï¼šSQLiteç±»å‹ç³»ç»Ÿä¸å…³ç³»æ¨¡å‹

> **åˆ›å»ºæ—¥æœŸ**ï¼š2025-01-15
> **æœ€åæ›´æ–°**ï¼š2025-01-15
> **ç‰ˆæœ¬**ï¼šSQLite 3.31+ è‡³ 3.47.x

---

## 1. ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£ä»æ•°æ®æ¨¡å‹ç†è®ºè§†è§’æ·±å…¥åˆ†æSQLiteçš„ç±»å‹ç³»ç»Ÿã€å…³ç³»æ¨¡å‹ã€çº¦æŸç†è®ºå’ŒèŒƒå¼ç†è®ºï¼Œæä¾›å½¢å¼åŒ–çš„ç†è®ºåˆ†æå’Œæ•°å­¦è¯æ˜ã€‚

---

## 2. ğŸ“‘ ç›®å½•

- [æ•°æ®æ¨¡å‹ç†è®ºï¼šSQLiteç±»å‹ç³»ç»Ÿä¸å…³ç³»æ¨¡å‹](#æ•°æ®æ¨¡å‹ç†è®ºsqliteç±»å‹ç³»ç»Ÿä¸å…³ç³»æ¨¡å‹)
  - [1. ğŸ“‹ æ¦‚è¿°](#1--æ¦‚è¿°)
  - [2. ğŸ“‘ ç›®å½•](#2--ç›®å½•)
  - [3. ğŸ“Š æ€ç»´å¯¼å›¾](#3--æ€ç»´å¯¼å›¾)
  - [4. ç±»å‹ç³»ç»Ÿç†è®º](#4-ç±»å‹ç³»ç»Ÿç†è®º)
    - [4.1. ç±»å‹ç³»ç»Ÿå®šä¹‰](#41-ç±»å‹ç³»ç»Ÿå®šä¹‰)
    - [4.2. SQLiteç±»å‹ç³»ç»Ÿæ¨¡å‹](#42-sqliteç±»å‹ç³»ç»Ÿæ¨¡å‹)
    - [4.3. ç±»å‹è½¬æ¢ç†è®º](#43-ç±»å‹è½¬æ¢ç†è®º)
    - [4.4. ç±»å‹å®‰å…¨ç†è®º](#44-ç±»å‹å®‰å…¨ç†è®º)
  - [5. å…³ç³»æ¨¡å‹ç†è®º](#5-å…³ç³»æ¨¡å‹ç†è®º)
    - [5.1. å…³ç³»æ¨¡å‹åŸºç¡€](#51-å…³ç³»æ¨¡å‹åŸºç¡€)
    - [5.2. SQLiteå…³ç³»æ¨¡å‹å®ç°](#52-sqliteå…³ç³»æ¨¡å‹å®ç°)
    - [5.3. å…³ç³»ä»£æ•°ç†è®º](#53-å…³ç³»ä»£æ•°ç†è®º)
    - [5.4. å…³ç³»å®Œæ•´æ€§ç†è®º](#54-å…³ç³»å®Œæ•´æ€§ç†è®º)
  - [6. çº¦æŸç†è®º](#6-çº¦æŸç†è®º)
    - [6.1. çº¦æŸå®šä¹‰](#61-çº¦æŸå®šä¹‰)
    - [6.2. çº¦æŸç±»å‹ç†è®º](#62-çº¦æŸç±»å‹ç†è®º)
    - [6.3. çº¦æŸæ£€æŸ¥ç†è®º](#63-çº¦æŸæ£€æŸ¥ç†è®º)
    - [6.4. çº¦æŸç»´æŠ¤ç†è®º](#64-çº¦æŸç»´æŠ¤ç†è®º)
  - [7. èŒƒå¼ç†è®º](#7-èŒƒå¼ç†è®º)
    - [7.1. èŒƒå¼å®šä¹‰](#71-èŒƒå¼å®šä¹‰)
    - [7.2. èŒƒå¼åˆ†è§£ç†è®º](#72-èŒƒå¼åˆ†è§£ç†è®º)
    - [7.3. SQLiteèŒƒå¼æ”¯æŒ](#73-sqliteèŒƒå¼æ”¯æŒ)
    - [7.4. åèŒƒå¼åŒ–ç†è®º](#74-åèŒƒå¼åŒ–ç†è®º)
  - [8. æ•°æ®æ¨¡å‹ç†è®ºæ€»ç»“](#8-æ•°æ®æ¨¡å‹ç†è®ºæ€»ç»“)
    - [8.1. ç†è®ºæ¨¡å‹è¦ç‚¹](#81-ç†è®ºæ¨¡å‹è¦ç‚¹)
    - [8.2. ç†è®ºæ¨¡å‹åº”ç”¨](#82-ç†è®ºæ¨¡å‹åº”ç”¨)
    - [8.3. SQLiteç‰¹æ€§åˆ†æ](#83-sqliteç‰¹æ€§åˆ†æ)
    - [8.4. æ•°æ®æ¨¡å‹ç†è®ºéªŒè¯ä»£ç ](#84-æ•°æ®æ¨¡å‹ç†è®ºéªŒè¯ä»£ç )
  - [9. ğŸ”— ç›¸å…³èµ„æº](#9--ç›¸å…³èµ„æº)
  - [10. ğŸ“š å‚è€ƒèµ„æ–™](#10--å‚è€ƒèµ„æ–™)

---

## 3. ğŸ“Š æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((æ•°æ®æ¨¡å‹ç†è®º))
    ç±»å‹ç³»ç»Ÿç†è®º
      ç±»å‹ç³»ç»Ÿå®šä¹‰
        ç±»å‹é›†åˆ
        ç±»å‹è§„åˆ™
        ç±»å‹æ£€æŸ¥
      SQLiteç±»å‹ç³»ç»Ÿ
        å­˜å‚¨ç±»
        INTEGER
        TEXT
        REAL
        BLOB
        NULL
        ç±»å‹äº²å’Œæ€§
        NUMERIC
        INTEGER
        TEXT
        REAL
        BLOB
        ä¸¥æ ¼è¡¨æ¨¡å¼
        ç±»å‹æ£€æŸ¥
        ç±»å‹çº¦æŸ
      ç±»å‹è½¬æ¢ç†è®º
        éšå¼è½¬æ¢
        æ˜¾å¼è½¬æ¢
        è½¬æ¢è§„åˆ™
        è½¬æ¢å®‰å…¨æ€§
      ç±»å‹å®‰å…¨ç†è®º
        ç±»å‹å®‰å…¨å®šä¹‰
        ç±»å‹é”™è¯¯æ£€æµ‹
        ç±»å‹å®‰å…¨ä¿è¯
    å…³ç³»æ¨¡å‹ç†è®º
      å…³ç³»æ¨¡å‹åŸºç¡€
        å…³ç³»å®šä¹‰
        å…ƒç»„
        å±æ€§
        åŸŸ
        SQLiteå…³ç³»å®ç°
        è¡¨ç»“æ„
        è¡Œå’Œåˆ—
        ä¸»é”®
        å¤–é”®
      å…³ç³»ä»£æ•°ç†è®º
        é€‰æ‹©è¿ç®—
        æŠ•å½±è¿ç®—
        è¿æ¥è¿ç®—
        å¹¶è¿ç®—
        å·®è¿ç®—
        äº¤è¿ç®—
      å…³ç³»å®Œæ•´æ€§ç†è®º
        å®ä½“å®Œæ•´æ€§
        å‚ç…§å®Œæ•´æ€§
        ç”¨æˆ·å®šä¹‰å®Œæ•´æ€§
    çº¦æŸç†è®º
      çº¦æŸå®šä¹‰
        çº¦æŸæ¦‚å¿µ
        çº¦æŸä½œç”¨
        çº¦æŸåˆ†ç±»
      çº¦æŸç±»å‹ç†è®º
        ä¸»é”®çº¦æŸ
        å”¯ä¸€çº¦æŸ
        éç©ºçº¦æŸ
        æ£€æŸ¥çº¦æŸ
        å¤–é”®çº¦æŸ
        é»˜è®¤å€¼çº¦æŸ
      çº¦æŸæ£€æŸ¥ç†è®º
        æ£€æŸ¥æ—¶æœº
        æ£€æŸ¥ç®—æ³•
        æ£€æŸ¥æ•ˆç‡
      çº¦æŸç»´æŠ¤ç†è®º
        çº¦æŸç»´æŠ¤
        çº¦æŸæ›´æ–°
        çº¦æŸåˆ é™¤
    èŒƒå¼ç†è®º
      èŒƒå¼å®šä¹‰
        ç¬¬ä¸€èŒƒå¼
        ç¬¬äºŒèŒƒå¼
        ç¬¬ä¸‰èŒƒå¼
        BCNF
        ç¬¬å››èŒƒå¼
        ç¬¬äº”èŒƒå¼
      èŒƒå¼åˆ†è§£ç†è®º
        å‡½æ•°ä¾èµ–
        å¤šå€¼ä¾èµ–
        è¿æ¥ä¾èµ–
        åˆ†è§£ç®—æ³•
       SQLiteèŒƒå¼æ”¯æŒ
        èŒƒå¼æ”¯æŒ
        èŒƒå¼æ£€æŸ¥
        èŒƒå¼ä¼˜åŒ–
      åèŒƒå¼åŒ–ç†è®º
        åèŒƒå¼åŒ–åŸå› 
        åèŒƒå¼åŒ–æ–¹æ³•
        æ€§èƒ½æƒè¡¡
```

---

## 4. ç±»å‹ç³»ç»Ÿç†è®º

### 4.1. ç±»å‹ç³»ç»Ÿå®šä¹‰

**å®šä¹‰1ï¼ˆç±»å‹ç³»ç»Ÿï¼‰**ï¼šç±»å‹ç³»ç»Ÿæ˜¯ä¸€ç»„è§„åˆ™ï¼Œç”¨äºå®šä¹‰å€¼çš„ç±»å‹ã€ç±»å‹ä¹‹é—´çš„å…³ç³»ä»¥åŠç±»å‹ä¸Šçš„æ“ä½œã€‚

**å½¢å¼åŒ–è¡¨ç¤º**ï¼š

```text
TypeSystem = (T, O, R)

å…¶ä¸­ï¼š
  T = {tâ‚, tâ‚‚, ..., tâ‚™}  // ç±»å‹é›†åˆ
  O = {oâ‚, oâ‚‚, ..., oâ‚˜}  // æ“ä½œé›†åˆ
  R = {râ‚, râ‚‚, ..., râ‚–}  // ç±»å‹è§„åˆ™é›†åˆ
```

**ç±»å‹ç³»ç»Ÿå±æ€§**ï¼š

1. **ç±»å‹å®‰å…¨**ï¼šé˜²æ­¢ç±»å‹é”™è¯¯
2. **ç±»å‹æ¨æ–­**ï¼šè‡ªåŠ¨æ¨å¯¼ç±»å‹
3. **ç±»å‹è½¬æ¢**ï¼šç±»å‹é—´çš„è½¬æ¢è§„åˆ™
4. **ç±»å‹æ£€æŸ¥**ï¼šç¼–è¯‘æ—¶æˆ–è¿è¡Œæ—¶æ£€æŸ¥

### 4.2. SQLiteç±»å‹ç³»ç»Ÿæ¨¡å‹

**SQLiteå­˜å‚¨ç±»æ¨¡å‹**ï¼š

```text
StorageClasses = {INTEGER, REAL, TEXT, BLOB, NULL}

ç±»å‹å®šä¹‰ï¼š
  INTEGER: â„¤ (æ•´æ•°é›†åˆ)
  REAL: â„ (å®æ•°é›†åˆ)
  TEXT: String (å­—ç¬¦ä¸²é›†åˆ)
  BLOB: Byte[] (å­—èŠ‚æ•°ç»„é›†åˆ)
  NULL: {null} (ç©ºå€¼)
```

**ç±»å‹äº²å’Œæ€§æ¨¡å‹**ï¼š

```text
TypeAffinity = {NUMERIC, INTEGER, TEXT, REAL, BLOB}

äº²å’Œæ€§æ˜ å°„ï¼š
  NUMERIC â†’ INTEGER | REAL
  INTEGER â†’ INTEGER
  TEXT â†’ TEXT
  REAL â†’ REAL
  BLOB â†’ BLOB
```

**ä¸¥æ ¼è¡¨æ¨¡å¼æ¨¡å‹**ï¼š

```text
StrictMode = {
  TypeCheck: âˆ€v âˆˆ Value, t âˆˆ Type: v.type = t
  ConstraintCheck: âˆ€c âˆˆ Constraint: c.check(v)
}

ä¸¥æ ¼æ¨¡å¼ä¿è¯ï¼š
  âˆ€v, t: Insert(v, t) â†’ (v.type = t) âˆ§ Valid(v, t)
```

### 4.3. ç±»å‹è½¬æ¢ç†è®º

**ç±»å‹è½¬æ¢å®šä¹‰**ï¼š

```text
ç±»å‹è½¬æ¢å‡½æ•°ï¼š
  Convert: Value Ã— Type â†’ Value

è½¬æ¢è§„åˆ™ï¼š
  Convert(v, t) = {
    if v.type = t: v
    else if Compatible(v.type, t): Coerce(v, t)
    else: Error
  }
```

**SQLiteç±»å‹è½¬æ¢è§„åˆ™**ï¼š

```text
è½¬æ¢çŸ©é˜µï¼š

        â†’ INTEGER  REAL    TEXT    BLOB
INTEGER    -       âœ“       âœ“       âœ—
REAL       âœ“       -       âœ“       âœ—
TEXT       âœ“       âœ“       -       âœ—
BLOB       âœ—       âœ—       âœ—       -
NULL       NULL    NULL    NULL    NULL

è½¬æ¢è§„åˆ™ï¼š
  INTEGER â†’ REAL: ç›´æ¥è½¬æ¢
  REAL â†’ INTEGER: æˆªæ–­è½¬æ¢
  INTEGER/REAL â†’ TEXT: å­—ç¬¦ä¸²è½¬æ¢
  TEXT â†’ INTEGER/REAL: æ•°å€¼è§£æ
  BLOB: ä¸è½¬æ¢
```

**ç±»å‹è½¬æ¢å®‰å…¨æ€§**ï¼š

```text
å®‰å…¨è½¬æ¢ï¼š
  SafeConvert(v, t) = {
    if Lossless(v, t): Convert(v, t)
    else: Warning + Convert(v, t)
  }

æ— æŸè½¬æ¢ï¼š
  Lossless(v, t) = {
    INTEGER â†’ REAL: âœ“ (æ— æŸ)
    REAL â†’ INTEGER: âœ— (æœ‰æŸï¼Œæˆªæ–­)
    TEXT â†’ INTEGER: âœ— (å¯èƒ½å¤±è´¥)
  }
```

### 4.4. ç±»å‹å®‰å…¨ç†è®º

**ç±»å‹å®‰å…¨å®šä¹‰**ï¼š

```text
ç±»å‹å®‰å…¨ = âˆ€Operation, âˆ€Value:
  TypeCheck(Operation, Value) â†’
    (ValidType(Value) âˆ§ ValidOperation(Operation, Value.type))

ç±»å‹å®‰å…¨ä¿è¯ï¼š
  1. ç±»å‹æ£€æŸ¥ï¼šç¼–è¯‘æ—¶æˆ–è¿è¡Œæ—¶æ£€æŸ¥
  2. ç±»å‹é”™è¯¯ï¼šæ£€æµ‹å¹¶æŠ¥å‘Šç±»å‹é”™è¯¯
  3. ç±»å‹çº¦æŸï¼šå¼ºåˆ¶æ‰§è¡Œç±»å‹çº¦æŸ
```

**SQLiteç±»å‹å®‰å…¨æ¨¡å‹**ï¼š

```text
ç±»å‹å®‰å…¨çº§åˆ«ï¼š

  åŠ¨æ€ç±»å‹æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ï¼š
    TypeSafety = RuntimeCheck
    - è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥
    - å…è®¸ç±»å‹è½¬æ¢
    - ç±»å‹é”™è¯¯åœ¨è¿è¡Œæ—¶å‘ç°

  ä¸¥æ ¼è¡¨æ¨¡å¼ï¼š
    TypeSafety = CompileTimeCheck + RuntimeCheck
    - ç¼–è¯‘æ—¶ç±»å‹æ£€æŸ¥ï¼ˆDDLï¼‰
    - è¿è¡Œæ—¶ç±»å‹æ£€æŸ¥ï¼ˆDMLï¼‰
    - ç¦æ­¢ä¸å…¼å®¹ç±»å‹è½¬æ¢
    - ç±»å‹é”™è¯¯åœ¨ç¼–è¯‘æ—¶æˆ–è¿è¡Œæ—¶å‘ç°
```

---

## 5. å…³ç³»æ¨¡å‹ç†è®º

### 5.1. å…³ç³»æ¨¡å‹åŸºç¡€

**å®šä¹‰2ï¼ˆå…³ç³»ï¼‰**ï¼šå…³ç³»æ˜¯å…ƒç»„çš„é›†åˆï¼Œæ¯ä¸ªå…ƒç»„ç”±å±æ€§å€¼ç»„æˆã€‚

**å½¢å¼åŒ–è¡¨ç¤º**ï¼š

```text
å…³ç³»å®šä¹‰ï¼š
  R(Aâ‚, Aâ‚‚, ..., Aâ‚™)

å…¶ä¸­ï¼š
  R: å…³ç³»å
  Aáµ¢: å±æ€§ï¼ˆi = 1, 2, ..., nï¼‰
  Domain(Aáµ¢): å±æ€§Aáµ¢çš„å€¼åŸŸ

å…³ç³»å®ä¾‹ï¼š
  r = {tâ‚, tâ‚‚, ..., tâ‚˜}

å…¶ä¸­ï¼š
  táµ¢ = (aâ‚áµ¢, aâ‚‚áµ¢, ..., aâ‚™áµ¢)  // å…ƒç»„
  aâ±¼áµ¢ âˆˆ Domain(Aâ±¼)          // å±æ€§å€¼
```

**å…³ç³»æ¨¡å‹åŸºæœ¬æ¦‚å¿µ**ï¼š

1. **å…³ç³»ï¼ˆRelationï¼‰**ï¼šäºŒç»´è¡¨
2. **å…ƒç»„ï¼ˆTupleï¼‰**ï¼šè¡¨ä¸­çš„è¡Œ
3. **å±æ€§ï¼ˆAttributeï¼‰**ï¼šè¡¨ä¸­çš„åˆ—
4. **åŸŸï¼ˆDomainï¼‰**ï¼šå±æ€§çš„å–å€¼èŒƒå›´
5. **ä¸»é”®ï¼ˆPrimary Keyï¼‰**ï¼šå”¯ä¸€æ ‡è¯†å…ƒç»„çš„å±æ€§é›†åˆ

### 5.2. SQLiteå…³ç³»æ¨¡å‹å®ç°

**SQLiteè¡¨ç»“æ„æ¨¡å‹**ï¼š

```text
Table = (Name, Schema, Data, Constraints)

å…¶ä¸­ï¼š
  Name: è¡¨å
  Schema = {Columnâ‚, Columnâ‚‚, ..., Columnâ‚™}
  Column = (Name, Type, Constraints)
  Data = {Rowâ‚, Rowâ‚‚, ..., Rowâ‚˜}
  Row = (Valueâ‚, Valueâ‚‚, ..., Valueâ‚™)
  Constraints = {PK, FK, UNIQUE, CHECK, NOT NULL, ...}
```

**å…³ç³»å®Œæ•´æ€§å®ç°**ï¼š

```text
å®ä½“å®Œæ•´æ€§ï¼š
  âˆ€Row âˆˆ Table: PK(Row) â‰  NULL âˆ§ Unique(PK(Row))

å‚ç…§å®Œæ•´æ€§ï¼š
  âˆ€Row âˆˆ ChildTable:
    FK(Row) âˆˆ PK(ParentTable) âˆ¨ FK(Row) = NULL

ç”¨æˆ·å®šä¹‰å®Œæ•´æ€§ï¼š
  âˆ€Row âˆˆ Table: CheckConstraints(Row) = True
```

### 5.3. å…³ç³»ä»£æ•°ç†è®º

**å…³ç³»ä»£æ•°è¿ç®—**ï¼š

```text
åŸºæœ¬è¿ç®—ï¼š
  1. é€‰æ‹©ï¼ˆSelectionï¼‰: Ïƒâ‚š(R)
  2. æŠ•å½±ï¼ˆProjectionï¼‰: Ï€â‚(R)
  3. è¿æ¥ï¼ˆJoinï¼‰: R â‹ˆ S
  4. å¹¶ï¼ˆUnionï¼‰: R âˆª S
  5. å·®ï¼ˆDifferenceï¼‰: R - S
  6. äº¤ï¼ˆIntersectionï¼‰: R âˆ© S
```

**SQLiteå…³ç³»ä»£æ•°å®ç°**ï¼š

```sql
-- é€‰æ‹©è¿ç®—
SELECT * FROM R WHERE P
-- å¯¹åº”ï¼šÏƒâ‚š(R)

-- æŠ•å½±è¿ç®—
SELECT A, B FROM R
-- å¯¹åº”ï¼šÏ€â‚,â‚‘(R)

-- è¿æ¥è¿ç®—
SELECT * FROM R JOIN S ON R.A = S.B
-- å¯¹åº”ï¼šR â‹ˆáµ£.â‚=â‚›.áµ¦ S

-- å¹¶è¿ç®—
SELECT * FROM R UNION SELECT * FROM S
-- å¯¹åº”ï¼šR âˆª S

-- å·®è¿ç®—
SELECT * FROM R EXCEPT SELECT * FROM S
-- å¯¹åº”ï¼šR - S
```

**å…³ç³»ä»£æ•°æ€§è´¨**ï¼š

```text
äº¤æ¢å¾‹ï¼š
  R âˆª S = S âˆª R
  R âˆ© S = S âˆ© R

ç»“åˆå¾‹ï¼š
  (R âˆª S) âˆª T = R âˆª (S âˆª T)
  (R â‹ˆ S) â‹ˆ T = R â‹ˆ (S â‹ˆ T)

åˆ†é…å¾‹ï¼š
  Ïƒâ‚š(R âˆª S) = Ïƒâ‚š(R) âˆª Ïƒâ‚š(S)
  Ï€â‚(R â‹ˆ S) = Ï€â‚(R) â‹ˆ Ï€â‚(S)
```

### 5.4. å…³ç³»å®Œæ•´æ€§ç†è®º

**å®Œæ•´æ€§çº¦æŸå®šä¹‰**ï¼š

```text
å®Œæ•´æ€§çº¦æŸ = {
  å®ä½“å®Œæ•´æ€§: âˆ€t âˆˆ R: PK(t) â‰  NULL âˆ§ Unique(PK(t))
  å‚ç…§å®Œæ•´æ€§: âˆ€t âˆˆ R: FK(t) âˆˆ PK(S) âˆ¨ FK(t) = NULL
  ç”¨æˆ·å®šä¹‰å®Œæ•´æ€§: âˆ€t âˆˆ R: UserConstraint(t) = True
}
```

**å®Œæ•´æ€§ç»´æŠ¤ç†è®º**ï¼š

```text
æ’å…¥æ“ä½œå®Œæ•´æ€§ï¼š
  Insert(t, R) â†’ {
    EntityIntegrity(t) âˆ§
    ReferentialIntegrity(t) âˆ§
    UserIntegrity(t)
  }

åˆ é™¤æ“ä½œå®Œæ•´æ€§ï¼š
  Delete(t, R) â†’ {
    CheckReferentialIntegrity(t)  // æ£€æŸ¥å¤–é”®å¼•ç”¨
  }

æ›´æ–°æ“ä½œå®Œæ•´æ€§ï¼š
  Update(t, R, t') â†’ {
    EntityIntegrity(t') âˆ§
    ReferentialIntegrity(t') âˆ§
    UserIntegrity(t')
  }
```

---

## 6. çº¦æŸç†è®º

### 6.1. çº¦æŸå®šä¹‰

**å®šä¹‰3ï¼ˆçº¦æŸï¼‰**ï¼šçº¦æŸæ˜¯å¯¹æ•°æ®å€¼çš„é™åˆ¶æ¡ä»¶ï¼Œç”¨äºä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚

**å½¢å¼åŒ–è¡¨ç¤º**ï¼š

```text
çº¦æŸå®šä¹‰ï¼š
  Constraint = (Type, Scope, Condition, Action)

å…¶ä¸­ï¼š
  Type: çº¦æŸç±»å‹ï¼ˆPK, FK, UNIQUE, CHECK, NOT NULL, DEFAULTï¼‰
  Scope: çº¦æŸä½œç”¨åŸŸï¼ˆColumn, Table, Databaseï¼‰
  Condition: çº¦æŸæ¡ä»¶ï¼ˆé€»è¾‘è¡¨è¾¾å¼ï¼‰
  Action: è¿åçº¦æŸæ—¶çš„åŠ¨ä½œï¼ˆREJECT, CASCADE, SET NULL, SET DEFAULTï¼‰
```

### 6.2. çº¦æŸç±»å‹ç†è®º

**çº¦æŸç±»å‹åˆ†ç±»**ï¼š

```text
çº¦æŸç±»å‹ = {
  ä¸»é”®çº¦æŸï¼ˆPKï¼‰:
    âˆ€tâ‚, tâ‚‚ âˆˆ R: tâ‚ â‰  tâ‚‚ â†’ PK(tâ‚) â‰  PK(tâ‚‚)
    âˆ€t âˆˆ R: PK(t) â‰  NULL

  å”¯ä¸€çº¦æŸï¼ˆUNIQUEï¼‰:
    âˆ€tâ‚, tâ‚‚ âˆˆ R: tâ‚ â‰  tâ‚‚ â†’ UNIQUE(tâ‚) â‰  UNIQUE(tâ‚‚)
    UNIQUE(t) å¯ä»¥ä¸º NULLï¼ˆä½†NULLå€¼å”¯ä¸€ï¼‰

  éç©ºçº¦æŸï¼ˆNOT NULLï¼‰:
    âˆ€t âˆˆ R: NOT_NULL(t) â‰  NULL

  æ£€æŸ¥çº¦æŸï¼ˆCHECKï¼‰:
    âˆ€t âˆˆ R: CHECK_CONDITION(t) = True

  å¤–é”®çº¦æŸï¼ˆFKï¼‰:
    âˆ€t âˆˆ Child: FK(t) âˆˆ PK(Parent) âˆ¨ FK(t) = NULL

  é»˜è®¤å€¼çº¦æŸï¼ˆDEFAULTï¼‰:
    Insert(t, R) âˆ§ t.A = NULL â†’ t.A = DEFAULT(A)
}
```

### 6.3. çº¦æŸæ£€æŸ¥ç†è®º

**çº¦æŸæ£€æŸ¥æ—¶æœº**ï¼š

```text
æ£€æŸ¥æ—¶æœº = {
  ç¼–è¯‘æ—¶æ£€æŸ¥: DDLçº¦æŸå®šä¹‰æ£€æŸ¥
  è¿è¡Œæ—¶æ£€æŸ¥: DMLæ“ä½œçº¦æŸæ£€æŸ¥
  å»¶è¿Ÿæ£€æŸ¥: äº‹åŠ¡æäº¤æ—¶æ£€æŸ¥ï¼ˆDEFERRABLEçº¦æŸï¼‰
}

æ£€æŸ¥é¡ºåºï¼š
  1. NOT NULLçº¦æŸ
  2. DEFAULTçº¦æŸ
  3. CHECKçº¦æŸ
  4. UNIQUEçº¦æŸ
  5. ä¸»é”®çº¦æŸ
  6. å¤–é”®çº¦æŸ
```

**çº¦æŸæ£€æŸ¥ç®—æ³•**ï¼š

```text
çº¦æŸæ£€æŸ¥ç®—æ³•ï¼š

  CheckConstraints(t, R):
    for each constraint c in R.constraints:
      if not c.check(t):
        return Error(c)
    return Success

  ä¸»é”®æ£€æŸ¥ï¼š
    CheckPK(t, R):
      if t.PK = NULL: return Error("PK cannot be NULL")
      if âˆƒt' âˆˆ R: t' â‰  t âˆ§ t'.PK = t.PK:
        return Error("PK violation")
      return Success

  å¤–é”®æ£€æŸ¥ï¼š
    CheckFK(t, Child, Parent):
      if t.FK = NULL: return Success  // å…è®¸NULL
      if t.FK âˆ‰ {t'.PK | t' âˆˆ Parent}:
        return Error("FK violation")
      return Success
```

### 6.4. çº¦æŸç»´æŠ¤ç†è®º

**çº¦æŸç»´æŠ¤ç­–ç•¥**ï¼š

```text
çº¦æŸç»´æŠ¤ = {
  ç«‹å³ç»´æŠ¤: æ“ä½œæ—¶ç«‹å³æ£€æŸ¥
  å»¶è¿Ÿç»´æŠ¤: äº‹åŠ¡æäº¤æ—¶æ£€æŸ¥
  çº§è”ç»´æŠ¤: è¿åæ—¶è‡ªåŠ¨å¤„ç†ï¼ˆCASCADE, SET NULL, SET DEFAULTï¼‰
}

å¤–é”®çº§è”æ“ä½œï¼š
  ON DELETE CASCADE: åˆ é™¤çˆ¶è®°å½•æ—¶åˆ é™¤å­è®°å½•
  ON DELETE SET NULL: åˆ é™¤çˆ¶è®°å½•æ—¶å­è®°å½•FKè®¾ä¸ºNULL
  ON DELETE SET DEFAULT: åˆ é™¤çˆ¶è®°å½•æ—¶å­è®°å½•FKè®¾ä¸ºé»˜è®¤å€¼
  ON DELETE RESTRICT: ç¦æ­¢åˆ é™¤æœ‰å­è®°å½•çš„çˆ¶è®°å½•
```

---

## 7. èŒƒå¼ç†è®º

### 7.1. èŒƒå¼å®šä¹‰

**å®šä¹‰4ï¼ˆèŒƒå¼ï¼‰**ï¼šèŒƒå¼æ˜¯å…³ç³»æ•°æ®åº“è®¾è®¡çš„è§„èŒƒåŒ–ç¨‹åº¦ï¼Œç”¨äºæ¶ˆé™¤æ•°æ®å†—ä½™å’Œæ›´æ–°å¼‚å¸¸ã€‚

**èŒƒå¼å±‚æ¬¡**ï¼š

```text
èŒƒå¼å±‚æ¬¡ï¼š
  1NF âŠ† 2NF âŠ† 3NF âŠ† BCNF âŠ† 4NF âŠ† 5NF

ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰:
  âˆ€A âˆˆ R: Domain(A) æ˜¯åŸå­å€¼ï¼ˆä¸å¯å†åˆ†ï¼‰

ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰:
  R âˆˆ 1NF âˆ§
  âˆ€éä¸»å±æ€§A: Aå®Œå…¨ä¾èµ–äºä¸»é”®ï¼ˆä¸å­˜åœ¨éƒ¨åˆ†ä¾èµ–ï¼‰

ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰:
  R âˆˆ 2NF âˆ§
  âˆ€éä¸»å±æ€§A: Aä¸ä¼ é€’ä¾èµ–äºä¸»é”®

BCNFï¼ˆBoyce-CoddèŒƒå¼ï¼‰:
  R âˆˆ 3NF âˆ§
  âˆ€å‡½æ•°ä¾èµ–X â†’ Y: Xæ˜¯è¶…é”®

ç¬¬å››èŒƒå¼ï¼ˆ4NFï¼‰:
  R âˆˆ BCNF âˆ§
  âˆ€å¤šå€¼ä¾èµ–X â†’â†’ Y: Xæ˜¯è¶…é”®

ç¬¬äº”èŒƒå¼ï¼ˆ5NFï¼‰:
  R âˆˆ 4NF âˆ§
  âˆ€è¿æ¥ä¾èµ–: è¢«åŒ…å«çš„æŠ•å½±éƒ½æ˜¯è¶…é”®
```

### 7.2. èŒƒå¼åˆ†è§£ç†è®º

**å‡½æ•°ä¾èµ–ç†è®º**ï¼š

```text
å‡½æ•°ä¾èµ–å®šä¹‰ï¼š
  X â†’ Y: å¯¹äºRä¸­çš„ä»»æ„ä¸¤ä¸ªå…ƒç»„tâ‚, tâ‚‚,
    å¦‚æœtâ‚[X] = tâ‚‚[X], åˆ™tâ‚[Y] = tâ‚‚[Y]

å‡½æ•°ä¾èµ–æ€§è´¨ï¼š
  è‡ªåæ€§: Y âŠ† X â†’ X â†’ Y
  å¢å¹¿æ€§: X â†’ Y â†’ XZ â†’ YZ
  ä¼ é€’æ€§: X â†’ Y, Y â†’ Z â†’ X â†’ Z
```

**èŒƒå¼åˆ†è§£ç®—æ³•**ï¼š

```text
3NFåˆ†è§£ç®—æ³•ï¼š
  1. è®¡ç®—å‡½æ•°ä¾èµ–é›†çš„é—­åŒ…Fâº
  2. æ‰¾åˆ°æœ€å°è¦†ç›–
  3. å¯¹æ¯ä¸ªå‡½æ•°ä¾èµ–X â†’ Yï¼Œåˆ›å»ºå…³ç³»R(X, Y)
  4. å¦‚æœæŸä¸ªå…³ç³»ä¸åŒ…å«å€™é€‰é”®ï¼Œæ·»åŠ å€™é€‰é”®å…³ç³»
  5. åˆå¹¶ç›¸åŒå·¦éƒ¨çš„å‡½æ•°ä¾èµ–

BCNFåˆ†è§£ç®—æ³•ï¼š
  1. å¦‚æœRä¸æ»¡è¶³BCNFï¼Œæ‰¾åˆ°è¿åBCNFçš„å‡½æ•°ä¾èµ–X â†’ Y
  2. åˆ†è§£Rä¸ºRâ‚(X, Y)å’ŒRâ‚‚(X, R - Y)
  3. é€’å½’åˆ†è§£Râ‚å’ŒRâ‚‚ç›´åˆ°æ»¡è¶³BCNF
```

### 7.3. SQLiteèŒƒå¼æ”¯æŒ

**SQLiteèŒƒå¼æ”¯æŒ**ï¼š

```text
èŒƒå¼æ”¯æŒï¼š
  1NF: âœ… å®Œå…¨æ”¯æŒï¼ˆåˆ—å€¼åŸå­æ€§ï¼‰
  2NF: âœ… æ”¯æŒï¼ˆä¸»é”®çº¦æŸï¼‰
  3NF: âœ… æ”¯æŒï¼ˆå¤–é”®çº¦æŸï¼ŒCHECKçº¦æŸï¼‰
  BCNF: âš ï¸ éƒ¨åˆ†æ”¯æŒï¼ˆéœ€è¦æ‰‹åŠ¨è®¾è®¡ï¼‰
  4NF: âš ï¸ éƒ¨åˆ†æ”¯æŒï¼ˆå¤šå€¼ä¾èµ–éœ€è¦åº”ç”¨å±‚å¤„ç†ï¼‰
  5NF: âŒ ä¸æ”¯æŒï¼ˆè¿æ¥ä¾èµ–éœ€è¦åº”ç”¨å±‚å¤„ç†ï¼‰
```

**èŒƒå¼æ£€æŸ¥**ï¼š

```sql
-- SQLiteä¸æä¾›è‡ªåŠ¨èŒƒå¼æ£€æŸ¥
-- éœ€è¦æ‰‹åŠ¨è®¾è®¡å’ŒéªŒè¯

-- ç¤ºä¾‹ï¼š3NFè®¾è®¡
CREATE TABLE users (
    id INTEGER PRIMARY KEY,      -- ä¸»é”®
    name TEXT NOT NULL,
    email TEXT UNIQUE NOT NULL
);

CREATE TABLE orders (
    id INTEGER PRIMARY KEY,
    user_id INTEGER NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(id)  -- å¤–é”®ä¿è¯å‚ç…§å®Œæ•´æ€§
);
```

### 7.4. åèŒƒå¼åŒ–ç†è®º

**åèŒƒå¼åŒ–å®šä¹‰**ï¼š

```text
åèŒƒå¼åŒ– = æ•…æ„è¿åèŒƒå¼è§„åˆ™ä»¥æå‡æ€§èƒ½

åèŒƒå¼åŒ–åŸå› ï¼š
  1. æ€§èƒ½ä¼˜åŒ–ï¼šå‡å°‘JOINæ“ä½œ
  2. æŸ¥è¯¢ç®€åŒ–ï¼šå‡å°‘æŸ¥è¯¢å¤æ‚åº¦
  3. å­˜å‚¨ä¼˜åŒ–ï¼šå‡å°‘å­˜å‚¨ç©ºé—´ï¼ˆæŸäº›æƒ…å†µï¼‰
```

**åèŒƒå¼åŒ–æƒè¡¡**ï¼š

```text
æƒè¡¡åˆ†æï¼š

  èŒƒå¼åŒ–ä¼˜åŠ¿ï¼š
    âœ… æ•°æ®ä¸€è‡´æ€§
    âœ… å‡å°‘å†—ä½™
    âœ… æ›´æ–°ç®€å•
    âŒ æŸ¥è¯¢å¤æ‚ï¼ˆéœ€è¦JOINï¼‰
    âŒ æ€§èƒ½å¯èƒ½è¾ƒå·®

  åèŒƒå¼åŒ–ä¼˜åŠ¿ï¼š
    âœ… æŸ¥è¯¢ç®€å•ï¼ˆæ— éœ€JOINï¼‰
    âœ… æ€§èƒ½å¯èƒ½æ›´å¥½
    âŒ æ•°æ®å†—ä½™
    âŒ æ›´æ–°å¤æ‚ï¼ˆéœ€è¦ç»´æŠ¤å†—ä½™ï¼‰
    âŒ ä¸€è‡´æ€§é£é™©
```

**åèŒƒå¼åŒ–å†³ç­–æ¨¡å‹**ï¼š

```text
åèŒƒå¼åŒ–å†³ç­– = f(æŸ¥è¯¢é¢‘ç‡, æ›´æ–°é¢‘ç‡, æ•°æ®é‡, ä¸€è‡´æ€§è¦æ±‚)

å†³ç­–è§„åˆ™ï¼š
  if æŸ¥è¯¢é¢‘ç‡ >> æ›´æ–°é¢‘ç‡:
    è€ƒè™‘åèŒƒå¼åŒ–
  else if ä¸€è‡´æ€§è¦æ±‚é«˜:
    ä¿æŒèŒƒå¼åŒ–
  else:
    æ ¹æ®å…·ä½“æƒ…å†µæƒè¡¡
```

---

## 8. æ•°æ®æ¨¡å‹ç†è®ºæ€»ç»“

### 8.1. ç†è®ºæ¨¡å‹è¦ç‚¹

**æ ¸å¿ƒç†è®º**ï¼š

1. **ç±»å‹ç³»ç»Ÿç†è®º**ï¼šå­˜å‚¨ç±»ã€ç±»å‹äº²å’Œæ€§ã€ç±»å‹è½¬æ¢ã€ç±»å‹å®‰å…¨
2. **å…³ç³»æ¨¡å‹ç†è®º**ï¼šå…³ç³»å®šä¹‰ã€å…³ç³»ä»£æ•°ã€å…³ç³»å®Œæ•´æ€§
3. **çº¦æŸç†è®º**ï¼šçº¦æŸç±»å‹ã€çº¦æŸæ£€æŸ¥ã€çº¦æŸç»´æŠ¤
4. **èŒƒå¼ç†è®º**ï¼šèŒƒå¼å®šä¹‰ã€èŒƒå¼åˆ†è§£ã€åèŒƒå¼åŒ–

### 8.2. ç†è®ºæ¨¡å‹åº”ç”¨

**åº”ç”¨åœºæ™¯**ï¼š

- æ•°æ®åº“è®¾è®¡
- ç±»å‹ç³»ç»Ÿè®¾è®¡
- çº¦æŸè®¾è®¡
- èŒƒå¼åŒ–è®¾è®¡
- æ€§èƒ½ä¼˜åŒ–

### 8.3. SQLiteç‰¹æ€§åˆ†æ

**SQLiteç‰¹æ€§**ï¼š

- âœ… çµæ´»çš„ç±»å‹ç³»ç»Ÿï¼ˆåŠ¨æ€ç±»å‹ + ä¸¥æ ¼æ¨¡å¼ï¼‰
- âœ… å®Œæ•´çš„å…³ç³»æ¨¡å‹æ”¯æŒ
- âœ… ä¸°å¯Œçš„çº¦æŸæ”¯æŒ
- âœ… èŒƒå¼æ”¯æŒï¼ˆ1NF-3NFï¼Œéƒ¨åˆ†BCNFï¼‰
- âš ï¸ éœ€è¦æ‰‹åŠ¨èŒƒå¼åŒ–è®¾è®¡

### 8.4. æ•°æ®æ¨¡å‹ç†è®ºéªŒè¯ä»£ç 

**ç±»å‹ç³»ç»ŸéªŒè¯**ï¼š

```python
import sqlite3

def test_type_system():
    """éªŒè¯SQLiteç±»å‹ç³»ç»Ÿ"""
    conn = sqlite3.connect(':memory:')
    cursor = conn.cursor()

# æµ‹è¯•åŠ¨æ€ç±»å‹
    cursor.execute('CREATE TABLE test (id INTEGER, value TEXT)')
    cursor.execute('INSERT INTO test VALUES (?, ?)', (1, 'text'))
    cursor.execute('INSERT INTO test VALUES (?, ?)', ('2', 123))  # ç±»å‹è½¬æ¢

    cursor.execute('SELECT typeof(id), typeof(value) FROM test')
    results = cursor.fetchall()

# éªŒè¯ç±»å‹è½¬æ¢
    assert results[0] == ('integer', 'text')
    assert results[1] == ('integer', 'text')  # '2'è½¬æ¢ä¸ºinteger

# æµ‹è¯•ä¸¥æ ¼è¡¨æ¨¡å¼
    cursor.execute('CREATE TABLE strict_test (id INTEGER, value TEXT) STRICT')
    try:
        cursor.execute('INSERT INTO strict_test VALUES (?, ?)', ('abc', 123))
        assert False, "ä¸¥æ ¼æ¨¡å¼åº”è¯¥æ‹’ç»ç±»å‹ä¸åŒ¹é…"
    except sqlite3.OperationalError:
        pass  # é¢„æœŸé”™è¯¯

    conn.close()
    print("âœ… ç±»å‹ç³»ç»ŸéªŒè¯é€šè¿‡")

# è¿è¡Œæµ‹è¯•
if __name__ == '__main__':
    test_type_system()
```

**å…³ç³»æ¨¡å‹éªŒè¯**ï¼š

```python
import sqlite3

def test_relational_model():
    """éªŒè¯å…³ç³»æ¨¡å‹å®ç°"""
    conn = sqlite3.connect(':memory:')
    cursor = conn.cursor()

# åˆ›å»ºå…³ç³»ï¼ˆè¡¨ï¼‰
    cursor.execute('''
        CREATE TABLE users (
            id INTEGER PRIMARY KEY,
            name TEXT NOT NULL,
            email TEXT UNIQUE
        )
    ''')

    cursor.execute('''
        CREATE TABLE orders (
            id INTEGER PRIMARY KEY,
            user_id INTEGER NOT NULL,
            amount REAL,
            FOREIGN KEY (user_id) REFERENCES users(id)
        )
    ''')

# æ’å…¥å…ƒç»„
    cursor.execute('INSERT INTO users (name, email) VALUES (?, ?)',
                   ('Alice', 'alice@example.com'))
    cursor.execute('INSERT INTO orders (user_id, amount) VALUES (?, ?)',
                   (1, 100.50))

# å…³ç³»ä»£æ•°ï¼šé€‰æ‹©
    cursor.execute('SELECT * FROM users WHERE id = 1')
    selection = cursor.fetchone()
    assert selection == (1, 'Alice', 'alice@example.com')

# å…³ç³»ä»£æ•°ï¼šæŠ•å½±
    cursor.execute('SELECT name, email FROM users')
    projection = cursor.fetchall()
    assert projection == [('Alice', 'alice@example.com')]

# å…³ç³»ä»£æ•°ï¼šè¿æ¥
    cursor.execute('''
        SELECT u.name, o.amount
        FROM users u
        JOIN orders o ON u.id = o.user_id
    ''')
    join_result = cursor.fetchall()
    assert join_result == [('Alice', 100.5)]

    conn.close()
    print("âœ… å…³ç³»æ¨¡å‹éªŒè¯é€šè¿‡")

# è¿è¡Œæµ‹è¯•
if __name__ == '__main__':
    test_relational_model()
```

**çº¦æŸç†è®ºéªŒè¯**ï¼š

```python
import sqlite3

def test_constraints():
    """éªŒè¯çº¦æŸç†è®º"""
    conn = sqlite3.connect(':memory:')
    cursor = conn.cursor()

# åˆ›å»ºå¸¦çº¦æŸçš„è¡¨
    cursor.execute('''
        CREATE TABLE products (
            id INTEGER PRIMARY KEY,
            name TEXT NOT NULL,
            price REAL CHECK (price > 0),
            sku TEXT UNIQUE
        )
    ''')

# æµ‹è¯•ä¸»é”®çº¦æŸ
    cursor.execute('INSERT INTO products (name, price, sku) VALUES (?, ?, ?)',
                   ('Product1', 10.0, 'SKU001'))
    try:
        cursor.execute('INSERT INTO products (id, name, price, sku) VALUES (?, ?, ?, ?)',
                       (1, 'Product2', 20.0, 'SKU002'))  # ä¸»é”®å†²çª
        assert False, "ä¸»é”®çº¦æŸåº”è¯¥è¢«è¿å"
    except sqlite3.IntegrityError:
        pass  # é¢„æœŸé”™è¯¯

# æµ‹è¯•NOT NULLçº¦æŸ
    try:
        cursor.execute('INSERT INTO products (price, sku) VALUES (?, ?)',
                       (30.0, 'SKU003'))  # nameä¸ºNULL
        assert False, "NOT NULLçº¦æŸåº”è¯¥è¢«è¿å"
    except sqlite3.IntegrityError:
        pass  # é¢„æœŸé”™è¯¯

# æµ‹è¯•CHECKçº¦æŸ
    try:
        cursor.execute('INSERT INTO products (name, price, sku) VALUES (?, ?, ?)',
                       ('Product3', -10.0, 'SKU004'))  # price < 0
        assert False, "CHECKçº¦æŸåº”è¯¥è¢«è¿å"
    except sqlite3.IntegrityError:
        pass  # é¢„æœŸé”™è¯¯

# æµ‹è¯•UNIQUEçº¦æŸ
    cursor.execute('INSERT INTO products (name, price, sku) VALUES (?, ?, ?)',
                   ('Product4', 40.0, 'SKU005'))
    try:
        cursor.execute('INSERT INTO products (name, price, sku) VALUES (?, ?, ?)',
                       ('Product5', 50.0, 'SKU001'))  # skué‡å¤
        assert False, "UNIQUEçº¦æŸåº”è¯¥è¢«è¿å"
    except sqlite3.IntegrityError:
        pass  # é¢„æœŸé”™è¯¯

    conn.close()
    print("âœ… çº¦æŸç†è®ºéªŒè¯é€šè¿‡")

# è¿è¡Œæµ‹è¯•
if __name__ == '__main__':
    test_constraints()
```

**èŒƒå¼ç†è®ºéªŒè¯**ï¼š

```python
import sqlite3

def test_normalization():
    """éªŒè¯èŒƒå¼ç†è®º"""
    conn = sqlite3.connect(':memory:')
    cursor = conn.cursor()

# éèŒƒå¼åŒ–è®¾è®¡ï¼ˆè¿å2NFï¼‰
    cursor.execute('''
        CREATE TABLE orders_denormalized (
            order_id INTEGER,
            customer_id INTEGER,
            customer_name TEXT,
            product_id INTEGER,
            product_name TEXT,
            quantity INTEGER,
            price REAL
        )
    ''')

# èŒƒå¼åŒ–è®¾è®¡ï¼ˆ3NFï¼‰
    cursor.execute('''
        CREATE TABLE customers (
            customer_id INTEGER PRIMARY KEY,
            customer_name TEXT NOT NULL
        )
    ''')

    cursor.execute('''
        CREATE TABLE products (
            product_id INTEGER PRIMARY KEY,
            product_name TEXT NOT NULL,
            price REAL NOT NULL
        )
    ''')

    cursor.execute('''
        CREATE TABLE orders (
            order_id INTEGER PRIMARY KEY,
            customer_id INTEGER NOT NULL,
            FOREIGN KEY (customer_id) REFERENCES customers(customer_id)
        )
    ''')

    cursor.execute('''
        CREATE TABLE order_items (
            order_id INTEGER NOT NULL,
            product_id INTEGER NOT NULL,
            quantity INTEGER NOT NULL,
            PRIMARY KEY (order_id, product_id),
            FOREIGN KEY (order_id) REFERENCES orders(order_id),
            FOREIGN KEY (product_id) REFERENCES products(product_id)
        )
    ''')

# æ’å…¥æ•°æ®
    cursor.execute('INSERT INTO customers VALUES (1, "Alice")')
    cursor.execute('INSERT INTO products VALUES (1, "Product1", 10.0)')
    cursor.execute('INSERT INTO orders VALUES (1, 1)')
    cursor.execute('INSERT INTO order_items VALUES (1, 1, 5)')

# éªŒè¯èŒƒå¼åŒ–è®¾è®¡
    cursor.execute('''
        SELECT c.customer_name, p.product_name, oi.quantity, p.price
        FROM orders o
        JOIN customers c ON o.customer_id = c.customer_id
        JOIN order_items oi ON o.order_id = oi.order_id
        JOIN products p ON oi.product_id = p.product_id
    ''')
    results = cursor.fetchall()
    assert results == [('Alice', 'Product1', 5, 10.0)]

    conn.close()
    print("âœ… èŒƒå¼ç†è®ºéªŒè¯é€šè¿‡")

# è¿è¡Œæµ‹è¯•
if __name__ == '__main__':
    test_normalization()
```

---

## 9. ğŸ”— ç›¸å…³èµ„æº

- [02.01 æ•°æ®ç±»å‹ç³»ç»Ÿ](../02-æ•°æ®æ¨¡å‹/02.01-æ•°æ®ç±»å‹ç³»ç»Ÿ.md)
- [02.02 è¡¨ç»“æ„è®¾è®¡](../02-æ•°æ®æ¨¡å‹/02.02-è¡¨ç»“æ„è®¾è®¡.md)
- [12.02 è®¾è®¡åŸåˆ™](../12-è®¾è®¡æ¨¡å‹/12.02-è®¾è®¡åŸåˆ™.md)

---

## 10. ğŸ“š å‚è€ƒèµ„æ–™

- ã€Šæ•°æ®åº“ç³»ç»Ÿæ¦‚å¿µã€‹
- ã€Šæ•°æ®åº“ç³»ç»Ÿå®ç°ã€‹
- ã€Šç±»å‹ç³»ç»Ÿï¼šç¨‹åºè®¾è®¡è¯­è¨€çš„ç†è®ºä¸å®è·µã€‹

---

**æœ€åæ›´æ–°**ï¼š2025-01-15
**ç»´æŠ¤è€…**ï¼šData-Science Team
