# SQLite Kubernetesè¾¹ç¼˜è®¡ç®—éƒ¨ç½²æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025-12-05
> **ç‰ˆæœ¬**: SQLite 3.47.x
> **éš¾åº¦**: â­â­â­â­â­
> **é€‚ç”¨åœºæ™¯**: Kubernetesè¾¹ç¼˜é›†ç¾¤ã€è¾¹ç¼˜èŠ‚ç‚¹éƒ¨ç½²ã€åˆ†å¸ƒå¼SQLite

---

## ğŸ“‘ ç›®å½•

- [SQLite Kubernetesè¾¹ç¼˜è®¡ç®—éƒ¨ç½²æŒ‡å—](#sqlite-kubernetesè¾¹ç¼˜è®¡ç®—éƒ¨ç½²æŒ‡å—)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [Kubernetesè¾¹ç¼˜éƒ¨ç½²æ€»è§ˆ](#kubernetesè¾¹ç¼˜éƒ¨ç½²æ€»è§ˆ)
  - [1. è¾¹ç¼˜èŠ‚ç‚¹é…ç½®](#1-è¾¹ç¼˜èŠ‚ç‚¹é…ç½®)
    - [1.1 èŠ‚ç‚¹æ ‡ç­¾ä¸é€‰æ‹©å™¨](#11-èŠ‚ç‚¹æ ‡ç­¾ä¸é€‰æ‹©å™¨)
    - [1.2 èµ„æºé™åˆ¶](#12-èµ„æºé™åˆ¶)
  - [2. SQLite StatefulSetéƒ¨ç½²](#2-sqlite-statefulsetéƒ¨ç½²)
    - [2.1 StatefulSeté…ç½®](#21-statefulseté…ç½®)
    - [2.2 æŒä¹…åŒ–å­˜å‚¨](#22-æŒä¹…åŒ–å­˜å‚¨)
  - [3. æ•°æ®åŒæ­¥ç­–ç•¥](#3-æ•°æ®åŒæ­¥ç­–ç•¥)
    - [3.1 è¾¹ç¼˜-äº‘ç«¯åŒæ­¥](#31-è¾¹ç¼˜-äº‘ç«¯åŒæ­¥)
  - [4. ç›‘æ§ä¸è§‚æµ‹](#4-ç›‘æ§ä¸è§‚æµ‹)
    - [4.1 Prometheusé›†æˆ](#41-prometheusé›†æˆ)
  - [5. é«˜å¯ç”¨é…ç½®](#5-é«˜å¯ç”¨é…ç½®)
    - [5.1 å‰¯æœ¬ç­–ç•¥](#51-å‰¯æœ¬ç­–ç•¥)
  - [6. å®ç°ç¤ºä¾‹](#6-å®ç°ç¤ºä¾‹)
    - [6.1 YAMLé…ç½®](#61-yamlé…ç½®)
    - [6.2 éƒ¨ç½²è„šæœ¬](#62-éƒ¨ç½²è„šæœ¬)
  - [7. æœ€ä½³å®è·µ](#7-æœ€ä½³å®è·µ)
  - [8. ğŸ”— ç›¸å…³èµ„æº](#8--ç›¸å…³èµ„æº)
    - [å†…éƒ¨èµ„æº](#å†…éƒ¨èµ„æº)
    - [å¤–éƒ¨èµ„æº](#å¤–éƒ¨èµ„æº)
  - [ğŸ”— äº¤å‰å¼•ç”¨](#-äº¤å‰å¼•ç”¨)
    - [ç¼–ç¨‹å®è·µæ–‡æ¡£](#ç¼–ç¨‹å®è·µæ–‡æ¡£)
    - [æ ¸å¿ƒæ¶æ„æ–‡æ¡£ ğŸ†•](#æ ¸å¿ƒæ¶æ„æ–‡æ¡£-)
    - [çŸ¥è¯†å›¾è°±ä¸å¯¼èˆª ğŸ†•](#çŸ¥è¯†å›¾è°±ä¸å¯¼èˆª-)
    - [ç›¸å…³æ¦‚å¿µé“¾æ¥ ğŸ†•](#ç›¸å…³æ¦‚å¿µé“¾æ¥-)
      - [Kuberneteséƒ¨ç½²æ¦‚å¿µ](#kuberneteséƒ¨ç½²æ¦‚å¿µ)

---

## Kubernetesè¾¹ç¼˜éƒ¨ç½²æ€»è§ˆ

```text
Kubernetesè¾¹ç¼˜SQLiteéƒ¨ç½²æ¶æ„
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   è¾¹ç¼˜é›†ç¾¤æ¶æ„                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¾¹ç¼˜èŠ‚ç‚¹1 (Edge Node 1)                                                 â”‚
â”‚   â””â”€ SQLite Pod (StatefulSet)                                           â”‚
â”‚      â”œâ”€ æŒä¹…åŒ–å­˜å‚¨ (PVC)                                                 â”‚
â”‚      â”œâ”€ é…ç½® (ConfigMap)                                                â”‚
â”‚      â””â”€ æœåŠ¡ (Service)                                                  â”‚
â”‚                                                                         â”‚
â”‚ è¾¹ç¼˜èŠ‚ç‚¹2 (Edge Node 2)                                                 â”‚
â”‚   â””â”€ SQLite Pod (StatefulSet)                                           â”‚
â”‚      â”œâ”€ æŒä¹…åŒ–å­˜å‚¨ (PVC)                                                 â”‚
â”‚      â”œâ”€ é…ç½® (ConfigMap)                                                â”‚
â”‚      â””â”€ æœåŠ¡ (Service)                                                  â”‚
â”‚                                                                         â”‚
â”‚ äº‘ç«¯æ§åˆ¶å¹³é¢ (Cloud Control Plane)                                      â”‚
â”‚   â”œâ”€ æ•°æ®åŒæ­¥æœåŠ¡                                                        â”‚
â”‚   â”œâ”€ ç›‘æ§æœåŠ¡                                                            â”‚
â”‚   â””â”€ é…ç½®ç®¡ç†                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1. è¾¹ç¼˜èŠ‚ç‚¹é…ç½®

### 1.1 èŠ‚ç‚¹æ ‡ç­¾ä¸é€‰æ‹©å™¨

```yaml
# è¾¹ç¼˜èŠ‚ç‚¹æ ‡ç­¾
apiVersion: v1
kind: Node
metadata:
  name: edge-node-1
  labels:
    node-type: edge
    region: edge-zone-1
    storage-type: local-ssd
spec:
  # èŠ‚ç‚¹é…ç½®
```

### 1.2 èµ„æºé™åˆ¶

```yaml
apiVersion: v1
kind: ResourceQuota
metadata:
  name: edge-sqlite-quota
  namespace: edge-computing
spec:
  hard:
    requests.memory: "2Gi"
    requests.cpu: "2"
    limits.memory: "4Gi"
    limits.cpu: "4"
    persistentvolumeclaims: "10"
    storage.storageclass.storage.k8s.io/edge-ssd: "100Gi"
```

---

## 2. SQLite StatefulSetéƒ¨ç½²

### 2.1 StatefulSeté…ç½®

```yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: sqlite-edge
  namespace: edge-computing
spec:
  serviceName: sqlite-edge
  replicas: 3
  selector:
    matchLabels:
      app: sqlite-edge
  template:
    metadata:
      labels:
        app: sqlite-edge
    spec:
      nodeSelector:
        node-type: edge
      containers:
      - name: sqlite
        image: sqlite:3.47
        resources:
          requests:
            memory: "512Mi"
            cpu: "500m"
          limits:
            memory: "1Gi"
            cpu: "1000m"
        volumeMounts:
        - name: sqlite-data
          mountPath: /data
        - name: sqlite-config
          mountPath: /etc/sqlite
        env:
        - name: SQLITE_DB_PATH
          value: "/data/edge.db"
        - name: SQLITE_JOURNAL_MODE
          value: "WAL"
        - name: SQLITE_CACHE_SIZE
          value: "-2000"
  volumeClaimTemplates:
  - metadata:
      name: sqlite-data
    spec:
      accessModes: [ "ReadWriteOnce" ]
      storageClassName: edge-ssd
      resources:
        requests:
          storage: 10Gi
```

### 2.2 æŒä¹…åŒ–å­˜å‚¨

```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sqlite-data-pvc
  namespace: edge-computing
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: edge-ssd
  resources:
    requests:
      storage: 10Gi
```

---

## 3. æ•°æ®åŒæ­¥ç­–ç•¥

### 3.1 è¾¹ç¼˜-äº‘ç«¯åŒæ­¥

```python
import sqlite3
import requests
import time
from typing import List, Dict

class EdgeCloudSync:
    def __init__(self, db_path: str, cloud_endpoint: str):
        self.conn = sqlite3.connect(db_path)
        self.cloud_endpoint = cloud_endpoint
        self.setup_sync_tracking()

    def setup_sync_tracking(self):
        """è®¾ç½®åŒæ­¥è·Ÿè¸ªè¡¨"""
        cursor = self.conn.cursor()
        cursor.execute("""
            CREATE TABLE IF NOT EXISTS sync_status (
                table_name TEXT,
                last_sync_timestamp INTEGER,
                sync_state TEXT,
                PRIMARY KEY (table_name)
            )
        """)
        self.conn.commit()

    def sync_to_cloud(self, table_name: str):
        """åŒæ­¥æ•°æ®åˆ°äº‘ç«¯"""
        cursor = self.conn.cursor()

        # è·å–ä¸Šæ¬¡åŒæ­¥æ—¶é—´
        cursor.execute("""
            SELECT last_sync_timestamp FROM sync_status
            WHERE table_name = ?
        """, (table_name,))

        result = cursor.fetchone()
        last_sync = result[0] if result else 0

        # è·å–å¢é‡æ•°æ®
        cursor.execute(f"""
            SELECT * FROM {table_name}
            WHERE updated_at > ?
        """, (last_sync,))

        rows = cursor.fetchall()

        # åŒæ­¥åˆ°äº‘ç«¯
        if rows:
            response = requests.post(
                f"{self.cloud_endpoint}/sync/{table_name}",
                json={'data': rows}
            )

            if response.status_code == 200:
                # æ›´æ–°åŒæ­¥çŠ¶æ€
                cursor.execute("""
                    INSERT OR REPLACE INTO sync_status
                    (table_name, last_sync_timestamp, sync_state)
                    VALUES (?, ?, ?)
                """, (table_name, int(time.time()), 'synced'))

                self.conn.commit()
```

---

## 4. ç›‘æ§ä¸è§‚æµ‹

### 4.1 Prometheusé›†æˆ

```yaml
apiVersion: v1
kind: Service
metadata:
  name: sqlite-metrics
  namespace: edge-computing
spec:
  selector:
    app: sqlite-edge
  ports:
  - name: metrics
    port: 9090
    targetPort: 9090
---
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: sqlite-edge
  namespace: edge-computing
spec:
  selector:
    matchLabels:
      app: sqlite-edge
  endpoints:
  - port: metrics
    interval: 30s
```

---

## 5. é«˜å¯ç”¨é…ç½®

### 5.1 å‰¯æœ¬ç­–ç•¥

```yaml
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: sqlite-edge-pdb
  namespace: edge-computing
spec:
  minAvailable: 2
  selector:
    matchLabels:
      app: sqlite-edge
```

---

## 6. å®ç°ç¤ºä¾‹

### 6.1 YAMLé…ç½®

å®Œæ•´çš„éƒ¨ç½²é…ç½®ç¤ºä¾‹è§ä¸Šè¿°ç« èŠ‚ã€‚

### 6.2 éƒ¨ç½²è„šæœ¬

```bash
#!/bin/bash
# éƒ¨ç½²SQLiteåˆ°Kubernetesè¾¹ç¼˜é›†ç¾¤

# åˆ›å»ºå‘½åç©ºé—´
kubectl create namespace edge-computing

# åº”ç”¨é…ç½®
kubectl apply -f sqlite-statefulset.yaml
kubectl apply -f sqlite-service.yaml
kubectl apply -f sqlite-configmap.yaml

# ç­‰å¾…éƒ¨ç½²å®Œæˆ
kubectl wait --for=condition=ready pod -l app=sqlite-edge -n edge-computing --timeout=300s

# æ£€æŸ¥çŠ¶æ€
kubectl get pods -n edge-computing
kubectl get pvc -n edge-computing
```

---

## 7. æœ€ä½³å®è·µ

1. **èŠ‚ç‚¹é€‰æ‹©**
   - ä½¿ç”¨èŠ‚ç‚¹é€‰æ‹©å™¨ç¡®ä¿Podéƒ¨ç½²åˆ°è¾¹ç¼˜èŠ‚ç‚¹
   - è€ƒè™‘å­˜å‚¨ç±»å‹å’Œç½‘ç»œå»¶è¿Ÿ

2. **èµ„æºç®¡ç†**
   - è®¾ç½®åˆç†çš„èµ„æºé™åˆ¶
   - ä½¿ç”¨ResourceQuotaç®¡ç†èµ„æº

3. **æ•°æ®åŒæ­¥**
   - å¢é‡åŒæ­¥å‡å°‘ç½‘ç»œæµé‡
   - å†²çªè§£å†³ç­–ç•¥

4. **ç›‘æ§**
   - PrometheusæŒ‡æ ‡æ”¶é›†
   - æ—¥å¿—èšåˆ
   - å¥åº·æ£€æŸ¥

---

## 8. ğŸ”— ç›¸å…³èµ„æº

### å†…éƒ¨èµ„æº

- [è¾¹ç¼˜è®¡ç®—æ•°æ®å­˜å‚¨æ¡ˆä¾‹](../cases/12-è¾¹ç¼˜è®¡ç®—æ•°æ®å­˜å‚¨æ¡ˆä¾‹.md) - è¾¹ç¼˜å­˜å‚¨åŸºç¡€
- [ç”Ÿäº§ç¯å¢ƒç›‘æ§ä¸è¯Šæ–­](./08.13-SQLiteç”Ÿäº§ç¯å¢ƒç›‘æ§ä¸è¯Šæ–­.md) - ç›‘æ§å®è·µ
- [å¼€å‘å·¥ä½œæµä¸CI/CDé›†æˆ](./08.17-SQLiteå¼€å‘å·¥ä½œæµä¸CI-CDé›†æˆ.md) - CI/CDå®è·µ

### å¤–éƒ¨èµ„æº

- [Kuberneteså®˜æ–¹æ–‡æ¡£](https://kubernetes.io/docs/)
- [K3sè¾¹ç¼˜Kubernetes](https://k3s.io/) - è½»é‡çº§Kubernetes
- [KubeEdge](https://kubeedge.io/) - è¾¹ç¼˜è®¡ç®—å¹³å°

---

## ğŸ”— äº¤å‰å¼•ç”¨

### ç¼–ç¨‹å®è·µæ–‡æ¡£

- â­â­â­ [è¾¹ç¼˜è®¡ç®—æ•°æ®å­˜å‚¨æ¡ˆä¾‹](../cases/12-è¾¹ç¼˜è®¡ç®—æ•°æ®å­˜å‚¨æ¡ˆä¾‹.md) - è¾¹ç¼˜å­˜å‚¨åŸºç¡€
- â­â­ [ç”Ÿäº§ç¯å¢ƒç›‘æ§ä¸è¯Šæ–­](./08.13-SQLiteç”Ÿäº§ç¯å¢ƒç›‘æ§ä¸è¯Šæ–­.md) - ç›‘æ§å®è·µ
- â­â­ [å¼€å‘å·¥ä½œæµä¸CI/CDé›†æˆ](./08.17-SQLiteå¼€å‘å·¥ä½œæµä¸CI-CDé›†æˆ.md) - CI/CDå®è·µ

### æ ¸å¿ƒæ¶æ„æ–‡æ¡£ ğŸ†•

- â­â­ [å­˜å‚¨å¼•æ“](../01-æ ¸å¿ƒæ¶æ„/01.03-å­˜å‚¨å¼•æ“.md) - å­˜å‚¨ä¼˜åŒ–åŸºç¡€
- â­â­ [è¿æ¥ç®¡ç†](./08.01-è¿æ¥ç®¡ç†.md) - è¿æ¥ç®¡ç†åŸºç¡€

### çŸ¥è¯†å›¾è°±ä¸å¯¼èˆª ğŸ†•

- â­â­â­ [çŸ¥è¯†å›¾è°±ä¸æ¦‚å¿µå…³ç³»ç½‘ç»œ](../09-æœ€æ–°ç‰¹æ€§/09.03-SQLiteçŸ¥è¯†å›¾è°±ä¸æ¦‚å¿µå…³ç³»ç½‘ç»œ.md) - Kuberneteséƒ¨ç½²æ¦‚å¿µå…³ç³»
- â­â­ [æ–‡æ¡£ä¾èµ–å…³ç³»å›¾](../00-é¡¹ç›®å¯¼èˆª/06-æ–‡æ¡£ä¾èµ–å…³ç³»å›¾.md) - Kuberneteséƒ¨ç½²æ–‡æ¡£ä¾èµ–
- â­â­ [æœ¯è¯­æ ‡å‡†åŒ–è¯å…¸](../00-é¡¹ç›®å¯¼èˆª/03-æœ¯è¯­è¯å…¸/SQLiteæœ¯è¯­æ ‡å‡†åŒ–è¯å…¸.md) - Kubernetesæœ¯è¯­ç´¢å¼•

### ç›¸å…³æ¦‚å¿µé“¾æ¥ ğŸ†•

#### Kuberneteséƒ¨ç½²æ¦‚å¿µ

- **StatefulSet** â†’ [çŸ¥è¯†å›¾è°±ï¼šéƒ¨ç½²æ¦‚å¿µ](../09-æœ€æ–°ç‰¹æ€§/09.03-SQLiteçŸ¥è¯†å›¾è°±ä¸æ¦‚å¿µå…³ç³»ç½‘ç»œ.md#å¼€å‘å®è·µæœ¬ä½“)
- **è¾¹ç¼˜è®¡ç®—** â†’ [è¾¹ç¼˜è®¡ç®—æ•°æ®å­˜å‚¨æ¡ˆä¾‹](../cases/12-è¾¹ç¼˜è®¡ç®—æ•°æ®å­˜å‚¨æ¡ˆä¾‹.md)
- **æ•°æ®åŒæ­¥** â†’ [ç§»åŠ¨åº”ç”¨ç¦»çº¿æ•°æ®åŒæ­¥æ¡ˆä¾‹](../cases/09-ç§»åŠ¨åº”ç”¨ç¦»çº¿æ•°æ®åŒæ­¥æ¡ˆä¾‹.md)

---

**æœ€åæ›´æ–°**: 2025-12-05
**ç»´æŠ¤è€…**: SQLite Knowledge Base Team
