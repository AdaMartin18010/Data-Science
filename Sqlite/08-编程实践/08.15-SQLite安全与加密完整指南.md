# SQLiteå®‰å…¨ä¸åŠ å¯†å®Œæ•´æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**: 2025-12-05
> **ç‰ˆæœ¬**: SQLite 3.47.x
> **éš¾åº¦**: â­â­â­â­â­
> **é€‚ç”¨åœºæ™¯**: æ•æ„Ÿæ•°æ®ä¿æŠ¤ã€åˆè§„è¦æ±‚ã€å®‰å…¨å®¡è®¡

---

## ğŸ“‘ ç›®å½•

- [SQLiteå®‰å…¨ä¸åŠ å¯†å®Œæ•´æŒ‡å—](#sqliteå®‰å…¨ä¸åŠ å¯†å®Œæ•´æŒ‡å—)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [å®‰å…¨ä½“ç³»æ€»è§ˆ](#å®‰å…¨ä½“ç³»æ€»è§ˆ)
  - [1. åº”ç”¨å±‚å®‰å…¨](#1-åº”ç”¨å±‚å®‰å…¨)
    - [1.1 SQLæ³¨å…¥é˜²æŠ¤](#11-sqlæ³¨å…¥é˜²æŠ¤)
      - [å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆå¼ºçƒˆæ¨èï¼‰](#å‚æ•°åŒ–æŸ¥è¯¢å¼ºçƒˆæ¨è)
      - [è¾“å…¥éªŒè¯](#è¾“å…¥éªŒè¯)
    - [1.2 è¾“å…¥éªŒè¯](#12-è¾“å…¥éªŒè¯)
    - [1.3 æƒé™æ§åˆ¶](#13-æƒé™æ§åˆ¶)
    - [1.4 å®¡è®¡æ—¥å¿—](#14-å®¡è®¡æ—¥å¿—)
  - [2. æ–‡ä»¶ç³»ç»Ÿå®‰å…¨](#2-æ–‡ä»¶ç³»ç»Ÿå®‰å…¨)
    - [2.1 æ–‡ä»¶æƒé™é…ç½®](#21-æ–‡ä»¶æƒé™é…ç½®)
    - [2.2 æ–‡ä»¶åŠ å¯†](#22-æ–‡ä»¶åŠ å¯†)
    - [2.3 å®‰å…¨åˆ é™¤](#23-å®‰å…¨åˆ é™¤)
  - [3. SQLCipheråŠ å¯†](#3-sqlcipheråŠ å¯†)
    - [3.1 SQLCipherç®€ä»‹](#31-sqlcipherç®€ä»‹)
    - [3.2 Pythonä½¿ç”¨SQLCipher](#32-pythonä½¿ç”¨sqlcipher)
    - [3.3 Cè¯­è¨€ä½¿ç”¨SQLCipher](#33-cè¯­è¨€ä½¿ç”¨sqlcipher)
    - [3.4 å¯†é’¥ç®¡ç†](#34-å¯†é’¥ç®¡ç†)
  - [4. æ•°æ®ä¼ è¾“å®‰å…¨](#4-æ•°æ®ä¼ è¾“å®‰å…¨)
    - [4.1 ç½‘ç»œä¼ è¾“åŠ å¯†](#41-ç½‘ç»œä¼ è¾“åŠ å¯†)
    - [4.2 å¤‡ä»½åŠ å¯†](#42-å¤‡ä»½åŠ å¯†)
  - [5. å®‰å…¨æœ€ä½³å®è·µ](#5-å®‰å…¨æœ€ä½³å®è·µ)
    - [5.1 å®‰å…¨é…ç½®çŸ©é˜µ](#51-å®‰å…¨é…ç½®çŸ©é˜µ)
    - [5.2 å®‰å…¨æ£€æŸ¥æ¸…å•](#52-å®‰å…¨æ£€æŸ¥æ¸…å•)
  - [6. æ¼æ´ä¸è¡¥ä¸ç®¡ç†](#6-æ¼æ´ä¸è¡¥ä¸ç®¡ç†)
    - [6.1 CVEè·Ÿè¸ª](#61-cveè·Ÿè¸ª)
    - [6.2 ç‰ˆæœ¬æ›´æ–°ç­–ç•¥](#62-ç‰ˆæœ¬æ›´æ–°ç­–ç•¥)
  - [6.3. å®‰å…¨åŠ å¯†å†³ç­–æ ‘](#63-å®‰å…¨åŠ å¯†å†³ç­–æ ‘)
  - [7. åˆè§„æ€§è¦æ±‚](#7-åˆè§„æ€§è¦æ±‚)
    - [7.1 GDPRåˆè§„](#71-gdpråˆè§„)
    - [7.2 æ•°æ®è„±æ•](#72-æ•°æ®è„±æ•)
  - [8. ğŸ”— ç›¸å…³èµ„æº](#8--ç›¸å…³èµ„æº)
    - [å†…éƒ¨èµ„æº](#å†…éƒ¨èµ„æº)
    - [å¤–éƒ¨èµ„æº](#å¤–éƒ¨èµ„æº)
  - [ğŸ”— äº¤å‰å¼•ç”¨](#-äº¤å‰å¼•ç”¨)
    - [ç¼–ç¨‹å®è·µæ–‡æ¡£](#ç¼–ç¨‹å®è·µæ–‡æ¡£)
    - [æ ¸å¿ƒæ¶æ„æ–‡æ¡£ ğŸ†•](#æ ¸å¿ƒæ¶æ„æ–‡æ¡£-)
    - [çŸ¥è¯†å›¾è°±ä¸å¯¼èˆª ğŸ†•](#çŸ¥è¯†å›¾è°±ä¸å¯¼èˆª-)
    - [ç›¸å…³æ¦‚å¿µé“¾æ¥ ğŸ†•](#ç›¸å…³æ¦‚å¿µé“¾æ¥-)
      - [å®‰å…¨åŠ å¯†æ¦‚å¿µ](#å®‰å…¨åŠ å¯†æ¦‚å¿µ)

---

## å®‰å…¨ä½“ç³»æ€»è§ˆ

```text
SQLiteå®‰å…¨ä½“ç³»æ¶æ„
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å®‰å…¨å±‚æ¬¡                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1. åº”ç”¨å±‚å®‰å…¨                                                            â”‚
â”‚    â€¢ SQLæ³¨å…¥é˜²æŠ¤                                                         â”‚
â”‚    â€¢ è¾“å…¥éªŒè¯                                                            â”‚
â”‚    â€¢ æƒé™æ§åˆ¶                                                            â”‚
â”‚    â€¢ å®¡è®¡æ—¥å¿—                                                            â”‚
â”‚                                                                         â”‚
â”‚ 2. æ–‡ä»¶ç³»ç»Ÿå®‰å…¨                                                          â”‚
â”‚    â€¢ æ–‡ä»¶æƒé™é…ç½®                                                        â”‚
â”‚    â€¢ æ–‡ä»¶åŠ å¯†                                                            â”‚
â”‚    â€¢ å®‰å…¨åˆ é™¤                                                            â”‚
â”‚                                                                         â”‚
â”‚ 3. æ•°æ®åº“åŠ å¯†                                                            â”‚
â”‚    â€¢ SQLCipheråŠ å¯†                                                      â”‚
â”‚    â€¢ å¯†é’¥ç®¡ç†                                                            â”‚
â”‚    â€¢ é€æ˜åŠ å¯†                                                            â”‚
â”‚                                                                         â”‚
â”‚ 4. ä¼ è¾“å®‰å…¨                                                              â”‚
â”‚    â€¢ ç½‘ç»œä¼ è¾“åŠ å¯†                                                        â”‚
â”‚    â€¢ å¤‡ä»½åŠ å¯†                                                            â”‚
â”‚                                                                         â”‚
â”‚ 5. åˆè§„æ€§                                                                â”‚
â”‚    â€¢ GDPRåˆè§„                                                            â”‚
â”‚    â€¢ æ•°æ®è„±æ•                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1. åº”ç”¨å±‚å®‰å…¨

### 1.1 SQLæ³¨å…¥é˜²æŠ¤

#### å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆå¼ºçƒˆæ¨èï¼‰

```python
import sqlite3

# âœ… å®‰å…¨ï¼šä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢
def safe_query(conn, user_id):
    cursor = conn.cursor()
    cursor.execute("SELECT * FROM users WHERE id = ?", (user_id,))
    return cursor.fetchall()

# âŒ ä¸å®‰å…¨ï¼šå­—ç¬¦ä¸²æ‹¼æ¥
def unsafe_query(conn, user_id):
    cursor = conn.cursor()
    cursor.execute(f"SELECT * FROM users WHERE id = {user_id}")  # å±é™©ï¼
    return cursor.fetchall()

# âœ… å®‰å…¨ï¼šå‘½åå‚æ•°
def safe_named_query(conn, user_id, user_name):
    cursor = conn.cursor()
    cursor.execute(
        "SELECT * FROM users WHERE id = :id AND name = :name",
        {'id': user_id, 'name': user_name}
    )
    return cursor.fetchall()
```

#### è¾“å…¥éªŒè¯

```python
import re
from typing import Optional

class InputValidator:
    @staticmethod
    def validate_user_id(user_id: str) -> Optional[int]:
        """éªŒè¯ç”¨æˆ·ID"""
        if not user_id:
            return None
        try:
            id_int = int(user_id)
            if id_int > 0:
                return id_int
        except ValueError:
            pass
        return None

    @staticmethod
    def validate_email(email: str) -> bool:
        """éªŒè¯é‚®ç®±æ ¼å¼"""
        pattern = r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$'
        return bool(re.match(pattern, email))

    @staticmethod
    def sanitize_string(input_str: str, max_length: int = 255) -> str:
        """æ¸…ç†å­—ç¬¦ä¸²è¾“å…¥"""
        # ç§»é™¤æ§åˆ¶å­—ç¬¦
        sanitized = ''.join(char for char in input_str if ord(char) >= 32)
        # é™åˆ¶é•¿åº¦
        return sanitized[:max_length]

# ä½¿ç”¨ç¤ºä¾‹
validator = InputValidator()
user_id = validator.validate_user_id(user_input)
if user_id:
    results = safe_query(conn, user_id)
```

### 1.2 è¾“å…¥éªŒè¯

```python
class SQLiteSecurity:
    def __init__(self, conn):
        self.conn = conn
        self.setup_security()

    def setup_security(self):
        """è®¾ç½®å®‰å…¨é…ç½®"""
        cursor = self.conn.cursor()

        # å¯ç”¨å¤–é”®çº¦æŸ
        cursor.execute("PRAGMA foreign_keys = ON")

        # è®¾ç½®ä¸¥æ ¼æ¨¡å¼ï¼ˆSQLite 3.37+ï¼‰
        cursor.execute("PRAGMA strict = ON")

        self.conn.commit()

    def validate_table_name(self, table_name: str) -> bool:
        """éªŒè¯è¡¨åï¼ˆé˜²æ­¢SQLæ³¨å…¥ï¼‰"""
        # åªå…è®¸å­—æ¯ã€æ•°å­—ã€ä¸‹åˆ’çº¿
        if not re.match(r'^[a-zA-Z_][a-zA-Z0-9_]*$', table_name):
            return False
        # ä¸å…è®¸SQLiteç³»ç»Ÿè¡¨
        if table_name.startswith('sqlite_'):
            return False
        return True

    def safe_table_query(self, table_name: str, where_clause: str = "", params: tuple = ()):
        """å®‰å…¨çš„è¡¨æŸ¥è¯¢"""
        if not self.validate_table_name(table_name):
            raise ValueError(f"æ— æ•ˆçš„è¡¨å: {table_name}")

        query = f"SELECT * FROM {table_name}"
        if where_clause:
            query += f" WHERE {where_clause}"

        cursor = self.conn.cursor()
        cursor.execute(query, params)
        return cursor.fetchall()
```

### 1.3 æƒé™æ§åˆ¶

```python
class AccessControl:
    def __init__(self):
        self.permissions = {}

    def grant_permission(self, user: str, table: str, operation: str):
        """æˆäºˆæƒé™"""
        key = (user, table)
        if key not in self.permissions:
            self.permissions[key] = set()
        self.permissions[key].add(operation)

    def check_permission(self, user: str, table: str, operation: str) -> bool:
        """æ£€æŸ¥æƒé™"""
        key = (user, table)
        if key not in self.permissions:
            return False
        return operation in self.permissions[key]

    def execute_with_permission_check(self, conn, user: str, query: str, params: tuple = ()):
        """å¸¦æƒé™æ£€æŸ¥çš„æ‰§è¡Œ"""
        # è§£ææŸ¥è¯¢è·å–è¡¨åå’Œæ“ä½œç±»å‹
        query_upper = query.upper().strip()

        if query_upper.startswith('SELECT'):
            operation = 'SELECT'
            # ç®€å•è§£æï¼ˆå®é™…åº”ä½¿ç”¨SQLè§£æå™¨ï¼‰
            table_match = re.search(r'FROM\s+(\w+)', query_upper)
            if table_match:
                table = table_match.group(1)
                if not self.check_permission(user, table, operation):
                    raise PermissionError(f"ç”¨æˆ· {user} æ²¡æœ‰ {table} è¡¨çš„ {operation} æƒé™")

        cursor = conn.cursor()
        cursor.execute(query, params)
        return cursor.fetchall()

# ä½¿ç”¨ç¤ºä¾‹
access_control = AccessControl()
access_control.grant_permission('user1', 'users', 'SELECT')
access_control.grant_permission('user1', 'users', 'INSERT')

try:
    results = access_control.execute_with_permission_check(
        conn, 'user1', 'SELECT * FROM users WHERE id = ?', (1,)
    )
except PermissionError as e:
    print(f"æƒé™é”™è¯¯: {e}")
```

### 1.4 å®¡è®¡æ—¥å¿—

```python
import logging
from datetime import datetime
from typing import Dict, Any

class AuditLogger:
    def __init__(self, log_file: str = 'sqlite_audit.log'):
        self.logger = logging.getLogger('sqlite_audit')
        self.logger.setLevel(logging.INFO)

        handler = logging.FileHandler(log_file)
        formatter = logging.Formatter(
            '%(asctime)s - %(user)s - %(operation)s - %(table)s - %(message)s'
        )
        handler.setFormatter(formatter)
        self.logger.addHandler(handler)

    def log_query(self, user: str, operation: str, table: str, query: str, params: tuple = ()):
        """è®°å½•æŸ¥è¯¢æ“ä½œ"""
        extra = {
            'user': user,
            'operation': operation,
            'table': table
        }
        self.logger.info(
            f"æŸ¥è¯¢: {query}, å‚æ•°: {params}",
            extra=extra
        )

    def log_data_change(self, user: str, operation: str, table: str,
                       old_data: Dict[str, Any] = None,
                       new_data: Dict[str, Any] = None):
        """è®°å½•æ•°æ®å˜æ›´"""
        extra = {
            'user': user,
            'operation': operation,
            'table': table
        }
        message = f"æ•°æ®å˜æ›´ - æ—§æ•°æ®: {old_data}, æ–°æ•°æ®: {new_data}"
        self.logger.info(message, extra=extra)

# ä½¿ç”¨ç¤ºä¾‹
audit_logger = AuditLogger()

def execute_with_audit(conn, user: str, query: str, params: tuple = ()):
    """å¸¦å®¡è®¡çš„æ‰§è¡Œ"""
    # è§£ææ“ä½œç±»å‹å’Œè¡¨å
    query_upper = query.upper().strip()
    operation = query_upper.split()[0] if query_upper else 'UNKNOWN'

    table_match = re.search(r'FROM\s+(\w+)|INTO\s+(\w+)|UPDATE\s+(\w+)', query_upper)
    table = table_match.group(1) or table_match.group(2) or table_match.group(3) if table_match else 'UNKNOWN'

    # è®°å½•å®¡è®¡æ—¥å¿—
    audit_logger.log_query(user, operation, table, query, params)

    # æ‰§è¡ŒæŸ¥è¯¢
    cursor = conn.cursor()
    cursor.execute(query, params)
    conn.commit()

    return cursor.fetchall() if operation == 'SELECT' else cursor.rowcount
```

---

## 2. æ–‡ä»¶ç³»ç»Ÿå®‰å…¨

### 2.1 æ–‡ä»¶æƒé™é…ç½®

```python
import os
import stat
from pathlib import Path

class FileSecurity:
    @staticmethod
    def set_secure_permissions(db_path: str):
        """è®¾ç½®å®‰å…¨çš„æ–‡ä»¶æƒé™"""
        db_path = Path(db_path)

        # è®¾ç½®æ•°æ®åº“æ–‡ä»¶æƒé™ï¼š0600ï¼ˆä»…æ‰€æœ‰è€…è¯»å†™ï¼‰
        os.chmod(db_path, stat.S_IRUSR | stat.S_IWUSR)

        # è®¾ç½®WALæ–‡ä»¶æƒé™
        wal_path = Path(f"{db_path}-wal")
        if wal_path.exists():
            os.chmod(wal_path, stat.S_IRUSR | stat.S_IWUSR)

        # è®¾ç½®SHMæ–‡ä»¶æƒé™
        shm_path = Path(f"{db_path}-shm")
        if shm_path.exists():
            os.chmod(shm_path, stat.S_IRUSR | stat.S_IWUSR)

    @staticmethod
    def verify_permissions(db_path: str) -> bool:
        """éªŒè¯æ–‡ä»¶æƒé™"""
        db_path = Path(db_path)

        # æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æƒé™
        file_stat = os.stat(db_path)
        mode = stat.filemode(file_stat.st_mode)

        # åº”è¯¥åªæœ‰æ‰€æœ‰è€…æœ‰è¯»å†™æƒé™
        if mode != '-rw-------':
            return False

        return True

# ä½¿ç”¨ç¤ºä¾‹
file_security = FileSecurity()
file_security.set_secure_permissions('database.db')
if file_security.verify_permissions('database.db'):
    print("æ–‡ä»¶æƒé™é…ç½®æ­£ç¡®")
```

### 2.2 æ–‡ä»¶åŠ å¯†

```python
from cryptography.fernet import Fernet
from cryptography.hazmat.primitives import hashes
from cryptography.hazmat.primitives.kdf.pbkdf2 import PBKDF2HMAC
import base64

class FileEncryption:
    def __init__(self, password: str):
        """åˆå§‹åŒ–æ–‡ä»¶åŠ å¯†"""
        # ä»å¯†ç æ´¾ç”Ÿå¯†é’¥
        kdf = PBKDF2HMAC(
            algorithm=hashes.SHA256(),
            length=32,
            salt=b'fixed_salt',  # ç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨éšæœºsalt
            iterations=100000,
        )
        key = base64.urlsafe_b64encode(kdf.derive(password.encode()))
        self.cipher = Fernet(key)

    def encrypt_file(self, input_path: str, output_path: str):
        """åŠ å¯†æ–‡ä»¶"""
        with open(input_path, 'rb') as f:
            data = f.read()

        encrypted_data = self.cipher.encrypt(data)

        with open(output_path, 'wb') as f:
            f.write(encrypted_data)

    def decrypt_file(self, input_path: str, output_path: str):
        """è§£å¯†æ–‡ä»¶"""
        with open(input_path, 'rb') as f:
            encrypted_data = f.read()

        decrypted_data = self.cipher.decrypt(encrypted_data)

        with open(output_path, 'wb') as f:
            f.write(decrypted_data)
```

### 2.3 å®‰å…¨åˆ é™¤

```python
import random

class SecureDelete:
    @staticmethod
    def secure_delete_file(file_path: str, passes: int = 3):
        """å®‰å…¨åˆ é™¤æ–‡ä»¶ï¼ˆå¤šæ¬¡è¦†å†™ï¼‰"""
        file_path = Path(file_path)

        if not file_path.exists():
            return

        file_size = file_path.stat().st_size

        with open(file_path, 'r+b') as f:
            for _ in range(passes):
                # éšæœºæ•°æ®è¦†å†™
                f.seek(0)
                random_data = os.urandom(file_size)
                f.write(random_data)
                f.flush()
                os.fsync(f.fileno())

        # åˆ é™¤æ–‡ä»¶
        file_path.unlink()

    @staticmethod
    def secure_delete_database(db_path: str):
        """å®‰å…¨åˆ é™¤æ•°æ®åº“åŠå…¶ç›¸å…³æ–‡ä»¶"""
        db_path = Path(db_path)

        # åˆ é™¤ä¸»æ•°æ®åº“æ–‡ä»¶
        if db_path.exists():
            SecureDelete.secure_delete_file(str(db_path))

        # åˆ é™¤WALæ–‡ä»¶
        wal_path = Path(f"{db_path}-wal")
        if wal_path.exists():
            SecureDelete.secure_delete_file(str(wal_path))

        # åˆ é™¤SHMæ–‡ä»¶
        shm_path = Path(f"{db_path}-shm")
        if shm_path.exists():
            SecureDelete.secure_delete_file(str(shm_path))
```

---

## 3. SQLCipheråŠ å¯†

### 3.1 SQLCipherç®€ä»‹

SQLCipheræ˜¯SQLiteçš„åŠ å¯†æ‰©å±•ï¼Œæä¾›é€æ˜çš„æ•°æ®åº“åŠ å¯†åŠŸèƒ½ã€‚

```text
SQLCipherç‰¹æ€§
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â€¢ é€æ˜åŠ å¯†ï¼šåº”ç”¨ç¨‹åºæ— éœ€ä¿®æ”¹ï¼Œåªéœ€è®¾ç½®å¯†ç 
â€¢ AES-256åŠ å¯†ï¼šä½¿ç”¨AES-256åŠ å¯†ç®—æ³•
â€¢ æ€§èƒ½å½±å“ï¼šåŠ å¯†å¼€é”€çº¦5-15%
â€¢ è·¨å¹³å°ï¼šæ”¯æŒWindowsã€Linuxã€macOSã€iOSã€Android
â€¢ å¼€æºï¼šåŸºäºSQLiteï¼Œå®Œå…¨å¼€æº
```

### 3.2 Pythonä½¿ç”¨SQLCipher

```python
# å®‰è£…: pip install pysqlcipher3

try:
    from pysqlcipher3 import dbapi2 as sqlcipher
except ImportError:
    print("è¯·å®‰è£… pysqlcipher3: pip install pysqlcipher3")
    raise

class SQLCipherDatabase:
    def __init__(self, db_path: str, password: str):
        self.db_path = db_path
        self.password = password
        self.conn = None

    def connect(self):
        """è¿æ¥åˆ°åŠ å¯†æ•°æ®åº“"""
        self.conn = sqlcipher.connect(self.db_path)
        cursor = self.conn.cursor()

        # è®¾ç½®å¯†ç 
        cursor.execute(f"PRAGMA key = '{self.password}'")

        # éªŒè¯å¯†ç ï¼ˆå°è¯•æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢ï¼‰
        cursor.execute("SELECT COUNT(*) FROM sqlite_master")
        cursor.fetchone()

        return self.conn

    def change_password(self, new_password: str):
        """æ›´æ”¹å¯†ç """
        if not self.conn:
            self.connect()

        cursor = self.conn.cursor()

        # ä½¿ç”¨quote()é˜²æ­¢SQLæ³¨å…¥
        cursor.execute("SELECT quote(?)", (new_password,))
        quoted_password = cursor.fetchone()[0]

        cursor.execute(f"PRAGMA rekey = {quoted_password}")
        self.conn.commit()
        self.password = new_password

    def encrypt_existing_database(self, plain_db_path: str, encrypted_db_path: str):
        """åŠ å¯†ç°æœ‰æ•°æ®åº“"""
        # æ‰“å¼€æ˜æ–‡æ•°æ®åº“
        plain_conn = sqlite3.connect(plain_db_path)

        # åˆ›å»ºåŠ å¯†æ•°æ®åº“
        encrypted_conn = sqlcipher.connect(encrypted_db_path)
        encrypted_cursor = encrypted_conn.cursor()
        encrypted_cursor.execute(f"PRAGMA key = '{self.password}'")

        # å¤åˆ¶æ•°æ®
        plain_conn.backup(encrypted_conn)

        plain_conn.close()
        encrypted_conn.close()

    def close(self):
        """å…³é—­è¿æ¥"""
        if self.conn:
            self.conn.close()

# ä½¿ç”¨ç¤ºä¾‹
db = SQLCipherDatabase('encrypted.db', 'my_secret_password')
conn = db.connect()

# æ­£å¸¸ä½¿ç”¨ï¼ŒåŠ å¯†æ˜¯é€æ˜çš„
cursor = conn.cursor()
cursor.execute("CREATE TABLE IF NOT EXISTS users (id INTEGER PRIMARY KEY, name TEXT)")
cursor.execute("INSERT INTO users (name) VALUES (?)", ('Alice',))
conn.commit()

db.close()
```

### 3.3 Cè¯­è¨€ä½¿ç”¨SQLCipher

```c
#include <sqlcipher/sqlite3.h>
#include <stdio.h>
#include <string.h>

int open_encrypted_database(const char* db_path, const char* password) {
    sqlite3* db;
    int rc;

    // æ‰“å¼€æ•°æ®åº“
    rc = sqlite3_open(db_path, &db);
    if (rc != SQLITE_OK) {
        fprintf(stderr, "æ— æ³•æ‰“å¼€æ•°æ®åº“: %s\n", sqlite3_errmsg(db));
        return rc;
    }

    // è®¾ç½®å¯†ç 
    char pragma_key[256];
    snprintf(pragma_key, sizeof(pragma_key), "PRAGMA key = '%s'", password);
    rc = sqlite3_exec(db, pragma_key, NULL, NULL, NULL);
    if (rc != SQLITE_OK) {
        fprintf(stderr, "è®¾ç½®å¯†ç å¤±è´¥: %s\n", sqlite3_errmsg(db));
        sqlite3_close(db);
        return rc;
    }

    // éªŒè¯å¯†ç ï¼ˆæ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢ï¼‰
    rc = sqlite3_exec(db, "SELECT COUNT(*) FROM sqlite_master", NULL, NULL, NULL);
    if (rc != SQLITE_OK) {
        fprintf(stderr, "å¯†ç éªŒè¯å¤±è´¥: %s\n", sqlite3_errmsg(db));
        sqlite3_close(db);
        return rc;
    }

    printf("åŠ å¯†æ•°æ®åº“æ‰“å¼€æˆåŠŸ\n");
    sqlite3_close(db);
    return SQLITE_OK;
}

int change_password(sqlite3* db, const char* new_password) {
    char pragma_rekey[256];
    char* quoted_password;
    int rc;

    // ä½¿ç”¨quote()å‡½æ•°é˜²æ­¢SQLæ³¨å…¥
    char query[256];
    snprintf(query, sizeof(query), "SELECT quote('%s')", new_password);

    rc = sqlite3_exec(db, query, quote_callback, &quoted_password, NULL);
    if (rc != SQLITE_OK) {
        return rc;
    }

    snprintf(pragma_rekey, sizeof(pragma_rekey), "PRAGMA rekey = %s", quoted_password);
    rc = sqlite3_exec(db, pragma_rekey, NULL, NULL, NULL);

    free(quoted_password);
    return rc;
}
```

### 3.4 å¯†é’¥ç®¡ç†

```python
import keyring
from cryptography.fernet import Fernet
import base64

class KeyManager:
    def __init__(self, service_name: str = 'sqlite_encryption'):
        self.service_name = service_name

    def store_password(self, db_path: str, password: str):
        """å­˜å‚¨å¯†ç åˆ°ç³»ç»Ÿå¯†é’¥ç¯"""
        keyring.set_password(self.service_name, db_path, password)

    def get_password(self, db_path: str) -> str:
        """ä»ç³»ç»Ÿå¯†é’¥ç¯è·å–å¯†ç """
        password = keyring.get_password(self.service_name, db_path)
        if not password:
            raise ValueError(f"æœªæ‰¾åˆ° {db_path} çš„å¯†ç ")
        return password

    def delete_password(self, db_path: str):
        """åˆ é™¤å­˜å‚¨çš„å¯†ç """
        keyring.delete_password(self.service_name, db_path)

    def generate_key(self) -> str:
        """ç”Ÿæˆéšæœºå¯†é’¥"""
        key = Fernet.generate_key()
        return base64.urlsafe_b64encode(key).decode()

# ä½¿ç”¨ç¤ºä¾‹
key_manager = KeyManager()

# ç”Ÿæˆå¹¶å­˜å‚¨å¯†ç 
password = key_manager.generate_key()
key_manager.store_password('encrypted.db', password)

# è·å–å¯†ç 
retrieved_password = key_manager.get_password('encrypted.db')
db = SQLCipherDatabase('encrypted.db', retrieved_password)
```

---

## 4. æ•°æ®ä¼ è¾“å®‰å…¨

### 4.1 ç½‘ç»œä¼ è¾“åŠ å¯†

```python
import ssl
import socket
from cryptography.fernet import Fernet

class SecureTransfer:
    def __init__(self, encryption_key: bytes):
        self.cipher = Fernet(encryption_key)

    def encrypt_backup(self, db_path: str) -> bytes:
        """åŠ å¯†æ•°æ®åº“å¤‡ä»½"""
        with open(db_path, 'rb') as f:
            data = f.read()
        return self.cipher.encrypt(data)

    def transfer_encrypted_backup(self, db_path: str, host: str, port: int):
        """ä¼ è¾“åŠ å¯†å¤‡ä»½"""
        encrypted_data = self.encrypt_backup(db_path)

        # åˆ›å»ºSSLè¿æ¥
        context = ssl.create_default_context()
        with socket.create_connection((host, port)) as sock:
            with context.wrap_socket(sock, server_hostname=host) as ssock:
                ssock.sendall(encrypted_data)
```

### 4.2 å¤‡ä»½åŠ å¯†

```python
class EncryptedBackup:
    def __init__(self, encryption_key: bytes):
        self.cipher = Fernet(encryption_key)

    def create_encrypted_backup(self, db_path: str, backup_path: str):
        """åˆ›å»ºåŠ å¯†å¤‡ä»½"""
        # å…ˆåˆ›å»ºæ™®é€šå¤‡ä»½
        temp_backup = f"{backup_path}.tmp"
        # ... æ‰§è¡Œå¤‡ä»½æ“ä½œ ...

        # åŠ å¯†å¤‡ä»½æ–‡ä»¶
        with open(temp_backup, 'rb') as f:
            data = f.read()

        encrypted_data = self.cipher.encrypt(data)

        with open(backup_path, 'wb') as f:
            f.write(encrypted_data)

        # åˆ é™¤ä¸´æ—¶æ–‡ä»¶
        Path(temp_backup).unlink()

    def restore_from_encrypted_backup(self, backup_path: str, db_path: str):
        """ä»åŠ å¯†å¤‡ä»½æ¢å¤"""
        with open(backup_path, 'rb') as f:
            encrypted_data = f.read()

        decrypted_data = self.cipher.decrypt(encrypted_data)

        with open(db_path, 'wb') as f:
            f.write(decrypted_data)
```

---

## 5. å®‰å…¨æœ€ä½³å®è·µ

### 5.1 å®‰å…¨é…ç½®çŸ©é˜µ

```text
SQLiteå®‰å…¨é…ç½®çŸ©é˜µ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å®‰å…¨æªæ–½             â”‚ å¼€å‘ç¯å¢ƒ  â”‚ æµ‹è¯•ç¯å¢ƒ â”‚ é¢„ç”Ÿäº§    â”‚ ç”Ÿäº§ç¯å¢ƒ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‚æ•°åŒ–æŸ¥è¯¢          â”‚ âœ… å¿…éœ€  â”‚ âœ… å¿…éœ€  â”‚ âœ… å¿…éœ€  â”‚ âœ… å¿…éœ€  â”‚
â”‚ æ–‡ä»¶æƒé™0600        â”‚ âš ï¸ æ¨è   â”‚ âœ… å¿…éœ€  â”‚ âœ… å¿…éœ€  â”‚ âœ… å¿…éœ€  â”‚
â”‚ SQLCipheråŠ å¯†       â”‚ âŒ å¯é€‰  â”‚ âš ï¸ æ¨è  â”‚ âœ… å¿…éœ€  â”‚ âœ… å¿…éœ€  â”‚
â”‚ å®¡è®¡æ—¥å¿—            â”‚ âŒ å¯é€‰  â”‚ âš ï¸ æ¨è  â”‚ âœ… å¿…éœ€  â”‚ âœ… å¿…éœ€  â”‚
â”‚ è¾“å…¥éªŒè¯            â”‚ âœ… å¿…éœ€  â”‚ âœ… å¿…éœ€  â”‚ âœ… å¿…éœ€  â”‚ âœ… å¿…éœ€  â”‚
â”‚ æƒé™æ§åˆ¶            â”‚ âŒ å¯é€‰  â”‚ âš ï¸ æ¨è  â”‚ âœ… å¿…éœ€  â”‚ âœ… å¿…éœ€  â”‚
â”‚ å¤‡ä»½åŠ å¯†            â”‚ âŒ å¯é€‰  â”‚ âš ï¸ æ¨è  â”‚ âœ… å¿…éœ€  â”‚ âœ… å¿…éœ€  â”‚
â”‚ å®‰å…¨åˆ é™¤            â”‚ âŒ å¯é€‰  â”‚ âŒ å¯é€‰  â”‚ âš ï¸ æ¨è  â”‚ âœ… å¿…éœ€  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 å®‰å…¨æ£€æŸ¥æ¸…å•

```python
class SecurityChecklist:
    def __init__(self, db_path: str):
        self.db_path = db_path
        self.checks = []

    def check_parameterized_queries(self) -> bool:
        """æ£€æŸ¥æ˜¯å¦ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢"""
        # ä»£ç å®¡æŸ¥æ£€æŸ¥ç‚¹
        return True  # éœ€è¦ä»£ç å®¡æŸ¥

    def check_file_permissions(self) -> bool:
        """æ£€æŸ¥æ–‡ä»¶æƒé™"""
        return FileSecurity.verify_permissions(self.db_path)

    def check_encryption(self) -> bool:
        """æ£€æŸ¥æ˜¯å¦å¯ç”¨åŠ å¯†"""
        # æ£€æŸ¥æ˜¯å¦ä½¿ç”¨SQLCipher
        return False  # éœ€è¦æ ¹æ®å®é™…æƒ…å†µæ£€æŸ¥

    def check_input_validation(self) -> bool:
        """æ£€æŸ¥è¾“å…¥éªŒè¯"""
        # ä»£ç å®¡æŸ¥æ£€æŸ¥ç‚¹
        return True

    def run_all_checks(self) -> dict:
        """è¿è¡Œæ‰€æœ‰å®‰å…¨æ£€æŸ¥"""
        results = {
            'parameterized_queries': self.check_parameterized_queries(),
            'file_permissions': self.check_file_permissions(),
            'encryption': self.check_encryption(),
            'input_validation': self.check_input_validation()
        }

        all_passed = all(results.values())
        results['all_passed'] = all_passed

        return results
```

---

## 6. æ¼æ´ä¸è¡¥ä¸ç®¡ç†

### 6.1 CVEè·Ÿè¸ª

```python
import requests
from datetime import datetime

class CVETracker:
    def __init__(self):
        self.cve_url = "https://www.sqlite.org/security.html"
        self.known_cves = {
            'CVE-2024-0232': {
                'description': 'JSONè§£æå™¨æ¼æ´',
                'fixed_in': '3.43.2',
                'severity': 'HIGH'
            }
        }

    def check_version(self, current_version: str) -> list:
        """æ£€æŸ¥å½“å‰ç‰ˆæœ¬æ˜¯å¦æœ‰å·²çŸ¥æ¼æ´"""
        vulnerabilities = []

        for cve_id, info in self.known_cves.items():
            if self._version_compare(current_version, info['fixed_in']) < 0:
                vulnerabilities.append({
                    'cve_id': cve_id,
                    'description': info['description'],
                    'severity': info['severity'],
                    'fixed_in': info['fixed_in']
                })

        return vulnerabilities

    def _version_compare(self, v1: str, v2: str) -> int:
        """æ¯”è¾ƒç‰ˆæœ¬å·"""
        v1_parts = [int(x) for x in v1.split('.')]
        v2_parts = [int(x) for x in v2.split('.')]

        for i in range(max(len(v1_parts), len(v2_parts))):
            v1_val = v1_parts[i] if i < len(v1_parts) else 0
            v2_val = v2_parts[i] if i < len(v2_parts) else 0

            if v1_val < v2_val:
                return -1
            elif v1_val > v2_val:
                return 1

        return 0

# ä½¿ç”¨ç¤ºä¾‹
cve_tracker = CVETracker()
vulnerabilities = cve_tracker.check_version('3.43.1')
if vulnerabilities:
    print("å‘ç°å®‰å…¨æ¼æ´:")
    for vuln in vulnerabilities:
        print(f"  {vuln['cve_id']}: {vuln['description']} (ä¿®å¤ç‰ˆæœ¬: {vuln['fixed_in']})")
```

### 6.2 ç‰ˆæœ¬æ›´æ–°ç­–ç•¥

```text
ç‰ˆæœ¬æ›´æ–°ç­–ç•¥
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. å®šæœŸæ£€æŸ¥
   â€¢ æ¯æœˆæ£€æŸ¥ä¸€æ¬¡SQLiteç‰ˆæœ¬æ›´æ–°
   â€¢ å…³æ³¨å®‰å…¨å…¬å‘Šé‚®ä»¶åˆ—è¡¨

2. æµ‹è¯•æµç¨‹
   â€¢ åœ¨æµ‹è¯•ç¯å¢ƒå…ˆå‡çº§
   â€¢ è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
   â€¢ æ€§èƒ½åŸºå‡†æµ‹è¯•

3. ç”Ÿäº§å‡çº§
   â€¢ é€‰æ‹©ç»´æŠ¤çª—å£
   â€¢ å¤‡ä»½æ•°æ®åº“
   â€¢ é€æ­¥å‡çº§ï¼ˆç°åº¦å‘å¸ƒï¼‰
   â€¢ ç›‘æ§æ€§èƒ½æŒ‡æ ‡
```

---

## 6.3. å®‰å…¨åŠ å¯†å†³ç­–æ ‘

```text
å®‰å…¨åŠ å¯†å†³ç­–æ ‘
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

é—®é¢˜ï¼šå¦‚ä½•é€‰æ‹©å®‰å…¨åŠ å¯†ç­–ç•¥ï¼Ÿ
    â”‚
    â”œâ”€ å®‰å…¨éœ€æ±‚ï¼Ÿ
    â”‚   â”œâ”€ æ•æ„Ÿæ•°æ®ä¿æŠ¤ï¼Ÿ â†’ SQLCipheråŠ å¯†ï¼ˆæ¨èï¼‰
    â”‚   â”‚   â”œâ”€ æ•°æ®åº“çº§åŠ å¯†
    â”‚   â”‚   â”œâ”€ é€æ˜åŠ å¯†
    â”‚   â”‚   â”œâ”€ å¯†é’¥ç®¡ç†
    â”‚   â”‚   â””â”€ é€‚åˆæ•æ„Ÿæ•°æ®
    â”‚   â”‚
    â”‚   â”œâ”€ SQLæ³¨å…¥é˜²æŠ¤ï¼Ÿ â†’ å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆå¿…éœ€ï¼‰
    â”‚   â”‚   â”œâ”€ å‚æ•°åŒ–æŸ¥è¯¢
    â”‚   â”‚   â”œâ”€ è¾“å…¥éªŒè¯
    â”‚   â”‚   â”œâ”€ ç™½åå•éªŒè¯
    â”‚   â”‚   â””â”€ æ‰€æœ‰åœºæ™¯å¿…éœ€
    â”‚   â”‚
    â”‚   â”œâ”€ æ–‡ä»¶ç³»ç»Ÿå®‰å…¨ï¼Ÿ â†’ æ–‡ä»¶æƒé™+åŠ å¯†
    â”‚   â”‚   â”œâ”€ æ–‡ä»¶æƒé™é…ç½®
    â”‚   â”‚   â”œâ”€ æ–‡ä»¶åŠ å¯†
    â”‚   â”‚   â””â”€ å®‰å…¨åˆ é™¤
    â”‚   â”‚
    â”‚   â””â”€ ä¼ è¾“å®‰å…¨ï¼Ÿ â†’ ä¼ è¾“åŠ å¯†
    â”‚       â”œâ”€ ç½‘ç»œä¼ è¾“åŠ å¯†
    â”‚       â””â”€ å¤‡ä»½åŠ å¯†
    â”‚
    â”œâ”€ åŠ å¯†æ–¹æ¡ˆï¼Ÿ
    â”‚   â”œâ”€ æ•°æ®åº“çº§åŠ å¯†ï¼Ÿ â†’ SQLCipher
    â”‚   â”‚   â”œâ”€ é€æ˜åŠ å¯†
    â”‚   â”‚   â”œâ”€ æ€§èƒ½å½±å“å°
    â”‚   â”‚   â”œâ”€ å¯†é’¥ç®¡ç†
    â”‚   â”‚   â””â”€ é€‚åˆç”Ÿäº§ç¯å¢ƒ
    â”‚   â”‚
    â”‚   â”œâ”€ æ–‡ä»¶çº§åŠ å¯†ï¼Ÿ â†’ æ–‡ä»¶ç³»ç»ŸåŠ å¯†
    â”‚   â”‚   â”œâ”€ æ“ä½œç³»ç»Ÿçº§
    â”‚   â”‚   â”œâ”€ æ€§èƒ½å½±å“å¤§
    â”‚   â”‚   â””â”€ é€‚åˆé™æ€æ•°æ®
    â”‚   â”‚
    â”‚   â””â”€ åº”ç”¨å±‚åŠ å¯†ï¼Ÿ â†’ åº”ç”¨åŠ å¯†
    â”‚       â”œâ”€ å­—æ®µçº§åŠ å¯†
    â”‚       â”œâ”€ çµæ´»æ§åˆ¶
    â”‚       â””â”€ å®ç°å¤æ‚
    â”‚
    â”œâ”€ å¯†é’¥ç®¡ç†ï¼Ÿ
    â”‚   â”œâ”€ å¯†é’¥å­˜å‚¨ï¼Ÿ
    â”‚   â”‚   â”œâ”€ ç¯å¢ƒå˜é‡ â†’ ç®€å•ä½†ä¸å®‰å…¨
    â”‚   â”‚   â”œâ”€ å¯†é’¥ç®¡ç†æœåŠ¡ â†’ å®‰å…¨ä½†å¤æ‚
    â”‚   â”‚   â””â”€ ç¡¬ä»¶å®‰å…¨æ¨¡å— â†’ æœ€å®‰å…¨
    â”‚   â”‚
    â”‚   â””â”€ å¯†é’¥è½®æ¢ï¼Ÿ
    â”‚       â”œâ”€ å®šæœŸè½®æ¢ â†’ æé«˜å®‰å…¨æ€§
    â”‚       â””â”€ ä¸è½®æ¢ â†’ é£é™©é«˜
    â”‚
    â””â”€ åˆè§„è¦æ±‚ï¼Ÿ
        â”œâ”€ GDPRåˆè§„ï¼Ÿ â†’ GDPRåˆè§„æªæ–½
        â”‚   â”œâ”€ æ•°æ®è„±æ•
        â”‚   â”œâ”€ è®¿é—®æ§åˆ¶
        â”‚   â””â”€ å®¡è®¡æ—¥å¿—
        â”‚
        â””â”€ å…¶ä»–åˆè§„ï¼Ÿ â†’ ç›¸åº”åˆè§„æªæ–½
            â””â”€ æ ¹æ®è¦æ±‚é…ç½®

æ¨èå®‰å…¨ç­–ç•¥:
1. ç”Ÿäº§ç¯å¢ƒï¼ˆæ¨èï¼‰:
   - SQLCipheråŠ å¯†
   - å‚æ•°åŒ–æŸ¥è¯¢
   - æ–‡ä»¶æƒé™é…ç½®
   - å¯†é’¥ç®¡ç†æœåŠ¡
   - å®¡è®¡æ—¥å¿—

2. æ•æ„Ÿæ•°æ®:
   - SQLCipheråŠ å¯†
   - å¯†é’¥ç®¡ç†æœåŠ¡
   - æ•°æ®è„±æ•
   - GDPRåˆè§„

3. ä¸€èˆ¬åº”ç”¨:
   - å‚æ•°åŒ–æŸ¥è¯¢ï¼ˆå¿…éœ€ï¼‰
   - è¾“å…¥éªŒè¯
   - æ–‡ä»¶æƒé™é…ç½®
```

---

## 7. åˆè§„æ€§è¦æ±‚

### 7.1 GDPRåˆè§„

```python
class GDPRCompliance:
    def __init__(self, conn):
        self.conn = conn

    def delete_user_data(self, user_id: int):
        """åˆ é™¤ç”¨æˆ·æ•°æ®ï¼ˆGDPR Right to be Forgottenï¼‰"""
        cursor = self.conn.cursor()

        # è®°å½•åˆ é™¤æ“ä½œï¼ˆå®¡è®¡ï¼‰
        cursor.execute("""
            INSERT INTO audit_log (operation, table_name, user_id, timestamp)
            VALUES ('DELETE', 'users', ?, datetime('now'))
        """, (user_id,))

        # åˆ é™¤ç”¨æˆ·æ•°æ®
        cursor.execute("DELETE FROM users WHERE id = ?", (user_id,))
        cursor.execute("DELETE FROM user_sessions WHERE user_id = ?", (user_id,))

        self.conn.commit()

    def export_user_data(self, user_id: int) -> dict:
        """å¯¼å‡ºç”¨æˆ·æ•°æ®ï¼ˆGDPR Data Portabilityï¼‰"""
        cursor = self.conn.cursor()

        user_data = {}

        # å¯¼å‡ºç”¨æˆ·åŸºæœ¬ä¿¡æ¯
        cursor.execute("SELECT * FROM users WHERE id = ?", (user_id,))
        user_data['user'] = dict(cursor.fetchone())

        # å¯¼å‡ºç”¨æˆ·ä¼šè¯
        cursor.execute("SELECT * FROM user_sessions WHERE user_id = ?", (user_id,))
        user_data['sessions'] = [dict(row) for row in cursor.fetchall()]

        return user_data
```

### 7.2 æ•°æ®è„±æ•

```python
class DataMasking:
    @staticmethod
    def mask_email(email: str) -> str:
        """è„±æ•é‚®ç®±"""
        if '@' not in email:
            return email
        local, domain = email.split('@', 1)
        masked_local = local[0] + '*' * (len(local) - 2) + local[-1] if len(local) > 2 else '*'
        return f"{masked_local}@{domain}"

    @staticmethod
    def mask_phone(phone: str) -> str:
        """è„±æ•æ‰‹æœºå·"""
        if len(phone) < 4:
            return '*' * len(phone)
        return phone[:2] + '*' * (len(phone) - 4) + phone[-2:]

    @staticmethod
    def mask_id_card(id_card: str) -> str:
        """è„±æ•èº«ä»½è¯å·"""
        if len(id_card) < 8:
            return '*' * len(id_card)
        return id_card[:4] + '*' * (len(id_card) - 8) + id_card[-4:]

# ä½¿ç”¨ç¤ºä¾‹
masking = DataMasking()
masked_email = masking.mask_email('user@example.com')  # u**r@example.com
masked_phone = masking.mask_phone('13812345678')  # 13********78
```

---

## 8. ğŸ”— ç›¸å…³èµ„æº

### å†…éƒ¨èµ„æº

- [å®˜æ–¹æœ€ä½³å®è·µå¯¹é½æŒ‡å—](../09-æœ€æ–°ç‰¹æ€§/09.04-SQLiteå®˜æ–¹æœ€ä½³å®è·µå¯¹é½æŒ‡å—.md) - å®˜æ–¹å®‰å…¨å»ºè®®
- [é”™è¯¯å¤„ç†](./08.05-é”™è¯¯å¤„ç†.md) - é”™è¯¯å¤„ç†å’Œå®‰å…¨
- [å¤‡ä»½ä¸æ¢å¤](./08.14-SQLiteå¤‡ä»½ä¸æ¢å¤å®Œæ•´æŒ‡å—.md) - å¤‡ä»½åŠ å¯†

### å¤–éƒ¨èµ„æº

- [SQLiteå®‰å…¨é¡µé¢](https://www.sqlite.org/security.html) - å®˜æ–¹å®‰å…¨ä¿¡æ¯
- [SQLCipheræ–‡æ¡£](https://www.zetetic.net/sqlcipher/) - SQLCipherå®˜æ–¹æ–‡æ¡£
- [OWASP SQLæ³¨å…¥é˜²æŠ¤](https://owasp.org/www-community/attacks/SQL_Injection) - SQLæ³¨å…¥é˜²æŠ¤æŒ‡å—

---

## ğŸ”— äº¤å‰å¼•ç”¨

### ç¼–ç¨‹å®è·µæ–‡æ¡£

- â­â­â­ [å®˜æ–¹æœ€ä½³å®è·µå¯¹é½æŒ‡å—](../09-æœ€æ–°ç‰¹æ€§/09.04-SQLiteå®˜æ–¹æœ€ä½³å®è·µå¯¹é½æŒ‡å—.md) - å®˜æ–¹å®‰å…¨å»ºè®®
- â­â­ [é”™è¯¯å¤„ç†](./08.05-é”™è¯¯å¤„ç†.md) - é”™è¯¯å¤„ç†å’Œå®‰å…¨ï¼ˆå«äº¤å‰å¼•ç”¨ï¼‰
- â­â­ [å¤‡ä»½ä¸æ¢å¤](./08.14-SQLiteå¤‡ä»½ä¸æ¢å¤å®Œæ•´æŒ‡å—.md) - å¤‡ä»½åŠ å¯†ï¼ˆå«äº¤å‰å¼•ç”¨ï¼‰

### æ ¸å¿ƒæ¶æ„æ–‡æ¡£ ğŸ†•

- â­â­ [äº‹åŠ¡ä¸å¹¶å‘æ§åˆ¶](../01-æ ¸å¿ƒæ¶æ„/01.02-äº‹åŠ¡ä¸å¹¶å‘æ§åˆ¶.md) - äº‹åŠ¡å®‰å…¨åŸºç¡€
- â­â­ [å­˜å‚¨å¼•æ“](../01-æ ¸å¿ƒæ¶æ„/01.03-å­˜å‚¨å¼•æ“.md) - å­˜å‚¨å®‰å…¨åŸºç¡€

### çŸ¥è¯†å›¾è°±ä¸å¯¼èˆª ğŸ†•

- â­â­â­ [çŸ¥è¯†å›¾è°±ä¸æ¦‚å¿µå…³ç³»ç½‘ç»œ](../09-æœ€æ–°ç‰¹æ€§/09.03-SQLiteçŸ¥è¯†å›¾è°±ä¸æ¦‚å¿µå…³ç³»ç½‘ç»œ.md) - å®‰å…¨åŠ å¯†æ¦‚å¿µå…³ç³»ï¼ˆ400+æ¦‚å¿µï¼‰
- â­â­ [æ–‡æ¡£ä¾èµ–å…³ç³»å›¾](../00-é¡¹ç›®å¯¼èˆª/06-æ–‡æ¡£ä¾èµ–å…³ç³»å›¾.md) - å®‰å…¨åŠ å¯†æ–‡æ¡£ä¾èµ–
- â­â­ [æœ¯è¯­æ ‡å‡†åŒ–è¯å…¸](../00-é¡¹ç›®å¯¼èˆª/03-æœ¯è¯­è¯å…¸/SQLiteæœ¯è¯­æ ‡å‡†åŒ–è¯å…¸.md) - å®‰å…¨åŠ å¯†æœ¯è¯­ç´¢å¼•

### ç›¸å…³æ¦‚å¿µé“¾æ¥ ğŸ†•

#### å®‰å…¨åŠ å¯†æ¦‚å¿µ

- **å®‰å…¨åŠ å¯†** â†’ [çŸ¥è¯†å›¾è°±ï¼šå¼€å‘å®è·µæœ¬ä½“](../09-æœ€æ–°ç‰¹æ€§/09.03-SQLiteçŸ¥è¯†å›¾è°±ä¸æ¦‚å¿µå…³ç³»ç½‘ç»œ.md#å¼€å‘å®è·µæœ¬ä½“)
- **SQLæ³¨å…¥é˜²æŠ¤** â†’ [çŸ¥è¯†å›¾è°±ï¼šå®‰å…¨æ¦‚å¿µ](../09-æœ€æ–°ç‰¹æ€§/09.03-SQLiteçŸ¥è¯†å›¾è°±ä¸æ¦‚å¿µå…³ç³»ç½‘ç»œ.md#å¼€å‘å®è·µæœ¬ä½“)
- **SQLCipher** â†’ [çŸ¥è¯†å›¾è°±ï¼šåŠ å¯†æ¦‚å¿µ](../09-æœ€æ–°ç‰¹æ€§/09.03-SQLiteçŸ¥è¯†å›¾è°±ä¸æ¦‚å¿µå…³ç³»ç½‘ç»œ.md#å¼€å‘å®è·µæœ¬ä½“)

---

**æœ€åæ›´æ–°**: 2025-12-05
**ç»´æŠ¤è€…**: Data-Science Team
