# SQLite JavaScript/TypeScriptä½¿ç”¨æŒ‡å—

> **åˆ›å»ºæ—¥æœŸ**ï¼š2025-11-13
> **æœ€åæ›´æ–°**ï¼š2025-01-15
> **ç‰ˆæœ¬**ï¼šNode.js 14+ï¼ŒTypeScript 4.0+ï¼ŒSQLite 3.31+ è‡³ 3.47.x
> **é€‚ç”¨åº“**ï¼šbetter-sqlite3ã€sql.jsã€node-sqlite3

---

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›SQLiteåœ¨JavaScriptå’ŒTypeScriptä¸­çš„å®Œæ•´ä½¿ç”¨æŒ‡å—ï¼ŒåŒ…æ‹¬Node.jsç¯å¢ƒä¸‹çš„åŒæ­¥/å¼‚æ­¥åº“å’Œæµè§ˆå™¨ç¯å¢ƒä¸‹çš„WebAssemblyç‰ˆæœ¬ã€‚

---

## ğŸ“‘ ç›®å½•

- [SQLite JavaScript/TypeScriptä½¿ç”¨æŒ‡å—](#sqlite-javascripttypescriptä½¿ç”¨æŒ‡å—)
  - [ğŸ“‹ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [ğŸ“Š æ€ç»´å¯¼å›¾](#-æ€ç»´å¯¼å›¾)
  - [ä¸€ã€better-sqlite3ï¼ˆæ¨èï¼‰](#ä¸€better-sqlite3æ¨è)
    - [1.1 å®‰è£…å’ŒåŸºæœ¬ä½¿ç”¨](#11-å®‰è£…å’ŒåŸºæœ¬ä½¿ç”¨)
    - [1.2 åŸºæœ¬æ“ä½œ](#12-åŸºæœ¬æ“ä½œ)
    - [1.3 äº‹åŠ¡ç®¡ç†](#13-äº‹åŠ¡ç®¡ç†)
    - [1.4 é¢„ç¼–è¯‘è¯­å¥](#14-é¢„ç¼–è¯‘è¯­å¥)
    - [1.5 æ€§èƒ½ä¼˜åŒ–](#15-æ€§èƒ½ä¼˜åŒ–)
  - [äºŒã€node-sqlite3ï¼ˆå¼‚æ­¥ï¼‰](#äºŒnode-sqlite3å¼‚æ­¥)
    - [2.1 å®‰è£…å’Œè¿æ¥](#21-å®‰è£…å’Œè¿æ¥)
    - [2.2 å¼‚æ­¥æ“ä½œ](#22-å¼‚æ­¥æ“ä½œ)
    - [2.3 Promiseå°è£…](#23-promiseå°è£…)
  - [ä¸‰ã€sql.jsï¼ˆæµè§ˆå™¨/WebAssemblyï¼‰](#ä¸‰sqljsæµè§ˆå™¨webassembly)
    - [3.1 æµè§ˆå™¨ç¯å¢ƒä½¿ç”¨](#31-æµè§ˆå™¨ç¯å¢ƒä½¿ç”¨)
    - [3.2 æ–‡ä»¶æ“ä½œ](#32-æ–‡ä»¶æ“ä½œ)
    - [3.3 æ€§èƒ½è€ƒè™‘](#33-æ€§èƒ½è€ƒè™‘)
  - [å››ã€TypeScriptæ”¯æŒ](#å››typescriptæ”¯æŒ)
    - [4.1 better-sqlite3ç±»å‹å®šä¹‰](#41-better-sqlite3ç±»å‹å®šä¹‰)
    - [4.2 ç±»å‹å®‰å…¨æŸ¥è¯¢](#42-ç±»å‹å®‰å…¨æŸ¥è¯¢)
    - [4.3 è‡ªå®šä¹‰ç±»å‹](#43-è‡ªå®šä¹‰ç±»å‹)
  - [äº”ã€ORMæ¡†æ¶](#äº”ormæ¡†æ¶)
    - [5.1 TypeORM](#51-typeorm)
    - [5.2 Sequelize](#52-sequelize)
    - [5.3 Prisma](#53-prisma)
  - [å…­ã€JavaScript/TypeScriptåº“å¤šç»´å¯¹æ¯”çŸ©é˜µ](#å…­javascripttypescriptåº“å¤šç»´å¯¹æ¯”çŸ©é˜µ)
    - [6.1 JavaScript/TypeScript SQLiteåº“å¯¹æ¯”çŸ©é˜µ](#61-javascripttypescript-sqliteåº“å¯¹æ¯”çŸ©é˜µ)
    - [6.2 JavaScript/TypeScript ORMæ¡†æ¶å¯¹æ¯”çŸ©é˜µ](#62-javascripttypescript-ormæ¡†æ¶å¯¹æ¯”çŸ©é˜µ)
    - [6.3 JavaScript/TypeScriptä½¿ç”¨æ–¹å¼å¯¹æ¯”çŸ©é˜µ](#63-javascripttypescriptä½¿ç”¨æ–¹å¼å¯¹æ¯”çŸ©é˜µ)
  - [ä¸ƒã€æœ€ä½³å®è·µ](#ä¸ƒæœ€ä½³å®è·µ)
    - [7.1 è¿æ¥ç®¡ç†](#71-è¿æ¥ç®¡ç†)
    - [7.2 é”™è¯¯å¤„ç†](#72-é”™è¯¯å¤„ç†)
    - [7.3 æ€§èƒ½ä¼˜åŒ–](#73-æ€§èƒ½ä¼˜åŒ–)
  - [ğŸ”— ç›¸å…³èµ„æº](#-ç›¸å…³èµ„æº)
  - [ğŸ”— äº¤å‰å¼•ç”¨](#-äº¤å‰å¼•ç”¨)
    - [ç†è®ºæ¨¡å‹ ğŸ†•](#ç†è®ºæ¨¡å‹-)
    - [è®¾è®¡æ¨¡å‹ ğŸ†•](#è®¾è®¡æ¨¡å‹-)
  - [ğŸ“š å‚è€ƒèµ„æ–™](#-å‚è€ƒèµ„æ–™)

---

## ğŸ“Š æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((JavaScript/TypeScriptä½¿ç”¨æŒ‡å—))
    better-sqlite3æ¨è
      å®‰è£…å’ŒåŸºæœ¬ä½¿ç”¨
        npmå®‰è£…
        åŸºæœ¬è¿æ¥
        æ•°æ®åº“åˆ›å»º
      åŸºæœ¬æ“ä½œ
        CREATE TABLE
        INSERT UPDATE DELETE
        SELECTæŸ¥è¯¢
      äº‹åŠ¡ç®¡ç†
        äº‹åŠ¡å¼€å§‹
        äº‹åŠ¡æäº¤
        äº‹åŠ¡å›æ»š
      é¢„ç¼–è¯‘è¯­å¥
        prepareæ–¹æ³•
        å‚æ•°ç»‘å®š
        æ€§èƒ½ä¼˜åŒ–
      æ€§èƒ½ä¼˜åŒ–
        æ‰¹é‡æ“ä½œ
        ç´¢å¼•ä¼˜åŒ–
        WALæ¨¡å¼
    node-sqlite3å¼‚æ­¥
      å®‰è£…å’Œè¿æ¥
        npmå®‰è£…
        å¼‚æ­¥è¿æ¥
        å›è°ƒå‡½æ•°
      å¼‚æ­¥æ“ä½œ
        async/await
        Promiseå°è£…
        é”™è¯¯å¤„ç†
      Promiseå°è£…
        promisify
        å¼‚æ­¥æ¨¡å¼
        é”™è¯¯å¤„ç†
    sql.jsæµè§ˆå™¨WebAssembly
      æµè§ˆå™¨ç¯å¢ƒä½¿ç”¨
        WebAssembly
        å†…å­˜æ•°æ®åº“
        æ–‡ä»¶æ“ä½œ
      æ–‡ä»¶æ“ä½œ
        æ•°æ®åº“åŠ è½½
        æ•°æ®åº“ä¿å­˜
        æ–‡ä»¶ç³»ç»Ÿ
      æ€§èƒ½è€ƒè™‘
        å†…å­˜é™åˆ¶
        æ€§èƒ½ä¼˜åŒ–
        ä½¿ç”¨åœºæ™¯
    TypeScriptæ”¯æŒ
      better-sqlite3ç±»å‹å®šä¹‰
        ç±»å‹å®šä¹‰
        ç±»å‹å®‰å…¨
        IDEæ”¯æŒ
      ç±»å‹å®‰å…¨æŸ¥è¯¢
        æŸ¥è¯¢ç±»å‹
        ç»“æœç±»å‹
        ç±»å‹æ¨æ–­
      è‡ªå®šä¹‰ç±»å‹
        ç±»å‹æ‰©å±•
        ç±»å‹å®šä¹‰
        ç±»å‹å·¥å…·
    ORMæ¡†æ¶
      TypeORM
        TypeScriptåŸç”Ÿ
        è£…é¥°å™¨å®šä¹‰
        å…³ç³»æ˜ å°„
      Sequelize
        æˆç†Ÿæ¡†æ¶
        å¤šæ•°æ®åº“æ”¯æŒ
        è¿ç§»å·¥å…·
      Prisma
        ç±»å‹å®‰å…¨
        æŸ¥è¯¢æ„å»ºå™¨
        è¿ç§»å·¥å…·
    æœ€ä½³å®è·µ
      è¿æ¥ç®¡ç†
        å•è¿æ¥
        è¿æ¥å¤ç”¨
        èµ„æºé‡Šæ”¾
      é”™è¯¯å¤„ç†
        å¼‚å¸¸æ•è·
        é”™è¯¯æ¢å¤
        æ—¥å¿—è®°å½•
      æ€§èƒ½ä¼˜åŒ–
        æ‰¹é‡æ“ä½œ
        ç´¢å¼•ä¼˜åŒ–
        æŸ¥è¯¢ä¼˜åŒ–
```

---

## ä¸€ã€better-sqlite3ï¼ˆæ¨èï¼‰

`better-sqlite3`æ˜¯Node.jsç¯å¢ƒä¸‹æœ€æ¨èçš„SQLiteåº“ï¼Œæä¾›åŒæ­¥APIï¼Œæ€§èƒ½ä¼˜å¼‚ã€‚

### 1.1 å®‰è£…å’ŒåŸºæœ¬ä½¿ç”¨

**å®‰è£…**ï¼š

```bash
npm install better-sqlite3
# æˆ–
yarn add better-sqlite3
```

**åŸºæœ¬ä½¿ç”¨**ï¼š

```javascript
const Database = require('better-sqlite3');

// è¿æ¥åˆ°æ•°æ®åº“ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰
const db = new Database('example.db');

// åˆ›å»ºè¡¨
db.exec(`
    CREATE TABLE IF NOT EXISTS users (
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        name TEXT NOT NULL,
        email TEXT UNIQUE,
        age INTEGER,
        created_at TEXT DEFAULT (datetime('now'))
    )
`);

// å…³é—­è¿æ¥
db.close();
```

### 1.2 åŸºæœ¬æ“ä½œ

**æ’å…¥æ•°æ®**ï¼š

```javascript
const Database = require('better-sqlite3');
const db = new Database('example.db');

// æ’å…¥å•æ¡æ•°æ®
const insert = db.prepare('INSERT INTO users (name, email, age) VALUES (?, ?, ?)');
const info = insert.run('Alice', 'alice@example.com', 25);
console.log(`æ’å…¥æˆåŠŸï¼ŒID: ${info.lastInsertRowid}`);

// æ’å…¥å¤šæ¡æ•°æ®
const insertMany = db.prepare('INSERT INTO users (name, email, age) VALUES (?, ?, ?)');
const insertManyTransaction = db.transaction((users) => {
    for (const user of users) {
        insertMany.run(user.name, user.email, user.age);
    }
});

insertManyTransaction([
    { name: 'Bob', email: 'bob@example.com', age: 30 },
    { name: 'Charlie', email: 'charlie@example.com', age: 35 }
]);

db.close();
```

**æŸ¥è¯¢æ•°æ®**ï¼š

```javascript
const Database = require('better-sqlite3');
const db = new Database('example.db');

// æŸ¥è¯¢å•æ¡è®°å½•
const get = db.prepare('SELECT * FROM users WHERE id = ?');
const user = get.get(1);
console.log(user);

// æŸ¥è¯¢å¤šæ¡è®°å½•
const getAll = db.prepare('SELECT * FROM users WHERE age > ?');
const users = getAll.all(25);
users.forEach(user => {
    console.log(`${user.name} - ${user.email}`);
});

// æŸ¥è¯¢å•ä¸ªå€¼
const count = db.prepare('SELECT COUNT(*) as count FROM users');
const result = count.get();
console.log(`ç”¨æˆ·æ€»æ•°: ${result.count}`);

db.close();
```

**æ›´æ–°å’Œåˆ é™¤**ï¼š

```javascript
const Database = require('better-sqlite3');
const db = new Database('example.db');

// æ›´æ–°æ•°æ®
const update = db.prepare('UPDATE users SET age = ? WHERE id = ?');
const info = update.run(26, 1);
console.log(`æ›´æ–°äº† ${info.changes} è¡Œ`);

// åˆ é™¤æ•°æ®
const del = db.prepare('DELETE FROM users WHERE id = ?');
const info2 = del.run(2);
console.log(`åˆ é™¤äº† ${info2.changes} è¡Œ`);

db.close();
```

### 1.3 äº‹åŠ¡ç®¡ç†

**ä½¿ç”¨äº‹åŠ¡**ï¼š

```javascript
const Database = require('better-sqlite3');
const db = new Database('example.db');

// ç®€å•äº‹åŠ¡
const transfer = db.transaction((fromId, toId, amount) => {
    const updateFrom = db.prepare('UPDATE accounts SET balance = balance - ? WHERE id = ?');
    const updateTo = db.prepare('UPDATE accounts SET balance = balance + ? WHERE id = ?');

    updateFrom.run(amount, fromId);
    updateTo.run(amount, toId);
});

try {
    transfer(1, 2, 100);
    console.log('è½¬è´¦æˆåŠŸ');
} catch (error) {
    console.error('è½¬è´¦å¤±è´¥:', error);
}

// åµŒå¥—äº‹åŠ¡ï¼ˆä½¿ç”¨SAVEPOINTï¼‰
const nestedTransaction = db.transaction((operations) => {
    for (const op of operations) {
        const stmt = db.prepare(op.sql);
        stmt.run(...op.params);
    }
});

db.close();
```

### 1.4 é¢„ç¼–è¯‘è¯­å¥

**é¢„ç¼–è¯‘è¯­å¥æå‡æ€§èƒ½**ï¼š

```javascript
const Database = require('better-sqlite3');
const db = new Database('example.db');

// é¢„ç¼–è¯‘è¯­å¥å¯ä»¥é‡å¤ä½¿ç”¨
const getUser = db.prepare('SELECT * FROM users WHERE id = ?');
const getUsersByAge = db.prepare('SELECT * FROM users WHERE age > ? AND age < ?');

// å¤šæ¬¡ä½¿ç”¨
const user1 = getUser.get(1);
const user2 = getUser.get(2);

const youngUsers = getUsersByAge.all(20, 30);
const middleUsers = getUsersByAge.all(30, 40);

db.close();
```

### 1.5 æ€§èƒ½ä¼˜åŒ–

**æ‰¹é‡æ“ä½œä¼˜åŒ–**ï¼š

```javascript
const Database = require('better-sqlite3');
const db = new Database('example.db');

// å¯ç”¨WALæ¨¡å¼
db.pragma('journal_mode = WAL');
db.pragma('synchronous = NORMAL');
db.pragma('cache_size = -16000'); // 16MB

// æ‰¹é‡æ’å…¥
const insert = db.prepare('INSERT INTO users (name, email, age) VALUES (?, ?, ?)');
const insertMany = db.transaction((users) => {
    for (const user of users) {
        insert.run(user.name, user.email, user.age);
    }
});

const users = Array.from({ length: 10000 }, (_, i) => ({
    name: `User${i}`,
    email: `user${i}@example.com`,
    age: 20 + (i % 50)
}));

insertMany(users);

db.close();
```

---

## äºŒã€node-sqlite3ï¼ˆå¼‚æ­¥ï¼‰

`node-sqlite3`æä¾›å¼‚æ­¥APIï¼Œé€‚åˆéœ€è¦å¼‚æ­¥æ“ä½œçš„åœºæ™¯ã€‚

### 2.1 å®‰è£…å’Œè¿æ¥

**å®‰è£…**ï¼š

```bash
npm install sqlite3
```

**åŸºæœ¬è¿æ¥**ï¼š

```javascript
const sqlite3 = require('sqlite3').verbose();

// æ‰“å¼€æ•°æ®åº“
const db = new sqlite3.Database('example.db', (err) => {
    if (err) {
        console.error('æ‰“å¼€æ•°æ®åº“å¤±è´¥:', err.message);
    } else {
        console.log('æ•°æ®åº“è¿æ¥æˆåŠŸ');
    }
});

// å…³é—­æ•°æ®åº“
db.close((err) => {
    if (err) {
        console.error('å…³é—­æ•°æ®åº“å¤±è´¥:', err.message);
    } else {
        console.log('æ•°æ®åº“è¿æ¥å·²å…³é—­');
    }
});
```

### 2.2 å¼‚æ­¥æ“ä½œ

**å¼‚æ­¥CRUDæ“ä½œ**ï¼š

```javascript
const sqlite3 = require('sqlite3').verbose();
const db = new sqlite3.Database('example.db');

// åˆ›å»ºè¡¨
db.serialize(() => {
    db.run(`
        CREATE TABLE IF NOT EXISTS users (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            name TEXT NOT NULL,
            email TEXT UNIQUE,
            age INTEGER
        )
    `);

    // æ’å…¥æ•°æ®
    db.run('INSERT INTO users (name, email, age) VALUES (?, ?, ?)',
        ['Alice', 'alice@example.com', 25],
        function(err) {
            if (err) {
                console.error('æ’å…¥å¤±è´¥:', err.message);
            } else {
                console.log(`æ’å…¥æˆåŠŸï¼ŒID: ${this.lastID}`);
            }
        }
    );

    // æŸ¥è¯¢æ•°æ®
    db.all('SELECT * FROM users', [], (err, rows) => {
        if (err) {
            console.error('æŸ¥è¯¢å¤±è´¥:', err.message);
        } else {
            rows.forEach(row => {
                console.log(row);
            });
        }
    });

    // æŸ¥è¯¢å•æ¡
    db.get('SELECT * FROM users WHERE id = ?', [1], (err, row) => {
        if (err) {
            console.error('æŸ¥è¯¢å¤±è´¥:', err.message);
        } else {
            console.log(row);
        }
    });
});

db.close();
```

### 2.3 Promiseå°è£…

**ä½¿ç”¨Promiseå°è£…**ï¼š

```javascript
const sqlite3 = require('sqlite3').verbose();
const { open } = require('sqlite');
const { Database } = require('sqlite3');

async function main() {
    // ä½¿ç”¨sqliteåº“ï¼ˆåŸºäºsqlite3çš„Promiseå°è£…ï¼‰
    const db = await open({
        filename: 'example.db',
        driver: Database
    });

    // åˆ›å»ºè¡¨
    await db.exec(`
        CREATE TABLE IF NOT EXISTS users (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            name TEXT NOT NULL,
            email TEXT UNIQUE,
            age INTEGER
        )
    `);

    // æ’å…¥æ•°æ®
    await db.run('INSERT INTO users (name, email, age) VALUES (?, ?, ?)',
        ['Alice', 'alice@example.com', 25]
    );

    // æŸ¥è¯¢æ•°æ®
    const users = await db.all('SELECT * FROM users');
    console.log(users);

    // æŸ¥è¯¢å•æ¡
    const user = await db.get('SELECT * FROM users WHERE id = ?', [1]);
    console.log(user);

    await db.close();
}

main().catch(console.error);
```

---

## ä¸‰ã€sql.jsï¼ˆæµè§ˆå™¨/WebAssemblyï¼‰

`sql.js`æ˜¯SQLiteçš„WebAssemblyç‰ˆæœ¬ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚

### 3.1 æµè§ˆå™¨ç¯å¢ƒä½¿ç”¨

**åŸºæœ¬ä½¿ç”¨**ï¼š

```html
<!DOCTYPE html>
<html>
<head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
</head>
<body>
    <script>
        initSqlJs({
            locateFile: file => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${file}`
        }).then(SQL => {
            // åˆ›å»ºæ•°æ®åº“
            const db = new SQL.Database();

            // åˆ›å»ºè¡¨
            db.run(`
                CREATE TABLE users (
                    id INTEGER PRIMARY KEY AUTOINCREMENT,
                    name TEXT NOT NULL,
                    email TEXT UNIQUE,
                    age INTEGER
                )
            `);

            // æ’å…¥æ•°æ®
            db.run('INSERT INTO users (name, email, age) VALUES (?, ?, ?)',
                ['Alice', 'alice@example.com', 25]
            );

            // æŸ¥è¯¢æ•°æ®
            const result = db.exec('SELECT * FROM users');
            console.log(result);

            // å¯¼å‡ºæ•°æ®åº“
            const data = db.export();
            const buffer = Buffer.from(data);

            // å…³é—­æ•°æ®åº“
            db.close();
        });
    </script>
</body>
</html>
```

### 3.2 æ–‡ä»¶æ“ä½œ

**åŠ è½½å’Œä¿å­˜æ•°æ®åº“æ–‡ä»¶**ï¼š

```javascript
// åœ¨Node.jsç¯å¢ƒä¸­
const initSqlJs = require('sql.js');
const fs = require('fs');

async function main() {
    const SQL = await initSqlJs();

    // ä»æ–‡ä»¶åŠ è½½æ•°æ®åº“
    const buffer = fs.readFileSync('example.db');
    const db = new SQL.Database(buffer);

    // æ‰§è¡Œæ“ä½œ
    const result = db.exec('SELECT * FROM users');
    console.log(result);

    // ä¿å­˜æ•°æ®åº“
    const data = db.export();
    const buffer2 = Buffer.from(data);
    fs.writeFileSync('example_backup.db', buffer2);

    db.close();
}

main();
```

### 3.3 æ€§èƒ½è€ƒè™‘

**æ€§èƒ½ä¼˜åŒ–å»ºè®®**ï¼š

```javascript
// sql.jsæ€§èƒ½ä¼˜åŒ–
const SQL = await initSqlJs();

const db = new SQL.Database();

// ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥
const stmt = db.prepare('SELECT * FROM users WHERE age > ?');
stmt.bind([25]);
while (stmt.step()) {
    const row = stmt.getAsObject();
    console.log(row);
}
stmt.free();

// æ‰¹é‡æ“ä½œ
db.run('BEGIN TRANSACTION');
for (let i = 0; i < 1000; i++) {
    db.run('INSERT INTO users (name, age) VALUES (?, ?)', [`User${i}`, 20 + i]);
}
db.run('COMMIT');

db.close();
```

---

## å››ã€TypeScriptæ”¯æŒ

### 4.1 better-sqlite3ç±»å‹å®šä¹‰

**TypeScriptç±»å‹å®šä¹‰**ï¼š

```typescript
import Database from 'better-sqlite3';

interface User {
    id: number;
    name: string;
    email: string | null;
    age: number | null;
    created_at: string;
}

const db = new Database('example.db');

// ç±»å‹å®‰å…¨çš„æŸ¥è¯¢
const getUser = db.prepare<User, [number]>('SELECT * FROM users WHERE id = ?');
const user = getUser.get(1);
if (user) {
    console.log(user.name); // TypeScriptçŸ¥é“useræœ‰nameå±æ€§
}

// ç±»å‹å®‰å…¨çš„æ’å…¥
const insertUser = db.prepare<Database.RunResult, [string, string, number]>(
    'INSERT INTO users (name, email, age) VALUES (?, ?, ?)'
);
const result = insertUser.run('Alice', 'alice@example.com', 25);

db.close();
```

### 4.2 ç±»å‹å®‰å…¨æŸ¥è¯¢

**åˆ›å»ºç±»å‹å®‰å…¨çš„æŸ¥è¯¢å‡½æ•°**ï¼š

```typescript
import Database from 'better-sqlite3';

interface User {
    id: number;
    name: string;
    email: string | null;
    age: number | null;
}

class UserRepository {
    private db: Database.Database;

    constructor(db: Database.Database) {
        this.db = db;
    }

    findById(id: number): User | undefined {
        const stmt = this.db.prepare<User, [number]>(
            'SELECT * FROM users WHERE id = ?'
        );
        return stmt.get(id);
    }

    findByAge(minAge: number, maxAge: number): User[] {
        const stmt = this.db.prepare<User, [number, number]>(
            'SELECT * FROM users WHERE age > ? AND age < ?'
        );
        return stmt.all(minAge, maxAge);
    }

    create(user: Omit<User, 'id'>): number {
        const stmt = this.db.prepare<Database.RunResult, [string, string | null, number | null]>(
            'INSERT INTO users (name, email, age) VALUES (?, ?, ?)'
        );
        const result = stmt.run(user.name, user.email, user.age);
        return Number(result.lastInsertRowid);
    }
}

const db = new Database('example.db');
const userRepo = new UserRepository(db);

const user = userRepo.findById(1);
const users = userRepo.findByAge(20, 30);
const newUserId = userRepo.create({
    name: 'Bob',
    email: 'bob@example.com',
    age: 30
});

db.close();
```

### 4.3 è‡ªå®šä¹‰ç±»å‹

**ä½¿ç”¨æ³›å‹åˆ›å»ºç±»å‹å®‰å…¨çš„æ•°æ®åº“æ“ä½œ**ï¼š

```typescript
import Database from 'better-sqlite3';

class TypedDatabase<T> {
    private db: Database.Database;

    constructor(dbPath: string) {
        this.db = new Database(dbPath);
    }

    prepare<Params extends any[] = []>(
        sql: string
    ): Database.Statement<T, Params> {
        return this.db.prepare<T, Params>(sql);
    }

    transaction<Params extends any[], Return>(
        fn: (...args: Params) => Return
    ): (...args: Params) => Return {
        return this.db.transaction(fn);
    }

    close(): void {
        this.db.close();
    }
}

interface User {
    id: number;
    name: string;
    email: string;
}

const db = new TypedDatabase<User>('example.db');
const getUser = db.prepare<[number]>('SELECT * FROM users WHERE id = ?');
const user = getUser.get(1);

db.close();
```

---

## äº”ã€ORMæ¡†æ¶

### 5.1 TypeORM

**ä½¿ç”¨TypeORM**ï¼š

```typescript
import { DataSource, Entity, PrimaryGeneratedColumn, Column } from 'typeorm';

@Entity()
class User {
    @PrimaryGeneratedColumn()
    id: number;

    @Column()
    name: string;

    @Column({ unique: true })
    email: string;

    @Column({ nullable: true })
    age: number;
}

const AppDataSource = new DataSource({
    type: 'better-sqlite3',
    database: 'example.db',
    entities: [User],
    synchronize: true
});

AppDataSource.initialize().then(async () => {
    const userRepository = AppDataSource.getRepository(User);

    // åˆ›å»ºç”¨æˆ·
    const user = new User();
    user.name = 'Alice';
    user.email = 'alice@example.com';
    user.age = 25;
    await userRepository.save(user);

    // æŸ¥è¯¢ç”¨æˆ·
    const users = await userRepository.find();
    console.log(users);

    AppDataSource.destroy();
});
```

### 5.2 Sequelize

**ä½¿ç”¨Sequelize**ï¼š

```javascript
const { Sequelize, DataTypes } = require('sequelize');

const sequelize = new Sequelize({
    dialect: 'sqlite',
    storage: 'example.db'
});

const User = sequelize.define('User', {
    id: {
        type: DataTypes.INTEGER,
        primaryKey: true,
        autoIncrement: true
    },
    name: {
        type: DataTypes.STRING,
        allowNull: false
    },
    email: {
        type: DataTypes.STRING,
        unique: true
    },
    age: {
        type: DataTypes.INTEGER
    }
});

(async () => {
    await sequelize.sync();

    // åˆ›å»ºç”¨æˆ·
    const user = await User.create({
        name: 'Alice',
        email: 'alice@example.com',
        age: 25
    });

    // æŸ¥è¯¢ç”¨æˆ·
    const users = await User.findAll();
    console.log(users);

    await sequelize.close();
})();
```

### 5.3 Prisma

**ä½¿ç”¨Prisma**ï¼š

```prisma
// schema.prisma
datasource db {
    provider = "sqlite"
    url      = "file:./example.db"
}

model User {
    id        Int      @id @default(autoincrement())
    name      String
    email     String   @unique
    age       Int?
    createdAt DateTime @default(now())
}
```

```typescript
import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
    // åˆ›å»ºç”¨æˆ·
    const user = await prisma.user.create({
        data: {
            name: 'Alice',
            email: 'alice@example.com',
            age: 25
        }
    });

    // æŸ¥è¯¢ç”¨æˆ·
    const users = await prisma.user.findMany({
        where: {
            age: {
                gt: 20
            }
        }
    });

    console.log(users);
}

main()
    .catch(console.error)
    .finally(() => prisma.$disconnect());
```

---

## å…­ã€JavaScript/TypeScriptåº“å¤šç»´å¯¹æ¯”çŸ©é˜µ

### 6.1 JavaScript/TypeScript SQLiteåº“å¯¹æ¯”çŸ©é˜µ

| ç»´åº¦ | better-sqlite3 | node-sqlite3 | sql.js |
|------|---------------|--------------|--------|
| **ç±»å‹** | åŒæ­¥åº“ | å¼‚æ­¥åº“ | WebAssemblyåº“ |
| **è¿è¡Œç¯å¢ƒ** | Node.js | Node.js | æµè§ˆå™¨/Node.js |
| **æ€§èƒ½** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ |
| **æ˜“ç”¨æ€§** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ |
| **å¼‚æ­¥æ”¯æŒ** | âŒ | âœ… | âŒ |
| **TypeScriptæ”¯æŒ** | âœ… | âœ… | âœ… |
| **ç±»å‹å®‰å…¨** | â­â­â­â­ | â­â­â­ | â­â­â­ |
| **å­¦ä¹ æ›²çº¿** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ |
| **é€‚ç”¨åœºæ™¯** | Node.jsåº”ç”¨ï¼ˆæ¨èï¼‰ | å¼‚æ­¥Node.jsåº”ç”¨ | æµè§ˆå™¨åº”ç”¨ |
| **æ–‡æ¡£è´¨é‡** | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­ |
| **ç¤¾åŒºæ”¯æŒ** | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ |
| **å†…å­˜å ç”¨** | ä½ | ä¸­ | é«˜ï¼ˆWASMï¼‰ |

### 6.2 JavaScript/TypeScript ORMæ¡†æ¶å¯¹æ¯”çŸ©é˜µ

| ç»´åº¦ | TypeORM | Sequelize | Prisma |
|------|---------|-----------|--------|
| **ç±»å‹** | TypeScript ORM | JavaScript ORM | ç±»å‹å®‰å…¨ORM |
| **TypeScriptæ”¯æŒ** | â­â­â­â­â­ | â­â­â­ | â­â­â­â­â­ |
| **æ€§èƒ½** | â­â­â­â­ | â­â­â­ | â­â­â­â­ |
| **æ˜“ç”¨æ€§** | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ |
| **ä»£ç ç”Ÿæˆ** | âŒ | âŒ | âœ… |
| **è¿ç§»æ”¯æŒ** | âœ… | âœ… | âœ… |
| **æŸ¥è¯¢æ„å»ºå™¨** | âœ… | âœ… | âœ… |
| **å…³ç³»æ˜ å°„** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ |
| **å­¦ä¹ æ›²çº¿** | â­â­â­ | â­â­â­â­ | â­â­â­â­ |
| **é€‚ç”¨åœºæ™¯** | TypeScripté¡¹ç›® | JavaScripté¡¹ç›® | ç±»å‹å®‰å…¨é¡¹ç›® |

### 6.3 JavaScript/TypeScriptä½¿ç”¨æ–¹å¼å¯¹æ¯”çŸ©é˜µ

| ç»´åº¦ | åŸç”ŸSQL | ORM | æŸ¥è¯¢æ„å»ºå™¨ |
|------|---------|-----|-----------|
| **æ€§èƒ½** | â­â­â­â­â­ | â­â­â­ | â­â­â­â­ |
| **çµæ´»æ€§** | â­â­â­â­â­ | â­â­â­ | â­â­â­â­ |
| **å¼€å‘æ•ˆç‡** | â­â­â­ | â­â­â­â­â­ | â­â­â­â­ |
| **ç±»å‹å®‰å…¨** | â­â­ | â­â­â­â­ | â­â­â­ |
| **å­¦ä¹ æˆæœ¬** | â­â­â­â­ | â­â­â­ | â­â­â­ |
| **é€‚ç”¨åœºæ™¯** | ç®€å•æŸ¥è¯¢ã€æ€§èƒ½è¦æ±‚é«˜ | å¤æ‚åº”ç”¨ã€å¿«é€Ÿå¼€å‘ | ä¸­ç­‰å¤æ‚åº¦åº”ç”¨ |
| **ä»£ç å¯è¯»æ€§** | â­â­â­ | â­â­â­â­â­ | â­â­â­â­ |
| **ç»´æŠ¤æˆæœ¬** | â­â­â­ | â­â­â­â­ | â­â­â­â­ |

## ä¸ƒã€æœ€ä½³å®è·µ

### 7.1 è¿æ¥ç®¡ç†

**è¿æ¥ç®¡ç†æœ€ä½³å®è·µ**ï¼š

```typescript
import Database from 'better-sqlite3';

class DatabaseManager {
    private static instance: Database.Database | null = null;

    static getInstance(dbPath: string = 'example.db'): Database.Database {
        if (!this.instance) {
            this.instance = new Database(dbPath);
            this.instance.pragma('journal_mode = WAL');
            this.instance.pragma('foreign_keys = ON');
        }
        return this.instance;
    }

    static close(): void {
        if (this.instance) {
            this.instance.close();
            this.instance = null;
        }
    }
}

// ä½¿ç”¨
const db = DatabaseManager.getInstance();
// ... ä½¿ç”¨æ•°æ®åº“
DatabaseManager.close();
```

### 7.2 é”™è¯¯å¤„ç†

**å®Œå–„çš„é”™è¯¯å¤„ç†**ï¼š

```typescript
import Database from 'better-sqlite3';

function safeExecute<T>(
    db: Database.Database,
    sql: string,
    params: any[] = []
): T | null {
    try {
        const stmt = db.prepare(sql);
        if (sql.trim().toUpperCase().startsWith('SELECT')) {
            return stmt.all(...params) as T;
        } else {
            stmt.run(...params);
            return null;
        }
    } catch (error) {
        if (error instanceof Database.SqliteError) {
            console.error(`SQLiteé”™è¯¯ (${error.code}): ${error.message}`);
        } else {
            console.error('æœªçŸ¥é”™è¯¯:', error);
        }
        return null;
    }
}

const db = new Database('example.db');
const users = safeExecute<any[]>(db, 'SELECT * FROM users');
db.close();
```

### 7.3 æ€§èƒ½ä¼˜åŒ–

**æ€§èƒ½ä¼˜åŒ–å»ºè®®**ï¼š

```typescript
import Database from 'better-sqlite3';

const db = new Database('example.db');

// 1. å¯ç”¨WALæ¨¡å¼
db.pragma('journal_mode = WAL');
db.pragma('synchronous = NORMAL');

// 2. è®¾ç½®ç¼“å­˜å¤§å°
db.pragma('cache_size = -16000'); // 16MB

// 3. ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥
const insert = db.prepare('INSERT INTO users (name, email) VALUES (?, ?)');
const insertMany = db.transaction((users) => {
    for (const user of users) {
        insert.run(user.name, user.email);
    }
});

// 4. æ‰¹é‡æ“ä½œä½¿ç”¨äº‹åŠ¡
const users = Array.from({ length: 1000 }, (_, i) => ({
    name: `User${i}`,
    email: `user${i}@example.com`
}));
insertMany(users);

db.close();
```

---

## ğŸ”— ç›¸å…³èµ„æº

- [08.01 è¿æ¥ç®¡ç†](./08.01-è¿æ¥ç®¡ç†.md) - è¿æ¥ç®¡ç†æœ€ä½³å®è·µ
- [08.02 äº‹åŠ¡ç®¡ç†](./08.02-äº‹åŠ¡ç®¡ç†.md) - äº‹åŠ¡ç®¡ç†è¯¦è§£
- [08.03 æŸ¥è¯¢ä¼˜åŒ–](./08.03-æŸ¥è¯¢ä¼˜åŒ–.md) - æŸ¥è¯¢ä¼˜åŒ–æŠ€å·§
- [08.06 Pythonä½¿ç”¨æŒ‡å—](./08.06-Pythonä½¿ç”¨æŒ‡å—.md) - å…¶ä»–è¯­è¨€ä½¿ç”¨æŒ‡å—
- [08.08 Goä½¿ç”¨æŒ‡å—](./08.08-Goä½¿ç”¨æŒ‡å—.md) - å…¶ä»–è¯­è¨€ä½¿ç”¨æŒ‡å—
- [better-sqlite3æ–‡æ¡£](https://github.com/WiseLibs/better-sqlite3)
- [node-sqlite3æ–‡æ¡£](https://github.com/TryGhost/node-sqlite3)
- [sql.jsæ–‡æ¡£](https://github.com/sql-js/sql.js)

---

## ğŸ”— äº¤å‰å¼•ç”¨

### ç†è®ºæ¨¡å‹ ğŸ†•

- â­ [ç³»ç»Ÿç†è®ºæ¨¡å‹](../11-ç†è®ºæ¨¡å‹/11.01-ç³»ç»Ÿç†è®ºæ¨¡å‹.md) - ç¼–ç¨‹æ¥å£ç†è®º
- â­ [ç®—æ³•å¤æ‚åº¦ç†è®º](../11-ç†è®ºæ¨¡å‹/11.03-ç®—æ³•å¤æ‚åº¦ç†è®º.md) - JavaScript/TypeScriptæ“ä½œå¤æ‚åº¦

### è®¾è®¡æ¨¡å‹ ğŸ†•

- â­â­ [è®¾è®¡æ¨¡å¼](../12-è®¾è®¡æ¨¡å‹/12.03-è®¾è®¡æ¨¡å¼.md) - JavaScript/TypeScriptç¼–ç¨‹æ¨¡å¼
- â­ [è®¾è®¡åŸåˆ™](../12-è®¾è®¡æ¨¡å‹/12.02-è®¾è®¡åŸåˆ™.md) - JavaScript/TypeScriptç¼–ç¨‹åŸåˆ™

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [better-sqlite3 GitHub](https://github.com/WiseLibs/better-sqlite3)
- [node-sqlite3 GitHub](https://github.com/TryGhost/node-sqlite3)
- [sql.js GitHub](https://github.com/sql-js/sql.js)
- [TypeORMæ–‡æ¡£](https://typeorm.io/)
- [Prismaæ–‡æ¡£](https://www.prisma.io/)

---

**æœ€åæ›´æ–°**ï¼š2025-01-15
**ç»´æŠ¤è€…**ï¼šData-Science Team
