# æ€§èƒ½ç‰¹å¾åˆ†æï¼šé›¶IPCå¼€é”€ä¸è¯»è·¯å¾„ä¼˜åŒ–

> **åˆ›å»ºæ—¥æœŸ**ï¼š2025-11-13
> **æœ€åæ›´æ–°**ï¼š2025-11-13
> **ç‰ˆæœ¬**ï¼šSQLite 3.31+ è‡³ 3.47+

---

## ğŸ“‹ æ¦‚è¿°

SQLiteçš„æ€§èƒ½ç‰¹å¾æºäºå…¶åµŒå…¥å¼æ¶æ„å’Œé›¶IPCå¼€é”€è®¾è®¡ã€‚
æœ¬æ–‡æ¡£æ·±å…¥è§£æSQLiteçš„æ€§èƒ½ç‰¹å¾ã€è¯»è·¯å¾„ä¼˜åŒ–å’Œæ€§èƒ½é™·é˜±ã€‚

---

## ğŸ“‘ ç›®å½•

- [æ€§èƒ½ç‰¹å¾åˆ†æï¼šé›¶IPCå¼€é”€ä¸è¯»è·¯å¾„ä¼˜åŒ–](#æ€§èƒ½ç‰¹å¾åˆ†æé›¶ipcå¼€é”€ä¸è¯»è·¯å¾„ä¼˜åŒ–)
  - [ğŸ“‹ æ¦‚è¿°](#-æ¦‚è¿°)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [ğŸ“Š æ€ç»´å¯¼å›¾](#-æ€ç»´å¯¼å›¾)
  - [ğŸ“Š å¤šç»´æ¦‚å¿µçŸ©é˜µå¯¹æ¯”](#-å¤šç»´æ¦‚å¿µçŸ©é˜µå¯¹æ¯”)
  - [ğŸŒ Wikipediaå¯¹é½](#-wikipediaå¯¹é½)
  - [ä¸€ã€é›¶IPCå¼€é”€æ¶æ„](#ä¸€é›¶ipcå¼€é”€æ¶æ„)
    - [1.1 è¿›ç¨‹å†…è°ƒç”¨ä¼˜åŠ¿](#11-è¿›ç¨‹å†…è°ƒç”¨ä¼˜åŠ¿)
    - [1.2 æ— ç½‘ç»œåè®®å¼€é”€](#12-æ— ç½‘ç»œåè®®å¼€é”€)
    - [1.3 æ€§èƒ½å¯¹æ¯”åˆ†æ](#13-æ€§èƒ½å¯¹æ¯”åˆ†æ)
  - [äºŒã€è¯»è·¯å¾„ä¼˜åŒ–](#äºŒè¯»è·¯å¾„ä¼˜åŒ–)
    - [2.1 è¦†ç›–ç´¢å¼•ä¼˜åŒ–](#21-è¦†ç›–ç´¢å¼•ä¼˜åŒ–)
    - [2.2 æŸ¥è¯¢ç¼“å­˜æœºåˆ¶](#22-æŸ¥è¯¢ç¼“å­˜æœºåˆ¶)
    - [2.3 åªè¯»æ¨¡å¼ä¼˜åŒ–](#23-åªè¯»æ¨¡å¼ä¼˜åŒ–)
  - [ä¸‰ã€å†™è·¯å¾„ä¼˜åŒ–](#ä¸‰å†™è·¯å¾„ä¼˜åŒ–)
    - [3.1 WALæ¨¡å¼å†™ä¼˜åŒ–](#31-walæ¨¡å¼å†™ä¼˜åŒ–)
    - [3.2 æ‰¹é‡äº‹åŠ¡ä¼˜åŒ–](#32-æ‰¹é‡äº‹åŠ¡ä¼˜åŒ–)
    - [3.3 é¢„å†™æ—¥å¿—ä¼˜åŒ–](#33-é¢„å†™æ—¥å¿—ä¼˜åŒ–)
  - [å››ã€æ€§èƒ½é™·é˜±](#å››æ€§èƒ½é™·é˜±)
    - [4.1 åŒæ­¥æ¨¡å¼é™·é˜±](#41-åŒæ­¥æ¨¡å¼é™·é˜±)
    - [4.2 ç´¢å¼•è†¨èƒ€é™·é˜±](#42-ç´¢å¼•è†¨èƒ€é™·é˜±)
    - [4.3 æŸ¥è¯¢è®¡åˆ’é€€åŒ–](#43-æŸ¥è¯¢è®¡åˆ’é€€åŒ–)
    - [4.4 å†™å†²çªé™·é˜±](#44-å†™å†²çªé™·é˜±)
  - [äº”ã€æ€§èƒ½åŸºå‡†æµ‹è¯•](#äº”æ€§èƒ½åŸºå‡†æµ‹è¯•)
    - [5.1 è¯»æ€§èƒ½æµ‹è¯•](#51-è¯»æ€§èƒ½æµ‹è¯•)
    - [5.2 å†™æ€§èƒ½æµ‹è¯•](#52-å†™æ€§èƒ½æµ‹è¯•)
    - [5.3 å¹¶å‘æ€§èƒ½æµ‹è¯•](#53-å¹¶å‘æ€§èƒ½æµ‹è¯•)
  - [å…­ã€æ€§èƒ½ç‰¹å¾æ€»ç»“](#å…­æ€§èƒ½ç‰¹å¾æ€»ç»“)
    - [6.1 ä¼˜åŠ¿ç‰¹å¾](#61-ä¼˜åŠ¿ç‰¹å¾)
    - [6.2 åŠ£åŠ¿ç‰¹å¾](#62-åŠ£åŠ¿ç‰¹å¾)
    - [6.3 é€‚ç”¨åœºæ™¯](#63-é€‚ç”¨åœºæ™¯)
  - [ä¸ƒã€å½¢å¼è¯æ˜ä¸ç†è®ºè®ºè¯](#ä¸ƒå½¢å¼è¯æ˜ä¸ç†è®ºè®ºè¯)
    - [7.1 é›¶IPCå¼€é”€æ€§èƒ½ä¼˜åŠ¿è¯æ˜](#71-é›¶ipcå¼€é”€æ€§èƒ½ä¼˜åŠ¿è¯æ˜)
    - [7.2 è¦†ç›–ç´¢å¼•ä¼˜åŒ–è¯æ˜](#72-è¦†ç›–ç´¢å¼•ä¼˜åŒ–è¯æ˜)
    - [7.3 WALæ¨¡å¼æ€§èƒ½æå‡è¯æ˜](#73-walæ¨¡å¼æ€§èƒ½æå‡è¯æ˜)
  - [å…«ã€Wikipediaå¯¹é½](#å…«wikipediaå¯¹é½)
  - [ğŸ”— ç›¸å…³èµ„æº](#-ç›¸å…³èµ„æº)
  - [ğŸ“š å‚è€ƒèµ„æ–™](#-å‚è€ƒèµ„æ–™)

---

## ğŸ“Š æ€ç»´å¯¼å›¾

```mermaid
mindmap
  root((æ€§èƒ½ç‰¹å¾åˆ†æ))
    é›¶IPCå¼€é”€æ¶æ„
      è¿›ç¨‹å†…è°ƒç”¨
        å‡½æ•°è°ƒç”¨
        æ— ç½‘ç»œå»¶è¿Ÿ
        ä½å»¶è¿Ÿä¼˜åŠ¿
      æ— ç½‘ç»œåè®®
        æ— åè®®è§£æ
        æ— åºåˆ—åŒ–å¼€é”€
        æ€§èƒ½æå‡
      æ€§èƒ½å¯¹æ¯”
        å»¶è¿Ÿå¯¹æ¯”
        ååé‡å¯¹æ¯”
        å¼€é”€åˆ†æ
    è¯»è·¯å¾„ä¼˜åŒ–
      è¦†ç›–ç´¢å¼•
        ç´¢å¼•æ‰«æ
        é¿å…å›è¡¨
        æ€§èƒ½æå‡
      æŸ¥è¯¢ç¼“å­˜
        ç¼–è¯‘ç¼“å­˜
        ç»“æœç¼“å­˜
        ç¼“å­˜å‘½ä¸­
      åªè¯»æ¨¡å¼
        æ— é”è¯»å–
        æ€§èƒ½ä¼˜åŒ–
    å†™è·¯å¾„ä¼˜åŒ–
      WALæ¨¡å¼
        å†™ä¼˜åŒ–
        å¹¶å‘æå‡
        æ€§èƒ½æå‡
      æ‰¹é‡äº‹åŠ¡
        æ‰¹é‡æ’å…¥
        æ‰¹é‡æ›´æ–°
        äº‹åŠ¡ä¼˜åŒ–
      é¢„å†™æ—¥å¿—
        æ—¥å¿—ä¼˜åŒ–
        æ¢å¤ä¼˜åŒ–
    æ€§èƒ½é™·é˜±
      åŒæ­¥æ¨¡å¼
        åŒæ­¥å¼€é”€
        æ€§èƒ½ä¸‹é™
      ç´¢å¼•è†¨èƒ€
        ç´¢å¼•ç»´æŠ¤
        ç©ºé—´æµªè´¹
      æŸ¥è¯¢è®¡åˆ’é€€åŒ–
        è®¡åˆ’é€‰æ‹©
        æ€§èƒ½ä¸‹é™
      å†™å†²çª
        é”ç«äº‰
        æ€§èƒ½ä¸‹é™
    æ€§èƒ½åŸºå‡†
      è¯»æ€§èƒ½æµ‹è¯•
        ç®€å•æŸ¥è¯¢
        å¤æ‚æŸ¥è¯¢
        å¹¶å‘è¯»å–
      å†™æ€§èƒ½æµ‹è¯•
        å•æ¡å†™å…¥
        æ‰¹é‡å†™å…¥
        å¹¶å‘å†™å…¥
      å¹¶å‘æ€§èƒ½æµ‹è¯•
        è¯»å†™æ··åˆ
        å¹¶å‘åº¦æµ‹è¯•
```

---

## ğŸ“Š å¤šç»´æ¦‚å¿µçŸ©é˜µå¯¹æ¯”

### æ¶æ„ç±»å‹æ€§èƒ½å¯¹æ¯”çŸ©é˜µ

| æ¶æ„ç±»å‹ | å»¶è¿Ÿ | ååé‡ | å¹¶å‘æ€§ | å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ | SQLiteæ”¯æŒ |
|---------|------|--------|--------|--------|---------|-----------|
| **åµŒå…¥å¼æ¶æ„** | æä½ | é«˜ | ä¸­ | ä½ | å•æœºåº”ç”¨ | âœ… SQLite |
| **C/Sæ¶æ„** | ä¸­ | ä¸­ | é«˜ | ä¸­ | åˆ†å¸ƒå¼åº”ç”¨ | âŒ ä¸æ”¯æŒ |
| **é›†ç¾¤æ¶æ„** | ä¸­ | å¾ˆé«˜ | å¾ˆé«˜ | é«˜ | å¤§è§„æ¨¡åº”ç”¨ | âŒ ä¸æ”¯æŒ |

### è¯»è·¯å¾„ä¼˜åŒ–ç­–ç•¥å¯¹æ¯”çŸ©é˜µ

| ä¼˜åŒ–ç­–ç•¥ | æ€§èƒ½æå‡ | ç©ºé—´å¼€é”€ | å®ç°å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ | SQLiteæ”¯æŒ |
|---------|---------|---------|-----------|---------|-----------|
| **è¦†ç›–ç´¢å¼•** | é«˜ | ä¸­ | ä½ | æŸ¥è¯¢ä¼˜åŒ– | âœ… æ”¯æŒ |
| **æŸ¥è¯¢ç¼“å­˜** | ä¸­ | ä½ | ä½ | é‡å¤æŸ¥è¯¢ | âœ… æ”¯æŒ |
| **åªè¯»æ¨¡å¼** | ä¸­ | æ—  | ä½ | åªè¯»åœºæ™¯ | âœ… æ”¯æŒ |
| **é¢„ç¼–è¯‘è¯­å¥** | é«˜ | æ—  | ä½ | é‡å¤æŸ¥è¯¢ | âœ… æ”¯æŒ |

### å†™è·¯å¾„ä¼˜åŒ–ç­–ç•¥å¯¹æ¯”çŸ©é˜µ

| ä¼˜åŒ–ç­–ç•¥ | æ€§èƒ½æå‡ | ä¸€è‡´æ€§ | å¤æ‚åº¦ | é€‚ç”¨åœºæ™¯ | SQLiteæ”¯æŒ |
|---------|---------|--------|--------|---------|-----------|
| **WALæ¨¡å¼** | é«˜ | å¼ºä¸€è‡´æ€§ | ä¸­ | é«˜å¹¶å‘å†™ | âœ… æ”¯æŒ |
| **æ‰¹é‡äº‹åŠ¡** | å¾ˆé«˜ | å¼ºä¸€è‡´æ€§ | ä½ | æ‰¹é‡æ“ä½œ | âœ… æ”¯æŒ |
| **å¼‚æ­¥å†™å…¥** | é«˜ | æœ€ç»ˆä¸€è‡´æ€§ | ä¸­ | æ€§èƒ½ä¼˜å…ˆ | âš ï¸ æœ‰é™æ”¯æŒ |
| **å»¶è¿ŸåŒæ­¥** | ä¸­ | å¼±ä¸€è‡´æ€§ | ä½ | æ€§èƒ½ä¼˜å…ˆ | âœ… PRAGMAé…ç½® |

---

## ğŸŒ Wikipediaå¯¹é½

### åµŒå…¥å¼æ•°æ®åº“æ¦‚å¿µå¯¹é½

**Wikipediaå®šä¹‰**: [Embedded database](https://en.wikipedia.org/wiki/Embedded_database)

> An embedded database system is a database management system (DBMS) which is tightly integrated with an application software that requires access to stored data, such that the database system is "hidden" from the application's end-user and requires little or no ongoing administration.

**å¯¹é½è¯´æ˜**:
- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒåµŒå…¥å¼æ•°æ®åº“æ˜¯ä¸åº”ç”¨ç¨‹åºç´§å¯†é›†æˆçš„æ•°æ®åº“ç³»ç»Ÿ
- âœ… **æ ¸å¿ƒç‰¹æ€§**: éƒ½æåˆ°é›¶é…ç½®ã€è¿›ç¨‹å†…è°ƒç”¨ã€ä½å»¶è¿Ÿç­‰æ ¸å¿ƒç‰¹æ€§
- âœ… **åº”ç”¨åœºæ™¯**: éƒ½æåˆ°ç§»åŠ¨åº”ç”¨ã€æ¡Œé¢åº”ç”¨ã€åµŒå…¥å¼ç³»ç»Ÿç­‰åº”ç”¨åœºæ™¯

### æ€§èƒ½ä¼˜åŒ–æ¦‚å¿µå¯¹é½

**Wikipediaå®šä¹‰**: [Database tuning](https://en.wikipedia.org/wiki/Database_tuning)

> Database tuning describes a group of activities used to optimize and homogenize the performance of a database.

**å¯¹é½è¯´æ˜**:
- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒæ•°æ®åº“è°ƒä¼˜æ˜¯ä¼˜åŒ–æ•°æ®åº“æ€§èƒ½çš„æ´»åŠ¨
- âœ… **ä¼˜åŒ–æ–¹æ³•**: éƒ½æåˆ°ç´¢å¼•ä¼˜åŒ–ã€æŸ¥è¯¢ä¼˜åŒ–ã€é…ç½®ä¼˜åŒ–ç­‰æ–¹æ³•
- âœ… **æ€§èƒ½æŒ‡æ ‡**: éƒ½æåˆ°å»¶è¿Ÿã€ååé‡ã€å¹¶å‘æ€§ç­‰æ€§èƒ½æŒ‡æ ‡

### SQLiteæ€§èƒ½ç‰¹å¾å¯¹é½

- **Wikipediaå®šä¹‰**: [SQLite](https://en.wikipedia.org/wiki/SQLite)

> SQLite is a database engine written in the C programming language. It is not a standalone app; rather, it is a library that software developers embed in their apps.

**å¯¹é½è¯´æ˜**:
- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒSQLiteæ˜¯åµŒå…¥å¼çš„æ•°æ®åº“å¼•æ“
- âœ… **æ ¸å¿ƒç‰¹æ€§**: éƒ½æåˆ°é›¶é…ç½®ã€æœåŠ¡å™¨æ— å…³ã€è‡ªåŒ…å«ç­‰æ ¸å¿ƒç‰¹æ€§
- âœ… **æ€§èƒ½ä¼˜åŠ¿**: éƒ½æåˆ°ä½å»¶è¿Ÿã€é«˜ååé‡ç­‰æ€§èƒ½ä¼˜åŠ¿

---

## ä¸€ã€é›¶IPCå¼€é”€æ¶æ„

### 1.1 è¿›ç¨‹å†…è°ƒç”¨ä¼˜åŠ¿

**å®šä¹‰**ï¼šSQLiteä½œä¸ºCåº“ç›´æ¥åµŒå…¥åº”ç”¨ç¨‹åºï¼Œæ‰€æœ‰æ“ä½œåœ¨è¿›ç¨‹å†…å®Œæˆï¼Œæ— éœ€è¿›ç¨‹é—´é€šä¿¡ï¼ˆIPCï¼‰ã€‚

**æ€§èƒ½ä¼˜åŠ¿**ï¼š

```text
ä¼ ç»ŸC/Sæ¶æ„ï¼š
åº”ç”¨ â†’ ç½‘ç»œåè®® â†’ æ•°æ®åº“æœåŠ¡å™¨ â†’ ç£ç›˜
å»¶è¿Ÿï¼š~1-10msï¼ˆç½‘ç»œå¾€è¿”ï¼‰

SQLiteæ¶æ„ï¼š
åº”ç”¨ â†’ SQLiteåº“ â†’ ç£ç›˜
å»¶è¿Ÿï¼š~0.01-0.1msï¼ˆå‡½æ•°è°ƒç”¨ï¼‰
```

**æ€§èƒ½æå‡**ï¼š10-100å€å»¶è¿Ÿé™ä½

### 1.2 æ— ç½‘ç»œåè®®å¼€é”€

**ç½‘ç»œåè®®å¼€é”€å¯¹æ¯”**ï¼š

| æ“ä½œ | C/Sæ¶æ„ | SQLite | æ€§èƒ½æå‡ |
|------|---------|--------|---------|
| ç®€å•æŸ¥è¯¢ | ~2ms | ~0.02ms | 100å€ |
| æ‰¹é‡æ’å…¥ | ~50ms | ~5ms | 10å€ |
| äº‹åŠ¡æäº¤ | ~10ms | ~1ms | 10å€ |

**å¼€é”€åˆ†è§£**ï¼š

```text
C/Sæ¶æ„å¼€é”€ï¼š
- ç½‘ç»œå¾€è¿”ï¼š1-5ms
- åè®®è§£æï¼š0.1-0.5ms
- æ•°æ®åºåˆ—åŒ–ï¼š0.1-0.5ms
- æ€»è®¡ï¼š1.2-6ms

SQLiteå¼€é”€ï¼š
- å‡½æ•°è°ƒç”¨ï¼š<0.01ms
- æ€»è®¡ï¼š<0.01ms
```

### 1.3 æ€§èƒ½å¯¹æ¯”åˆ†æ

**ç®€å•æŸ¥è¯¢æ€§èƒ½**ï¼š

```python
# æµ‹è¯•ï¼š1000æ¬¡ç®€å•æŸ¥è¯¢
# PostgreSQLï¼ˆç½‘ç»œï¼‰
# è€—æ—¶ï¼š~2000msï¼ˆ2ms/æ¬¡ï¼‰

# SQLiteï¼ˆè¿›ç¨‹å†…ï¼‰
# è€—æ—¶ï¼š~20msï¼ˆ0.02ms/æ¬¡ï¼‰
# æ€§èƒ½æå‡ï¼š100å€
```

**æ‰¹é‡æ’å…¥æ€§èƒ½**ï¼š

```python
# æµ‹è¯•ï¼šæ’å…¥10000æ¡è®°å½•
# PostgreSQLï¼ˆç½‘ç»œï¼‰
# è€—æ—¶ï¼š~5000ms

# SQLiteï¼ˆè¿›ç¨‹å†…ï¼Œæ‰¹é‡äº‹åŠ¡ï¼‰
# è€—æ—¶ï¼š~50ms
# æ€§èƒ½æå‡ï¼š100å€
```

---

## äºŒã€è¯»è·¯å¾„ä¼˜åŒ–

### 2.1 è¦†ç›–ç´¢å¼•ä¼˜åŒ–

**è¦†ç›–ç´¢å¼•å®šä¹‰**ï¼šç´¢å¼•åŒ…å«æŸ¥è¯¢æ‰€éœ€çš„æ‰€æœ‰åˆ—ï¼Œæ— éœ€å›è¡¨æŸ¥è¯¢ã€‚

**æ€§èƒ½æå‡**ï¼š

```sql
-- æŸ¥è¯¢ï¼šåªéœ€è¦user_idå’Œstatus
SELECT user_id, status FROM orders WHERE user_id = 123;

-- æ™®é€šç´¢å¼•ï¼ˆéœ€è¦å›è¡¨ï¼‰
CREATE INDEX idx_user_id ON orders(user_id);
-- æ‰§è¡Œè®¡åˆ’ï¼šSEARCH orders USING INDEX idx_user_id + å›è¡¨
-- è€—æ—¶ï¼š~0.5ms

-- è¦†ç›–ç´¢å¼•ï¼ˆæ— éœ€å›è¡¨ï¼‰
CREATE INDEX idx_covering ON orders(user_id, status);
-- æ‰§è¡Œè®¡åˆ’ï¼šSEARCH orders USING COVERING INDEX idx_covering
-- è€—æ—¶ï¼š~0.1ms
-- æ€§èƒ½æå‡ï¼š5å€
```

### 2.2 æŸ¥è¯¢ç¼“å­˜æœºåˆ¶

**é¢„ç¼–è¯‘è¯­å¥ç¼“å­˜**ï¼š

```c
// ç¬¬ä¸€æ¬¡ï¼šç¼–è¯‘SQL
sqlite3_prepare_v2(db, "SELECT * FROM users WHERE id = ?", -1, &stmt, NULL);
// è€—æ—¶ï¼š~0.1msï¼ˆè§£æå’Œä¼˜åŒ–ï¼‰

// åç»­ï¼šé‡ç”¨é¢„ç¼–è¯‘è¯­å¥
sqlite3_reset(stmt);
sqlite3_bind_int(stmt, 1, 123);
sqlite3_step(stmt);
// è€—æ—¶ï¼š~0.01msï¼ˆæ— éœ€é‡æ–°è§£æï¼‰
// æ€§èƒ½æå‡ï¼š10å€
```

### 2.3 åªè¯»æ¨¡å¼ä¼˜åŒ–

**åªè¯»æ¨¡å¼é…ç½®**ï¼š

```sql
-- å¯ç”¨åªè¯»æ¨¡å¼
PRAGMA query_only=ON;
```

**æ€§èƒ½æå‡**ï¼š

- è·³è¿‡å†™é”æ£€æŸ¥
- å‡å°‘å†…å­˜åˆ†é…
- æå‡æŸ¥è¯¢æ€§èƒ½çº¦10-20%

---

## ä¸‰ã€å†™è·¯å¾„ä¼˜åŒ–

### 3.1 WALæ¨¡å¼å†™ä¼˜åŒ–

**WALæ¨¡å¼ä¼˜åŠ¿**ï¼š

```text
DELETEæ¨¡å¼ï¼š
1. å†™å…¥æ—¥å¿—é¡µ â†’ fsync
2. æ›´æ–°æ•°æ®é¡µ â†’ fsync
æ€»è€—æ—¶ï¼š~2-5ms

WALæ¨¡å¼ï¼š
1. è¿½åŠ åˆ°WALæ–‡ä»¶ â†’ fsync
æ€»è€—æ—¶ï¼š~1-2ms
æ€§èƒ½æå‡ï¼š2-3å€
```

### 3.2 æ‰¹é‡äº‹åŠ¡ä¼˜åŒ–

**æ‰¹é‡æ’å…¥æ€§èƒ½**ï¼š

```python
# æ–¹å¼1ï¼šæ¯æ¡æ’å…¥ä¸€ä¸ªäº‹åŠ¡ï¼ˆæ…¢ï¼‰
for item in items:
    cursor.execute('INSERT INTO orders ...', item)
    conn.commit()
# è€—æ—¶ï¼š~5000msï¼ˆ1000æ¡ï¼‰

# æ–¹å¼2ï¼šæ‰¹é‡æ’å…¥ä¸€ä¸ªäº‹åŠ¡ï¼ˆå¿«ï¼‰
conn.execute('BEGIN')
cursor.executemany('INSERT INTO orders ...', items)
conn.commit()
# è€—æ—¶ï¼š~50msï¼ˆ1000æ¡ï¼‰
# æ€§èƒ½æå‡ï¼š100å€
```

### 3.3 é¢„å†™æ—¥å¿—ä¼˜åŒ–

**WAL Checkpointä¼˜åŒ–**ï¼š

```sql
-- è‡ªåŠ¨Checkpointï¼ˆåå°æ‰§è¡Œï¼Œä¸é˜»å¡ï¼‰
PRAGMA wal_autocheckpoint=1000;

-- æ‰‹åŠ¨Checkpointï¼ˆéœ€è¦æ—¶æ‰§è¡Œï¼‰
PRAGMA wal_checkpoint(TRUNCATE);
```

---

## å››ã€æ€§èƒ½é™·é˜±

### 4.1 åŒæ­¥æ¨¡å¼é™·é˜±

**é—®é¢˜**ï¼š`PRAGMA synchronous=FULL`å¯¼è‡´æ€§èƒ½ä¸‹é™

**æ€§èƒ½å¯¹æ¯”**ï¼š

| åŒæ­¥æ¨¡å¼ | å†™å…¥æ€§èƒ½ | å®‰å…¨æ€§ |
|---------|---------|--------|
| FULL | åŸºå‡†ï¼ˆæ…¢ï¼‰ | æœ€é«˜ |
| NORMAL | 2-3å€æå‡ | é«˜ï¼ˆæ¨èï¼‰ |
| OFF | 5-10å€æå‡ | ä½ï¼ˆä¸æ¨èï¼‰ |

**æ¨èé…ç½®**ï¼š

```sql
-- ç”Ÿäº§ç¯å¢ƒï¼šNORMALï¼ˆå¹³è¡¡æ€§èƒ½å’Œå®‰å…¨ï¼‰
PRAGMA synchronous=NORMAL;
```

### 4.2 ç´¢å¼•è†¨èƒ€é™·é˜±

**é—®é¢˜**ï¼šè¿‡å¤šç´¢å¼•å¯¼è‡´å†™å…¥æ€§èƒ½ä¸‹é™

**æ€§èƒ½å½±å“**ï¼š

```text
æ— ç´¢å¼•ï¼šæ’å…¥1000æ¡ ~10ms
1ä¸ªç´¢å¼•ï¼šæ’å…¥1000æ¡ ~20ms
5ä¸ªç´¢å¼•ï¼šæ’å…¥1000æ¡ ~100ms
10ä¸ªç´¢å¼•ï¼šæ’å…¥1000æ¡ ~200ms
```

**è§£å†³æ–¹æ¡ˆ**ï¼š

- åªåˆ›å»ºå¿…è¦çš„ç´¢å¼•
- ä½¿ç”¨éƒ¨åˆ†ç´¢å¼•
- å®šæœŸæ¸…ç†æœªä½¿ç”¨çš„ç´¢å¼•

### 4.3 æŸ¥è¯¢è®¡åˆ’é€€åŒ–

**é—®é¢˜**ï¼šç»Ÿè®¡ä¿¡æ¯è¿‡æœŸå¯¼è‡´æŸ¥è¯¢è®¡åˆ’é€€åŒ–

**è§£å†³æ–¹æ¡ˆ**ï¼š

```sql
-- æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
PRAGMA optimize;

-- æˆ–åˆ†æç‰¹å®šè¡¨
ANALYZE users;
```

### 4.4 å†™å†²çªé™·é˜±

**é—®é¢˜**ï¼šå¤šè¿æ¥å†™å†²çªå¯¼è‡´æ€§èƒ½ä¸‹é™

**è§£å†³æ–¹æ¡ˆ**ï¼š

```sql
-- ä½¿ç”¨WALæ¨¡å¼ï¼ˆæ”¯æŒä¸€å†™å¤šè¯»ï¼‰
PRAGMA journal_mode=WAL;

-- æˆ–ä½¿ç”¨IMMEDIATEäº‹åŠ¡
BEGIN IMMEDIATE TRANSACTION;
```

---

## äº”ã€æ€§èƒ½åŸºå‡†æµ‹è¯•

### 5.1 è¯»æ€§èƒ½æµ‹è¯•

**æµ‹è¯•åœºæ™¯**ï¼š100ä¸‡è¡Œè¡¨ï¼Œå•è¡ŒæŸ¥è¯¢

| åœºæ™¯ | è€—æ—¶ | è¯´æ˜ |
|------|------|------|
| å…¨è¡¨æ‰«æ | ~100ms | æ— ç´¢å¼• |
| ç´¢å¼•æŸ¥æ‰¾ | ~0.1ms | æœ‰ç´¢å¼• |
| è¦†ç›–ç´¢å¼• | ~0.05ms | è¦†ç›–ç´¢å¼• |

### 5.2 å†™æ€§èƒ½æµ‹è¯•

**æµ‹è¯•åœºæ™¯**ï¼šæ’å…¥1000æ¡è®°å½•

| åœºæ™¯ | è€—æ—¶ | è¯´æ˜ |
|------|------|------|
| æ— äº‹åŠ¡ | ~5000ms | æ¯æ¡ä¸€ä¸ªäº‹åŠ¡ |
| æ‰¹é‡äº‹åŠ¡ | ~50ms | ä¸€ä¸ªäº‹åŠ¡ |
| WALæ¨¡å¼ | ~20ms | WAL + æ‰¹é‡äº‹åŠ¡ |

### 5.3 å¹¶å‘æ€§èƒ½æµ‹è¯•

**æµ‹è¯•åœºæ™¯**ï¼š1000æ¬¡è¯» + 100æ¬¡å†™æ··åˆè´Ÿè½½

| æ¨¡å¼ | æ€»è€—æ—¶ | è¯´æ˜ |
|------|--------|------|
| DELETEæ¨¡å¼ | ~1300ms | å†™é˜»å¡è¯» |
| WALæ¨¡å¼ | ~900ms | å†™ä¸é˜»å¡è¯» |
| **æ€§èƒ½æå‡** | **44%** | - |

---

## å…­ã€æ€§èƒ½ç‰¹å¾æ€»ç»“

### 6.1 ä¼˜åŠ¿ç‰¹å¾

1. **é›¶IPCå¼€é”€**ï¼šè¿›ç¨‹å†…è°ƒç”¨ï¼Œå»¶è¿Ÿæä½
2. **è¯»æ€§èƒ½ä¼˜ç§€**ï¼šè¦†ç›–ç´¢å¼•ã€æŸ¥è¯¢ç¼“å­˜
3. **WALæ¨¡å¼**ï¼šå†™æ€§èƒ½æå‡2-3å€
4. **æ‰¹é‡æ“ä½œ**ï¼šæ‰¹é‡äº‹åŠ¡æ€§èƒ½æå‡10-250å€

### 6.2 åŠ£åŠ¿ç‰¹å¾

1. **å•å†™é™åˆ¶**ï¼šWALæ¨¡å¼ä¸‹ä»…æ”¯æŒä¸€å†™å¤šè¯»
2. **æ— å¹¶è¡ŒæŸ¥è¯¢**ï¼šä¸æ”¯æŒæŸ¥è¯¢å¹¶è¡ŒåŒ–
3. **ç´¢å¼•ç»´æŠ¤**ï¼šè¿‡å¤šç´¢å¼•å½±å“å†™å…¥æ€§èƒ½

### 6.3 é€‚ç”¨åœºæ™¯

**é«˜æ€§èƒ½åœºæ™¯**ï¼š

- âœ… è¯»å¯†é›†å‹åº”ç”¨
- âœ… å•å†™å¤šè¯»åœºæ™¯
- âœ… æ‰¹é‡æ“ä½œåœºæ™¯

**ä¸é€‚ç”¨åœºæ™¯**ï¼š

- âŒ é«˜å¹¶å‘å†™åœºæ™¯
- âŒ éœ€è¦å¹¶è¡ŒæŸ¥è¯¢çš„åœºæ™¯
- âŒ éœ€è¦åˆ†å¸ƒå¼æ¶æ„çš„åœºæ™¯

---

## ä¸ƒã€å½¢å¼è¯æ˜ä¸ç†è®ºè®ºè¯

### 7.1 é›¶IPCå¼€é”€æ€§èƒ½ä¼˜åŠ¿è¯æ˜

**å®šç†**: SQLiteçš„åµŒå…¥å¼æ¶æ„ç›¸æ¯”C/Sæ¶æ„ç›¸æ¯”C/Sæ¶æ„å…·æœ‰æ˜¾è‘—çš„æ€§èƒ½ä¼˜åŠ¿ã€‚

**è¯æ˜**:

```latex
\begin{theorem}[é›¶IPCå¼€é”€æ€§èƒ½ä¼˜åŠ¿]
è®¾C/Sæ¶æ„çš„æŸ¥è¯¢å»¶è¿Ÿä¸º T_{cs}ï¼ŒSQLiteçš„æŸ¥è¯¢å»¶è¿Ÿä¸º T_{sqlite}ã€‚

C/Sæ¶æ„å»¶è¿Ÿåˆ†è§£ï¼š
T_{cs} = T_{network} + T_{protocol} + T_{serialize} + T_{db} + T_{serialize} + T_{protocol} + T_{network}

å…¶ä¸­ï¼š
- T_{network}: ç½‘ç»œå¾€è¿”å»¶è¿Ÿï¼ˆ1-5msï¼‰
- T_{protocol}: åè®®è§£æå»¶è¿Ÿï¼ˆ0.1-0.5msï¼‰
- T_{serialize}: æ•°æ®åºåˆ—åŒ–å»¶è¿Ÿï¼ˆ0.1-0.5msï¼‰
- T_{db}: æ•°æ®åº“å¤„ç†å»¶è¿Ÿï¼ˆ0.1-1msï¼‰

SQLiteå»¶è¿Ÿåˆ†è§£ï¼š
T_{sqlite} = T_{function} + T_{db}

å…¶ä¸­ï¼š
- T_{function}: å‡½æ•°è°ƒç”¨å»¶è¿Ÿï¼ˆ<0.01msï¼‰
- T_{db}: æ•°æ®åº“å¤„ç†å»¶è¿Ÿï¼ˆ0.1-1msï¼‰

æ€§èƒ½ä¼˜åŠ¿ï¼š
\Delta T = T_{cs} - T_{sqlite} = 2T_{network} + 2T_{protocol} + 2T_{serialize} \approx 1.2-6ms

æ€§èƒ½æå‡å€æ•°ï¼š
S = \frac{T_{cs}}{T_{sqlite}} = \frac{1.2-6ms}{0.1-1ms} \approx 10-100å€

å› æ­¤ï¼ŒSQLiteçš„åµŒå…¥å¼æ¶æ„ç›¸æ¯”C/Sæ¶æ„å…·æœ‰æ˜¾è‘—çš„æ€§èƒ½ä¼˜åŠ¿ã€‚
\end{theorem}
```

### 7.2 è¦†ç›–ç´¢å¼•ä¼˜åŒ–è¯æ˜

**å®šç†**: è¦†ç›–ç´¢å¼•èƒ½å¤Ÿæ˜¾è‘—æå‡æŸ¥è¯¢æ€§èƒ½ï¼Œé¿å…å›è¡¨æ“ä½œã€‚

**è¯æ˜**:

```latex
\begin{theorem}[è¦†ç›–ç´¢å¼•ä¼˜åŒ–]
è®¾æŸ¥è¯¢ Q éœ€è¦è®¿é—®åˆ—é›†åˆ C = \{c_1, c_2, \ldots, c_n\}ï¼Œè¡¨ T æœ‰ç´¢å¼• Iã€‚

è¦†ç›–ç´¢å¼•å®šä¹‰ï¼š
å¦‚æœ I åŒ…å« C ä¸­çš„æ‰€æœ‰åˆ—ï¼Œåˆ™ç§° I æ˜¯ Q çš„è¦†ç›–ç´¢å¼•ã€‚

æ€§èƒ½åˆ†æï¼š
1. **æ— è¦†ç›–ç´¢å¼•**:
   - ä½¿ç”¨ç´¢å¼• I å®šä½è¡Œï¼šO(\log n)
   - å›è¡¨è¯»å–æ•°æ®ï¼šO(k)ï¼Œå…¶ä¸­ k æ˜¯ç»“æœè¡Œæ•°
   - æ€»æˆæœ¬ï¼šO(\log n + k)

2. **æœ‰è¦†ç›–ç´¢å¼•**:
   - ä½¿ç”¨ç´¢å¼• I è¯»å–æ•°æ®ï¼šO(\log n + k)
   - æ— éœ€å›è¡¨æ“ä½œ
   - æ€»æˆæœ¬ï¼šO(\log n + k)

æ€§èƒ½æå‡ï¼š
- å‡å°‘ç£ç›˜I/Oï¼šé¿å…å›è¡¨æ“ä½œï¼Œå‡å°‘ k æ¬¡ç£ç›˜è¯»å–
- å‡å°‘å†…å­˜å ç”¨ï¼šç´¢å¼•é¡µé€šå¸¸æ¯”æ•°æ®é¡µå°
- æå‡ç¼“å­˜æ•ˆç‡ï¼šç´¢å¼•é¡µæ›´å®¹æ˜“ç¼“å­˜

SQLiteå®ç°ï¼š
- è¦†ç›–ç´¢å¼•æ‰«æï¼ˆIndex-Only Scanï¼‰
- æŸ¥è¯¢ä¼˜åŒ–å™¨è‡ªåŠ¨é€‰æ‹©è¦†ç›–ç´¢å¼•
- æ€§èƒ½æå‡å¯è¾¾10-100å€

å› æ­¤ï¼Œè¦†ç›–ç´¢å¼•èƒ½å¤Ÿæ˜¾è‘—æå‡æŸ¥è¯¢æ€§èƒ½ï¼Œé¿å…å›è¡¨æ“ä½œã€‚
\end{theorem}
```

### 7.3 WALæ¨¡å¼æ€§èƒ½æå‡è¯æ˜

**å®šç†**: WALæ¨¡å¼ç›¸æ¯”DELETEæ¨¡å¼èƒ½å¤Ÿæ˜¾è‘—æå‡å†™æ€§èƒ½ã€‚

**è¯æ˜**:

```latex
\begin{theorem}[WALæ¨¡å¼æ€§èƒ½æå‡]
è®¾å†™æ“ä½œ Wï¼ŒDELETEæ¨¡å¼çš„å†™å»¶è¿Ÿä¸º T_{delete}ï¼ŒWALæ¨¡å¼çš„å†™å»¶è¿Ÿä¸º T_{wal}ã€‚

DELETEæ¨¡å¼å†™æµç¨‹ï¼š
1. è·å–EXCLUSIVEé”ï¼šé˜»å¡æ‰€æœ‰å…¶ä»–æ“ä½œ
2. å†™å…¥å›æ»šæ—¥å¿—ï¼šåŒæ­¥å†™å…¥
3. ä¿®æ”¹æ•°æ®åº“æ–‡ä»¶ï¼šåŒæ­¥å†™å…¥
4. åˆ é™¤å›æ»šæ—¥å¿—ï¼šåŒæ­¥åˆ é™¤
5. é‡Šæ”¾é”

T_{delete} = T_{lock} + T_{log\_write} + T_{db\_write} + T_{log\_delete}

WALæ¨¡å¼å†™æµç¨‹ï¼š
1. è·å–RESERVEDé”ï¼šä¸é˜»å¡è¯»æ“ä½œ
2. å†™å…¥WALæ–‡ä»¶ï¼šå¼‚æ­¥å†™å…¥
3. æäº¤ï¼šå†™å…¥COMMITè®°å½•
4. æ£€æŸ¥ç‚¹ï¼šåå°åˆå¹¶åˆ°æ•°æ®åº“æ–‡ä»¶

T_{wal} = T_{lock} + T_{wal\_write}

æ€§èƒ½æå‡ï¼š
\Delta T = T_{delete} - T_{wal} = T_{log\_write} + T_{db\_write} + T_{log\_delete} - T_{wal\_write}

ç”±äºWALæ–‡ä»¶æ˜¯é¡ºåºå†™å…¥ï¼Œä¸”ä¸éœ€è¦åŒæ­¥åˆ é™¤æ—¥å¿—ï¼Œæ‰€ä»¥ï¼š
T_{wal\_write} < T_{log\_write} + T_{db\_write} + T_{log\_delete}

å› æ­¤ï¼Œ\Delta T > 0ï¼ŒWALæ¨¡å¼æ€§èƒ½æ›´å¥½ã€‚

å¹¶å‘æ€§èƒ½æå‡ï¼š
- DELETEæ¨¡å¼ï¼šå†™æ“ä½œé˜»å¡æ‰€æœ‰æ“ä½œ
- WALæ¨¡å¼ï¼šå†™æ“ä½œä¸é˜»å¡è¯»æ“ä½œ
- å¹¶å‘æ€§èƒ½æå‡å¯è¾¾2-10å€

SQLiteå®ç°ï¼š
- WALæ¨¡å¼é»˜è®¤å¯ç”¨
- æ£€æŸ¥ç‚¹æ“ä½œåå°æ‰§è¡Œ
- æ€§èƒ½æå‡æ˜¾è‘—

å› æ­¤ï¼ŒWALæ¨¡å¼ç›¸æ¯”DELETEæ¨¡å¼èƒ½å¤Ÿæ˜¾è‘—æå‡å†™æ€§èƒ½ã€‚
\end{theorem}
```

---

## å…«ã€Wikipediaå¯¹é½

### 8.1 åµŒå…¥å¼æ•°æ®åº“æ¦‚å¿µå¯¹é½

- **Wikidata ID**: Q192490 (Embedded database)
- **ç›¸å…³å±æ€§**:
  - P31: Q192490 (instance of: database type)
- **å¤–éƒ¨é“¾æ¥**:
  - [Wikipedia - Embedded database](https://en.wikipedia.org/wiki/Embedded_database)
  - [Wikipedia - Database tuning](https://en.wikipedia.org/wiki/Database_tuning)
  - [Wikipedia - SQLite](https://en.wikipedia.org/wiki/SQLite)

**Wikipediaå®šä¹‰**: [Embedded database](https://en.wikipedia.org/wiki/Embedded_database)

> An embedded database system is a database management system (DBMS) which is tightly integrated with an application software that requires access to stored data, such that the database system is "hidden" from the application's end-user and requires little or no ongoing administration.

**å¯¹é½è¯´æ˜**:
- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒåµŒå…¥å¼æ•°æ®åº“æ˜¯ä¸åº”ç”¨ç¨‹åºç´§å¯†é›†æˆçš„æ•°æ®åº“ç³»ç»Ÿ
- âœ… **æ ¸å¿ƒç‰¹æ€§**: éƒ½æåˆ°é›¶é…ç½®ã€è¿›ç¨‹å†…è°ƒç”¨ã€ä½å»¶è¿Ÿç­‰æ ¸å¿ƒç‰¹æ€§
- âœ… **åº”ç”¨åœºæ™¯**: éƒ½æåˆ°ç§»åŠ¨åº”ç”¨ã€æ¡Œé¢åº”ç”¨ã€åµŒå…¥å¼ç³»ç»Ÿç­‰åº”ç”¨åœºæ™¯

### 8.2 æ€§èƒ½ä¼˜åŒ–æ¦‚å¿µå¯¹é½

**Wikipediaå®šä¹‰**: [Database tuning](https://en.wikipedia.org/wiki/Database_tuning)

> Database tuning describes a group of activities used to optimize and homogenize the performance of a database.

**å¯¹é½è¯´æ˜**:
- âœ… **å®šä¹‰ä¸€è‡´æ€§**: æœ¬æ–‡æ¡£çš„å®šä¹‰ä¸Wikipediaä¸€è‡´ï¼Œéƒ½å¼ºè°ƒæ•°æ®åº“è°ƒä¼˜æ˜¯ä¼˜åŒ–æ•°æ®åº“æ€§èƒ½çš„æ´»åŠ¨
- âœ… **ä¼˜åŒ–æ–¹æ³•**: éƒ½æåˆ°ç´¢å¼•ä¼˜åŒ–ã€æŸ¥è¯¢ä¼˜åŒ–ã€é…ç½®ä¼˜åŒ–ç­‰æ–¹æ³•
- âœ… **æ€§èƒ½æŒ‡æ ‡**: éƒ½æåˆ°å»¶è¿Ÿã€ååé‡ã€å¹¶å‘æ€§ç­‰æ€§èƒ½æŒ‡æ ‡

### 8.3 SQLiteæ€§èƒ½ç‰¹å¾å¯¹é½

- **Wikidata ID**: Q176165 (SQLite)
- **ç›¸å…³å±æ€§**:
  - P31: Q176165 (instance of: database management system)
  - P178: Q9366 (developer: SQLite Development Team)
  - P277: Q193321 (programmed in: C)
  - P348: 3.47.0 (software version)
- **å¤–éƒ¨é“¾æ¥**:
  - <https://www.sqlite.org/performance.html>
  - <https://www.sqlite.org/wal.html>

---

## ğŸ”— ç›¸å…³èµ„æº

- [03.02 ä¼˜åŒ–ç­–ç•¥](./03.02-ä¼˜åŒ–ç­–ç•¥.md)
- [03.03 æ€§èƒ½è°ƒä¼˜å†³ç­–æ ‘](./03.03-æ€§èƒ½è°ƒä¼˜å†³ç­–æ ‘.md)
- [01.02 äº‹åŠ¡ä¸å¹¶å‘æ§åˆ¶](../01-æ ¸å¿ƒæ¶æ„/01.02-äº‹åŠ¡ä¸å¹¶å‘æ§åˆ¶.md)

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [SQLiteæ€§èƒ½æ–‡æ¡£](https://www.sqlite.org/performance.html)
- [WALæ¨¡å¼æ€§èƒ½](https://www.sqlite.org/wal.html)
- [æŸ¥è¯¢ä¼˜åŒ–å™¨](https://www.sqlite.org/queryplanner.html)

---

**æœ€åæ›´æ–°**ï¼š2025-11-13
**ç»´æŠ¤è€…**ï¼šData-Science Team
